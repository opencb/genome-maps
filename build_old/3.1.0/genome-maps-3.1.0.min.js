function Event(a){this._sender=a;this._listeners=[]}Event.prototype={addEventListener:function(a){return this._listeners.push(a)-1},removeEventListener:function(a){this._listeners.splice(a,1)},attach:function(a){this._listeners.push(a)},notify:function(a){for(var b=0;b<this._listeners.length;b++)this._listeners[b](this._sender,a)}};
var SVG={create:function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a),d;for(d in b)c.setAttribute(d,b[d]);return c},addChild:function(a,b,c,d){var b=document.createElementNS("http://www.w3.org/2000/svg",b),e;for(e in c)b.setAttribute(e,c[e]);return this._insert(a,b,d)},addChildImage:function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","image"),e;for(e in b)"xlink:href"==e&&d.setAttributeNS("http://www.w3.org/1999/xlink","href",b[e]),d.setAttribute(e,b[e]);
return this._insert(a,d,c)},_insert:function(a,b,c){if(null==c)a.appendChild(b);else{var d=c+1;0==c&&(d=0);(c=a.childNodes[d])?a.insertBefore(b,c):a.appendChild(b)}return b},init:function(a,b){return this.addChild(a,"svg",b)}},Normalizer=new function(){this.normalizeArray=function(a){return this.standardizeArray(this.normal(a))};this.normal=function(a){var b=this._getMean(a),c=this._getStdDeviation(a);this._getMaxAndMin(a);for(var d=[],e=0;e<a.length;e++)0!=c?d.push((a[e]-b)/c):d.push(a[e]);return d};
this.standardizeArray=function(a){for(var b=this._getMaxAndMin(a),c=b[0],b=b[1],c=0>=c?Math.abs(c):-1*c,d=[],e=0;e<a.length;e++)0!=b+c?d.push((a[e]+c)/(b+c)):d.push(a[e]+c);return d};this._getMean=function(a){for(var b=0,c=0;c<a.length;c++)b+=parseFloat(a[c]);return b/a.length};this._getStdDeviation=function(a){for(var b=this._getMean(a),c=0,d=0;d<a.length;d++)c+=Math.pow(parseFloat(a[d])-b,2);return Math.sqrt(c/a.length)};this._getMaxAndMin=function(a){for(var b=Number.MAX_VALUE,c=Number.MIN_VALUE,
d=0;d<a.length;d++)a[d]<b&&(b=parseFloat(a[d])),a[d]>c&&(c=parseFloat(a[d]));return[b,c]}},Colors=new function(){function a(){var b=0,c=0,d=0,e=0,f=0,g=0;this.SetRGB=function(a,j,k){b=a/255;c=j/255;d=k/255;a=Math.max(Math.max(b,c),d);j=Math.min(Math.min(b,c),d);g=a;f=0;0!=a&&(f=1-j/a);e=0;j!=a&&(j=a-j,e=b==a?(c-d)/j:c==a?2+(d-b)/j:4+(b-c)/j,e*=60,0>e&&(e+=360))};this.Red=function(){return Math.round(255*b)};this.Green=function(){return Math.round(255*c)};this.Blue=function(){return Math.round(255*
d)};this.SetHSV=function(a,j,k){e=a;f=j;g=k;d=c=b=g;if(!(0==g||0==f)){var j=e/60,a=Math.floor(j),l=j-a,j=g*(1-f),k=g*(1-f*l),l=g*(1-f*(1-l));switch(a){case 0:b=g;c=l;d=j;break;case 1:b=k;c=g;d=j;break;case 2:b=j;c=g;d=l;break;case 3:b=j;c=k;d=g;break;case 4:b=l;c=j;d=g;break;default:b=g,c=j,d=k}}};this.Hue=function(){return e};this.Saturation=function(){return f};this.Value=function(){return g};this.SetHexString=function(a){if(null==a||"string"!=typeof a)this.SetRGB(0,0,0);else if("#"==a.substr(0,
1)&&(a=a.substr(1)),6!=a.length)this.SetRGB(0,0,0);else{var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),a=parseInt(a.substr(4,2),16);isNaN(b)||isNaN(c)||isNaN(a)?this.SetRGB(0,0,0):this.SetRGB(b,c,a)}};this.HexString=function(){var a=this.Red().toString(16);1==a.length&&(a="0"+a);var b=this.Green().toString(16);1==b.length&&(b="0"+b);var c=this.Blue().toString(16);1==c.length&&(c="0"+c);return("#"+a+b+c).toUpperCase()};this.Complement=function(){var b=180<=e?e-180:e+180,c=g*(f-1)+1,
d=g*f/c,l=new a;l.SetHSV(b,d,c);return l}}this.hashColor=[];this.getColorByScoreArrayValue=function(a){for(var c=[],d=0;d<a.length;d++){var e=this.getColorByScoreValue(a[d]);c.push(e)}return c};this.getHexStringByScoreArrayValue=function(a){for(var a=this.getColorByScoreArrayValue(a),c=[],d=0;d<a.length;d++)c.push(a[d].HexString());return c};this.getColorByScoreValue=function(a){var c=a.toString().substr(0,4);if(null!=this.hashColor[c])return this.hashColor[c];if(isNaN(a))return Colors.ColorFromRGB(0,
0,0);var d,e,f;0.5>a?(e=Colors.ColorFromRGB(0,0,255),f=Colors.ColorFromRGB(255,255,255),d=2*a):(e=Colors.ColorFromRGB(255,255,255),f=Colors.ColorFromRGB(255,0,0),d=2*a-1);a=d;d=1-d;e=Colors.ColorFromRGB(d*e.Red()+a*f.Red(),d*e.Green()+a*f.Green(),d*e.Blue()+a*f.Blue());return this.hashColor[c]=e};this.ColorFromHSV=function(b,c,d){var e=new a;e.SetHSV(b,c,d);return e};this.ColorFromRGB=function(b,c,d){var e=new a;e.SetRGB(b,c,d);return e};this.ColorFromHex=function(b){var c=new a;c.SetHexString(b);
return c}},Utils={characters:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",formatNumber:function(a){return a.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},formatText:function(a,b){a=a.replace(RegExp(b,"gi")," ");return a=a.charAt(0).toUpperCase()+a.slice(1)},getZoomByRegion:function(a,b){return this.getZoomByPixelBase(this.getPixelBaseByRegion(a,b))},getPixelBaseByZoom:function(a){a=Math.max(0,a);a=Math.min(100,a);return 10/Math.pow(2,20-a/5)},getZoomByPixelBase:function(a){a=
Math.max(0,a);a=Math.min(10,a);return 100-5*(Math.log(10/a)/Math.log(2))},getPixelBaseByRegion:function(a,b){return a/b.length()},calculatePixelBaseAndZoomByRegion:function(a){var b=this.regionLength(a.region),c=a.width/b,d=parseInt(a.width/10);b<d&&(c=this.getPixelBaseByZoom(a.zoom),b=this.centerPosition(a.region),d=Math.ceil(d/2-1),a.region.start=Math.floor(b-d),a.region.end=Math.floor(b+d));return{pixelBase:c,zoom:this.getZoomByPixelBase(c)}},isString:function(a){return"string"===typeof a||a instanceof
String},parseDate:function(a){return a.substring(0,4)+" "+a.substring(4,6)+" "+a.substring(6,8)+", "+a.substring(8,10)+":"+a.substring(10,12)+":"+a.substring(12,14)},genId:function(a){a=a||"";a=0==a.length?a:a+"-";return a+this.randomString()},randomString:function(a){for(var a=a||10,b="",c=0;c<a;c++)b+=this.characters.charAt(this.getRandomInt(0,this.characters.length-1));return b},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},endsWithIgnoreCase:function(a,b){return RegExp("^.*\\.("+
b+")$","i").test(a)},endsWith:function(a,b){return RegExp("^.*\\.("+b+")$").test(a)},randomColor:function(){for(var a="",b=0;6>b;b++)a+=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f"][Math.floor(16*Math.random())];return"#"+a},getSpeciesFromAvailable:function(a,b){for(var c=0;c<a.items.length;c++)for(var d=a.items[c].items,e=0;e<d.length;e++){var f=d[e];if(this.getSpeciesCode(f.text)==b)return f}},getSpeciesCode:function(a){a=a.split(" ");return(a[0].charAt(0)+a[1]).toLowerCase()},test:function(){return this},
images:{add:"data:image/gif;base64,R0lGODlhEAAQAIcAAD2GNUKNNkOPOESMO0WNPEmPP0iNQUmPQlOVTFWWTVCZQVeeRV6cVmGeWGSgVWSgV2aiWGejW2WrVWirU2uqWGqsW2yqWm61WG+1WG+1WXS3W3S3XHC4WXK5W3O6XHG+X3asZ3iuaHe8YHi0ZH+yany6ZH28Zn2+Z3m9bn25an25a3+5bUD/QHDBY3nBZHrGa3zDa37BaX7Hb4K1boO1boa3cYi4d4y7doq5eYm+eI2+e5O/f4HMdYbJeobJfIXNeYrCeY/CfYnIf4rPfZW/gozLgY7MhI7Sg5LFgJXAgpfHhZfMhZPNiJjLhpjMh5jMipvBl5vBmJTTipbTiZXUipbUi5fVi5nRi53YkqTOlKbPlqbQlqDZlaDZlqXbm6rUnavUnKbIoKfJoa/fpa/fprPZpbTZpbTaprLbqLPdqbXbqLfaqrTdqrXfrLbdrLjVr7jdr7vcr7rWsbfgr77itr3ktsTcuMXducXowMvmw87pydTrz9fu0tzx2ODy3P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAACwALAAAAAAQABAAAAi/AFkIHEiwoME7SWrMwCHH4MAdWfLs0QNnRQiHN+L4qeOlyxg8QCAU3LGmDxYmRqpQOTJHRYSBdpTw4SJFyJ8/P2DIaLNAjEAibsgU8YHiZgURHq4gaSCQBh0rPW5K/cMhxpcCAkmkGcJj6k0OJ8AMEGjjyZQXLSR85dBhiY4EAt9MYOPig4ivFzacEQBlIIgUaJByyIBBQxkLBwo6GKHGiYkSTcxQAODwgYIgW7TkCGDAocAwDAoQQBDFs2mCAQEAOw==",
del:"data:image/gif;base64,R0lGODlhEAAQAIcAAED/QLpSNL9TOr5WOb5cQL9cQMFNM8RQNMBVPcBZP8xSPNBPPttWS9ddUcJnTMRkTMdrVM1gUc5iVMxmVclrVs1oWNZgVNZuZNtpZdxraN5ratxuadRxZd14c955dOZWTOZYTOZZTulZTelbT+ZWUOZaUuddWepcUOxfVOBlXO5mUuljW+pmXO5qXvBkVvNzXeNrYeNuY+FvcOJwZuJ7deR4ceJ5eeN4eeJ/feN/fOl7cOh6del/ePJ3Y/N5Y+qDfe6Efe+Gfu6KdfaCaPaEbPCFcPCDe/CMd/GOeviGcPiMdvCRf/eRfveTfvmSfvqTf/iUf9ymltynl+6Mge2Tju6Sj/SOgfqah/qdi/GclvGdluGpnvSgnvSinvWjn/qjkfupnPqrneGroOqwrOuzr/Ono/WmoferofarovWsofWvpfKtqvivpPS0qvi2qPm5r/q6rvC1tfC2tvjDvvzHuvnLxPnTzPzUzf3b1P3c2P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAAALAAAAAAQABAAAAi6AAEIHEiwoEE5ODRk8EDG4EAbVObYqdNmxgWHMtbkgfMFCxg6OiQUvFEGz5UlSKA4UeImRoWBcX7cwdJECJGbRHywWSBGYA41YY6gGEq0hxUeFARuePOkiJ6nUEW00IJAIIYzSYZAjcoiywCBHaYweSGirNkRRmg8EDiGARoXKsyKAFHCy4EoAznASIPihIgQH0h0sVCgYIQUZoKsMAGES4MADico2FGlSg0DBBwK3AIhgQAHUjSLJhgQADs=",
enable:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAKfSURBVDjLpZPrS1NhHMf9O3bOdmwDCWREIYKEUHsVJBI7mg3FvCxL09290jZj2EyLMnJexkgpLbPUanNOberU5taUMnHZUULMvelCtWF0sW/n7MVMEiN64AsPD8/n83uucQDi/id/DBT4Dolypw/qsz0pTMbj/WHpiDgsdSUyUmeiPt2+V7SrIM+bSss8ySGdR4abQQv6lrui6VxsRonrGCS9VEjSQ9E7CtiqdOZ4UuTqnBHO1X7YXl6Daa4yGq7vWO1D40wVDtj4kWQbn94myPGkCDPdSesczE2sCZShwl8CzcwZ6NiUs6n2nYX99T1cnKqA2EKui6+TwphA5k4yqMayopU5mANV3lNQTBdCMVUA9VQh3GuDMHiVcLCS3J4jSLhCGmKCjBEx0xlshjXYhApfMZRP5CyYD+UkG08+xt+4wLVQZA1tzxthm2tEfD3JxARH7QkbD1ZuozaggdZbxK5kAIsf5qGaKMTY2lAU/rH5HW3PLsEwUYy+YCcERmIjJpDcpzb6l7th9KtQ69fi09ePUej9l7cx2DJbD7UrG3r3afQHOyCo+V3QQzE35pvQvnAZukk5zL5qRL59jsKbPzdheXoBZc4saFhBS6AO7V4zqCpiawuptwQG+UAa7Ct3UT0hh9p9EnXT5Vh6t4C22QaUDh6HwnECOmcO7K+6kW49DKqS2DrEZCtfuI+9GrNHg4fMHVSO5kE7nAPVkAxKBxcOzsajpS4Yh4ohUPPWKTUh3PaQEptIOr6BiJjcZXCwktaAGfrRIpwblqOV3YKdhfXOIvBLeREWpnd8ynsaSJoyESFphwTtfjN6X1jRO2+FxWtCWksqBApeiFIR9K6fiTpPiigDoadqCEag5YUFKl6Yrciw0VOlhOivv/Ff8wtn0KzlebrUYwAAAABJRU5ErkJggg==",
warning:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAIsSURBVDjLpVNLSJQBEP7+h6uu62vLVAJDW1KQTMrINQ1vPQzq1GOpa9EppGOHLh0kCEKL7JBEhVCHihAsESyJiE4FWShGRmauu7KYiv6Pma+DGoFrBQ7MzGFmPr5vmDFIYj1mr1WYfrHPovA9VVOqbC7e/1rS9ZlrAVDYHig5WB0oPtBI0TNrUiC5yhP9jeF4X8NPcWfopoY48XT39PjjXeF0vWkZqOjd7LJYrmGasHPCCJbHwhS9/F8M4s8baid764Xi0Ilfp5voorpJfn2wwx/r3l77TwZUvR+qajXVn8PnvocYfXYH6k2ioOaCpaIdf11ivDcayyiMVudsOYqFb60gARJYHG9DbqQFmSVNjaO3K2NpAeK90ZCqtgcrjkP9aUCXp0moetDFEeRXnYCKXhm+uTW0CkBFu4JlxzZkFlbASz4CQGQVBFeEwZm8geyiMuRVntzsL3oXV+YMkvjRsydC1U+lhwZsWXgHb+oWVAEzIwvzyVlk5igsi7DymmHlHsFQR50rjl+981Jy1Fw6Gu0ObTtnU+cgs28AKgDiy+Awpj5OACBAhZ/qh2HOo6i+NeA73jUAML4/qWux8mt6NjW1w599CS9xb0mSEqQBEDAtwqALUmBaG5FV3oYPnTHMjAwetlWksyByaukxQg2wQ9FlccaK/OXA3/uAEUDp3rNIDQ1ctSk6kHh1/jRFoaL4M4snEMeD73gQx4M4PsT1IZ5AfYH68tZY7zv/ApRMY9mnuVMvAAAAAElFTkSuQmCC",
edit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB80lEQVR42o2T30tTURzArb8ioiAI6kHoZeF7CGE/IISCUDNCqAeL3rIWPfSwByskYUEJIhSChBhJFAiNqMVYPqRuc4tcW3NLt3C7u3d3d3c/+nS+0GRK0134cC6c8/ncc+7ltgFt6jqgcCg6duGQYq84deoBR6lU0iqVSq1arfI/1Dxut3u0Htke6BC5UChgmuYm+XyeXC5HOp1GIsnQNJHJi3x/7WJh/CSLT9r7Rd4jAVlgWRa2bSOjYBgGmqaRyWQwkq9Y8wyhLb0BI0VuaRrfo671xoDIwmakWCyi6zrr36bILt/HXp1l7cNDioEZqnEvgYmr1paAOgYy1u/l3NrqHNngPWpFL8XodTa+3CD8YoCvz/o078i5o1sC29FT78kG7lCzfJgrl7ESvejLThLPuxk8fbhP3KaBVFCdeX7on9yP9bOHfPAu0bEzmKkg4jQNpEKzhOduqW1/xIoNUEpcQlM7WXl6Cj39Q9Y0D4Q/TRJ662Tx3WOS/guYsV42Fm4THe/G/B2T97Jz4OVwJ+hxImPn8Tj381k91TfShfErIvLuAde1Y9g+N7Z/FL/rBDODR8gmgpTL5To7B3o69zF8pR3Pg7PMT90kn47LJ22kaeCPghapidP4Lxy3bduUiVZktdaQH7AxcFAiUm0Rhzji/gUhbp0s2Zf2xwAAAABJRU5ErkJggg==",
info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJ1SURBVHjafJJdSJNhFMd/z3QzLWdZrnQmSA2DPqRCK4KuhIq66kLoAy/qoqCguqqL6JsgLwoKKhCMSIy6CDKKRFZZYYQRVhJl02nWmG5uc19u7/vuPV0lW7QOnIsHnt+P8z/Pg4gw26aZ0263uzEUCn2IxWJjXq/3JqBETLIZ8gkePLhfKyKy/Z5HHJf7xe0Jic/n65mejizPK0inUiSTKUSE0dHRhxf6JoSDb4Rjr4QDz0REJBgMtmczFrJKKYVSCjCYnPR/W1FuAwQSGjbHXAA0LRXKZnIm0NJpgAKvd/hSOBz2iIj0eiPS2vtDYsmUPH/uPg9YshklIrOyCb+/eUG5ve3au5C99W2AqGbgKivk8R4X1lSkv2pJZaNmmBQVWWeZnAiGoa+3KovdyBjsW2kn/SvK4Jcgtaf7cDqrGkQMUDkBcgXVS2tOHjp8dG2jOXT1yo5lYOpgFTB0wKTAOqdQMlqOoDD7EE8kREwGXr/oWTg4HjxONAklBayuKSUeT/hFTxrwnwlAMa8I1qyrP3H95RiQgUiC/RsWM+wZ6jIME0M38wtSM0mmojM4nc6mzr5xKDQgnWb/pmoedT29EU3pTMUS+QVKKerq6kqnI3EVHwmAplO8qBh7WTFnzpz9bOg6FovlfxGEixfOrfT6YxCOQ1rDUaIAG4EJ38+PAwNb/95Bzj8ITAZwLHbMT0yHw3N33YVwEnQDqss41VzPkaalX6Iz+m6Xy/Xp34JAAICR7187nLWuvbe6h9C0DA2uRTTVV9J++87OlpaWJxUVFf9+xj+1cfOWls6OO93Nq1zblMVm9flG3pcvXNPm90+E/777ewB+UIqdqtYXHAAAAABJRU5ErkJggg==",
bucket:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90BCg4hBcbCoOMAAABsSURBVDjLY2RgYFBjYGCIZCAPLGeBam4g0wAGJgYKARMDA8NZCvSfZYQy6sk0oJEFiUNqODRQLQxGDYCAb2To/YZswEsyDHiJbMAHMgz4gO6F5aTkQpgXYElZkoGBgZeEbL2cgYHhMwMDw3MA93ARk+mSg4gAAAAASUVORK5CYII=",dir:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsSAAALEgHS3X78AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKNJREFUeNrEk7sNwkAQBefQ5m6BTiAAQssZiMh0QFUIMrAEpKYD8ynAJeD4nXQEkJHgu4CXv9GsdteFEEjJgMQ4gPli+aWx227cLwAD8FK8QZ4XTyCL6B6qal+YlzLgCpSn87HpbTCdzAKwAkpg1Bdgn/nbmDLQmby6hC3W5qUGGEcCGpNUJwBq09tgHdO+Pe61eamNvIMLgEkaxuoDuL9/42sAM20/EZafbV8AAAAASUVORK5CYII=",
r:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB90CDRIvNbHTpbwAAADjSURBVDjLpZFBbsIwEEUfVRZYahcVK3qKXoauMFK5C91nkyUB+xC5BqeAA7SKq1B5ugl2EiC04UkjayzN17NnROTRWvvJFbTWL8CBHqbGWOlSlqVkWSbGWAGm3aGHZiMiAByPP6FOd1rP2W7NvhvSCvDe10E+VJPFQpPnm1ZIcsmgPgJVVZGmaejX63y/XL4/AV/JJYPTCeDcN7PZWyuwKAqA8wARqSsGKDVGqXGjV8H07AnRQPq21TK8+YSBAQMN4hb6Df7wB/5eA+4zmEyehxk451itPrhFksSxUeP+lf+z+wXwdayJk/mqtgAAAABJRU5ErkJggg==",
box:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwRAVvTmTAAAAK/SURBVDjLpZM9bFxFGEXPNzPvZ+39sb2xHceREjDQBwlDCqqIiiotokAghYKEjvSkQkKJkEiB0lOkoAHaBAokFCQKUATIIOLIMbHWrHfX+7zvvZk3MzQODUgU3PJK5+g2F/5n5N/Kb66/1NNK3hAxr4HcFqVuvfju18V/Cu58sPmMVnJZ4K32Qr+t8za+KnCz4kCUuiGibm5euTv5h+CL958/nxj1XivVF+e6C9TVhPmFdbROgEhwNU1d4m09UaJuInLjhct3DgDUh5ee7j14PLxulLvYP/0seadPkub88Wib0eB3bDkmxgbRoFPpxeCuKvjsyQIzOyqImT7/y8Mh++NveW7jLFmrx6m1NlWxz6PHA7otQ7tloAmYJE9isOeeCJRtIrULLLUTjsqG7+//xs72z7jZgCTNONlVJKEiuobW0jqSaoiet19dFQATJcc2FSFEciNoLYwOHcPDASvdjM5cQntxlbR9gqacoFSK84VsnOrkH11Zdmp0FFXjobSeCFgXSDS0Eo11ge7yGXSaU092UUlCaEpC8FK4tDcu4rzZ2a/S+bWI94HSAgFigDQD24Cvp4gIOp0juBJvC2L07B1Uc/Mtg9k7sHMbywZrA3lLECV4AtaCpAp79CcmzXHlhOBrAJrGyNbOVBY7qTO1C9r5EKyPSttAiJEs01SuQStFkrdp6gKd5AzHjixVxCDxp+1paZRUxoc4Kp36bndYbS53U5WlCq0CMYIPMY7GI0mNpiqmGK0oK4jIveGkPgRqfTBt3A8Pqtvrq52HtglnGh9XIaKUkCQ6nj6RyWBsmdXCtFI/bu2Fq5c+3roGzIAgWokCDNACOhfOLb781Ip+vd+RC2dXWibROkxKvvp1z376yZe7d4HpMdz8/YVjiQYyoA30Ti6la2++0n/n83vTW/e3ix1gcgzXgPchBoC/AFu/UBF5InryAAAAAElFTkSuQmCC",
bluebox:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMHAwTE5pcivoAAALsSURBVDjLXZPPaxxlGMc/77wz+3N2k822tWsTIrQFe/BWEKxKCV5UohdFhJ60p6rgUfpP6C0K4kHx0ENEkV7aElHwUikhFVosRGoTm83+3pnZnXfed2beHtItIQ98+Z6+H57nga8AsNYKDkYcEofcHvKZEEJYcSTszPzqL3fmf3+w/+a51tytby9d6D0N5UecGeBZ8MPv/jh9fy/6dKzMpVPHmvWdbl/XCvKn5Wbl6+ufrNwGssMgYa2VgFj58sZr7VB/LqX3zlKrydJzTTzXxdqcx90hO+0Bk2l8Z74i1z6+cOba5VfOqGeAb3579M/NR53T40xwrDGHFALPEUjn4LoMi0ktwWTKXqCIqAVrbyycvHj2hHYBR+bO8Q/Ov0imEzZ2xrRDRalQwC9LLBalUgaJQy+tU6gvIBJbv3j2RA4IFxDdICFa9ulMCrz/UgOs5kEwpeh57I4Nt/dzsmLOYlEThgFjUePp33IHoD9SJAbuTVyudRweixJvnVtg3/i00wpLPiwQ0hkO6YYKawWj0UjONqAfKHwDkxTqqeW/RHA3hO2+Zqk05e5wTD9KmOqMKDEUqoLNzU0PyF2AQaBoaIhiw0h6TIwgUDCODb5NiWJNlKREyhAozXwOW1tbFSmlcAHbD2KaytCdGgyWglfEs4LeNKeaa4axYRgpwlgTTTXVDDqdTslaewAYh4kNlKUbZsTGonOwCYwm1vq5Ft1AMYgU08SQR5o0gziOcRxHuoCNtdl6uPHX6/Vmi3Yyh9I5IoEgMdkgT9x+qJhEGrdQo77cJMuy+4DJskwLa60DOCtf3HhZpfZKtVx+L3x+sfCv8CFxTINd72HfodQ4aQp5fP24/v/Hd4Nf/5RSJmma6lkXZn1wPvvq5qndsbhS9esf/Zy/UEtzxnURfn8+/fuHV7m353mecV1XSym1lDI72kaxvr5e3N7eruyP0tpG/e3LK/rW2mLNUb7vm3K5nFarVdNqtbJer2dXV1fzJ6cDpboAZRAGAAAAAElFTkSuQmCC",
refresh:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAK8AAACvABQqw0mAAAAAd0SU1FB90CFA8bKScXIjIAAAJ1SURBVDjLlVJdSJNRGH7es+/7NlduWFLTKAskwjJqZYiBglJhLKguqou6EFkFIkLQH9IPBFI3BsouzMJupGYRajcqmeBFhWBU5oUgpZikrSnzZ9v3nW/ndKEbziXUAwfOOe/7Puc9z/MCq1DwMmB1NX/rzfCNnsc/gK08lPgnnT8Cs33BULg0HI4YKdkHX9DqKwKArXXv1bTMTFcoyruC89E8MxaDw659t6rKhIUwRBLdP2t2v/5bBwQA+5pH8ibnIj3BucgWIQRASw8RERTGYFUtsGmWYUXKmqmr7t4UAnal54GQ8lq8MBlyOU0CEnA67MiwqfvHbhZ+Smgg6o9eV2L8Nhk6wI2lZeggrpvE+TTjxgxxQ4IbmJsJYSa00JQiotnguacJ8zIZOmDosAnzTpowt8tGj0s0ejZqprnDKmPHSNebjHDkUPatt4cTTbZ+LsmO79XK52dZxTNp9/ovAEDnaM62lo8HHrd9SVfiOelVryrSq9vrEx0s8sW2tuEzDgDgT875bcIsjy6owwAwHhjnYT5bGTL29PiHyuwAMO873aL/Ct5PiPjwXe5vq7KJW2hdJxENMFInGCkhIblLj80WRoyxGxZmh1XJGlSIlV8s6A8kuVDXn+MF6JHC7GBkBSNlOSRgiihMsQhAgJGGNNU1atc2HPG6O8YSBABwt2/nGyFlGSCSB4UIBMuyoQKMFNiUjIApRH5t8YfpFOOrO/JrhZBVUiJLxq2ipIkY8Z36uivpC6txqb3YbhqhIingFlLmxmLSKyXAGAaYqh13aFjfcHJwfE2ClSitK9psc85PMVC3M999orX4Kcf/wuPb27VW7A+O2QVVA1M1CQAAAABJRU5ErkJggg==",
newitem:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAtxJREFUeNqM0llIVHEUBvDv3vlfZ8ac6zZtWpmamtliUUHRDlFJWlEYLdBLtG/QBlFJQUTSU089RZRlG4EvkS9NlqkpldHyYLk1OurcOzp30vHO/y6nBwsSIvzgvBw+fpyHA8MwwDmHbdsjQwSbCACkYDBYp6pqU3Fxcfyf/Z+eYRjQOQf+Bnw+30IiIsMwhizL4n3lV6mn7BzZtm1yzn8SETU0NKz+J2ARobe3t85/+SI1506j9hOHqTEO9FYEtR/ZTx/n5FDH6eOkquoni2g00NjUtEzTtBYioneLCulVHKg2yUkNmelUn5VOtUlueu0SqDE/m4iIIpFI64fm5vU65xAMIlicR9rOn/UEKytgmQbYuARAEDAqRLCiQxBFhtTNWzDzxk1LcjgkFhuKIhLR2qJKcN5Al/q7reF/cXUHoA0MtA9Gh4klJIxz6ro+PZiVC0uOw1jimJEDWZbTDhw8lCi0+/3PtUeV696ePIPUnIwxAf3fOjG/7AK8e/e9ZH2K0uWdPRdivANm3NguED1OJBYWQunvDwgAXIqifO54+CC7/tSxMQELL11B/r6D3cnJybniQDis25Ikfn1wD2GdQLIMISkF5JFhudwgjwySkyCkpILkRER0wpf7d2FJkqSoapQRRPCYjoLDR+EY70VXbS2YxCC4nAARbAAQBJBlwTIMZJRsQN7W7eA6t9O8XkE0jRhWLV2y+Gdm9q0dT6rMhLw8dPn7EAoEMBSLIcpjCPUEEPD3gU1Kw+6qZ6TPKrizq3TbAjUUIkFRVYAIkkfG99bWp4P1b7Z0vq5BXtFGPN6zE6Zuo7SiAh01PkycV4jJRRt96VOmrOHhMESHiBEAgMkNlGwqmXC78mG1DXtQdruTgx/eF5g6x9Tly1pCmtYjMSnxatnFTeXXyn8wxiCMAgxz5EmcTjCXCynxblf1C9910eFwrl254nh/dDhqcQ5zeBgAwBiDIAr4NQAWJarVjshqqgAAAABJRU5ErkJggg=="},
genBamVariants:function(a,b,c,d){for(var e=a.length,f=b/6,g="",h=0;h<e;h++){switch(a.charAt(h)){case "A":g+="M"+(2.5*f+c)+","+d+"l-"+2.5*f+","+6*f+"l"+f+",0l"+0.875*f+",-"+2*f+"l"+2.25*f+",0l"+0.875*f+","+2*f+"l"+f+",0l-"+2.5*f+",-"+6*f+"l-"+0.5*f+",0l0,"+f+"l"+0.75*f+","+2*f+"l-"+1.5*f+",0l"+0.75*f+",-"+2*f+"l0,-"+f+" ";break;case "T":g+="M"+(0.5*f+c)+","+d+"l0,"+f+"l"+2*f+",0l0,"+5*f+"l"+f+",0l0,-"+5*f+"l"+2*f+",0l0,-"+f+" ";break;case "C":g+="M"+(5*f+c)+","+(0*f+d)+"l-"+2*f+",0l-"+2*f+","+2*f+
"l0,"+2*f+"l"+2*f+","+2*f+"l"+2*f+",0l0,-"+f+"l-"+1.5*f+",0l-"+1.5*f+",-"+1.5*f+"l0,-"+1*f+"l"+1.5*f+",-"+1.5*f+"l"+1.5*f+",0 ";break;case "G":g+="M"+(5*f+c)+","+(0*f+d)+"l-"+2*f+",0l-"+2*f+","+2*f+"l0,"+2*f+"l"+2*f+","+2*f+"l"+2*f+",0l0,-"+3*f+"l-"+1*f+",0l0,"+2*f+"l-"+0.5*f+",0l-"+1.5*f+",-"+1.5*f+"l0,-"+1*f+"l"+1.5*f+",-"+1.5*f+"l"+1.5*f+",0 ";break;case "N":g+="M"+(0.5*f+c)+","+(0*f+d)+"l0,"+6*f+"l"+f+",0l0,-"+4.5*f+"l"+3*f+","+4.5*f+"l"+f+",0l0,-"+6*f+"l-"+f+",0l0,"+4.5*f+"l-"+3*f+",-"+4.5*f+
" ";break;case "d":g+="M"+(0*f+c)+","+(2.5*f+d)+"l"+6*f+",0l0,"+f+"l-"+6*f+",0l0,-"+f+" ";break;default:g+="M0,0"}c+=b}return g}};
function HeaderWidget(a){var b=this;this.id="HeaderWidget"+Math.round(1E4*Math.random());this.targetId=null;this.height=67;this.accountData=null;this.appname="My new App";this.description="";this.suiteId=-1;this.news="";this.checkTimeInterval=4E3;"undefined"!=typeof a&&(this.appname=a.appname||this.appname,this.description=a.description||this.description,this.version=a.version||this.version,this.suiteId=a.suiteId||this.suiteId,this.news=a.news||this.news);this.adapter=new OpencgaManager;this.onLogin=
new Event;this.onLogout=new Event;this.onGetAccountInfo=new Event;this.loginWidget=new LoginWidget(this.suiteId);this.editUserWidget=new ProfileWidget;this.uploadWidget=new UploadWidget({suiteId:this.suiteId});this.projectManager=new ManageProjectsWidget({width:800,height:500,suiteId:this.suiteId});this.opencgaBrowserWidget=new OpencgaBrowserWidget({suiteId:this.suiteId});this.loginWidget.onSessionInitiated.addEventListener(function(){b.sessionInitiated();b.onLogin.notify()});this.projectManager.onRefreshProjectList.addEventListener(function(a,
d){b.userBarWidget.createProjectMenuItems(d)});this.adapter.onLogout.addEventListener(function(a,d){console.log(d);$.cookie("bioinfo_sid",null);$.cookie("bioinfo_sid",null,{path:"/"});$.cookie("bioinfo_account",null);$.cookie("bioinfo_account",null,{path:"/"});b.sessionFinished();b.onLogout.notify()});this.opencgaBrowserWidget.onNeedRefresh.addEventListener(function(){b.getAccountInfo()});this.adapter.onGetAccountInfo.addEventListener(function(a,d){if(d.accountId!=null){b.setAccountData(d);b.onGetAccountInfo.notify(d);
console.log("accountData has been modified since last call")}})}
HeaderWidget.prototype={setAccountData:function(a){this.accountData=a;this.opencgaBrowserWidget.setAccountData(a);Ext.getCmp(this.id+"textUser").setText(this._getAccountText())},getAccountInfo:function(){var a=null;null!=this.accountData&&(a=this.accountData.lastActivity);$.cookie("bioinfo_account")?this.adapter.getAccountInfo($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),a):(console.log("cookie: bioinfo_account, is not set, session will be finished..."),this.sessionFinished())},_getAccountText:function(){var a=
this.accountData.accountId;-1!=a.indexOf("anonymous_")&&(a="anonymous");return'logged in as <span style="color:darkred">'+a+"</span>"},sessionInitiated:function(){var a=this;this.loginWidget.clean();Ext.getCmp(this.id+"btnSignin").hide();Ext.getCmp(this.id+"btnLogout").show();Ext.getCmp(this.id+"btnEdit").show();Ext.getCmp(this.id+"btnOpencga").show();null==this.accountInfoInterval&&(this.getAccountInfo(),this.accountInfoInterval=setInterval(function(){a.getAccountInfo()},this.checkTimeInterval))},
sessionFinished:function(){Ext.getCmp(this.id+"btnOpencga").hide();Ext.getCmp(this.id+"btnLogout").hide();Ext.getCmp(this.id+"btnEdit").hide();Ext.getCmp(this.id+"btnSignin").show();Ext.getCmp(this.id+"textUser").setText("");clearInterval(this.accountInfoInterval)},setDescription:function(a){$("#"+this.id+"description").text(a)},draw:function(){this.render();null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished()},getPanel:function(){this.draw();return this.panel},setWidth:function(a){this.width=
a;this.getPanel().setWidth(a);this.getPanel().updateLayout()},render:function(){var a=this;if(null==this.panel){switch(this.suiteId){case 11:this.homeLink="http://renato.bioinfo.cipf.es";this.helpLink="http://bioinfo.cipf.es/docs/renato/";this.tutorialLink="http://bioinfo.cipf.es/docs/renato/tutorial";this.aboutText="";break;case 6:this.homeLink="http://variant.bioinfo.cipf.es";this.helpLink="http://docs.bioinfo.cipf.es/projects/variant";this.tutorialLink="http://docs.bioinfo.cipf.es/projects/variant/wiki/Tutorial";
this.aboutText="";break;case 9:this.homeLink="http://www.genomemaps.org";this.helpLink="http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:overview";this.tutorialLink="http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:tutorial";this.aboutText='Genome Maps is built with open and free technologies like HTML5 and SVG inline, so no plug-in is needed in modern internet browsers. We\u2019ve focused on providing the best user experience possible with a modern drag navigation and many features included.<br><br>Genome Maps project has been developed in the <b>Computational Biology Unit</b> led by <b>Ignacio Medina</b>, at <b>Computational Genomic Institute</b> led by <b>Joaquin Dopazo</b> at CIPF. Two people from my lab deserve special mention for their fantastic job done: <br><b>Franscisco Salavert</b> and <b>Alejandro de Maria</b>.<br><br>Genome Maps has been designed to be easily be embedded in any project with a couple of lines of code, and it has been implemented as a plugin framework to extend the standard features.<br><br>Supported browsers include: Google Chrome 14+, Apple Safari 5+, Opera 12+ and Mozilla Firefox 14+ (works slower than in the other browsers). Internet Explorer 10 is under RC and seems to work properly.<br><br>For more information or suggestions about Genome Maps please contact <br><b>Ignacio Medina</b>:  <span class="info">imedina@cipf.es</span>';
break;case 10:this.homeLink="http://www.cellbrowser.org";this.helpLink="http://docs.bioinfo.cipf.es/projects/cellbrowser";this.tutorialLink="http://docs.bioinfo.cipf.es/projects/cellbrowser/wiki/Tutorial";this.aboutText="";break;case 12:this.homeLink="http://bioinfo.cipf.es/apps/untbgen";this.tutorialLink=this.helpLink="http://bioinfo.cipf.es/ecolopy/";this.aboutText="";break;case 22:this.homeLink="http://pathiways.bioinfo.cipf.es";this.helpLink="http://bioinfo.cipf.es/pathiways";this.tutorialLink=
"http://bioinfo.cipf.es/pathiways/tutorial";this.aboutText='PATHiWAYS is built with open and free technologies like HTML5 and SVG inline, so no plug-in is needed in modern internet browsers<br><br>PATHiWAYS project has been developed in the <b>Computational Biology Unit</b>, at <b>Computational Medicine Institute</b> at CIPF in Valencia, Spain.<br><br>For more information please visit our web page  <span class="info"><a target="_blank" href="http://bioinfo.cipf.es">bioinfo.cipf.es</a></span>';break;
default:this.tutorialLink=this.helpLink=this.homeLink="http://docs.bioinfo.cipf.es",this.aboutText=""}var b=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"linkbar",dock:"top",cls:"bio-linkbar",height:40,minHeight:40,maxHeight:40,items:[{xtype:"tbtext",id:this.id+"appTextItem",text:'<span class="appName">'+this.appname+'</span> <span id="'+this.id+'description" class="appDesc">'+this.description+'</span><span class="appDesc" style="color:orangered;margin-left:20px">New version 3.1 beta2</span>',
padding:"0 0 0 10",listeners:{afterrender:function(){$("#"+a.id+"appTextItem").qtip({content:'<span class="info">'+a.version+"</span>",position:{my:"bottom center",at:"top center",adjust:{y:0,x:-25}}})}}},{xtype:"tbtext",id:this.id+"speciesTextItem",text:""},{xtype:"tbtext",id:this.id+"assemblyTextItem",text:""},"->",{id:this.id+"homeButton",text:"home",handler:function(){window.location.href=a.homeLink}},{id:this.id+"helpButton",text:"documentation",handler:function(){window.open(a.helpLink)}},{id:this.id+
"tutorialButton",text:"tutorial",handler:function(){window.open(a.tutorialLink)}},{id:this.id+"aboutButton",text:"about",handler:function(){Ext.create("Ext.window.Window",{id:a.id+"aboutWindow",bodyStyle:"background:#fff; color:#333;",bodyPadding:10,title:"About",height:340,width:500,modal:!0,layout:"fit",html:a.aboutText}).show()}}]}),c=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"userbar",dock:"top",border:!0,cls:"bio-userbar",height:27,minHeight:27,maxHeight:27,layout:"hbox",items:[{xtype:"tbtext",
id:this.id+"textNews",text:this.news},"->",{xtype:"tbtext",id:this.id+"textUser",text:""},{id:this.id+"btnOpencga",text:'<span class="emph">Upload & Manage</span>',iconCls:"icon-project-manager",handler:function(){a.opencgaBrowserWidget.draw("manager")}},{id:this.id+"btnSignin",text:'<span class="emph">sign in</span>',handler:function(){a.loginWidget.draw()}},{id:this.id+"btnEdit",text:'<span class="emph">profile</span>',handler:function(){a.editUserWidget.draw()}},{id:this.id+"btnLogout",text:'<span class="emph">logout</span>',
handler:function(){a.adapter.logout($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"))}}]});this.panel=Ext.create("Ext.panel.Panel",{id:this.id+"panel",region:"north",border:!1,renderTo:this.targetId,height:this.height,minHeight:this.height,maxHeigth:this.height,items:[c,b]})}}};
function UserListWidget(a){this.id="UserListWidget_"+Math.round(1E7*Math.random());this.data=[];this.args={};this.timeout=4E3;this.pagedViewList=a.pagedViewList;this.suiteId=-1;this.tools=[];if(null!=a&&(null!=a.timeout&&4E3<a.timeout&&(this.timeout=a.timeout),null!=a.suiteId&&(this.suiteId=a.suiteId),null!=a.tools))this.tools=a.tools}UserListWidget.prototype.draw=function(){var a=this;this.getResponse();this.interval=setInterval(function(){a.getResponse()},this.timeout)};
UserListWidget.prototype.getData=function(){return this.data};UserListWidget.prototype.getCount=function(){return this.data.length};UserListWidget.prototype.getResponse=function(){throw"abstract method must be implemented in child classes";};UserListWidget.prototype.render=function(){throw"abstract method must be implemented in child classes";};JobListWidget.prototype.draw=UserListWidget.prototype.draw;JobListWidget.prototype.getData=UserListWidget.prototype.getData;
JobListWidget.prototype.getCount=UserListWidget.prototype.getCount;
function JobListWidget(a){var b=this;UserListWidget.prototype.constructor.call(this,a);this.counter=null;this.pagedViewList.storeFields="commandLine date description diskUsage status finishTime inputData jobId message name outputData ownerId percentage projectId toolName visites".split(" ");this.pagedViewList.template='<tpl for=".">,<div class="joblist-item">,<p style="color:<tpl if="visites == 0">green</tpl><tpl if="visites &gt; 0">blue</tpl><tpl if="visites == -1">red</tpl><tpl if="visites == -2">Darkorange</tpl>">{name}</p>,<p style="color: #15428B"><i>{date}</i></p>,<p style="color:steelblue"><i>{toolName}</i></p>,<p style="color:grey"><i>,{status},<tpl if="visites &gt; -1"> - {visites} views</tpl>,</div>,</tpl>'.split(",");if(null!=
a.pagedViewList&&(null!=a.pagedViewList.storeFields&&(this.pagedViewList.storeFields=a.pagedViewList.storeFields),null!=a.pagedViewList.template))this.pagedViewList.template=a.pagedViewList.template;this.pagedListViewWidget=new PagedViewListWidget(this.pagedViewList);this.btnAllId=this.id+"_btnAll";this.btnActivePrjId=this.id+"_btnActivePrj";this.btnFinishedId=this.id+"_btnFinished";this.btnVisitedId=this.id+"_btnVisited";this.btnRunningId=this.id+"_btnRunning";this.btnQueuedId=this.id+"_btnQueued";
this.projectFilterButton=Ext.create("Ext.button.Button",{id:this.btnActivePrjId,iconCls:"icon-project-all",tooltip:"Toggle jobs from all projects or active project",enableToggle:!0,pressed:!1,listeners:{toggle:function(){b.render()}}});this.bar=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"jobsFilterBar",style:"border : 0",dock:"top",items:[{id:this.btnAllId,text:" ",tooltip:"Total jobs"},{id:this.btnFinishedId,text:" ",tooltip:"Finished jobs"},{id:this.btnVisitedId,text:" ",tooltip:"Visited jobs"},
{id:this.btnRunningId,text:" ",tooltip:"Running jobs"},{id:this.btnQueuedId,text:" ",tooltip:"Queued jobs"}]});Ext.getCmp(this.btnAllId).on("click",this.filter,this);Ext.getCmp(this.btnFinishedId).on("click",this.filter,this);Ext.getCmp(this.btnVisitedId).on("click",this.filter,this);Ext.getCmp(this.btnRunningId).on("click",this.filter,this);Ext.getCmp(this.btnQueuedId).on("click",this.filter,this);this.allData=[]}JobListWidget.prototype.draw=function(){};
JobListWidget.prototype.clean=function(){clearInterval(this.interval);!0==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).removeDocked(this.bar,!1);this.pagedListViewWidget.clean()};
JobListWidget.prototype.setAccountData=function(a){this.accountData=a;console.log("joblistwidget");for(var a=[],b,c=0;c<this.accountData.projects.length;c++)for(var d=0;d<this.accountData.projects[c].jobs.length;d++)b=this.accountData.projects[c].jobs[d],-1!=this.tools.indexOf(b.toolName)&&(b.date=Utils.parseDate(b.date),a.push(b));this.data=a;this.render()};
JobListWidget.prototype.render=function(){this.pagedListViewWidget.draw(this.getData());!1==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).addDocked(this.bar);var a=this.getJobCounter();0==a.all?Ext.getCmp(this.btnAllId).hide():Ext.getCmp(this.btnAllId).show();0==a.finished?Ext.getCmp(this.btnFinishedId).hide():Ext.getCmp(this.btnFinishedId).show();0==a.visited?Ext.getCmp(this.btnVisitedId).hide():Ext.getCmp(this.btnVisitedId).show();
0==a.running?Ext.getCmp(this.btnRunningId).hide():Ext.getCmp(this.btnRunningId).show();0==a.queued?Ext.getCmp(this.btnQueuedId).hide():Ext.getCmp(this.btnQueuedId).show();Ext.getCmp(this.btnAllId).setText('<b style="color:black;font-size: 1.3em;">'+a.all+"</b>");Ext.getCmp(this.btnFinishedId).setText('<b style="color:green;font-size: 1.3em;">'+a.finished+"</b>");Ext.getCmp(this.btnVisitedId).setText('<b style="color:blue;font-size: 1.3em;">'+a.visited+"</b>");Ext.getCmp(this.btnRunningId).setText('<b style="color:red;font-size: 1.3em;">'+
a.running+"</b>");Ext.getCmp(this.btnQueuedId).setText('<b style="color:Darkorange;font-size: 1.3em;">'+a.queued+"</b>")};JobListWidget.prototype.getJobCounter=function(){for(var a=0,b=0,c=0,d=0,e=0;e<this.getData().length;e++)0<this.getData()[e].visites?b++:(0==this.getData()[e].visites&&a++,-1==this.getData()[e].visites&&c++,-2==this.getData()[e].visites&&d++);return{all:this.getData().length,visited:b,finished:a,running:c,queued:d}};
JobListWidget.prototype.filter=function(a){switch(a.id){case this.btnFinishedId:this.pagedListViewWidget.setFilter(function(a){return 0==a.data.visites});break;case this.btnVisitedId:this.pagedListViewWidget.setFilter(function(a){return 0<a.data.visites});break;case this.btnRunningId:this.pagedListViewWidget.setFilter(function(a){return-1==a.data.visites});break;case this.btnQueuedId:this.pagedListViewWidget.setFilter(function(a){return-2==a.data.visites});break;default:this.pagedListViewWidget.setFilter(function(){return!0})}this.pagedListViewWidget.draw(this.getData())};
JobListWidget.prototype.selectProjectData=function(){if(this.projectFilterButton.pressed){for(var a=[],b=0;b<this.allData.length;b++)if(null!=this.allData[b].jobs)for(var c=0;c<this.allData[b].jobs.length;c++)a.push(this.allData[b].jobs[c]);this.data=a}else for(var b=0;b<this.allData.length;b++)if(this.allData[b].active){this.data=this.allData[b].jobs;break}null==this.data&&(this.data=[]);this.pagedListViewWidget.draw(this.getData())};DataListWidget.prototype.draw=UserListWidget.prototype.draw;
DataListWidget.prototype.getData=UserListWidget.prototype.getData;DataListWidget.prototype.getCount=UserListWidget.prototype.getCount;
function DataListWidget(a){UserListWidget.prototype.constructor.call(this,a);var b=this;this.pagedViewList.storeFields="commandLine creationTime dataFiles dataId date description diskUsage enabled finishTime jobId message multiple name organization ownerId percentage projectId responsible status statusMessage suiteId tags toolName visites write".split(" ");this.pagedViewList.template='<tpl for=".">;<div class="joblist-item">;<p><span>{name}</span><i style="color:green"> ({status}) </i></p>;<tpl for="dataFiles">;<p><i style="color:grey">{filename}</i><span style="color:blue"> {diskUsage}kB</span></p>;</tpl>;<tpl for="tags">;<span style="color:limegreen"> {.},</span>;</tpl>;<p><i>{creationTime}</i></p>;</div>;</tpl>'.split(";");
if(null!=a.pagedViewList&&(null!=a.pagedViewList.storeFields&&(this.pagedViewList.storeFields=a.pagedViewList.storeFields),null!=a.pagedViewList.template))this.pagedViewList.template=a.pagedViewList.template;this.pagedListViewWidget=new PagedViewListWidget(this.pagedViewList);this.adapter=new WumAdapter;this.adapter.onGetData.addEventListener(function(a,d){var e=null;try{e=JSON.parse(d)}catch(f){console.log("Data received is not a JSON valid."),e=[]}b.render(e)})}
DataListWidget.prototype.clean=function(){clearInterval(this.interval);this.pagedListViewWidget.clean()};DataListWidget.prototype.getResponse=function(){this.adapter.getData($.cookie("bioinfo_sid"),this.suiteId)};DataListWidget.prototype.render=function(a){this.data=a;this.pagedListViewWidget.draw(a)};
function PagedViewListWidget(a){var b=this;this._data=null;this.id="PagedViewListWidget_"+Math.round(1E4*Math.random());this.targetId=null;this.pageSize=6;this.storeFields={};this.template={};this.width=280;this.height=550;this.title="";this.border=this.order=0;this.mode="view";this.sort="DESC";if(null!=a&&(null!=a.pageSize&&(this.pageSize=a.pageSize),null!=a.storeFields&&(this.storeFields=a.storeFields),null!=a.template&&(this.template=a.template),null!=a.targetId&&(this.targetId=a.targetId),null!=
a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.title&&(this.title=a.title),null!=a.order&&(this.order=a.order),null!=a.border&&(this.border=a.border),null!=a.mode))this.mode=a.mode;this.currentPage=1;this.pageFieldId=this.id+"_pageField";this.pageLabelId=this.id+"_pageLabel";this.pagbarId=this.id+"_pagbar";this.panelId=this.id+"_panel";this.onItemClick=new Event(this);this.textFilterFunction=function(a){var d=Ext.getCmp(b.id+"searchField").getValue().toLowerCase();return 0>
a.data.name.toLowerCase().indexOf(d)?!1:!0}}PagedViewListWidget.prototype.getData=function(){return this._data};PagedViewListWidget.prototype._setData=function(a){this._data=a};PagedViewListWidget.prototype.setFilter=function(a){this.store.clearFilter();null!=a?(this.filterFunction=a,this.store.filter([a,this.textFilterFunction])):this.store.filter([this.textFilterFunction])};
PagedViewListWidget.prototype.draw=function(a){this._setData(a);this.render();this.store.loadData(this.getData());null!=this.filterFunction&&this.setFilter(this.filterFunction)};PagedViewListWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel)};
PagedViewListWidget.prototype.render=function(){var a=this;if(null==this.panel){this.tpl=new Ext.XTemplate(this.template);this.store=Ext.create("Ext.data.Store",{fields:this.storeFields,sorters:[{property:"date",direction:"DESC"}],autoLoad:!1});var b=null;"view"==this.mode&&(b=this.view=Ext.create("Ext.view.View",{id:this.id+"view",padding:15,store:this.store,tpl:this.tpl,height:$(document).height()-200,trackOver:!0,autoScroll:!0,overItemCls:"list-item-hover",itemSelector:".joblist-item",listeners:{scope:this,
itemclick:function(a,b){console.log(b.data);this.onItemClick.notify(b)}}}));if("grid"==this.mode){for(var b=[],c=0;c<this.storeFields.length;c++)b.push({header:this.storeFields[c],dataIndex:this.storeFields[c],flex:1});b=this.grid=Ext.create("Ext.grid.Panel",{store:this.store,columns:b,border:0})}var d=Ext.create("Ext.form.field.Text",{id:this.id+"searchField",flex:1,margin:"0 1 0 0",emptyText:"enter search term",enableKeyEvents:!0,listeners:{change:function(){a.setFilter(null)}}});this.pagBar=Ext.create("Ext.toolbar.Toolbar",
{id:this.pagbarId,style:"border: "+this.border,items:[{id:this.id+"btnSort",iconCls:"icon-order-desc",tooltip:"Change order",handler:function(){if(a.sort=="DESC"){a.sort="ASC";a.store.sort("date","ASC");this.setIconCls("icon-order-asc")}else{a.sort="DESC";a.store.sort("date","DESC");this.setIconCls("icon-order-desc")}}},d,{id:this.id+"btnClear",text:"X",margin:"0 2 0 0",tooltip:"Clear search box",handler:function(){d.reset()}}]});this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:this.border,
width:this.width,tbar:this.pagBar,items:[b]});b=Ext.getCmp(this.targetId);b instanceof Ext.panel.Panel?b.insert(this.order,this.panel):this.panel.render(this.targetId)}};
function UploadWidget(a){var b=this;this.id=Utils.genId("uploadWidget");this.suiteId=this.targetId=null;"undefined"!==typeof a&&(this.targetId=a.targetId||this.targetId,this.suiteId=a.suiteId||this.suiteId,this.opencgaBrowserWidget=a.opencgaBrowserWidget||this.opencgaBrowserWidget);this.adapter=new OpencgaManager;this.adapter.onUploadObjectToBucket.addEventListener(function(a,d){if(d.status=="done"){console.log(b.objectID);b.uploadComplete(d.data)}else d.status=="fail"&&b.uploadFailed(d.data)});this.uploadButtonId=
this.id+"_uploadButton";this.uploadFieldId=this.id+"_uploadField";this.selectedDataType=null}UploadWidget.prototype={getTypeValidation:function(a){return function(b){return RegExp("^.*\\.("+a+")$","i").test(b)}}};
UploadWidget.prototype.draw=function(a){this.opencgaLocation=a;a={};a["9"]=[{text:"ID List",children:[{text:"SNP",tag:"idlist:snp"},{text:"Gene/Transcript",tag:"idlist:gene:transcript"}]},{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"BAM",tag:"bam",validate:this.getTypeValidation("bam")},{text:"BAI",tag:"bai",validate:this.getTypeValidation("bai")},{text:"Expression",
tag:"expression"}]}];a["6"]=[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf"},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"}]}];a["11"]=[{text:"Annotation",tag:"annotation"},{text:"ID List",children:[{text:"Gene",tag:"idlist:gene"},{text:"Ranked",tag:"ranked"}]}];a["12"]=[{text:"Abundances",tag:"abundances"}];a["100"]=[{text:"Sequence",tag:"sequence"}];a["22"]=[{text:"Tabbed text file",tag:"txt",validate:this.getTypeValidation("txt|text")},{text:"CEL compressed file",
tag:"cel",validate:this.getTypeValidation("zip|tar|tar.gz|tgz")}];switch(this.suiteId){case 9:this.checkDataTypes(a["9"]);this.render(a["9"]);break;case 6:this.checkDataTypes(a["6"]);this.render(a["6"]);break;case 11:this.checkDataTypes(a["11"]);this.render(a["11"]);break;case 12:this.checkDataTypes(a["12"]);this.render(a["12"]);break;case 22:this.checkDataTypes(a["22"]);this.render(a["22"]);break;case 100:this.checkDataTypes(a["100"]);this.render(a["100"]);break;case -1:break;default:this.render([{text:"No data types defined"}])}};
UploadWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))};UploadWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)};
UploadWidget.prototype.render=function(a){var b=this;if(null==this.panel){var a=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Data type",children:a}}),c=23*Object.keys(a.tree.nodeHash).length;250>c&&(c=250);a=Ext.create("Ext.tree.Panel",{title:"Select your data type",bodyPadding:10,height:c,border:!1,cls:"panel-border-right",width:250,store:a,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){b.data.leaf?(this.selectedDataType=b.raw.tag,this.selectedDataTypeObj=b.raw,
this.dataTypeLabel.setText('<span class="info">Type:</span><span class="ok"> OK </span>',!1)):(this.selectedDataTypeObj=this.selectedDataType=null,this.dataTypeLabel.setText('<span class="info">Select a data type</span><span class="err"> !!!</span>',!1));this.validate()}}});this.nameField=Ext.create("Ext.form.field.Text",{name:"datalabel",fieldLabel:"Data name",labelWidth:110,msgTarget:"side",enableKeyEvents:!0,listeners:{scope:this,change:function(a){""!=a.getValue()?this.dataNameLabel.setText('<span class="info">Name:</span><span class="ok"> OK </span>',
!1):this.dataNameLabel.setText('<span class="info">Enter the data name</span><span class="err"> !!!</span>',!1);this.validate()}}});this.textArea=Ext.create("Ext.form.field.TextArea",{name:"datadescription",fieldLabel:"Data description",labelWidth:110,msgTarget:"side"});this.organizationField=Ext.create("Ext.form.field.Text",{name:"organization",fieldLabel:"Organization",labelWidth:110,msgTarget:"side"});this.responsableField=Ext.create("Ext.form.field.Text",{name:"responsable",fieldLabel:"Responsible",
labelWidth:110,msgTarget:"side"});this.acquisitiondate=Ext.create("Ext.form.field.Text",{name:"acquisitiondate",fieldLabel:"Acquisition date",labelWidth:110,msgTarget:"side"});c=Ext.create("Ext.panel.Panel",{title:"Some aditional data",width:350,border:!1,height:c,bodyPadding:15,items:[this.nameField,this.textArea,this.organizationField,this.responsableField,this.acquisitiondate]});this.dataTypeLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data type</span>'});this.dataNameLabel=
Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Enter the data name</span>'});this.dataFieldLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data file</span>'});this.originCheck=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",margin:"0 0 5 5",boxLabel:"Text mode",listeners:{scope:this,change:function(){this.originCheck.getValue()?(this.dataFieldLabel.setText('<span class="ok">'+this.editor.getValue().length+'</span><span class="info"> chars</span>',!1),
this.uploadBar.hide(),this.editor.show(),this.uploadField.destroy(),this.uploadField.setRawValue(null)):(this.dataFieldLabel.setText('<span class="info">Select a data file</span>',!1),this.editor.hide(),this.uploadBar.show(),this.editor.setRawValue(null),this.createUploadField());this.validate()}}});var d=Ext.create("Ext.button.Button",{id:this.uploadButtonId,text:"Upload",disabled:!0,handler:function(){b.uploadFile2()}});this.editor=Ext.create("Ext.form.field.TextArea",{xtype:"textarea",width:602,
flex:1,height:100,emptyText:"Paste or write your file directly",hidden:!0,name:"file",margin:"-1",enableKeyEvents:!0,listeners:{scope:this,change:function(){this.dataFieldLabel.setText('<span class="ok">'+this.editor.getValue().length+'</span> <span class="info"> chars</span>',!1);this.validate()}}});this.uploadBar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});this.createUploadField();this.modebar=Ext.create("Ext.toolbar.Toolbar",{dock:"top",height:28,border:!1,items:[this.originCheck,
"->",this.dataTypeLabel,"-",this.dataFieldLabel]});var e=Ext.create("Ext.panel.Panel",{title:"File origin",colspan:2,border:!1,width:600,cls:"panel-border-top",items:[this.uploadBar,this.editor],bbar:this.modebar});this.panel=Ext.create("Ext.window.Window",{title:'Upload a data file -  <span class="err">ZIP files will be allowed shortly</span>',iconCls:"icon-upload",resizable:!1,constrain:!0,closable:!1,modal:!0,layout:{type:"table",columns:2,rows:2},items:[a,c,e],buttonAlign:"right",buttons:[{text:"Close",
handler:function(){b.panel.destroy()}},d],listeners:{scope:this,minimize:function(){this.panel.destroy()},destroy:function(){delete this.panel}}})}this.panel.show()};
UploadWidget.prototype.createUploadField=function(){this.uploadField=Ext.create("Ext.form.field.File",{id:this.uploadFieldId,xtype:"filefield",name:"file",flex:1,padding:1,msgTarget:"side",emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Open file...",listeners:{scope:this,change:function(){this.fileSelected();this.validate()}}});this.uploadBar.add(this.uploadField)};
UploadWidget.prototype.validate=function(){var a=!0;null!=this.selectedDataTypeObj.validate&&(a=this.selectedDataTypeObj.validate(Ext.getCmp(this.uploadFieldId).getValue()));a&&null!=this.selectedDataType&&(""!=this.uploadField.getRawValue()||""!=this.editor.getValue())?(Ext.getCmp(this.uploadButtonId).enable(),this.dataTypeLabel.setText('<span class="info">Type:</span><span class="ok"> OK </span>',!1)):(Ext.getCmp(this.uploadButtonId).disable(),this.dataTypeLabel.setText('<span class="info">Type:</span><span class="err"> Not valid </span>',
!1))};UploadWidget.prototype.fileSelected=function(){var a=document.getElementById(this.uploadField.fileInputEl.id).files[0];if(a){var b=0,b=1048576<a.size?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB";this.dataFieldLabel.setText('<span class="info">Size: </span><span class="ok">'+b+"</span>",!1)}};
UploadWidget.prototype.uploadFile=function(){Ext.getBody().mask("Uploading file...");this.panel.disable();var a=new FormData,b=null;if(this.originCheck.getValue())b=this.nameField.getValue(),a.append("file",this.editor.getValue());else{var c=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0],b=c.name;a.append("file",c)}c=$.cookie("bioinfo_sid");b=this.opencgaLocation.directory+b;b=b.replace(RegExp("/","gi"),":");a.append("name",this.nameField.getValue());a.append("fileFormat",
this.selectedDataType);a.append("responsible",this.responsableField.getValue());a.append("organization",this.organizationField.getValue());a.append("date",this.acquisitiondate.getValue());a.append("description",this.textArea.getValue());a.append("objectid",b);a.append("sessionid",c);this.objectID=this.opencgaLocation.bucketId+":"+b;this.adapter.uploadObjectToBucket($.cookie("bioinfo_account"),c,this.opencgaLocation.bucketId,b,a)};
UploadWidget.prototype.uploadFile2=function(){var a=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0],b=this.opencgaLocation.directory+a.name,b=b.replace(RegExp("/","gi"),":"),c=new Worker(UPLOAD_WORKER);this.opencgaBrowserWidget.addUpload(a,c);c.postMessage({host:OPENCGA_HOST,accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),file:a,objectId:b,fileFormat:this.selectedDataType,bucketId:this.opencgaLocation.bucketId,resume:!0});this.panel.close()};
UploadWidget.prototype.uploadComplete=function(a){var b="Uploaded sucessfully";-1!=a.indexOf("ERROR")&&(b=a);Ext.Msg.show({title:"Upload status",msg:b});this.panel.enable();Ext.getBody().unmask();"Uploaded sucessfully"==b&&this.panel.close()};UploadWidget.prototype.uploadFailed=function(a){console.log(a);Ext.Msg.show({title:"Upload status",msg:"There was an error attempting to upload the file."});this.panel.enable();Ext.getBody().unmask()};
UploadWidget.prototype.uploadCanceled=function(a){console.log(a);Ext.Msg.show({title:"Upload status",msg:"The upload has been canceled by the user or the browser dropped the connection."});this.panel.enable();Ext.getBody().unmask()};
function LoginWidget(a,b){var c=this;this.id="LoginWidget_";this.targetId=null;this.suiteId=a;null!=b&&null!=b.targetId&&(this.targetId=b.targetId);this.onSessionInitiated=new Event(this);this.adapter=new OpencgaManager;this.adapter.onLogin.addEventListener(function(a,b){c.panel!=null&&c.panel.setLoading(false);console.log(b);if(b.errorMessage==null){$.cookie("bioinfo_sid",b.sessionId);$.cookie("bioinfo_account",b.accountId);$.cookie("bioinfo_bucket",b.bucketId);c.onSessionInitiated.notify()}else{Ext.getCmp(c.labelEmailId).setText('<span class="err">'+
b.errorMessage+"</span>",false);$.cookie("bioinfo_sid",null);$.cookie("bioinfo_sid",null,{path:"/"});$.cookie("bioinfo_account",null);$.cookie("bioinfo_account",null,{path:"/"})}});this.adapter.onCreateAccount.addEventListener(function(a,b){c.panel.setLoading(false);b=b.replace(/^\s+|\s+$/g,"");if(b.indexOf("OK")!=-1)Ext.getCmp(c.labelEmailId).setText('<span class="ok">Account created</span>',false);else{b.replace(/ERROR: /gi," ");Ext.getCmp(c.labelEmailId).setText('<span class="err">Account already exists</span>',
false);$.cookie("bioinfo_sid",null);$.cookie("bioinfo_sid",null,{path:"/"});$.cookie("bioinfo_account",null);$.cookie("bioinfo_account",null,{path:"/"})}});this.adapter.onResetPassword.addEventListener(function(a,b){c.panel.setLoading(false);Ext.getCmp(c.labelEmailId).setText('<span class="emph">'+b+"</span>",false)});this.labelEmailId=this.id+"labelEmail";this.labelPassId=this.id+"labelPass";this.fldEmailId=this.id+"fldEmail";this.fldPasswordId=this.id+"fldPassword";this.fldNpass1Id=this.id+"fldNpass1";
this.fldNpass2Id=this.id+"fldNpass2";this.btnSignId=this.id+"fldSign";this.btnAnonymousId=this.id+"btnAnonymous";this.btnForgotId=this.id+"btnForgot";this.btnNewaccId=this.id+"btnNewacc";this.btnSendId=this.id+"btnSend";this.btnBackId=this.id+"btnBack";this.btnRegisterId=this.id+"btnRegister"}
LoginWidget.prototype.sign=function(){Ext.getCmp(this.btnAnonymousId).getValue()?(this.anonymousSign(),this.panel.setLoading("Waiting server...")):this.checkAccountId()&&(this.adapter.login(this.getLogin(),this.getPassword(),this.suiteId),this.panel.setLoading("Waiting server..."),$.cookie("bioinfo_user",this.getLogin(),{path:"/",expires:7}))};LoginWidget.prototype.anonymousSign=function(){this.adapter.login("anonymous","",this.suiteId)};
LoginWidget.prototype.register=function(){this.checkAccountId()&&this.checkemail()&&this.checkName()&&this.checkpass()?this.adapter.createAccount(this.getLogin(),this.getEmail(),this.getAccountName(),this.getPasswordReg(),this.suiteId):Ext.getCmp(this.labelEmailId).setText('<span class="info">Fill all fields</span>',!1)};LoginWidget.prototype.sendRecover=function(){this.checkAccountId()&&this.checkemail()&&(this.adapter.resetPassword(this.getLogin(),this.getEmail()),this.panel.setLoading("Waiting server..."))};
LoginWidget.prototype.getLogin=function(){return Ext.getCmp(this.id+"accountId").getValue()};LoginWidget.prototype.getAccountName=function(){return Ext.getCmp(this.id+"accountName").getValue()};LoginWidget.prototype.getEmail=function(){return Ext.getCmp(this.fldEmailId).getValue()};LoginWidget.prototype.getPassword=function(){return $.sha1(Ext.getCmp(this.fldPasswordId).getValue())};LoginWidget.prototype.getPasswordReg=function(){return $.sha1(Ext.getCmp(this.fldNpass1Id).getValue())};
LoginWidget.prototype.draw=function(){this.render()};LoginWidget.prototype.clean=function(){null!=this.panel&&this.panel.destroy()};
LoginWidget.prototype.render=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.TextItem",{id:this.labelEmailId,padding:3,text:'<span class="info">Type your account ID and password</span>'});this.pan=Ext.create("Ext.form.Panel",{id:this.id+"formPanel",bodyPadding:20,width:350,height:145,border:!1,bbar:{items:[b]},items:[{id:this.id+"accountId",xtype:"textfield",value:$.cookie("bioinfo_user"),fieldLabel:"account ID",hidden:!1,listeners:{scope:this,change:this.checkAccountId}},
{id:this.fldPasswordId,xtype:"textfield",fieldLabel:"password",inputType:"password",listeners:{specialkey:function(b,d){console.log("asdf");d.getKey()==d.ENTER&&a.sign()}}},{id:this.fldEmailId,xtype:"textfield",fieldLabel:"e-mail",hidden:!0,listeners:{change:function(){a.checkemail()},specialkey:function(b,d){d.getKey()==d.ENTER&&a.sign()}}},{id:this.id+"accountName",xtype:"textfield",fieldLabel:"name",hidden:!0,listeners:{scope:this,change:this.checkName}},{id:this.fldNpass1Id,xtype:"textfield",
fieldLabel:"password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.fldNpass2Id,xtype:"textfield",fieldLabel:"re-password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.btnAnonymousId,xtype:"checkboxfield",padding:"10 0 0 0",boxLabel:'Anonymous login <p class="tip s90">Your work will be lost after logout</p>',margin:"0 0 0 50",listeners:{change:function(b,d){d?(Ext.getCmp(a.id+"accountId").disable(),Ext.getCmp(a.fldPasswordId).disable()):
(Ext.getCmp(a.id+"accountId").enable(),Ext.getCmp(a.fldPasswordId).enable())}}}]});this.panel=Ext.create("Ext.window.Window",{id:this.id+"windowPanel",title:"Sign in",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,items:[this.pan],buttonAlign:"center",buttons:[{id:this.btnSignId,text:"Sign in"},{id:this.btnForgotId,text:"Forgot yout password?",width:130,minWidth:130},{id:this.btnNewaccId,text:"New account",width:100,minWidth:100},{id:this.btnSendId,text:"Send",hidden:!0},{id:this.btnRegisterId,
text:"Register",hidden:!0},{id:this.btnBackId,text:"Back",hidden:!0}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}});Ext.getCmp(this.btnForgotId).on("click",this.ShowForgot,this);Ext.getCmp(this.btnBackId).on("click",this.ShowBack,this);Ext.getCmp(this.btnNewaccId).on("click",this.ShowNewacc,this);Ext.getCmp(this.btnSignId).on("click",this.sign,this);Ext.getCmp(this.btnSendId).on("click",this.sendRecover,this);Ext.getCmp(this.btnRegisterId).on("click",
this.register,this);Ext.getCmp(this.btnAnonymousId).on("change",this.anonymousSelected,this)}this.panel.show()};
LoginWidget.prototype.ShowForgot=function(){Ext.getCmp(this.fldEmailId).reset();Ext.getCmp(this.fldEmailId).show();Ext.getCmp(this.fldPasswordId).reset();Ext.getCmp(this.btnAnonymousId).reset();Ext.getCmp(this.fldNpass1Id).reset();Ext.getCmp(this.fldNpass2Id).reset();Ext.getCmp(this.fldPasswordId).hide();Ext.getCmp(this.btnAnonymousId).hide();Ext.getCmp(this.fldNpass1Id).hide();Ext.getCmp(this.fldNpass2Id).hide();Ext.getCmp(this.btnSignId).hide();Ext.getCmp(this.btnForgotId).hide();Ext.getCmp(this.btnNewaccId).hide();
Ext.getCmp(this.btnSendId).show();Ext.getCmp(this.btnBackId).show();Ext.getCmp(this.btnRegisterId).hide();Ext.getCmp(this.id+"accountId").reset();Ext.getCmp(this.id+"accountName").hide();Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and email to send a new password</span>',!1);Ext.getCmp(this.id+"formPanel").setHeight(145);Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1);Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1)};
LoginWidget.prototype.ShowBack=function(){Ext.getCmp(this.fldEmailId).hide();Ext.getCmp(this.fldPasswordId).reset();Ext.getCmp(this.btnAnonymousId).reset();Ext.getCmp(this.fldNpass1Id).reset();Ext.getCmp(this.fldNpass2Id).reset();Ext.getCmp(this.fldPasswordId).show();Ext.getCmp(this.btnAnonymousId).show();Ext.getCmp(this.fldNpass1Id).hide();Ext.getCmp(this.fldNpass2Id).hide();Ext.getCmp(this.btnSignId).show();Ext.getCmp(this.btnForgotId).show();Ext.getCmp(this.btnNewaccId).show();Ext.getCmp(this.btnSendId).hide();
Ext.getCmp(this.btnBackId).hide();Ext.getCmp(this.btnRegisterId).hide();Ext.getCmp(this.id+"accountId").reset();Ext.getCmp(this.id+"accountName").hide();Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1);Ext.getCmp(this.id+"formPanel").setHeight(145);Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1)};
LoginWidget.prototype.ShowNewacc=function(){Ext.getCmp(this.fldEmailId).reset();Ext.getCmp(this.fldEmailId).show();Ext.getCmp(this.fldPasswordId).reset();Ext.getCmp(this.btnAnonymousId).reset();Ext.getCmp(this.fldNpass1Id).reset();Ext.getCmp(this.fldNpass2Id).reset();Ext.getCmp(this.fldPasswordId).hide();Ext.getCmp(this.btnAnonymousId).hide();Ext.getCmp(this.fldNpass1Id).show();Ext.getCmp(this.fldNpass2Id).show();Ext.getCmp(this.btnSignId).hide();Ext.getCmp(this.btnForgotId).hide();Ext.getCmp(this.btnNewaccId).hide();
Ext.getCmp(this.btnSendId).hide();Ext.getCmp(this.btnBackId).show();Ext.getCmp(this.btnRegisterId).show();Ext.getCmp(this.id+"accountId").reset();Ext.getCmp(this.id+"accountName").reset();Ext.getCmp(this.id+"accountName").show();Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1);Ext.getCmp(this.id+"formPanel").setHeight(200);Ext.getCmp(this.id+"accountName").setFieldLabel("name",!1);Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1);Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1);
Ext.getCmp(this.fldNpass1Id).setFieldLabel("password",!1);Ext.getCmp(this.fldNpass2Id).setFieldLabel("re-password",!1);Ext.getCmp(this.id+"accountId").setValue("")};
LoginWidget.prototype.checkpass=function(){var a=Ext.getCmp(this.fldNpass1Id).getValue(),b=Ext.getCmp(this.fldNpass2Id).getValue();if(!/[ *]/.test(a)&&3<a.length){if(a==b)return Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="ok">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="ok">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),!0;Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1);Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',
!1);Ext.getCmp(this.labelEmailId).setText('<span class="err">Password does not match</span>',!1);return!1}Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1);Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1);Ext.getCmp(this.labelEmailId).setText('<span class="err">Password minimum length is 4</span>',!1);return!1};
LoginWidget.prototype.anonymousSelected=function(a,b){b?Ext.getCmp(this.labelEmailId).setText('<span class="ok">Anonymous selected</span>',!1):Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1)};
LoginWidget.prototype.checkemail=function(){Ext.getCmp(this.btnAnonymousId).reset();var a=Ext.getCmp(this.fldEmailId).getValue();if(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a))return Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="ok">e-mail</span>',!1),!0;Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="err">e-mail</span>',!1);return!1};
LoginWidget.prototype.checkName=function(){var a=Ext.getCmp(this.id+"accountName").getValue();if(""!=a&&null!=a)return Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="ok">name</span>',!1),!0;Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="err">name</span>',!1);return!1};
LoginWidget.prototype.checkAccountId=function(){var a=Ext.getCmp(this.id+"accountId").getValue();if(""!=a&&null!=a)return Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="ok">account ID</span>',!1),!0;Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="err">account ID</span>',!1);return!1};
function ProfileWidget(a){var b=this;this.id="EditUserWidget_"+Math.round(1E4*Math.random());this.targetId=null;"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId);this.adapter=new OpencgaManager;this.adapter.onChangePassword.addEventListener(function(a,d){b.panel.setLoading(false);if(d.indexOf("ERROR")==-1){Ext.getCmp(b.id+"fldOld").setValue(null);Ext.getCmp(b.id+"fldNew1").setValue(null);Ext.getCmp(b.id+"fldNew2").setValue(null)}Ext.getCmp(b.id+"labelPass").setText('<span class="info">'+
d+"</span>",false)});this.adapter.onChangeEmail.addEventListener(function(a,d){b.panel.setLoading(false);if(d.indexOf("ERROR")==-1){Ext.getCmp(b.id+"fldEmail").setValue(null);Ext.getCmp(b.id+"fldEmail").setFieldLabel("e-mail",false)}Ext.getCmp(b.id+"labelPass").setText('<span class="info">'+d+"</span>",false)})}
ProfileWidget.prototype={getOldPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldOld").getValue())},getNewPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldNew1").getValue())},getLogin:function(){return Ext.getCmp(this.id+"fldEmail").getValue()},clearAllFields:function(){Ext.getCmp(this.id+"fldOld").setValue(null);Ext.getCmp(this.id+"fldNew1").setValue(null);Ext.getCmp(this.id+"fldNew2").setValue(null);Ext.getCmp(this.id+"fldEmail").setValue(null);Ext.getCmp(this.id+"labelPass").setText("&nbsp",
!1)},changeEmail:function(){this.checkemail()&&(this.adapter.changeEmail($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.getLogin()),this.panel.setLoading("Waiting for the server to respond..."))},changePassword:function(){this.checkpass()&&(this.adapter.changePassword($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.getOldPassword(),this.getNewPassword(),this.getNewPassword()),this.panel.setLoading("Waiting for the server to respond..."))},draw:function(){this.render()},clean:function(){null!=
this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))},render:function(){var a=this;if(null==this.panel){console.log(this.id+" CREATING PANEL");var b=Ext.create("Ext.toolbar.TextItem",{id:this.id+"labelPass",padding:3,text:"&nbsp"}),c=Ext.create("Ext.form.Panel",{title:"Change password",bodyPadding:15,width:350,height:155,border:!1,items:[{id:this.id+"fldOld",name:"password",xtype:"textfield",fieldLabel:"Old password",inputType:"password"},{id:this.id+"fldNew1",
name:"new_password1",xtype:"textfield",fieldLabel:"New password",inputType:"password",listeners:{scope:this,change:this.checkpass}},{id:this.id+"fldNew2",name:"new_password2",xtype:"textfield",fieldLabel:"Confirm new",inputType:"password",listeners:{scope:this,change:this.checkpass}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){a.changePassword()}}]}),d=Ext.create("Ext.form.Panel",{title:"Change email",bodyPadding:15,width:350,height:155,border:!1,items:[{id:this.id+"fldEmail",
name:"new_email",xtype:"textfield",fieldLabel:"e-mail",listeners:{change:function(){a.checkemail()}}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){a.changeEmail()}}]}),b=Ext.create("Ext.tab.Panel",{width:350,height:175,border:!1,bbar:{items:[b]},items:[c,d],listeners:{tabchange:function(){a.clearAllFields()}}});this.panel=Ext.create("Ext.window.Window",{title:"Profile",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,items:[b],buttonAlign:"center",buttons:[{text:"Close",
handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show()},checkpass:function(){var a=Ext.getCmp(this.id+"fldNew1").getValue(),b=Ext.getCmp(this.id+"fldNew2").getValue(),c=/[ *]/;if(""!=Ext.getCmp(this.id+"fldOld").getValue()){if(!c.test(a)&&3<a.length){if(a==b)return Ext.getCmp(this.id+"labelPass").setText('<p class="ok">Passwords match</p>',!1),!0;Ext.getCmp(this.id+"labelPass").setText('<p class="err">Passwords does not match</p>',
!1);return!1}Ext.getCmp(this.id+"labelPass").setText('<p class="err">Password must be at least 4 characters</p>',!1);return!1}Ext.getCmp(this.id+"labelPass").setText('<p class="err">Old password is empty</p>',!1);return!1},checkemail:function(){var a=Ext.getCmp(this.id+"fldEmail").getValue();if(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a))return Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="ok">e-mail</span>',!1),!0;Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="err">e-mail</span>',
!1);""==a&&Ext.getCmp(this.id+"fldEmail").setFieldLabel("e-mail",!1);return!1}};
function ResultWidget(a){var b=this;this.id="ResultWidget"+Math.round(1E4*Math.random());this.targetId=null;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.application&&(this.application=a.application),null!=a.app))this.app=a.app;this.adapter=new OpencgaManager;this.adapter.onJobResult.addEventListener(function(a,d){b.data=JSON.parse(d);Ext.getBody().unmask();b.panel.setLoading(!1);b.render()});this.genomeMapsId=this.networkViewerId=this.panelId=null;this.resultTables={};this.resultHistograms=
{};this.resultGCharts={};this.variantFiles={};this.onViewRendered=new Event;this.onViewRendered.addEventListener(function(){b.drawTables();b.drawHistograms();b.drawGCharts();b.drawApplicationItems()})}
ResultWidget.prototype.draw=function(a,b){this.record=b;this.jobId=this.record.data.id;this.id=this.jobId+this.id;this.panelId="ResultWidget_"+this.jobId;this.networkViewerId=this.panelId+"_CellBrowserId";this.genomeMapsId=this.panelId+"_GenomeMapsId";this.panel=Ext.getCmp(this.panelId);null==this.panel?(this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:this.record.data.name,closable:!0,autoScroll:!0}),Ext.getCmp(this.targetId).add(this.panel),Ext.getCmp(this.targetId).setActiveTab(this.panel),
this.panel.setLoading("Loading job info..."),Ext.getBody().mask(),this.adapter.jobResult($.cookie("bioinfo_account"),a,this.jobId,"json")):Ext.getCmp(this.targetId).setActiveTab(this.panel)};
ResultWidget.prototype.render=function(){var a=this;console.log(this.application);debugger;if(0!=this.data.outputItems.length){for(var b=this.data.inputItems.concat(this.data.outputItems),c={},d=0;d<b.length;d++){var e=b[d].group;if(""!=e)if(-1!=e.indexOf(".")){var f=e.split(".")[0],e=e.split(".")[1];null==c[f]&&(c[f]={});null==c[f][e]&&(c[f][e]=[]);this.checkPValue(b[d].title)&&c[f][e].push(b[d])}else null==c[e]&&(c[e]={},c[e].items=[]),this.renamePValue(b[d]),c[e].items.push(b[d])}if("renato"==
this.application||"variant"==this.application)c["Interactive Results"]={items:[]};console.log(c);b=Ext.create("Ext.container.Container",{html:'<a name="'+this.jobId+'top"></a>'});f=Ext.create("Ext.container.Container",{margin:"15 0 5 15",html:'<p >The job named <span class="info">'+this.record.data.name+' </span>was launched on <span class="err">'+this.record.data.date+" </span><br>"});e=[];d=1;for(key in c){var g=this.jobId+key.replace(/\s/g,"_")+"group",g=Ext.create("Ext.container.Container",{padding:"0 0 2 15",
width:14*key.length,groupId:g,html:'<span class="s110 emph">'+d+". "+key+"</span>",listeners:{afterrender:function(){this.getEl().addClsOnOver("ssel u");this.getEl().addCls("dedo");var b=this.groupId;this.getEl().on("click",function(){var c=$("#"+b).position().top;$(a.panel.getEl().dom).children().scrollTop(c)})}}});e.push(g);d++}d=1;for(key in c){var h=(this.jobId+key+"info").replace(/ /gi,""),g=this.jobId+key.replace(/\s/g,"_")+"group",g=Ext.create("Ext.container.Container",{infoId:h,groupName:key,
padding:"60 15 5 15",html:'<p id="'+g+'" class="panel-border-bottom"><span class="s140 emph">'+d+". "+key+' &nbsp;&nbsp; &uarr; </span><span class="info" id="'+h+'"></span></p>',listeners:{afterrender:function(){this.getEl().addClsOnOver("ssel");this.getEl().addCls("dedo");this.getEl().on("click",function(){$(a.panel.getEl().dom).children().scrollTop(0)});var b=a.getInfo(this.groupName);if(""!=b){$("#"+this.infoId).html("+info");var c=Ext.create("Ext.tip.Tip",{html:b,listeners:{show:function(){var a=
this;this.getEl().on("mouseleave",function(){a.hide()})}}});$("#"+this.infoId).mouseover(function(a){$(this).css({cursor:"pointer"});c.showAt(a.clientX,a.clientY)});$("#"+this.infoId).click(function(){c.hide()})}}}});e.push(g);e.push(this.getResults(c[key].items));h=1;for(clave in c[key])"items"!=clave&&(g=Ext.create("Ext.container.Container",{padding:"15 15 5 30",cls:"inlineblock",html:'<p class="panel-border-bottom s120 emph">'+d+"."+h+" "+clave+"</p>"}),e.push(g),e.push(this.getResults(c[key][clave])),
h++);d++}Ext.create("Ext.button.Button",{text:"Download",margin:"0 0 25 15",handler:function(){a.adapter.download(a.jobId,$.cookie("bioinfo_sid"))}});Ext.create("Ext.button.Button",{text:"Delete",margin:"0 0 25 30",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(b){"yes"==b&&(a.adapter.onDeleteJob.addEventListener(function(b,c){var d="";-1!=c.response.indexOf("OK")?(Ext.getCmp(a.targetId).getActiveTab().close(),d="The job has been succesfully deleted."):
d="ERROR: could not delete job.";Ext.Msg.alert("Delete job",d)}),a.adapter.deleteJob(a.jobId,$.cookie("bioinfo_sid")))})}});this.panel.add(b);this.panel.add(f);this.panel.add(e);a.onViewRendered.notify()}};
ResultWidget.prototype.getResults=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.showInfo(d);b.push(e);(e=this.showTypeInfo(d))&&b.push(e);e=this.showTagInfo(d);null!=e&&b.push(e)}return Ext.create("Ext.container.Container",{layout:{type:"table",columns:1,tableAttrs:{style:{width:"100%"}}},items:b})};
ResultWidget.prototype.showInfo=function(a){var b=this,c=new Ext.XTemplate('<span class="key">{title} </span>','<span class="{[ this.setCSS(values) ]}">{value}</span><br>',{disableFormats:!0,setCSS:function(a){switch(a.type){case "FILE":return"file";case "MESSAGE":return"species"==a.name&&(b.species=a.value),"message"}}});return itemBox=Ext.create("Ext.container.Container",{data:a,datos:a,margin:"0 10 0 20",padding:5,tpl:c,cls:"inlineblock",listeners:{afterrender:function(){var a=this.datos;"FILE"==
this.datos.type&&(this.getEl().addClsOnOver("encima"),this.getEl().addCls("whiteborder"),"variant"==b.application&&-1!=a.title.toLowerCase().indexOf("filter")&&(b.filteredVcfFile=a.value),this.getEl().on("click",function(){console.log(a);var c=a.value.trim();b.adapter.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,c,true)}))}}})};
ResultWidget.prototype.showTypeInfo=function(a){var b=Ext.create("Ext.container.Container",{margin:"0 10 0 10",padding:5});switch(a.type){case "IMAGE":return a=a.value.trim(),b.html='<div><img src="'+this.adapter.pollurl($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.jobId,a)+'"></div>',b;default:return null}};
ResultWidget.prototype.showTagInfo=function(a){for(var b=Ext.create("Ext.container.Container",{margin:"0 10 0 10",flex:1,padding:5,html:""}),c=0;c<a.tags.length;c++)switch(a.tags[c]){case "TABLE":var c=a.value.trim(),d=this.jobId+c+a.tags;this.resultTables[d]=new ResultTable(this.jobId,c,a.tags,{targetId:"resultTable_"+d});b.html+='<div id="resultTable_'+d+'" style="padding:5px;"></div>';return b;case "HISTOGRAM":return d="histogram_"+this.jobId+a.value+a.tags,this.resultHistograms[d]=a.value,b.html=
'<div id="'+d+'" style="padding:5px;"></div>',b;case "GCHART":return d="gchart_"+a.name,this.resultGCharts[d]=a.value,b.html='<div id="'+d+'"></div>',b;case "CONSEQUENCE_TYPE_VARIANTS":this.variantFiles[a.name]=a.title}return null};ResultWidget.prototype.drawTables=function(){for(id in this.resultTables)this.resultTables[id].draw()};
ResultWidget.prototype.drawHistograms=function(){for(id in this.resultHistograms){var a=new OpencgaManager;a.onPoll.addEventListener(function(a,c){if(""!=c){for(var d=c.split("\n"),e=[],f=[],g=[],h=[],j=0,k=0;k<d.length;k++)e.push(d[k].split("\t")),""!=e[k][0]&&f.push(e[k][0]),null!=e[k][1]&&(j+=parseFloat(e[k][1]),g.push(e[k][1]));for(k=0;k<g.length;k++)h.push(Math.round(100*(parseFloat(g[k])/j)));f=f.toString().replace(/,/gi,"|");document.getElementById(id).innerHTML='<img src="https://chart.googleapis.com/chart?cht=p&chs=600x300&chd=t:'+
h+"&chl="+f+'&chtt=Consequence+types&chts=000000,14.5">'}});a.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.jobId,this.resultHistograms[id],!1)}};ResultWidget.prototype.drawGCharts=function(){for(id in this.resultGCharts)drawChart(id,this.resultGCharts[id])};
ResultWidget.prototype.drawApplicationItems=function(){var a=this,b=Ext.create("Ext.container.Container",{id:this.application+this.id+"Container",border:!0,margin:"50 50 0 50",html:'<div class="greyborder" id="'+this.id+'Container"></div><div style="height:40px"></div>'});switch(this.application){case "variant":b.on("afterrender",function(){a.createGenomeViewer(a.id+"Container")});break;case "renato":var c=Ext.create("Ext.ProgressBar",{id:this.id+"pbar",margin:"5 0 0 50",width:500});c.wait({interval:500,
duration:5E4,increment:15,text:"Getting database information and drawing the network, please wait...",scope:this,fn:function(){c.updateText("Done!")}});this.panel.add(c);b.on("afterrender",function(){a.createCellBrowser(a.id+"Container")});break;default:return null}this.panel.add(b)};
ResultWidget.prototype.createGenomeViewer=function(a){var b=this,c=Ext.getCmp(this.application+a).getWidth();Ext.getCmp(this.application+a).getHeight();genomeViewer=new GenomeViewer(a,DEFAULT_SPECIES,{sidePanelCollapsed:!0,width:c-2,height:698});genomeViewer.afterRender.addEventListener(function(){b.app.setTracks(genomeViewer);genomeViewer.addSidePanelItems();new VariantFilterWidget(b.jobId,{width:c-2,targetId:b.application+a,viewer:genomeViewer,fileNames:b.variantFiles})});genomeViewer.draw();var d=
new OpencgaManager;d.onPoll.addEventListener(function(a,b){1!=b.indexOf("ERROR")&&console.error(b);var c=new VCFDataAdapter(new StringDataSource(b),{async:!1,species:genomeViewer.species}),c=new TrackData("VCF file",{adapter:c});genomeViewer.addTrack(c,{id:"VCF file",featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})});null!=this.filteredVcfFile?d.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,this.filteredVcfFile,
!1):console.log("No filtered VCF file.")};var mostSignificativesFeatures=[];
ResultWidget.prototype.createCellBrowser=function(a){var b=this;record=this.record;Ext.getCmp(this.application+a).disable();var c=Ext.getCmp(this.application+a).getWidth(),d=Ext.getCmp(this.application+a).getHeight();this.networkViewer=new NetworkViewer(a,this.getSpeciesItem(this.species),{width:c-2,height:d-2});this.networkViewer.draw();var e=new GraphDataset,f=new LayoutDataset,g=new NetworkDataSetFormatter({defaultFormat:{type:"LineEdgeNetworkFormatter",opacity:1,fill:"#000000",radius:"5",strokeWidth:"1",
stroke:"#000000",size:"2",title:{fontSize:10,fill:"#000000"}},selected:{opacity:0.9,fill:"#FF0000",radius:"5",stroke:"#000000",size:"2"},over:{opacity:1,fill:"#DF0101",radius:"5",stroke:"#000000",size:"2",strokeWidth:"1"}},{defaultFormat:{opacity:0.8,stroke:"#000000",strokeWidth:"1",strokeOpacity:0.5,title:{fontSize:6,fontColor:"#000000"}},selected:{stroke:"#DF0101",fill:"#FF0000"},over:{stroke:"#DF0101",strokeOpacity:1,strokeWidth:"4"}},{labeled:!1,backgroundColor:"#FFFFFF",balanceNodes:!1,nodesMaxSize:4,
nodesMinSize:2});g.dataBind(e);f.dataBind(e);g.setHeight(d-140);g.setWidth(c-2-13);this.networkViewer.drawNetwork(e,g,f);c=new WumRestAdapter;c.onPoll.addEventListener(function(c,d){for(var e=d.split("\n"),f=[],g=1;g<e.length;g++){var n=13;"fatiscan"==record.data.toolName&&7==e[g].split("\t").length&&(n=6);1E6>e[g].split("\t")[n]&&f.push(e[g].split("\t")[0])}console.log("significativesFeatures.length: "+f.length);e=new WumRestAdapter;e.onPoll.addEventListener(function(c,d){var e=d.split("\n");e.pop();
console.log("genes.length: "+e.length);b.loadNetworkOnCellBrowser(e,f,a)});g="clean_list1.txt";"fatiscan"==record.data.toolName&&(g="id_list.txt");e.poll(b.jobId,g,!1,$.cookie("bioinfo_sid"))});c.poll(this.jobId,"significant_your_annotation_0.05.txt",!1,$.cookie("bioinfo_sid"));console.log("getting ranked_list...");c=new WumRestAdapter;c.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top clean_list...");for(var f=0;50>e&&f<d;f++)0>c[f].indexOf("#")&&
(mostSignificativesFeatures[c[f].split("\t")[0]]=!0,e++);e=0;console.log("getting bottom clean_list...");for(f=d-1;50>e&&0<f;f--)0>c[f].indexOf("#")&&(mostSignificativesFeatures[c[f].split("\t")[0]]=!0,e++)});c.poll(this.jobId,"clean_list1.txt",!1,$.cookie("bioinfo_sid"));console.log("getting ranked_list...");c=new WumRestAdapter;c.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top ranked_list...");for(var f=0;50>e&&f<d;f++)0>c[f].indexOf("#")&&(mostSignificativesFeatures[c[f].split("\t")[0]]=
!0,e++);e=0;console.log("getting bottom ranked_list...");for(f=d-1;50>e&&0<f;f--)0>c[f].indexOf("#")&&(mostSignificativesFeatures[c[f].split("\t")[0]]=!0,e++)});c.poll(this.jobId,"ranked_list.txt",!1,$.cookie("bioinfo_sid"))};
ResultWidget.prototype.loadNetworkOnCellBrowser=function(a,b,c){var d=this,e=0,f=new CellBaseManager(this.networkViewer.species);f.success.addEventListener(function(f,h){for(var j=h.result,k={},l=0;l<j.length;l++)for(var m=0;m<j[l].length;m++)-1!=b.toString().indexOf(j[l][m].tfName)&&(null==k[j[l][m].tfName]&&(k[j[l][m].tfName]={}),null==k[j[l][m].tfName][a[l]]&&(k[j[l][m].tfName][a[l]]=!0));console.log(k);console.log(j.length);console.log("contando TFBSs...");var j=0,n;for(n in k){if(500<j)break;
for(var p in k[n])j++}console.log("menos de 500: "+j);for(n in k)for(p in d.networkViewer.networkWidget.getDataset().addNode(n,{type:"tf"}),l=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1,d.networkViewer.networkWidget.getFormatter().getVertexById(l).getDefault().setFill("#DF0101"),k[n])if(500>j||!0==mostSignificativesFeatures[p])0==d.networkViewer.networkWidget.getDataset().getVertexByName(p).length&&d.networkViewer.networkWidget.getDataset().addNode(p,{type:"gene"}),l=d.networkViewer.networkWidget.getDataset().getVertexByName(p)[0].id,
m=d.networkViewer.networkWidget.getDataset().getVertexByName(n)[0].id,d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+l+"_"+m,m,l),d.networkViewer.networkWidget.getFormatter().getVertexById(l).getDefault().setFill("#0000FF");d.networkViewer.networkWidget.getLayout().getLayout("neato");d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(){e++;2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})});0<a.length&&f.get("feature","gene",a,
"tfbs");f=new CellBaseManager(this.networkViewer.species);f.success.addEventListener(function(f,h){for(var j=h.result,k={},l=0;l<j.length;l++)for(var m=0;m<j[l].length;m++)-1!=b.toString().indexOf(j[l][m].mirbaseId)&&(null==k[j[l][m].mirbaseId]&&(k[j[l][m].mirbaseId]={}),null==k[j[l][m].mirbaseId][a[l]]&&(k[j[l][m].mirbaseId][a[l]]=!0));console.log(k);console.log(j.length);console.log("contando miRNAs...");var j=0,n;for(n in k){if(500<j)break;for(var p in k[n])j++}console.log("menos de 500: "+j);
for(var o in k)for(p in d.networkViewer.networkWidget.getDataset().addNode(o,{type:"mirna"}),n=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1,d.networkViewer.networkWidget.getFormatter().getVertexById(n).getDefault().setFill("red"),k[o])if(500>j||!0==mostSignificativesFeatures[p])0==d.networkViewer.networkWidget.getDataset().getVertexByName(p).length&&d.networkViewer.networkWidget.getDataset().addNode(p,{type:"gene"}),n=d.networkViewer.networkWidget.getDataset().getVertexByName(p)[0].id,
l=d.networkViewer.networkWidget.getDataset().getVertexByName(o)[0].id,d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+n+"_"+l,l,n),d.networkViewer.networkWidget.getFormatter().getVertexById(n).getDefault().setFill("blue"),n=d.networkViewer.networkWidget.getDataset().getEdgesCount()-1,d.networkViewer.networkWidget.getFormatter().changeEdgeType(n,"CutDirectedLineEdgeNetworkFormatter");d.networkViewer.networkWidget.getLayout().getLayout("neato");d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(){e++;
2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})});0<a.length?f.get("feature","gene",a,"mirna_target"):(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())};
ResultWidget.prototype.getGenomeViewerResultBar=function(a){var b=this;switch(this.application){case "variant":return Ext.create("Ext.container.Container",{cls:"bio-toolbar",defaults:{margin:"1 0 0 2"},layout:"vbox",height:27,items:[{xtype:"button",text:'<span class="info">Variant filter tool...</span>',handler:function(){new VariantFilterWidget(b.jobId,{viewer:a,fileNames:b.variantFiles})}}]});default:return null}};
ResultWidget.prototype.getSpeciesItem=function(a){for(var b=0;b<AVAILABLE_SPECIES.length;b++)if(AVAILABLE_SPECIES[b].species==a)return AVAILABLE_SPECIES[b]};ResultWidget.prototype.checkPValue=function(a){return-1!=a.indexOf("pvalue<0.005")||-1!=a.indexOf("pvalue<0.01")||-1!=a.indexOf("pvalue<0.1")?!1:!0};ResultWidget.prototype.renamePValue=function(a){-1!=a.value.indexOf("${pvalue}")&&(a.value=a.value.replace(/\$\{pvalue\}/gi,"0.05"))};
ResultWidget.prototype.setPValue=function(a){console.log(this.id);$("#pvalue"+this.id).html(a)};
ResultWidget.prototype.getInfo=function(a){switch(this.application){case "renato":switch(a){case "Input data":return"This section is a reminder of the parameters or settings you have submitted to run the analysis.";case "Summary":return"<p>This section shows the number of genes annotated to each database in each list.</p><br><p>Gene list: contains three elements, the number of genes in your gene list annotated in the database over the total number of genes remaining in your gene list after the duplicates management, a percentage of genes in your gene list annotated in the database and the ratio of regulators per gene.<br> Genome: the same structure explained above but applied to the whole genome (TFBS or miRNA) or Your Annotations after the duplicates management.</p>";case "Significant Results":return"<p>We consider a significant enrichment after correcting the results by a multiple testing correction method. Enrichment p-values are corrected applying the False discovery rate (FDR) method (Benjamini et al., 1995; Storey andTibshirani, 2003). The threshold of signification applied to the correction has been set to 0.05.</p><br><p>The table provided summarizes the information about the enrichment test for each of the significant regulatory elements that have an Adjusted p-value < 0.05. The table is originally sorted by adjusted p-value and can be sorted up and down by clicking in any of the other column headings. When the number of significant results in a table is higher than five, results are split into different pages. You can move forward or backward in the page list using the arrow buttons.</p>";
case "All results":return"This section contains a downloadable individual text file containing all results for all significant and not significant regulators. This file follows the same structure described above.";case "Annotation files":return"<p>When significant results are obtained, we can suppose that there is one or several regulatory elements behaving different when comparing groups. The list of genes included in the analysis have pointed to a significantly over-represented set of common regulators to these genes. The interpretation of the results will be different in the case of TFs (transcription factors) and miRNAs given that (generally) the first are positive regulators and the latter are negative regulators.</p><br><p>TFs generally bind to the promoter region of their target genes to assist and promote the transcription. miRNAs, on the other hand, bind to transcript products preventing them from being translated. Significant TF and miRNAs can be pointed to be responsible for the differential expression of the genes observed in the list. We must take special care in the interpretation of over-expressed or under-expressed genes in a functional analysis. In the case of TFs, if we are working with the list of over-expressed genes, the significant results makes reference to active TFs in one condition with respect to the other; while significant results of under-expressed genes makes reference to inactive TFs. In miRNAs, significant results of over-expressed genes will point to inactive miRNAs, while significant results of under-expressed genes will point to active miRNAs when comparing conditions.</p>";
default:return""}case "variant":switch(a){case "Variants by Consequence Type":return"Click this link: <a class='ok' target='_blank' href='http://docs.bioinfo.cipf.es/projects/variant/wiki/Output_columns'>Output columns</a>";default:return""}default:return""}};
function ResultTable(a,b,c,d){var e=this;this.id="ResultTable"+Math.round(1E7*Math.random());this.targetId=null;this.jobId=a;this.fileName=b;this.tags=c;this.numRows=10;this.flex=null;this.border=this.collapsible=!0;this.cls=null;"undefined"!=typeof d&&(this.targetId=d.targetId||this.targetId,this.numRows=d.numRows||this.numRows,this.flex=d.flex||this.flex,this.collapsible=d.collapsible||this.collapsible,this.border=d.border||this.border,this.cls=d.cls||this.cls,this.tableLayout=d.tableLayout||this.tableLayout);
this.adapter=new OpencgaManager;this.table=null;this.onRendered=new Event;this.onRendered.addEventListener(function(){e.draw()})}ResultTable.prototype.draw=function(){this.render()};
ResultTable.prototype.render=function(){var a=this,b=null,c=[],d=[];this.tableSkel=this.tableLayout;this.colNames=this.tableSkel.colNames;this.colVisibilty=this.tableSkel.colVisibility;this.colTypes=this.tableSkel.colTypes;for(var b=this.tableSkel.numRows,c=[],d=[],e=0;e<this.colNames.length;e++)1==this.colVisibilty[e]&&(c.push({header:this.colNames[e],dataIndex:this.colNames[e],flex:1}),d.push({name:this.colNames[e],type:this.colTypes[e]}));"text"==this.tableSkel.type?(c=new WumAdapter,c.onPoll.addEventListener(function(b,
c){for(var d=a.parse(c),e=[],k=0;k<d.length;k++){var l=Ext.create("Ext.container.Container",{data:d[0],tpl:a.getTemplate(a.tableSkel.colNames)});e.push(l)}this.table=Ext.create("Ext.container.Container",{items:e,margin:"0 0 0 50",renderTo:a.targetId})}),c.poll(this.jobId,this.fileName,!1,$.cookie("bioinfo_sid"))):(e=this.adapter.tableurl($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.jobId,this.fileName,this.colNames,this.colVisibilty),console.log(e),null==b&&(b=this.numRows),this.st=Ext.create("Ext.data.Store",
{fields:d,pageSize:b,remoteSort:!0,proxy:{type:"jsonp",url:e,reader:{type:"json",root:"items",totalProperty:"total"}}}),this.st.loadPage(1),this.table=Ext.create("Ext.grid.Panel",{title:this.fileName,collapsible:this.collapsible,flex:this.flex,store:this.st,border:this.border,cls:this.cls,columns:c,height:75+22*b,dockedItems:[{xtype:"pagingtoolbar",store:this.st,dock:"top",displayInfo:!0}],renderTo:this.targetId}))};
ResultTable.prototype.parse=function(a){for(var a=a.split("\n"),b=[],c=0;c<a.length;c++)if("#"!=a[c].charAt(0)&&""!=a[c]){for(var d=a[c].split("\t"),e={},f=0;f<d.length;f++)""!=d[f]&&(e[this.tableSkel.colNames[f].replace(/ /g,"_")]=d[f]);b.push(e)}return b};ResultTable.prototype.getTemplate=function(a){for(var b="<p>",c=0;c<a.length;c++)b+='<span class="dis s90">'+a[c]+" </span> {"+a[c].replace(/ /g,"_")+"} &nbsp; &nbsp; &nbsp;";return new Ext.XTemplate(b+"</p>")};
function BrowserDataWidget(a){var b=this;this.id="BrowserDataWidget_"+Math.round(1E7*Math.random());this.tags=this.targetId=null;this.width=900;this.height=500;this.retrieveData=!0;this.notAvailableSuiteList=["SEA","GSnow"];if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.retrieveData&&(this.retrieveData=a.retrieveData),null!=a.notAvailableSuites))for(var c=0;c<a.notAvailableSuites.length;c++)this.notAvailableSuiteList.push(a.notAvailableSuites[c]);
this.adapter=new WumAdapter;this.adapter.onGetData.addEventListener(function(a,c){b.data=c;b.adapter.getSuiteList()});this.adapter.onSuiteList.addEventListener(function(a,c){b.suiteList=c;Ext.getBody().unmask();b.render()});this.onSelect=new Event(this);this.searchFieldId=this.id+"_searchField"}BrowserDataWidget.prototype.draw=function(a,b){this.tags=b;Ext.getBody().mask("Loading...");this.adapter.getData(a,-1)};
BrowserDataWidget.prototype.render=function(){var a=this;if(null==this.panel){for(var b=JSON.parse(this.data),c={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},d=0;d<b.length;d++){var e=b[d].creationTime.substring(0,4),f=b[d].creationTime.substring(5,7),g=b[d].creationTime.substring(8,10),h=b[d].creationTime.substring(11,16);b[d].yearMonth=e+" - "+f+" ("+c[parseInt(f)]+")";b[d].dayHour=g+" - "+h;b[d].tagsMatch=
!1;null!=b[d].tags&&(b[d].tagsMatch=this.checkTags(b[d].tags))}this.gridStore=Ext.create("Ext.data.Store",{fields:"dataId ownerId jobId suiteId name multiple diskUsage creationTime responsible organization date description status statusMessage write enabled tags dataFiles yearMonth dayHour tagsMatch".split(" "),groupField:"yearMonth",sorters:[{property:"yearMonth",direction:"DESC"}],data:b});this.selectedLabel=Ext.create("Ext.toolbar.TextItem",{padding:3,flex:1,text:'<span class="info"> Please select a file</span>.'});
d=Ext.create("Ext.toolbar.TextItem",{padding:3,text:'Suported tags by this analysis: <span class="emph">'+this.tags.toString().replace(/,/gi,", ").replace(/\|/gi," or ")+"</span>"});this.grid=Ext.create("Ext.grid.Panel",{border:!1,store:this.gridStore,columns:[{header:"Name",flex:3,xtype:"templatecolumn",tpl:['<tpl if="tagsMatch"><span class="emph">{name}</span></tpl>','<tpl if="!tagsMatch"><span class="dis">{name}</span></tpl>']},{header:"Disk usage (KB)",dataIndex:"diskUsage",flex:1.2},{header:"Year & Month",
dataIndex:"yearMonth",flex:1.3},{header:"Day & Time",dataIndex:"dayHour",flex:1},{header:"Tags",dataIndex:"tags",flex:1}],features:[{ftype:"grouping"}],selModel:{mode:"SINGLE",listeners:{scope:this,selectionchange:function(a,b){0<b.length?b[0].data.tagsMatch?(this.selectButton.enable(),this.selectedLabel.setText('<p>The selected file <span class="emph">'+b[0].data.name.substr(0,40)+'</span><span class="ok"> is allowed</span>.</p>',!1)):(this.selectButton.disable(),this.selectedLabel.setText('<p>The selected file <span class="dis">'+
b[0].data.name.substr(0,40)+'</span><span class="err"> is not allowed</span>.</p>',!1)):this.selectButton.disable()}}},flex:4,bbar:{items:[d,"-",this.selectedLabel]}});d=Ext.create("Ext.data.Store",{fields:["suiteId","name"],data:[{suiteId:"all",name:"all"},{suiteId:"Uploaded Data",name:"Uploaded Data"},{suiteId:"Job Generated",name:"Job Generated"}]});this.viewOrigin=Ext.create("Ext.view.View",{store:d,selModel:{mode:"SINGLE",listeners:{selectionchange:function(){a.setFilter()}}},cls:"list",trackOver:!0,
overItemCls:"list-item-hover",itemSelector:".list-item",tpl:'<tpl for="."><div class="list-item">{name}</div></tpl>'});b=Ext.create("Ext.panel.Panel",{title:"Search by origin",border:0,bodyPadding:5,style:"border-bottom:1px solid #99bce8;",items:[this.viewOrigin]});c=JSON.parse(this.suiteList);e=[];for(d=0;d<c.length;d++)-1==this.notAvailableSuiteList.indexOf(c[d].name)&&e.push(c[d]);d=Ext.create("Ext.data.Store",{fields:["suiteId","name","description"],data:e});this.viewSuite=Ext.create("Ext.view.View",
{store:d,selModel:{mode:"SINGLE",listeners:{selectionchange:function(){a.setFilter()}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".list-item",tpl:'<tpl for="."><div class="list-item">{name}</div></tpl>'});d=Ext.create("Ext.panel.Panel",{title:"Search by suite",border:0,bodyPadding:5,items:[this.viewSuite]});this.searchField=Ext.create("Ext.form.field.Text",{id:this.searchFieldId,flex:1,emptyText:"enter search term",enableKeyEvents:!0,listeners:{scope:this,change:this.setFilter}});
d=Ext.create("Ext.panel.Panel",{minWidth:125,minHeight:370,flex:1,cls:"panel-border-right",border:!1,items:[b,d],tbar:{items:this.searchField}});this.selectButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){var b=a.grid.getSelectionModel().getSelection()[0];!0==a.retrieveData&&a.adapter.readData($.cookie("bioinfo_sid"),b.data.dataFiles[0].dataId,b.data.dataFiles[0].filename);a.onSelect.notify(b.data.dataFiles[0]);a.panel.close()}});this.panel=Ext.create("Ext.window.Window",
{title:"Browse Data",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[d,this.grid],buttonAlign:"right",buttons:[{text:"Close",handler:function(){a.panel.close()}},this.selectButton],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show();this.viewOrigin.getSelectionModel().select(this.viewOrigin.store.first());this.viewSuite.getSelectionModel().select(this.viewSuite.store.first())};
BrowserDataWidget.prototype.setFilter=function(){var a=this,b=this.viewOrigin.getSelectionModel().getSelection()[0],c=this.viewSuite.getSelectionModel().getSelection()[0];this.gridStore.clearFilter();if(null!=b)switch(b.data.suiteId){case "Uploaded Data":this.gridStore.filter(function(a){return 0>a.data.jobId});break;case "Job Generated":this.gridStore.filter(function(a){return 0<a.data.jobId})}if(null!=c)switch(c.data.suiteId){case 1:break;default:this.gridStore.filter(function(a){return a.data.suiteId==
c.data.suiteId})}this.gridStore.filter(function(b){var c=Ext.getCmp(a.searchFieldId).getValue().toLowerCase();return 0>b.data.name.toLowerCase().indexOf(c)?!1:!0})};BrowserDataWidget.prototype.checkTags=function(a){for(var b=0;b<this.tags.length;b++)if(-1<this.tags[b].indexOf("|")){for(var c=this.tags[b].split("|"),d=!1,e=0;e<c.length;e++)-1<a.indexOf(c[e])&&(d=!0);if(!d)return!1}else if(-1==a.indexOf(this.tags[b]))return!1;return!0};
function OpencgaBrowserWidget(a){var b=this;"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId,this.title=a.title||this.title,this.width=a.width||this.width,this.height=a.height||this.height);this.adapter=new OpencgaManager;this.adapter.onCreateBucket.addEventListener(function(a,d){d.indexOf("ERROR")!=-1?Ext.Msg.alert("Create project","ERROR: could not create this project."):b.onNeedRefresh.notify();b.panel.setLoading(false);Ext.getBody().unmask()});this.uploadWidget=new UploadWidget({suiteId:a.suiteId,
opencgaBrowserWidget:this});this.uploadWidget.adapter.onUploadObjectToBucket.addEventListener(function(a,d){d.status=="done"&&b.onNeedRefresh.notify()});this.searchFieldId=this.id+"_searchField"}
OpencgaBrowserWidget.prototype={id:"OpencgaBrowserWidget_"+Math.round(1E7*Math.random()),title:"Cloud data",onSelect:new Event(this),onNeedRefresh:new Event(this),width:800,height:375,rendered:!1,draw:function(a){this.render(a);this.rendered=!0},setAccountData:function(a){this.accountData=a;this.rendered&&this._updateFolderTree()},_updateFolderTree:function(){console.log("updating folder tree");if(null!=this.accountData&&null!=this.accountData.accountId){this.folderStore.getRootNode().removeAll();
this.allStore.getRootNode().removeAll();this.filesStore.removeAll();for(var a=0;a<this.accountData.buckets.length;a++){for(var b=[],c=0;c<this.accountData.buckets[a].objects.length;c++){var d=this.accountData.buckets[a].objects[c];d.bucketId=this.accountData.buckets[a].id;null!=d.id&&(d.oid=d.id,delete d.id);var e=d.oid.split("/");"dir"==d.fileType?(d.expanded=!0,d.icon=Utils.images.dir):(d.leaf=!0,d.icon=Utils.images.r);for(var f=b,g=0;g<e.length;g++){var h;a:{for(h=0;h<f.length;h++)if(f[h].text==
e[g])break a;h=-1}if(-1!=h)f=f[h].children;else{h=[];var j=f.push({text:e[g],children:h})-1;if("undefined"==typeof e[g+1])for(key in d)"children"!=key&&(f[j][key]=d[key]);f=h}}}b=JSON.stringify(b);this.allStore.getRootNode().appendChild({text:this.accountData.buckets[a].name,bucketId:this.accountData.buckets[a].name,oid:"",icon:Utils.images.bucket,expanded:!0,isBucket:!0,children:JSON.parse(b)});this.folderStore.getRootNode().appendChild({text:this.accountData.buckets[a].name,bucketId:this.accountData.buckets[a].name,
oid:"",icon:Utils.images.bucket,expanded:!0,isBucket:!0,children:JSON.parse(b)})}}this.folderStore.getRootNode().collapse();this.folderStore.getRootNode().expand();null!=this.selectedFolderNode&&(a=this.folderTree.getRootNode().findChild(this.selectedFolderNode.field,this.selectedFolderNode.value,!0),null!=a&&this.folderTree.getSelectionModel().select(a));null!=this.selectedFileNode&&(a=this.filesGrid.getStore().findExact("oid",this.selectedFileNode.oid),-1!=a&&this.filesGrid.getSelectionModel().select(a))},
addUpload:function(a,b){var c=Ext.create("Ext.ProgressBar",{text:"Ready",width:250,margin:"4 6 0 6"}),d=Ext.create("Ext.Component",{html:a.name.substr(0,67),width:430,margin:"7 6 0 6"}),e=Ext.create("Ext.Button",{text:'<span style="color:#1155cc">Cancel</span>',margin:"3 6 0 4",width:50,handler:function(){b.terminate();f.destroy()}}),f=Ext.create("Ext.container.Container",{padding:"3 6 0 6",layout:"hbox",items:[d,c,e]});b.onmessage=function(a){a=a.data;console.log("@@@@@@@@@@@@@@@@ WORKER event message");
console.log(a);c.updateProgress((a.chunkId+1)/a.total,"uploading part "+(a.chunkId+1)+" of "+a.total,!1);!0==a.finished&&e.setText('<span style="color:#1155cc">Done </span>')};this.activeUploadsCont.add(f);Ext.getCmp(this.id+"activeUploadsButton").toggle(!0)},viewBuckets:function(){this.panel.removeAll(!1);this.panel.add(this.panAccordion);this.panel.add(this.filesGrid)},viewUploads:function(){this.panel.removeAll(!1);this.panel.add(this.activeUploadsCont)}};
OpencgaBrowserWidget.prototype.render=function(a){var b=this;if(null==this.panel){this.folderStore=Ext.create("Ext.data.TreeStore",{id:this.id+"folderStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:[]},listeners:{beforeappend:function(a,b){if(b.isLeaf())return!1}}});this.allStore=Ext.create("Ext.data.TreeStore",{id:this.id+"allStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:[]}});this.filesStore=Ext.create("Ext.data.Store",{fields:"oid fileBioType fileType fileFormat fileName multiple diskUsage creationTime responsible organization date description status statusMessage members".split(" "),
data:[]});var c=Ext.create("Ext.Action",{icon:Utils.images.refresh,text:"Refresh bucket",handler:function(){var a=b.folderTree.getSelectionModel().getSelection()[0];if(a&&a.raw.isBucket){var c=new OpencgaManager;c.onRefreshBucket.addEventListener(function(a,c){Ext.example.msg("Refresh Bucket",'</span class="emph">'+c+"</span>");-1!=c.indexOf("ERROR")?console.log(c):b.onNeedRefresh.notify()});c.refreshBucket($.cookie("bioinfo_account"),a.raw.text,$.cookie("bioinfo_sid"))}}}),d=Ext.create("Ext.Action",
{text:"Rename bucket",handler:function(){var a=b.folderTree.getSelectionModel().getSelection()[0];a&&a.raw.isBucket&&Ext.Msg.prompt("Rename bucket","Please enter a new name:",function(c,d){if("ok"==c){var d=d.replace(/[^a-z0-9-_.\/\s]/gi,"").trim(),e=new OpencgaManager;e.onRenameBucket.addEventListener(function(a,c){Ext.example.msg("Refresh Bucket",'</span class="emph">'+c+"</span>");-1!=c.indexOf("ERROR")?console.log(c):b.onNeedRefresh.notify()});e.renameBucket($.cookie("bioinfo_account"),a.raw.bucketId,
d,$.cookie("bioinfo_sid"))}},null,null,"new name")}});this.folderTree=Ext.create("Ext.tree.Panel",{id:this.id+"activeTracksTree",title:"Upload & Manage",bodyPadding:"5 0 0 0",margin:"-1 0 0 0",border:!1,autoScroll:!0,flex:4,useArrows:!0,rootVisible:!1,hideHeaders:!0,columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,editor:{xtype:"textfield",allowBlank:!1}}],viewConfig:{markDirty:!1,plugins:{ptype:"treeviewdragdrop"},listeners:{drop:function(a,c){var d=c.records[0];d.isLeaf()&&(d.data.index!=d.removedFrom&&
d.data.checked)&&b.setTrackIndex(d.data.trackId,d.data.index)},itemcontextmenu:function(a,b,e,f,g){g.stopEvent();a=[];console.log(b);b.raw.isBucket&&(a.push(c),a.push(d),Ext.create("Ext.menu.Menu",{items:a}).showAt(g.getXY()));return!1}}},listeners:{selectionchange:function(c,d){var e=d[0];if("undefined"!=typeof e){var f,g;null!=e.raw.isBucket?(f="text",g=!1):(f="oid",g=!0);var e=b.allStore.getRootNode().findChild(f,e.raw[f],g),h=[];b.selectedFolderNode={value:e.data[f],field:f};e.eachChild(function(a){h.push(a.raw)});
b.filesGrid.setTitle(e.getPath("text"," / "));b.filesStore.loadData(h);"folderSelection"==a&&(b.selectedFileNode=e.raw,b.selectButton.enable())}},viewready:function(a){setTimeout(function(){var b=a.getRootNode().getChildAt(0);"undefined"!=typeof b&&a.getSelectionModel().select(b)},0)},checkchange:function(){},itemmouseenter:function(){},itemmouseleave:function(){}},store:this.folderStore});var e=Ext.create("Ext.button.Button",{text:"OK",handler:function(){b.createProject();b.folderTree.toggleCollapse()}}),
f=Ext.create("Ext.form.field.Text",{id:this.id+"newProjectNameField",emptyText:"name",allowBlank:!1}),g=Ext.create("Ext.form.field.TextArea",{id:this.id+"newProjectDescriptionField",emptyText:"description"});Ext.create("Ext.container.Container",{flex:1,layout:{type:"hbox",align:"stretch"},items:[f,g]});var h=Ext.create("Ext.panel.Panel",{title:"Create bucket",bodyPadding:5,border:!1,items:[f,g,e]}),j=Ext.create("Ext.Action",{icon:Utils.images.info,text:"Create index",handler:function(){var a=b.filesGrid.getSelectionModel().getSelection()[0];
if(a){var c=new OpencgaManager;c.onIndexer.addEventListener(function(b,c){console.log(c);Ext.example.msg("indexer",c);a.raw.indexerId=c});c.indexer($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),a.raw.bucketId,a.data.oid)}}}),k=Ext.create("Ext.Action",{text:"Show name",handler:function(){var a=b.filesGrid.getSelectionModel().getSelection()[0];a&&Ext.example.msg("objectId",""+a.get("oid"))}}),l=Ext.create("Ext.Action",{icon:Utils.images.del,text:"Delete this file",handler:function(){var a=b.filesGrid.getSelectionModel().getSelection()[0];
a&&Ext.MessageBox.confirm("Confirm",'Are you sure you want to delete this file?<p class="emph">'+a.data.fileName+"<p>",function(c){"yes"==c&&(console.log("deleting"),c=new OpencgaManager,c.onDeleteObjectFromBucket.addEventListener(function(c,d){-1!=d.indexOf("ERROR:")?Ext.example.msg("Deleting",d):(a.destroy(),b.onNeedRefresh.notify())}),c.deleteObjectFromBucket($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),a.raw.bucketId,a.data.oid))})}});this.filesGrid=Ext.create("Ext.grid.Panel",{title:this.allStore.getRootNode().getPath("text",
" / "),store:this.filesStore,flex:4,border:!1,viewConfig:{stripeRows:!0,listeners:{itemcontextmenu:function(a,b,c,d,e){e.stopEvent();a=[k];console.log(b);("bam"==b.raw.fileFormat||"vcf"==b.raw.fileFormat)&&a.push(j);a.push(l);Ext.create("Ext.menu.Menu",{items:a}).showAt(e.getXY());return!1}}},selModel:{mode:"SINGLE",listeners:{selectionchange:function(c,d){0<d.length?(b.selectedFileNode=d[0].raw,"fileSelection"==a&&"dir"==d[0].raw.fileType||b.selectButton.enable()):b.selectButton.disable()}}},columns:[{text:"File type",
xtype:"actioncolumn",menuDisabled:!0,align:"center",width:54,icon:Utils.images.bluebox,renderer:function(a,b,c){this.icon=Utils.images[c.data.fileType];this.tooltip=c.data.fileType}},{text:"Name",dataIndex:"fileName",flex:2},{text:"Creation time",dataIndex:"creationTime",flex:1}]});this.panAccordion=Ext.create("Ext.panel.Panel",{minWidth:125,minHeight:250,flex:1,cls:"panel-border-right",border:!1,layout:"accordion",items:[this.folderTree,h]});this.selectButton=Ext.create("Ext.button.Button",{text:"Ok",
disabled:!0,handler:function(){b.onSelect.notify({id:b.selectedFileNode.oid,bucketId:b.selectedFileNode.bucketId});b.panel.close()}});this.activeUploadsCont=Ext.create("Ext.container.Container",{autoScroll:!0,items:[]});e={items:[]};switch(a){case "folderSelection":f={text:"New folder",handler:function(){b.folderTree.expand();b.createFolder()}};e.items.splice(0,0,f);f={text:"New bucket",handler:function(){h.expand()}};e.items.splice(0,0,f);this.filesStore.filter("fileType",/dir/);break;case "manager":f=
{text:"Upload",handler:function(){b.drawUploadWidget()}};e.items.splice(0,0,f);f={text:"New folder",handler:function(){b.folderTree.expand();b.createFolder()}};e.items.splice(0,0,f);f={text:"New bucket",handler:function(){h.expand()}};e.items.splice(0,0,f);this.selectButton.hide();break;default:f={text:"Upload",handler:function(){b.drawUploadWidget()}},e.items.splice(0,0,f),f={text:"New folder",handler:function(){b.folderTree.expand();b.createFolder()}},e.items.splice(0,0,f),f={text:"New bucket",
handler:function(){h.expand()}},e.items.splice(0,0,f)}e.items.push({id:this.id+"activeUploadsButton",text:"Active uploads",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?b.viewUploads():b.viewBuckets()}});this.panel=Ext.create("Ext.window.Window",{title:"Upload & Manage",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},tbar:e,items:[this.panAccordion,this.filesGrid],buttonAlign:"right",buttons:[{text:"Close",
handler:function(){b.onSelect=new Event;b.panel.hide()}},this.selectButton],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this._updateFolderTree();this.panel.show()};
OpencgaBrowserWidget.prototype.setFilter=function(){var a=this,b=this.viewOrigin.getSelectionModel().getSelection()[0],c=this.viewSuite.getSelectionModel().getSelection()[0];this.folderStore.clearFilter();if(null!=b)switch(b.data.suiteId){case "Uploaded Data":this.folderStore.filter(function(a){return 0>a.data.jobId});break;case "Job Generated":this.folderStore.filter(function(a){return 0<a.data.jobId})}if(null!=c)switch(c.data.suiteId){case 1:break;default:this.folderStore.filter(function(a){return a.data.suiteId==
c.data.suiteId})}this.folderStore.filter(function(b){var c=Ext.getCmp(a.searchFieldId).getValue().toLowerCase();return 0>b.data.name.toLowerCase().indexOf(c)?!1:!0})};OpencgaBrowserWidget.prototype.checkTags=function(a){for(var b=0;b<this.tags.length;b++)if(-1<this.tags[b].indexOf("|")){for(var c=this.tags[b].split("|"),d=!1,e=0;e<c.length;e++)-1<a.indexOf(c[e])&&(d=!0);if(!d)return!1}else if(-1==a.indexOf(this.tags[b]))return!1;return!0};
OpencgaBrowserWidget.prototype.createProject=function(){var a=Ext.getCmp(this.id+"newProjectNameField").getValue(),b=Ext.getCmp(this.id+"newProjectDescriptionField").getValue();""!=a&&(Ext.getBody().mask(),this.panel.setLoading("Creating project"),this.adapter.createBucket(a,b,$.cookie("bioinfo_account"),$.cookie("bioinfo_sid")))};
OpencgaBrowserWidget.prototype._getFolderTreeSelection=function(){var a=this.folderTree.getSelectionModel().getSelection();if(1>a.length)return Ext.example.msg("No folder selected","Please select a bucket or a folder."),null;var b=a[0],a="";null!=b.raw.fileType&&"dir"==b.raw.fileType?(a=b.getPath("text","/").substr(1),b=a.split("/",2),a=a.replace(b.join("/"),"").substr(1)+"/",b=b[1]):b=b.raw.text;return{bucketId:b,directory:a}};
OpencgaBrowserWidget.prototype.drawUploadWidget=function(){var a=this._getFolderTreeSelection();null!=a&&this.uploadWidget.draw(a)};
OpencgaBrowserWidget.prototype.createFolder=function(){var a=this;if(1>this.accountData.buckets.length)Ext.MessageBox.alert("No buckets found","Please create and select a bucket.");else{var b=this._getFolderTreeSelection();null!=b&&Ext.Msg.prompt("New folder","Please enter a name for the new folder:",function(c,d){if("ok"==c){var d=d.replace(/[^a-z0-9-_.\s]/gi,""),d=d.trim()+"/",e=new OpencgaManager;e.onCreateDirectory.addEventListener(function(b,c){Ext.example.msg("Create folder",'</span class="emph">'+
c+"</span>");-1!=c.indexOf("ERROR")?console.log(c):a.onNeedRefresh.notify()});e.createDirectory($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.bucketId,b.directory+d)}},null,null,"New Folder")}};
function ManageProjectsWidget(a){this.id="ManageProjectsWidget_"+Math.round(1E4*Math.random());this.title=this.targetId=null;this.width=880;this.height=420;this.suiteId=-1;this.args=a;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.suiteId))this.suiteId=a.suiteId;this.selectedItems={};this.lastSelectedItem=this.selectedProjectJobs=this.selectedProjectSuiteId=this.selectedProjectName=
this.selectedProjectId=null;this._storeProjects=Ext.create("Ext.data.Store",{fields:["name","projectId","jobs","active"],data:[]});this.deleting=!1;this.onRefreshProjectList=new Event}ManageProjectsWidget.prototype.draw=function(){var a=this;this._render();this._panel.show();this.refreshListProject();this.interval=setInterval(function(){a.refreshListProject()},4E3)};ManageProjectsWidget.prototype.getPanel=function(a){this._render("panel",a);return this._panel};
ManageProjectsWidget.prototype._render=function(a,b){var c=this;if(null==this._panel){var d=Ext.create("Ext.view.View",{id:this.id+"viewProject",store:this._storeProjects,selModel:{mode:"SINGLE",listeners:{selectionchange:function(a,b){0<b.length&&(null==b[0].data.jobs&&(b[0].data.jobs=[]),c.optionProjectClick(b[0].data))}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".list-item",tpl:'<tpl for="."><div class="list-item">{name}</div></tpl>'}),e=Ext.create("Ext.button.Button",
{text:"OK",handler:function(){c.optionProjectClick("newProject");h.toggleCollapse()}}),f=Ext.create("Ext.form.field.Text",{id:this.id+"newProjectNameField",width:210,emptyText:"name",allowBlank:!1}),g=Ext.create("Ext.form.field.TextArea",{id:this.id+"newProjectDescriptionField",width:210,emptyText:"description"});Ext.create("Ext.container.Container",{flex:1,layout:{type:"hbox",align:"stretch"},items:[f,g]});var h=Ext.create("Ext.panel.Panel",{title:"Create Project",bodyPadding:5,border:!1,items:[f,
g,e]}),e=Ext.create("Ext.form.field.Text",{flex:1,emptyText:"search project",enableKeyEvents:!0,listeners:{change:function(){var a=this.getValue().toLowerCase();c._storeProjects.clearFilter();c._storeProjects.filter(function(b){return 0>b.data.name.toLowerCase().indexOf(a)?!1:!0})}}}),f=Ext.create("Ext.button.Button",{id:this.id+"rBtn",iconCls:"icon-rename-project",tooltip:"Rename selected project",margin:"0 0 0 2",handler:function(){c.renameProject(c.selectedProjectId,c.selectedProjectName)}}),g=
Ext.create("Ext.button.Button",{id:this.id+"dBtn",iconCls:"icon-project-delete",tooltip:"Delete selected project",margin:"0 0 0 2",handler:function(){c.deleteProject(c.selectedProjectId,c.selectedProjectSuiteId,c.selectedProjectJobs)}}),j=Ext.create("Ext.button.Button",{id:this.id+"aBtn",iconCls:"icon-change-project",tooltip:"Active selected project",margin:"0 0 0 2",handler:function(){c.activeProject(c.selectedProjectId,c.selectedProjectName)}}),e=Ext.create("Ext.panel.Panel",{layout:"hbox",flex:1,
border:!1,items:[e,f,g,j]}),d=Ext.create("Ext.panel.Panel",{title:"Project list",flex:1,border:!1,autoScroll:!0,bodyPadding:5,items:[e,d]}),d=Ext.create("Ext.panel.Panel",{border:!1,minWidth:220,width:220,layout:"accordion",items:[d,h]});this._panel="panel"==a?Ext.create("Ext.panel.Panel",{title:"Manage projects",renderTo:b,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:d}):Ext.create("Ext.window.Window",{title:"Manage projects",iconCls:"icon-project-manager",resizable:!1,
minimizable:!1,constrain:!0,closable:!0,modal:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:d,listeners:{minimize:function(){c._panel.hide()},close:function(){clearInterval(c.interval);null!=c._panel.getComponent(1)&&(c._panel.getComponent(1).hide(),c._panel.remove(1,!1));delete c._panel}}})}};
ManageProjectsWidget.prototype.optionProjectClick=function(a){this.selectedItems={};var b=a.name;this.selectedProjectName!=b&&(this.lastSelectedItem=null);this.selectedProjectId=a.projectId;this.selectedProjectName=b;this.selectedProjectSuiteId=a.suiteId;this.selectedProjectJobs=a.jobs;null!=this._panel.getComponent(1)&&(this._panel.getComponent(1).hide(),this._panel.remove(1,!1));switch(a){case "newProject":this.createProject();break;default:this._panel.add(this.getByProjectGrid(a.jobs,b).show())}};
ManageProjectsWidget.prototype.getByProjectGrid=function(a,b){for(var c={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August","09":"September",10:"October",11:"November",12:"December"},d=null,e=[],f=0;f<a.length;f++)0<=a[f].visites&&(monthNumStr=a[f].creationTime.substr(5,2),d=parseInt(monthNumStr),a[f].creationMonth=a[f].creationTime.substr(0,4)+" - "+monthNumStr+" ("+c[d]+")",e.push(a[f]));null==this[b+"Grid"]&&(this[b+"Grid"]=this.doGrid([{header:"Name",dataIndex:"name",
flex:1},{header:"Launched on",dataIndex:"creationTime",flex:0.7},{header:"Tool name",dataIndex:"toolName",flex:1}],["name","creationTime","toolName","creationMonth","jobId"],b,"creationMonth"));if(null!=this.lastSelectedItem)var g=this.lastSelectedItem.data.jobId;this.deleting||this[b+"Grid"].store.loadData(e);null!=this.lastSelectedItem&&this[b+"Grid"].getSelectionModel().select(this[b+"Grid"].store.find("jobId",g));return this[b+"Grid"]};
ManageProjectsWidget.prototype.doGrid=function(a,b,c,d){var e=this;Ext.define(c,{extend:"Ext.data.Model",fields:b});b=Ext.create("Ext.data.Store",{groupField:d,sorters:[{property:"creationMonth",direction:"DESC"},{property:"creationTime",direction:"DESC"}],model:c});return Ext.create("Ext.grid.Panel",{id:this.id+c,store:b,title:"Jobs of project "+c,border:!1,cls:"panel-border-left",flex:3,multiSelect:!1,features:[{ftype:"grouping"}],columns:a,listeners:{selectionchange:function(a,b){if(null!=b[0]){e.selectedItems=
{};for(var c=0;c<b.length;c++)e.selectedItems[b[c].data.jobId]=b[c],e.lastSelectedItem=b[c]}}},tbar:[{id:"deleteButton",text:"Delete selected job",iconCls:"icon-delete",handler:function(){e.deleteJob(c)}}]})};
ManageProjectsWidget.prototype.deleteJob=function(a){var b=this;this.deleting=!0;Ext.Msg.confirm("Delete job","Are you sure you want to delete the selected job(s)?",function(c){"yes"==c&&(b[a+"Grid"].store.remove(b.lastSelectedItem),c=new WumAdapter,c.onDeleteJob.addEventListener(function(a,c){console.log("back from delete "+c.response);-1!=c.response.indexOf("OK")?b.deleting=!1:Ext.Msg.alert("Delete job","ERROR: could not delete job.")}),c.deleteJob(b.lastSelectedItem.data.jobId,$.cookie("bioinfo_sid")),
b.lastSelectedItem=null)})};
ManageProjectsWidget.prototype.createProject=function(){var a=this,b=Ext.getCmp(this.id+"newProjectNameField").getValue(),c=Ext.getCmp(this.id+"newProjectDescriptionField").getValue();if(""!=b){var d=new WumAdapter;d.onCreateProject.addEventListener(function(b,c){-1!=c.indexOf("ERROR")?Ext.Msg.alert("Create project","ERROR: could not create this project."):a.refreshListProject();a._panel.setLoading(!1);Ext.getBody().unmask()});Ext.getBody().mask();a._panel.setLoading("Creating project");d.createProject(b,
c,$.cookie("bioinfo_sid"))}};
ManageProjectsWidget.prototype.renameProject=function(a,b){var c=this,d=Ext.create("Ext.form.field.Text",{fieldLabel:"New name",labelWidth:70,width:200,minWidth:200,allowBlank:!1}),e=Ext.create("Ext.toolbar.TextItem",{padding:3,text:'<span class="info">Type the new project name</span>'});this.pan=Ext.create("Ext.panel.Panel",{bodyPadding:20,height:100,border:!1,bbar:{items:[e]},items:[d]});this.renameWindow=Ext.create("Ext.window.Window",{title:"Rename project "+b,resizable:!1,closable:!0,constrain:!0,
modal:!0,items:this.pan,buttons:["->",{text:"Ok",handler:function(){var b=d.getValue();if(""!=b){var e=new WumAdapter;e.onRenameProject.addEventListener(function(a,d){-1!=d.indexOf("OK")?(Ext.getCmp(c.id+c.selectedProjectName).setTitle("Jobs of project "+b),c.refreshListProject()):Ext.Msg.alert("Rename project","ERROR: could not rename this project.")});e.renameProject(a,b,$.cookie("bioinfo_sid"));c.renameWindow.close()}}}]});this.renameWindow.show()};
ManageProjectsWidget.prototype.deleteProject=function(a,b){var c=this;Ext.Msg.confirm("Delete project","Are you sure you want to delete this project?",function(d){"yes"==d&&(d=new WumAdapter,d.onDeleteProject.addEventListener(function(a,b){-1!=b.indexOf("OK")?(c.refreshListProject(),null!=c._panel.getComponent(1)&&(c._panel.getComponent(1).hide(),c._panel.remove(1,!1))):Ext.Msg.alert("Delete project","ERROR: could not delete this project. Project must not have jobs to be deleted.");c._panel.setLoading(!1);
Ext.getBody().unmask()}),Ext.getBody().mask(),c._panel.setLoading("Deleting project"),d.deleteProject(a,$.cookie("bioinfo_sid"),b))})};
ManageProjectsWidget.prototype.refreshListProject=function(){var a=this,b=new WumAdapter;b.onListProject.addEventListener(function(b,d){d=JSON.parse(d);a._storeProjects.loadData(d);for(var e=null,f=[],g=0;g<d.length;g++)f.push({name:d[g].name,projectId:d[g].projectId}),d[g].active&&(e=d[g].projectId,a.selectedProjectName=d[g].name);null==a.selectedProjectId&&(a.selectedProjectId=e);a._panel.setTitle('Manage projects - <b class="err">'+a.selectedProjectName+"</b>");e=a._storeProjects.find("projectId",
a.selectedProjectId);Ext.getCmp(a.id+"viewProject").getSelectionModel().select(e);a.onRefreshProjectList.notify(f)});b.listProject($.cookie("bioinfo_sid"),a.suiteId)};
ManageProjectsWidget.prototype.activeProject=function(a,b){var c=this,d=new WumAdapter;d.onActiveProject.addEventListener(function(a,d){-1!=d.indexOf("ERROR")?Ext.Msg.alert("Create project","ERROR: could not active this project."):(Ext.getCmp("UserBarWidget__spltbtnActiveProjectID").setText('<b class="emph">'+b+"</b>"),c._panel.setTitle('Manage projects - <b class="err">'+b+"</b>"));c._panel.setLoading(!1);Ext.getBody().unmask()});Ext.getBody().mask();this._panel.setLoading("Loading project");d.activeProject(a,
$.cookie("bioinfo_sid"))};
function CheckBrowser(a){Ext.isIE&&(window.console&&"undefined"==typeof window.console.time)&&(console.time=function(a,b){if(a){var e=(new Date).getTime();console.timeCounters||(console.timeCounters={});var f="KEY"+a.toString();if(b||!console.timeCounters[f])console.timeCounters[f]=e}},console.timeEnd=function(a){var b=(new Date).getTime();if(console.timeCounters){var e="KEY"+a.toString(),f=console.timeCounters[e];if(f){var g=b-f;console.info(a+": "+g+"ms");delete console.timeCounters[e]}return g}});var b=
!1;switch(a){case "renato":16<=Ext.chromeVersion&&(b=!0);5<=Ext.safariVersion&&(b=!0);10<=Ext.firefoxVersion&&(b=!0);break;case "variant":16<=Ext.chromeVersion&&(b=!0);5<=Ext.safariVersion&&(b=!0);10<=Ext.firefoxVersion&&(b=!0);break;default:14<=Ext.chromeVersion&&(b=!0),5<=Ext.safariVersion&&(b=!0),5<=Ext.isIE10&&(b=!0)}!1==b&&(console.log("--------------------------------------------"+b),$("#checkBrowser").html("This application provides the best user experience with Google Chrome and Apple Safari, otherwise some latencies may be experienced when browsing due to some problems in Firefox.").css("width",
"540px").css("height","40px").css("position","absolute").css("margin-left","300px").css("margin-top","26px").css("padding","5px").css("border","1px solid #F1D031").css("background","#FFFFA3").css("color","#555").css("position","absolute").css("z-index","50000").click(function(){$("#checkBrowser").fadeOut(function(){$(this).remove()})}))}
function FileWidget(a){this.targetId=null;this.id="FileWidget_"+Math.round(1E5*Math.random());this.wum=!0;this.tags=[];this.args=a;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title,this.id=this.title+this.id),null!=a.wum&&(this.wum=a.wum),null!=a.tags&&(this.tags=a.tags),null!=a.viewer))this.viewer=a.viewer;this.dataAdapter=null;this.onOk=new Event(this);this.chartWidgetByChromosome=new ChartWidget({height:200,width:570})}
FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()};FileWidget.prototype.getFileFromServer=function(){};FileWidget.prototype.loadFileFromLocal=function(){};FileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};
FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",flex:1,padding:1,emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Browse local",listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];debugger;a.trackNameField.setValue(b.name);a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1);a.loadFileFromLocal(b);
a.panel.setLoading(!1)}}}})};
FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">No file loaded</span>'});b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add(this.getFileUpload());this.panel=Ext.create("Ext.panel.Panel",{border:!1,cls:"panel-border-top panel-border-bottom",height:230,title:"Previsualization",items:this.getChartItems(),
bbar:b});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});b=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished());this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{});this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,
handler:function(){a.onOk.notify({fileName:a.file.name,adapter:a.adapter});a.openDialog.close()}});this.openDialog=Ext.create("Ext.ux.Window",{title:"Open "+this.title+" file",taskbar:Ext.getCmp(this.args.viewer.id+"uxTaskbar"),width:600,resizable:!1,items:[c,b],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()};
FileWidget.prototype._loadChartInfo=function(){var a=[],b;for(b in this.adapter.featuresByChromosome)a.push({features:this.adapter.featuresByChromosome[b],chromosome:b});this.chartWidgetByChromosome.getStore().loadData(a);this.panel.setLoading(!1);this.featureCountLabel.setText("Features count: "+this.adapter.featuresCount,!1)};FileWidget.prototype.sessionInitiated=function(){};FileWidget.prototype.sessionFinished=function(){};
function LegendWidget(a){this.height=this.width=300;this.title="Legend";if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height;this.legendPanel=new LegendPanel}
LegendWidget.prototype.draw=function(a){var b=this;null==this.panel&&(a=this.legendPanel.getPanel(a),this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,width:a.width+10,height:a.height+70,items:[a],buttonAlign:"right",layout:{type:"hbox",align:"stretch"},buttons:[{text:"Close",handler:function(){b.panel.close()}}]}));this.panel.show()};
function LegendPanel(a){this.width=200;this.height=250;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height}
LegendPanel.prototype.getColorItems=function(a){panelsArray=[];for(var b in a){var c=Ext.create("Ext.draw.Component",{width:15,height:15,items:[{type:"rect",fill:a[b],x:0,y:0,width:15,height:15}]}),d=Utils.formatText(b,"_"),c=Ext.create("Ext.panel.Panel",{height:15,border:!1,flex:1,margin:"1 0 0 1",layout:{type:"hbox",align:"stretch"},items:[c,{xtype:"tbtext",text:d,margin:"1 0 0 3"}]});panelsArray.push(c)}return panelsArray};
LegendPanel.prototype.getPanel=function(a){null==this.panel&&(a=this.getColorItems(a),this.panel=Ext.create("Ext.panel.Panel",{bodyPadding:"0 0 0 2",border:!1,layout:{type:"vbox",align:"stretch"},items:a,width:this.width,height:20*a.length}));return this.panel};LegendPanel.prototype.getButton=function(a){null==this.button&&(this.button=Ext.create("Ext.button.Button",{text:this.title,menu:{plain:!0,items:[this.getPanel(a)]}}));return this.button};
function UrlWidget(a){this.id="UrlWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.title="Custom url";this.width=500;this.height=400;if(null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height;this.onAdd=new Event(this)}UrlWidget.prototype.draw=function(){null==this.panel&&this.render();this.panel.show()};
UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,width:this.width-55,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}});this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasAdapter({url:a.urlField.getValue(),
featureCache:{gzip:!1,chunkSize:1E4}});b.onCheckUrl.addEventListener(function(b,d){console.log(d.data);a.contentArea.setValue(d.data);a.form.setLoading(!1)});b.onError.addEventListener(function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin");a.form.setLoading(!1)});b.checkUrl()}});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",
flex:1});this.panelSettings=Ext.create("Ext.panel.Panel",{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,width:this.width-2,items:[this.trackNameField]});this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height});this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false",items:[this.urlField,this.checkButton]});this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,
this.panelSettings]});this.panel=Ext.create("Ext.ux.Window",{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.onAdd.notify({name:a.trackNameField.getValue(),url:a.urlField.getValue()});a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})};GV_CELLBASE_HOST="http://ws.bioinfo.cipf.es/cellbase/rest";
FEATURE_CONFIG={gene:{filters:[{name:"biotype",text:"Biotype",values:"3prime_overlapping_ncrna ambiguous_orf antisense disrupted_domain IG_C_gene IG_D_gene IG_J_gene IG_V_gene lincRNA miRNA misc_RNA Mt_rRNA Mt_tRNA ncrna_host nonsense_mediated_decay non_coding non_stop_decay polymorphic_pseudogene processed_pseudogene processed_transcript protein_coding pseudogene retained_intron retrotransposed rRNA sense_intronic sense_overlapping snoRNA snRNA transcribed_processed_pseudogene transcribed_unprocessed_pseudogene unitary_pseudogene unprocessed_pseudogene".split(" "),selection:"multi"}]},
snp:{filters:[{name:"consequence_type",text:"Consequence Type",values:"2KB_upstream_variant 5KB_upstream_variant 500B_downstream_variant 5KB_downstream_variant 3_prime_UTR_variant 5_prime_UTR_variant coding_sequence_variant complex_change_in_transcript frameshift_variant incomplete_terminal_codon_variant inframe_codon_gain inframe_codon_loss initiator_codon_change non_synonymous_codon intergenic_variant intron_variant mature_miRNA_variant nc_transcript_variant splice_acceptor_variant splice_donor_variant splice_region_variant stop_gained stop_lost stop_retained_variant synonymous_codon".split(" "),
selection:"multi"}]},bam:{options:[{text:"View as pairs",name:"view_as_pairs",type:"checkbox",fetch:!0,checked:!1},{text:"Show Soft-clipping",name:"show_softclipping",type:"checkbox",fetch:!0,checked:!1},{text:"Insert size interval",name:"insert_size_interval",type:"doublenumberfield",fetch:!1,minValue:0,maxValue:0}]}};
FEATURE_OPTIONS={gene:[{name:"biotype",text:"Biotype",values:"3prime_overlapping_ncrna ambiguous_orf antisense disrupted_domain IG_C_gene IG_D_gene IG_J_gene IG_V_gene lincRNA miRNA misc_RNA Mt_rRNA Mt_tRNA ncrna_host nonsense_mediated_decay non_coding non_stop_decay polymorphic_pseudogene processed_pseudogene processed_transcript protein_coding pseudogene retained_intron retrotransposed rRNA sense_intronic sense_overlapping snoRNA snRNA transcribed_processed_pseudogene transcribed_unprocessed_pseudogene unitary_pseudogene unprocessed_pseudogene".split(" "),selection:"multi"}],
snp:[{name:"consequence_type",text:"Consequence Type",values:"2KB_upstream_variant 5KB_upstream_variant 500B_downstream_variant 5KB_downstream_variant 3_prime_UTR_variant 5_prime_UTR_variant coding_sequence_variant complex_change_in_transcript frameshift_variant incomplete_terminal_codon_variant inframe_codon_gain inframe_codon_loss initiator_codon_change non_synonymous_codon intergenic_variant intron_variant mature_miRNA_variant nc_transcript_variant splice_acceptor_variant splice_donor_variant splice_region_variant stop_gained stop_lost stop_retained_variant synonymous_codon".split(" "),
selection:"multi"}],bam:[{name:"view",text:"View",values:["view_as_pairs","show_soft-clipped_bases"],selection:"multi"}]};
GENE_BIOTYPE_COLORS={"3prime_overlapping_ncrna":"Orange",ambiguous_orf:"SlateBlue",antisense:"SteelBlue",disrupted_domain:"YellowGreen",IG_C_gene:"#FF7F50",IG_D_gene:"#FF7F50",IG_J_gene:"#FF7F50",IG_V_gene:"#FF7F50",lincRNA:"#8b668b",miRNA:"#8b668b",misc_RNA:"#8b668b",Mt_rRNA:"#8b668b",Mt_tRNA:"#8b668b",ncrna_host:"Fuchsia",nonsense_mediated_decay:"seagreen",non_coding:"orangered",non_stop_decay:"aqua",polymorphic_pseudogene:"#666666",processed_pseudogene:"#666666",processed_transcript:"#0000ff",
protein_coding:"#a00000",pseudogene:"#666666",retained_intron:"goldenrod",retrotransposed:"lightsalmon",rRNA:"indianred",sense_intronic:"#20B2AA",sense_overlapping:"#20B2AA",snoRNA:"#8b668b",snRNA:"#8b668b",transcribed_processed_pseudogene:"#666666",transcribed_unprocessed_pseudogene:"#666666",unitary_pseudogene:"#666666",unprocessed_pseudogene:"#666666","":"orangered",other:"#000000"};
SNP_BIOTYPE_COLORS={"2KB_upstream_variant":"#a2b5cd","5KB_upstream_variant":"#a2b5cd","500B_downstream_variant":"#a2b5cd","5KB_downstream_variant":"#a2b5cd","3_prime_UTR_variant":"#7ac5cd","5_prime_UTR_variant":"#7ac5cd",coding_sequence_variant:"#458b00",complex_change_in_transcript:"#00fa9a",frameshift_variant:"#ff69b4",incomplete_terminal_codon_variant:"#ff00ff",inframe_codon_gain:"#ffd700",inframe_codon_loss:"#ffd700",initiator_codon_change:"#ffd700",non_synonymous_codon:"#ffd700",intergenic_variant:"#636363",
intron_variant:"#02599c",mature_miRNA_variant:"#458b00",nc_transcript_variant:"#32cd32",splice_acceptor_variant:"#ff7f50",splice_donor_variant:"#ff7f50",splice_region_variant:"#ff7f50",stop_gained:"#ff0000",stop_lost:"#ff0000",stop_retained_variant:"#76ee00",synonymous_codon:"#76ee00",other:"#000000"};SEQUENCE_COLORS={A:"#009900",C:"#0000FF",G:"#857A00",T:"#aa0000",N:"#555555"};
SAM_FLAGS=[["read paired",1],["read mapped in proper pair",2],["read unmapped",4],["mate unmapped",8],["read reverse strand",16],["mate reverse strand",32],["first in pair",64],["second in pair",128],["not primary alignment",256],["read fails platform/vendor quality checks",512],["read is PCR or optical duplicate",1024]];
FEATURE_TYPES={formatTitle:function(a){a=a.replace(/_/gi," ");return a=a.charAt(0).toUpperCase()+a.slice(1)},getTipCommons:function(a){return'start-end:&nbsp;<span class="emph">'+a.start+"-"+a.end+'</span><br>strand:&nbsp;<span class="emph">'+(null!=a.strand?a.strand:"NA")+'</span><br>length:&nbsp;<span class="info">'+(a.end-a.start+1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"</span><br>"},sequence:{color:SEQUENCE_COLORS},undefined:{getLabel:function(a){return a=""+(a.chromosome+":"+
a.start+"-"+a.end)},getTipTitle:function(){return" "},getTipText:function(){return" "},getColor:function(){return"grey"},height:10},gene:{getLabel:function(a){var b=null!=a.name?a.name:a.id,c;c=""+(0>a.strand||"-"==a.strand?"<":"");c=c+(" "+b+" ")+(0<a.strand||"+"==a.strand?">":"");null!=a.biotype&&""!=a.biotype&&(c+=" ["+a.biotype+"]");return c},getTipTitle:function(a){var b=null!=a.name?a.name:a.id;return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+b+"</span>"},getTipText:function(a){return'id:&nbsp;<span class="ssel">'+
a.id+'</span><br>biotype:&nbsp;<span class="emph" style="color:'+GENE_BIOTYPE_COLORS[a.biotype]+';">'+a.biotype+'</span><br>description:&nbsp;<span class="emph">'+a.description+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(a){return GENE_BIOTYPE_COLORS[a.biotype]},infoWidgetId:"id",height:4,histogramColor:"lightblue"},transcript:{getLabel:function(a){var b=null!=a.name?a.name:a.id,c;c=""+(0>a.strand?"<":"");c=c+(" "+b+" ")+
(0<a.strand?">":"");null!=a.biotype&&""!=a.biotype&&(c+=" ["+a.biotype+"]");return c},getTipTitle:function(a){var b=null!=a.name?a.name:a.id;return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+b+"</span>"},getTipText:function(a){return'id:&nbsp;<span class="ssel">'+a.id+'</span><br>biotype:&nbsp;<span class="emph" style="color:'+GENE_BIOTYPE_COLORS[a.biotype]+';">'+a.biotype+'</span><br>description:&nbsp;<span class="emph">'+a.description+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},
getColor:function(a){return GENE_BIOTYPE_COLORS[a.biotype]},infoWidgetId:"id",height:1,histogramColor:"lightblue"},exon:{getLabel:function(a){return null!=a.name?a.name:a.id},getTipTitle:function(a){var b=null!=a.name?a.name:a.id;null==b&&(b="");return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+b+"</span>"},getTipText:function(a,b){return'transcript name:&nbsp;<span class="ssel">'+b.name+'</span><br>transcript Ensembl&nbsp;ID:&nbsp;<span class="ssel">'+b.id+'</span><br>transcript biotype:&nbsp;<span class="emph" style="color:'+
GENE_BIOTYPE_COLORS[b.biotype]+';">'+b.biotype+'</span><br>transcript description:&nbsp;<span class="emph">'+b.description+'</span><br>transcript start-end:&nbsp;<span class="emph">'+b.start+"-"+b.end+'</span><br>exon start-end:&nbsp;<span class="emph">'+a.start+"-"+a.end+'</span><br>strand:&nbsp;<span class="emph">'+b.strand+'</span><br>length:&nbsp;<span class="info">'+(a.end-a.start+1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+"</span><br>"},getColor:function(){return"black"},infoWidgetId:"id",
height:5,histogramColor:"lightblue"},snp:{getLabel:function(a){return null!=a.name?a.name:a.id},getTipTitle:function(a){var b=null!=a.name?a.name:a.id;return a.featureType.toUpperCase()+' - <span class="ok">'+b+"</span>"},getTipText:function(a){return'alleles:&nbsp;<span class="ssel">'+a.alleleString+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"lightblue"},infoWidgetId:"id",height:8,histogramColor:"orange"},cpg_island:{getLabel:function(a){return a.name},
getTipTitle:function(a){return'CpG island - <span class="ok">'+a.name+"</span>"},getTipText:function(a){return'CpG number:&nbsp;<span class="ssel">'+a.cpgNum+'</span><br>CpG precentage:&nbsp;<span class="ssel">'+a.perCpG+'</span><br>CG number:&nbsp;<span class="ssel">'+a.gcNum+'</span><br>CG percentage:&nbsp;<span class="ssel">'+a.perGc+'</span><br>observed-expected ratio:&nbsp;<span class="ssel">'+a.observedExpectedRatio+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"Aquamarine"},
infoWidgetId:"name",height:8,histogramColor:"Aquamarine"},mutation:{getLabel:function(a){return a.mutationCds},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+a.mutationCds+"</span>"},getTipText:function(a){return'mutation CDS:&nbsp;<span class="ssel">'+a.mutationCds+'</span><br>mutation Aa:&nbsp;<span class="ssel">'+a.mutationAa+'</span><br>mutation description:&nbsp;<span class="ssel">'+a.mutationDescription+'</span><br>primary histology:&nbsp;<span class="ssel">'+
a.primaryHistology+'</span><br>primary site:&nbsp;<span class="ssel">'+a.primarySite+'</span><br>site subtype:&nbsp;<span class="ssel">'+a.siteSubtype+'</span><br>gene name:&nbsp;<span class="ssel">'+a.geneName+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"Chartreuse"},infoWidgetId:"mutationCds",height:8,histogramColor:"Chartreuse"},structural_variation:{getLabel:function(a){return a.displayId},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+
' - <span class="ok">'+a.displayId+"</span>"},getTipText:function(a){return'display ID:&nbsp;<span class="ssel">'+a.displayId+'</span><br>SO term:&nbsp;<span class="ssel">'+a.soTerm+'</span><br>study description:&nbsp;<span class="emph">'+a.studyDescription+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"indigo"},infoWidgetId:"name",height:8,histogramColor:"indigo"},tfbs:{getLabel:function(a){return null!=a.name?a.name:
a.id},getTipTitle:function(a){return'TFBS - <span class="ok">'+(null!=a.name?a.name:a.id)+"</span>"},getTipText:function(a){return'TF name:&nbsp;<span class="ssel">'+(null!=a.name?a.name:a.id)+'</span><br>score:&nbsp;<span class="ssel">'+a.score+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"blue"},infoWidgetId:"name",height:8,histogramColor:"blue"},mirna_target:{getLabel:function(a){return null!=a.name?a.name:a.id},
getTipTitle:function(a){return'miRNA target - <span class="ok">'+(null!=a.name?a.name:a.id)+"</span>"},getTipText:function(a){return'score:&nbsp;<span class="ssel">'+a.score+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+'source:&nbsp;<span class="ssel">'+a.source+"</span><br>"},getColor:function(){return"#8b668b"},infoWidgetId:"name",height:8,histogramColor:"#8b668b"},conserved_region:{getLabel:function(a){return a.conservedRegionId},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+
' - <span class="ok">'+a.conservedRegionId+"</span>"},getTipText:function(a){return'method:&nbsp;<span class="ssel">'+a.method+'</span><br>data range primate:&nbsp;<span class="ssel">'+a.dataRangePrimate+'</span><br>lower limit primate:&nbsp;<span class="ssel">'+a.lowerLimitPrimate+'</span><br>sumData primate:&nbsp;<span class="ssel">'+a.sumDataPrimate+'</span><br>sumSquare primate:&nbsp;<span class="ssel">'+a.sumSquarePrimate+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"DodgerBlue"},
infoWidgetId:"name",height:8,histogramColor:"DodgerBlue"},file:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)},getTipText:function(a){return FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:8,histogramColor:"orange"},vcf:{getLabel:function(a){return a.id},getTipTitle:function(a){return'VCF variant - <span class="ok">'+a.id+"</span>"},getTipText:function(a){return'alleles (ref/alt):&nbsp;<span class="emph">'+
a.reference+"/"+a.alternate+'</span><br>quality:&nbsp;<span class="emph">'+a.quality+'</span><br>filter:&nbsp;<span class="emph">'+a.filter+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},infoWidgetId:"id",height:8,histogramColor:"gray"},gff2:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return a.featureType.toUpperCase()+' - <span class="ok">'+a.label+"</span>"},getTipText:function(a){return'score:&nbsp;<span class="emph">'+a.score+'</span><br>frame:&nbsp;<span class="emph">'+
a.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:8,histogramColor:"gray"},gff3:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return a.featureType.toUpperCase()+' - <span class="ok">'+a.label+"</span>"},getTipText:function(a){return'score:&nbsp;<span class="emph">'+a.score+'</span><br>frame:&nbsp;<span class="emph">'+a.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:8,histogramColor:"gray"},
gtf:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return a.featureType.toUpperCase()+' - <span class="ok">'+a.label+"</span>"},getTipText:function(a){return'score:&nbsp;<span class="emph">'+a.score+'</span><br>frame:&nbsp;<span class="emph">'+a.frame+"</span><br>"+FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:8,histogramColor:"gray"},bed:{getLabel:function(a){return a=""+a.label},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)},
getTipText:function(a){return FEATURE_TYPES.getTipCommons(a)},getColor:function(a){var b=[],b=a.itemRgb.split(","),a=function(a){var b="0123456789abcdef".split("");return isNaN(a)?"00":b[(a-a%16)/16]+b[a%16]};return"#"+(a(b[0])+a(b[1])+a(b[2]))},height:8,histogramColor:"orange"},bam:{explainFlags:function(a){for(var b='<div style="background:#FFEF93;font-weight:bold;margin:0 15px 0 0;">flags : <span class="ssel">'+a+"</span></div>",c=0;c<SAM_FLAGS.length;c++)SAM_FLAGS[c][1]&a&&(b+=SAM_FLAGS[c][0]+
"<br>");return b},getLabel:function(a){return"bam  "+a.chromosome+":"+a.start+"-"+a.end},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)+' - <span class="ok">'+a.name+"</span>"},getTipText:function(a){a.strand=FEATURE_TYPES.bam.getStrand(a);var b='cigar:&nbsp;<span class="ssel">'+a.cigar+'</span><br>insert size:&nbsp;<span class="ssel">'+a.inferredInsertSize+"</span><br>"+FEATURE_TYPES.getTipCommons(a)+"<br>"+this.explainFlags(a.flags),c='<div style="background:#FFEF93;font-weight:bold;">attributes</div>';
delete a.attributes.BQ;for(var d in a.attributes)c+=d+":"+a.attributes[d]+"<br>";return'<div style="float:left">'+b+'</div><div style="float:right">'+c+"</div>"},getColor:function(a,b){return a.mateReferenceName!=b?"lightgreen":0==(parseInt(a.flags)&16)?"DarkGray":"LightGray"},getStrokeColor:function(a){return this.getMateUnmappedFlag(a)?"tomato":"whitesmoke"},getStrand:function(a){return 0==(parseInt(a.flags)&16)?"Forward":"Reverse"},getReadPairedFlag:function(a){return 0==(parseInt(a.flags)&1)?
!1:!0},getFirstOfPairFlag:function(a){return 0==(parseInt(a.flags)&64)?!1:!0},getMateUnmappedFlag:function(a){return 0==(parseInt(a.flags)&8)?!1:!0},height:8,histogramColor:"grey"},das:{getLabel:function(a){return a=""+a.id},getTipTitle:function(a){return FEATURE_TYPES.formatTitle(a.featureType)},getTipText:function(a){return FEATURE_TYPES.getTipCommons(a)},getColor:function(){return"black"},height:8,histogramColor:"orange"}};function FeatureBinarySearchTree(){this._root=null}
FeatureBinarySearchTree.prototype={constructor:FeatureBinarySearchTree,add:function(a){var a={value:a,left:null,right:null},b;if(null===this._root)return this._root=a,!0;for(b=this._root;;)if(a.value.end<b.value.start){if(null===b.left)return b.left=a,!0;b=b.left}else if(a.value.start>b.value.end){if(null===b.right)return b.right=a,!0;b=b.right}else return!1},contains:function(a){for(var b=!1,c=this._root;!b&&c;)a.end<c.value.start?c=c.left:a.start>c.value.end?c=c.right:b=!0;return b}};
function GenomeViewer(a,b,c){var d=this;this.id="GenomeViewer"+Math.round(1E4*Math.random());this.menuBar=null;this.sidePanelWidth=26;this.width=$(document).width()-this.sidePanelWidth;this.height=$(document).height();this.targetId=null;this.species="hsa";this.speciesName="Homo sapiens";this.increment=3;this.zoom=100;this.regionPanelHidden=this.confPanelHidden=!1;null!=a&&(this.targetId=a);null!=b&&(this.species=Utils.getSpeciesCode(b.text),this.speciesName=b.text+" "+b.assembly);null!=c&&(null!=
c.toolbar&&(this.toolbar=c.toolbar),null!=c.width&&(this.width=c.width-this.sidePanelWidth),null!=c.height&&(this.height=c.height),null!=c.popularSpecies&&(this.popularSpecies=c.popularSpecies),null!=c.availableSpecies&&this.setSpeciesMenu(c.availableSpecies,this.popularSpecies),null!=c.zoom&&(this.zoom=c.zoom),this.region=null!=c.region?c.region:new Region(b.region),null!=c.confPanelHidden&&(this.confPanelHidden=c.confPanelHidden),null!=c.regionPanelHidden&&(this.regionPanelHidden=c.regionPanelHidden),
null!=c.region&&null!=c.region.url||this._calculateRegionByZoom(),this._calculateZoomByRegion());this.onSpeciesChange=new Event;this.onRegionChange=new Event;this.afterLocationChange=new Event;this.afterRender=new Event;this.onRegionChange.addEventListener(function(a,b){d.setRegion(b);b.sender!="trackSvgLayout"&&Ext.getCmp(d.id+"regionHistory").add({xtype:"box",padding:"2 5 2 3",border:1,html:d.region.toString(),s:d.region.toString(),listeners:{afterrender:function(){var a=this.s;this.getEl().addClsOnOver("encima");
this.getEl().addCls("whiteborder");this.getEl().on("click",function(){d.region.parse(a);d.setRegion({sender:"regionHistory"})})}}})});this.onSvgRemoveTrack=null;console.log(this.width+"x"+this.height);console.log(this.targetId);console.log(this.id)}GenomeViewer.prototype.draw=function(){this.render()};
GenomeViewer.prototype.render=function(){var a=this,b=Ext.create("Ext.container.Container",{id:this.id+"container",width:this.width,height:this.height,cls:"x-unselectable",region:"center",flex:0,layout:{type:"vbox",align:"stretch"},region:"center",margins:"0 0 0 0"});this.sideContainer=Ext.create("Ext.panel.Panel",{id:this.id+"sideContainer",region:"east",title:"Configuration",collapsed:this.confPanelHidden,collapsible:!0,titleCollapse:!0,width:this.sidePanelWidth+260,layout:"accordion"});var c=Ext.create("Ext.container.Container",
{id:this.id+"containerPort",renderTo:this.targetId,width:this.width+this.sidePanelWidth,height:this.height,cls:"x-unselectable",layout:{type:"border"},region:"center",margins:"0 0 0 0",items:[b,this.sideContainer]}),d=this._drawTracksPanel(),e=this._drawRegionPanel(),f=0,g=function(){var b=$("#"+a.id+"tracksSvgTop")[0],c=$("#"+a.id+"tracksSvgTrack")[0];a.trackSvgLayout=new TrackSvgLayout({top:b,track:c},{width:a.width-18,region:a.region,genomeViewer:a});a.trackSvgLayout.onMove.addEventListener(function(){a.onRegionChange.notify({sender:"trackSvgLayout"})});
a.trackSvgLayout.onMousePosition.addEventListener(function(b,c){Ext.getCmp(a.id+"mouseLabel").setText('<span class="ssel">Position: '+Utils.formatNumber(c.mousePos)+"</span>");$("#"+a.id+"mouseLabel").qtip({content:"Mouse position",style:{width:95},position:{my:"bottom center",at:"top center"}});Ext.getCmp(a.id+"mouseNucleotidLabel").setText(c.baseHtml)});Ext.getCmp(a.id+"windowSize").setText('<span class="emph">'+a.trackSvgLayout.windowSize+"</span>");a.trackSvgLayout.onWindowSize.addEventListener(function(b,
c){Ext.getCmp(a.id+"windowSize").setText('<span class="emph">'+c.windowSize+"</span>")});a.trackSvgLayout.onReady.addEventListener(function(){Ext.getCmp(a.id+"container").setLoading(!1)});a.onSvgRemoveTrack=a.trackSvgLayout.onSvgRemoveTrack;b=$("#"+a.id+"regionSvgTop")[0];c=$("#"+a.id+"regionSvgTrack")[0];a.trackSvgLayoutOverview=new TrackSvgLayout({top:b,track:c},{width:a.width-18,region:a.region,zoomOffset:40,zoomMultiplier:8,genomeViewer:a,parentLayout:a.trackSvgLayout});a.trackSvgLayoutOverview.onRegionSelect.addEventListener(function(){a.onRegionChange.notify({sender:"trackSvgLayoutOverview"})});
a.afterRender.notify()};d.on("afterrender",function(){f++;1<f&&g()});e.on("afterrender",function(){f++;1<f&&g()});c.insert(0,this._getNavigationBar());c.insert(1,this._getBottomBar());b.insert(0,this._drawKaryotypePanel().hide());b.insert(1,this._drawChromosomePanel());b.insert(2,d);b.insert(2,e);Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString())};
GenomeViewer.prototype.setMenuBar=function(a){this.toolbar=a};GenomeViewer.prototype.addSidePanelItems=function(a){this.sideContainer.insert(1,{title:"Region history",bodyPadding:"10",id:this.id+"regionHistory"});null!=a&&this.sideContainer.insert(0,a)};
GenomeViewer.prototype.setSize=function(a,b){this.width=a-this.sidePanelWidth;this.trackSvgLayout.setWidth(this.width-18);this.trackSvgLayoutOverview.setWidth(this.width-18);this.chromosomeWidget.setWidth(this.width);this.karyotypeWidget.setWidth(this.width);Ext.getCmp(this.id+"containerPort").setSize(a,b)};
GenomeViewer.prototype._calculateRegionByZoom=function(){var a=parseInt(this.width/Utils.getPixelBaseByZoom(this.zoom)),b=this.region.center(),a=Math.ceil(a/2-1);this.region.start=Math.floor(b-a);this.region.end=Math.floor(b+a)};GenomeViewer.prototype._calculateZoomByRegion=function(){this._getZoomSlider().suspendEvents();this.setZoom(Math.round(Utils.getZoomByPixelBase(this.width/this.region.length())));this._getZoomSlider().resumeEvents()};
GenomeViewer.prototype.setRegion=function(a){switch(a.sender){case "setSpecies":this._calculateZoomByRegion();this.species=a.species;this.speciesName=a.text;Ext.example.msg("Species",this.speciesName+" selected.");Ext.getCmp(this.id+"speciesMenuButton").setText(this.speciesName);Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString());
this._updateChrStore();this.trackSvgLayout.setRegion({species:this.species});this.trackSvgLayoutOverview.setRegion({species:this.species});this.chromosomeWidget.setRegion({species:this.species});this.karyotypeWidget.setRegion({species:this.species});this.onSpeciesChange.notify();Ext.getCmp(this.id+"container").setLoading();break;case "_getChromosomeMenu":this.trackSvgLayout.setRegion({});this.trackSvgLayoutOverview.setRegion({});this.chromosomeWidget.setRegion({});this.karyotypeWidget.setRegion({});
Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString());Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"container").setLoading();break;case "GoButton":this._calculateZoomByRegion();Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.region.chromosome);
this.trackSvgLayout.setRegion({});this.trackSvgLayoutOverview.setRegion({});this.chromosomeWidget.setRegion({});this.karyotypeWidget.setRegion({});Ext.getCmp(this.id+"container").setLoading();break;case "KaryotypePanel":this._calculateZoomByRegion();Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.region.chromosome);Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString());this.trackSvgLayout.setRegion({});
this.trackSvgLayoutOverview.setRegion({});this.chromosomeWidget.setRegion({});Ext.getCmp(this.id+"container").setLoading();break;case "ChromosomeWidget":this._calculateZoomByRegion();Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString());this.trackSvgLayout.setRegion({});this.trackSvgLayoutOverview.setRegion({});this.karyotypeWidget.setRegion({});Ext.getCmp(this.id+"container").setLoading();break;case "trackSvgLayout":Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString());
this.chromosomeWidget.setRegion({});this.karyotypeWidget.setRegion({});break;case "trackSvgLayoutOverview":this._calculateZoomByRegion();Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString());this.trackSvgLayout.setRegion({});this.trackSvgLayoutOverview.setRegion({});this.chromosomeWidget.setRegion({});this.karyotypeWidget.setRegion({});Ext.getCmp(this.id+"container").setLoading();break;case "zoom":this._calculateRegionByZoom();Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString());
this.trackSvgLayout.setRegion({});this.trackSvgLayoutOverview.setRegion({});this.chromosomeWidget.setRegion({});this.karyotypeWidget.setRegion({});Ext.getCmp(this.id+"container").setLoading();break;default:this._calculateZoomByRegion(),null!=a.species&&(this.species=a.species,this.speciesName=a.text,Ext.example.msg("Species",this.speciesName+" selected."),this.onSpeciesChange.notify()),Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.region.chromosome),Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+
this.region.chromosome),Ext.getCmp(this.id+"speciesMenuButton").setText(this.speciesName),Ext.getCmp(this.id+"tbCoordinate").setValue(this.region.toString()),this._updateChrStore(),this.trackSvgLayout.setRegion({}),this.trackSvgLayoutOverview.setRegion({}),this.chromosomeWidget.setRegion({}),this.karyotypeWidget.setRegion({}),Ext.getCmp(this.id+"container").setLoading()}};
GenomeViewer.prototype._getNavigationBar=function(){var a=this,b=Ext.create("Ext.data.Store",{fields:["xrefId","displayId","description"]}),c=Ext.create("Ext.form.field.ComboBox",{id:this.id+"quickSearch",displayField:"displayId",valueField:"displayId",emptyText:"gene, snp",hideTrigger:!0,fieldLabel:"Search:",labelWidth:40,width:150,store:b,queryMode:"local",typeAhead:!1,autoSelect:!1,queryDelay:500,listeners:{change:function(){var c=this.getValue(),e=2;c&&"ENS"==c.substring(0,3).toUpperCase()&&(e=
10);c&&c.length>e&&$.ajax({url:(new CellBaseManager).host+"/latest/"+a.species+"/feature/id/"+this.getValue()+"/starts_with?of=json",success:function(a){a=JSON.parse(a);b.loadData(a[0]);console.log(b)},error:function(a,b){console.log(b)}})},select:function(){a._handleNavigationBar("GoToGene")}}});return Ext.create("Ext.toolbar.Toolbar",{id:this.id+"navToolbar",cls:"bio-toolbar",region:"north",border:!0,height:35,items:[{id:this.id+"speciesMenuButton",text:this.speciesName,menu:this._getSpeciesMenu()},
{id:this.id+"chromosomeMenuButton",text:"Chromosome",menu:this._getChromosomeMenu()},"-",{id:this.id+"karyotypeButton",text:"Karyotype",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"karyotypePanel").show():Ext.getCmp(a.id+"karyotypePanel").hide()}},{id:this.id+"ChromosomeToggleButton",text:"Chromosome",enableToggle:!0,pressed:!0,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"chromosomePanel").show():Ext.getCmp(a.id+"chromosomePanel").hide()}},{id:this.id+
"RegionToggleButton",text:"Region",enableToggle:!0,pressed:this.regionPanelHidden,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"regionPanel").show():Ext.getCmp(a.id+"regionPanel").hide()}},"-",{id:this.id+"zoomOutButton",tooltip:"Zoom out",iconCls:"icon-zoom-out",margin:"0 0 0 10",listeners:{click:{fn:function(){var b=Ext.getCmp(a.id+"zoomSlider").getValue();Ext.getCmp(a.id+"zoomSlider").setValue(b-a.increment)}}}},this._getZoomSlider(),{id:this.id+"zoomInButton",margin:"0 5 0 0",tooltip:"Zoom in",
iconCls:"icon-zoom-in",listeners:{click:{fn:function(){var b=Ext.getCmp(a.id+"zoomSlider").getValue();Ext.getCmp(a.id+"zoomSlider").setValue(b+a.increment)}}}},"-",{id:this.id+"positionLabel",xtype:"label",text:"Position:",margins:"0 0 0 10"},{id:this.id+"tbCoordinate",xtype:"textfield",width:165,text:this.chromosome+":"+this.position,listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a._handleNavigationBar("Go")}}},{id:this.id+"GoButton",text:"Go",handler:function(){a._handleNavigationBar("Go")}},
"->",c,{id:this.id+"GoToGeneButton",iconCls:"icon-find",handler:function(){a._handleNavigationBar("GoToGene")}}]})};GenomeViewer.prototype._getSpeciesMenu=function(){null==this._specieMenu&&(this._specieMenu=Ext.create("Ext.menu.Menu",{id:this.id+"_specieMenu",margin:"0 0 10 0",floating:!0,plain:!0,items:[]}));return this._specieMenu};
GenomeViewer.prototype.setSpeciesMenu=function(a,b){var c=this,d=this._getSpeciesMenu();d.hide();d.removeAll();for(var e=[],f=0;f<a.items.length;f++){var g=a.items[f].items;a.items[f].menu={items:g};for(var h=0;h<g.length;h++){var j=g[h],k=j.text+" ("+j.assembly+")";j.name=j.text;j.species=Utils.getSpeciesCode(j.text);j.text=k;j.speciesObj=j;j.iconCls="";j.handler=function(a){c.setSpecies(a.speciesObj)};-1!=b.indexOf(j.name)&&e.push(j)}}e.sort(function(a,b){return a.text.localeCompare(b.text)});e.push("-");
e=e.concat(a.items);d.add(e)};GenomeViewer.prototype.setSpecies=function(a){this.region.load(a.region);a.sender="setSpecies";this.onRegionChange.notify(a)};
GenomeViewer.prototype._getChromosomeMenu=function(){var a=this,b=Ext.create("Ext.data.Store",{id:this.id+"chrStore",fields:["name"],autoLoad:!1}),c=Ext.create("Ext.view.View",{id:this.id+"chrView",width:125,style:"background-color:#fff",store:b,selModel:{mode:"SINGLE",listeners:{selectionchange:function(b,c){0<c.length&&(a.region.chromosome=c[0].data.name,a.onRegionChange.notify({sender:"_getChromosomeMenu"}));d.hide()}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".chromosome-item",
tpl:'<tpl for="."><div style="float:left" class="chromosome-item">{name}</div></tpl>'}),d=Ext.create("Ext.menu.Menu",{id:this.id+"chromosomeMenu",almacen:b,plain:!0,items:[c]});this._updateChrStore();return d};
GenomeViewer.prototype._updateChrStore=function(){var a=Ext.getStore(this.id+"chrStore");Ext.getCmp(this.id+"chrView");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){var e=[];d.result.sort(function(a,b){for(var c=!0,d=0;d<a.length&&!0==c;d++)isNaN(a[d])&&(c=!1);return!c?1:a-b});for(var f=0;f<d.result.length;f++)e.push({name:d.result[f]});a.loadData(e)});b.get("feature","chromosome",null,"list")};
GenomeViewer.prototype._getZoomSlider=function(){var a=this;null==this._zoomSlider&&(this._zoomSlider=Ext.create("Ext.slider.Single",{id:this.id+"zoomSlider",width:170,maxValue:100,minValue:0,useTips:!0,increment:1,tipText:function(a){return Ext.String.format("<b>{0}%</b>",a.value)},listeners:{change:{fn:function(b,c){a._handleNavigationBar("ZOOM",c)},buffer:500}}}));return this._zoomSlider};
GenomeViewer.prototype._disableZoomElements=function(){Ext.getCmp(this.id+"zoomSlider").disable();Ext.getCmp(this.id+"zoomOutButton").disable();Ext.getCmp(this.id+"zoomInButton").disable()};GenomeViewer.prototype._enableZoomElements=function(){Ext.getCmp(this.id+"zoomSlider").enable();Ext.getCmp(this.id+"zoomOutButton").enable();Ext.getCmp(this.id+"zoomInButton").enable()};GenomeViewer.prototype.setZoom=function(a){this.zoom=a;this._getZoomSlider().setValue(a)};
GenomeViewer.prototype._handleNavigationBar=function(a,b){"OptionMenuClick"==a&&(this.genomeWidget.showTranscripts=Ext.getCmp("showTranscriptCB").checked,this.genomeWidgetProperties.setShowTranscripts(Ext.getCmp("showTranscriptCB").checked),this.refreshMasterGenomeViewer());"ZOOM"==a&&(this.setZoom(b),this.onRegionChange.notify({sender:"zoom"}));if("GoToGene"==a){var c=Ext.getCmp(this.id+"quickSearch").getValue();null!=c&&("rs"==c.slice(0,2)||"AFFY_"==c.slice(0,5)||"SNP_"==c.slice(0,4)||"VAR_"==c.slice(0,
4)||"CRTAP_"==c.slice(0,6)||"FKBP10_"==c.slice(0,7)||"LEPRE1_"==c.slice(0,7)||"PPIB_"==c.slice(0,5)?this.openSNPListWidget(c):this.openGeneListWidget(c))}"+"==a&&(c=this.zoom,100>c&&this.setZoom(c+this.increment));"-"==a&&(c=this.zoom,5<=c&&this.setZoom(c-this.increment));"Go"==a&&(c=Ext.getCmp(this.id+"tbCoordinate").getValue(),c=new Region({str:c}),isNaN(c.start)||0>c.start?Ext.getCmp(this.id+"tbCoordinate").markInvalid("Position must be a positive number"):-1==Ext.getCmp(this.id+"chromosomeMenu").almacen.find("name",
c.chromosome)?Ext.getCmp(this.id+"tbCoordinate").markInvalid("Invalid chromosome"):(this.region.load(c),this.onRegionChange.notify({sender:"GoButton"})))};
GenomeViewer.prototype._drawKaryotypePanel=function(){var a=this;return Ext.create("Ext.panel.Panel",{id:this.id+"karyotypePanel",height:200,title:"Karyotype",border:!0,margin:"0 0 1 0",html:'<div id="'+this.id+'karyotypeSvg" style="margin-top:2px"></div>',listeners:{afterrender:function(){var b=$("#"+a.id+"karyotypeSvg")[0];a.karyotypeWidget=new KaryotypeWidget(b,{width:a.width,height:168,species:a.species,region:a.region});a.karyotypeWidget.onClick.addEventListener(function(){a.onRegionChange.notify({sender:"KaryotypePanel"})});
a.karyotypeWidget.drawKaryotype()}}})};
GenomeViewer.prototype._drawChromosomePanel=function(){var a=this;return Ext.create("Ext.panel.Panel",{id:this.id+"chromosomePanel",height:95,title:"Chromosome",border:!0,margin:"0 0 1 0",html:'<div id="'+this.id+'chromosomeSvg" style="margin-top:2px"></div>',listeners:{afterrender:function(){var b=$("#"+a.id+"chromosomeSvg")[0];a.chromosomeWidget=new ChromosomeWidget(b,{width:a.width,height:65,species:a.species,region:a.region,zoom:a.zoom});a.chromosomeWidget.onClick.addEventListener(function(){a.onRegionChange.notify({sender:"ChromosomeWidget"})});a.chromosomeWidget.drawChromosome()}}})};
GenomeViewer.prototype._drawRegionPanel=function(){var a=Ext.create("Ext.container.Container",{height:25,style:"background:whitesmoke",html:'<div id = "'+this.id+'regionSvgTop"></div>'}),b=Ext.create("Ext.container.Container",{overflowY:"auto",overflowX:"hidden",style:"background:whitesmoke",flex:1,html:'<div id = "'+this.id+'regionSvgTrack" style="margin-top:0px"></div></div>'});return Ext.create("Ext.panel.Panel",{id:this.id+"regionPanel",height:150,title:'Region overview <span class="ssel" id="'+
this.id+'regionPanelZoom"></span>',border:!0,hidden:!this.regionPanelHidden,margin:"0 0 1 0",layout:{type:"vbox",align:"stretch"},items:[a,b]})};
GenomeViewer.prototype._drawTracksPanel=function(){var a=Ext.create("Ext.container.Container",{height:25,style:"background:whitesmoke",html:'<div id = "'+this.id+'tracksSvgTop"></div>'}),b=Ext.create("Ext.container.Container",{overflowY:"auto",overflowX:"hidden",style:"background:whitesmoke",flex:1,html:'<div id = "'+this.id+'tracksSvgTrack"></div>'});return Ext.create("Ext.panel.Panel",{id:this.id+"tracksPanel",title:'Detailed information <span class="ssel" id="'+this.id+'regionPanelZoom"></span>',
shrinkWrap:1,layout:{type:"vbox",align:"stretch"},border:!0,cls:"x-unselectable",flex:1,items:[a,b]})};GenomeViewer.prototype.addTrack=function(a,b){this.trackSvgLayout.addTrack(a,b)};GenomeViewer.prototype.getTrackSvgById=function(a){return this.trackSvgLayout.getTrackSvgById(a)};GenomeViewer.prototype.removeTrack=function(a){return this.trackSvgLayout.removeTrack(a)};GenomeViewer.prototype.restoreTrack=function(a,b){return this.trackSvgLayout.restoreTrack(a,b)};
GenomeViewer.prototype.setTrackIndex=function(a,b){return this.trackSvgLayout.setTrackIndex(a,b)};GenomeViewer.prototype.scrollToTrack=function(a){return this.trackSvgLayout.scrollToTrack(a)};GenomeViewer.prototype.showTrack=function(a){this.trackSvgLayout._showTrack(a)};GenomeViewer.prototype.hideTrack=function(a){this.trackSvgLayout._hideTrack(a)};GenomeViewer.prototype.checkRenderedTrack=function(a){return this.trackSvgLayout.swapHash[a]?!0:!1};
GenomeViewer.prototype._getBottomBar=function(){var a=new LegendPanel({title:"Gene legend"}),b=new LegendPanel({title:"SNP legend"}),c=Ext.create("Ext.toolbar.TextItem",{id:this.id+"versionLabel",text:""}),d=Ext.create("Ext.toolbar.TextItem",{id:this.id+"mouseLabel",width:110,text:'<span class="ssel">Position: -</span>'}),e=Ext.create("Ext.toolbar.TextItem",{id:this.id+"mouseNucleotidLabel",width:10,text:"-"}),f=Ext.create("Ext.toolbar.TextItem",{id:this.id+"windowSize",width:150,text:'<span class="emph">Window size: -</span>'}),
g=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"uxTaskbar",winMgr:new Ext.ZIndexManager,enableOverflow:!0,cls:"bio-hiddenbar",height:28,flex:1}),a=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"legendBar",cls:"bio-hiddenbar",width:610,height:28,items:["-",d,e,f,a.getButton(GENE_BIOTYPE_COLORS),b.getButton(SNP_BIOTYPE_COLORS),"->",c]});return Ext.create("Ext.container.Container",{id:this.id+"bottomBar",layout:"hbox",region:"south",cls:"bio-botbar x-unselectable",height:30,border:!0,items:[g,a]})};
GenomeViewer.prototype.openListWidget=function(a){var b=this;console.log(a.query);var c=new CellBaseManager(this.species);c.success.addEventListener(function(c,e){if(1<e.result[0].length){var f=new GenomicListWidget(b.species,{title:a.title,gridFields:a.gridField,viewer:b});f.draw(e);f.onSelected.addEventListener(function(a,c){null!=c&&null!=c.chromosome&&(b.chromosome!=c.chromosome||b.position!=c.start)&&b.onRegionChange.notify({sender:"",chromosome:c.chromosome,position:c.start})});f.onTrackAddAction.addEventListener(function(a,
c){var d=new TrackData(c.fileName,{adapter:c.adapter});b.trackSvgLayout.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})}else f=e.result[0][0],null!=f?(b.region.load(f),b.onRegionChange.notify({sender:""})):Ext.example.msg('Feature <span class="ssel">'+a.query+"</span> not found","")});c.get(a.category,a.subcategory,a.query,a.resource,a.params)};
GenomeViewer.prototype.openGeneListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"gene",title:"Gene List"})};GenomeViewer.prototype.openTranscriptListWidget=function(a){this.openListWidget({category:"feature",subcategory:"transcript",query:a.toString(),resource:"info",title:"Transcript List",gridField:"externalName stableId biotype chromosome start end strand description".split(" ")})};
GenomeViewer.prototype.openExonListWidget=function(a){this.openListWidget({category:"feature",subcategory:"exon",query:a.toString(),resource:"info",title:"Exon List",gridField:["stableId","chromosome","start","end","strand"]})};GenomeViewer.prototype.openSNPListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"snp",title:"SNP List",gridField:"name variantAlleles ancestralAllele mapWeight position sequence chromosome start end".split(" ")})};
GenomeViewer.prototype.openGOListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"gene",title:"Gene List by GO"})};
function TrackSvg(a,b){this.args=b;this.parent=a;this.y=0;this.height=25;this.width=200;this.title="track";this.renderedArea={};this.maxPixelWidth=5E5;this.pixelPosition=this.maxPixelWidth/2;this.histogramZoom=-1E3;this.titleVisibility="visible";this.closable=!0;this.types=FEATURE_TYPES;this.labelZoom=-1;if("undefined"!=typeof b&&(this.id=b.id||this.id,this.title=b.title||this.title,this.type=b.type||this.type,this.trackSvgLayout=b.trackSvgLayout||this.trackSvgLayout,this.trackData=b.trackData||this.trackData,
this.width=b.width||this.width,this.height=b.height||this.height,this.zoom=b.zoom||this.zoom,this.region=b.region||this.region,this.pixelBase=b.pixelBase||this.pixelBase,this.closable=b.closable||this.closable,this.labelZoom=b.labelZoom||this.labelZoom,this.histogramZoom=b.histogramZoom||this.histogramZoom,this.transcriptZoom=b.transcriptZoom||this.transcriptZoom,this.featureTypes=b.featureTypes||this.featureTypes,this.titleVisibility=b.titleVisibility||this.titleVisibility,this.visibleRange=b.visibleRange||
this.visibleRange,null!=b.featuresRender)){switch(b.featuresRender){case "MultiFeatureRender":this.featuresRender=this.MultiFeatureRender;break;case "SequenceRender":this.featuresRender=this.SequenceRender;break;case "GeneTranscriptRender":this.featuresRender=this.GeneTranscriptRender;break;case "BamRender":this.featuresRender=this.BamRender;break;default:this.featuresRender=this.MultiFeatureRender}this.defaultRender=this.featuresRender}this.position=this.region.center();this.rendered=!1;this.transcript=
this.histogram=this.interval=this.status=null;this.chunksDisplayed={}}
TrackSvg.prototype={setY:function(a){this.y=a},getHeight:function(){return this.height},setHeight:function(a){this.height=a;this.rendered&&(this.main.setAttribute("height",a),this.features.setAttribute("height",a),this.titlebar.setAttribute("height",a))},setWidth:function(a){this.width=a;this.rendered&&this.main.setAttribute("width",a)},setLoading:function(a){a?(this.loading.setAttribute("visibility","visible"),this.status="rendering"):(this.loading.setAttribute("visibility","hidden"),this.status=
"ready")},setHistogramLegend:function(a){a?this.histogramLegend.setAttribute("transform","translate(0)"):this.histogramLegend.setAttribute("transform","translate(-1000)")},setFilters:function(a){this.trackData.setFilters(a);this.regionChange()},getFilters:function(){return this.trackData.adapter.filters},getFiltersConfig:function(){return this.trackData.adapter.filtersConfig},setOption:function(a,b){this.trackData.setOption(a,b);this.regionChange()},getOptions:function(){return this.trackData.adapter.options},
getOptionsConfig:function(){return this.trackData.adapter.optionsConfig},cleanSvg:function(){for(console.time("-----------------------------------------empty");this.features.firstChild;)this.features.removeChild(this.features.firstChild);console.timeEnd("-----------------------------------------empty");this.chunksDisplayed={};this.renderedArea={}},setTitle:function(a){this.titleText.textContent=a},getTitle:function(){return this.titleText.textContent},draw:function(){var a=SVG.addChild(this.parent,
"svg",{id:this.id,"class":"trackSvg",x:0,y:this.y,width:this.width,height:this.height}),b=SVG.addChild(a,"g",{"class":"trackTitle"}),c=this.title,d=SVG.addChild(b,"rect",{x:0,y:0,width:this.width,height:this.getHeight(),opacity:"0.6",fill:"transparent"}),e=SVG.addChild(b,"text",{x:4,y:14,"font-size":12,opacity:"0.4","font-family":"Oxygen",fill:"black"});e.textContent=c;c=SVG.addChild(b,"svg",{"class":"features",x:-this.pixelPosition,width:this.maxPixelWidth,height:this.height});this.fnTitleMouseEnter=
function(){d.setAttribute("opacity","0.1");d.setAttribute("fill","greenyellow");e.setAttribute("opacity","1.0")};this.fnTitleMouseLeave=function(){d.setAttribute("opacity","0.6");d.setAttribute("fill","transparent");e.setAttribute("opacity","0.4")};$(b).off("mouseenter");$(b).off("mouseleave");$(b).mouseenter(this.fnTitleMouseEnter);$(b).mouseleave(this.fnTitleMouseLeave);this.invalidZoomText=SVG.addChild(b,"text",{x:154,y:24,"font-size":10,opacity:"0.6",fill:"black","font-family":"Oxygen",visibility:"hidden"});
this.invalidZoomText.textContent="This level of zoom isn't appropiate for this track";this.loading=SVG.addChildImage(a,{"xlink:href":"data:image/svg+xml,"+encodeURIComponent('<?xml version="1.0" encoding="utf-8"?><svg version="1.1" width="22px" height="22px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><g id="pair"><ellipse cx="7" cy="0" rx="4" ry="1.7" style="fill:#ccc; fill-opacity:0.5;"/><ellipse cx="-7" cy="0" rx="4" ry="1.7" style="fill:#aaa; fill-opacity:1.0;"/></g></defs><g transform="translate(11,11)"><g><animateTransform attributeName="transform" type="rotate" from="0" to="360" dur="1.5s" repeatDur="indefinite"/><use xlink:href="#pair"/><use xlink:href="#pair" transform="rotate(45)"/><use xlink:href="#pair" transform="rotate(90)"/><use xlink:href="#pair" transform="rotate(135)"/></g></g></svg>'),
x:10,y:0,width:22,height:22,visibility:"hidden"});this.main=a;this.titleGroup=b;this.titlebar=d;this.titleText=e;this.features=c;this.rendered=!0;this.status="ready";this.histogramLegend=SVG.addChild(this.titleGroup,"g")}};
TrackSvg.prototype.MultiFeatureRender=function(a){var b=this._getFeaturesByChunks(a),c=this;console.time("Multirender ["+b.length+"] "+a.params.resource);for(var d=function(a){var b=a.start,d=a.end-b+1,f=c.width/2;0>d&&(d=Math.abs(d));0==d&&(d=1);var l=c.types[a.featureType];try{var m=l.getColor(a)}catch(n){console.log(n);debugger}var d=d*c.pixelBase,b=c.pixelPosition+f-(c.position-b)*c.pixelBase,p=9;if(c.zoom>c.labelZoom)try{var o=Math.max(d,8*l.getLabel(a).length)}catch(r){o=72}else o=Math.max(d,
2),p=0;for(var q=p+10,f=0,p=p+l.height;;){null==c.renderedArea[f]&&(c.renderedArea[f]=new FeatureBinarySearchTree);if(c.renderedArea[f].add({start:b,end:b+o-1})){o=SVG.addChild(c.features,"g");SVG.addChild(o,"rect",{x:b,y:f,width:d,height:l.height,stroke:"black","stroke-width":1,"stroke-opacity":0.5,fill:m,cursor:"pointer"});c.zoom>c.labelZoom&&(SVG.addChild(o,"text",{i:e,x:b,y:p,"font-size":10,opacity:null,fill:"black","font-family":"Oxygen Mono",cursor:"pointer"}).textContent=l.getLabel(a));$(o).qtip({content:{text:l.getTipText(a),
title:l.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$(o).click(function(){c.showInfoWidget({query:a[l.infoWidgetId],feature:a,featureType:a.featureType,adapter:c.trackData.adapter})});break}f+=q;p+=q}},e=0,f=b.length;e<f;e++)d(b[e]);d=24*Object.keys(this.renderedArea).length;0<d&&this.setHeight(d+10);console.timeEnd("Multirender ["+b.length+"] "+a.params.resource)};
TrackSvg.prototype.BamRender=function(a){var b=this,c=!1;null!=a.params.view_as_pairs&&(c=!0);console.log("viewAsPairs "+c);var d=0,e=0;null!=a.params.insert_size_interval&&(d=a.params.insert_size_interval.split(",")[0],e=a.params.insert_size_interval.split(",")[1]);console.log("insertSizeMin "+d);console.log("insertSizeMin "+e);$(this.features).contextmenu(function(){console.log("click derecho")});console.time("BamRender "+a.params.resource);var a=this._removeDisplayedChunks(a),f=a.items,g=this.width/
2,h=SVG.addChild(b.features,"g",{"class":"bamCoverage",cursor:"pointer"}),j=SVG.addChild(b.features,"g",{"class":"bamReads",cursor:"pointer"}),k=function(a){for(var c=a.coverage.all,d=a.coverage.a,e=a.coverage.c,f=a.coverage.g,j=a.coverage.t,l=parseInt(a.start),k=(parseInt(a.end)-l+1)*b.pixelBase,m=b.pixelBase/2-0.5,p,n=parseInt(a.start),o="",q="",r="",t="",s=0;s<c.length;s++){p=b.pixelPosition+g-(b.position-n)*b.pixelBase;xx=b.pixelPosition+g-(b.position-n)*b.pixelBase+b.pixelBase;o=o+(p+","+d[s]/
200*50+" ");o=o+(xx+","+d[s]/200*50+" ");q=q+(p+","+(e[s]+d[s])/200*50+" ");q=q+(xx+","+(e[s]+d[s])/200*50+" ");r=r+(p+","+(f[s]+e[s]+d[s])/200*50+" ");r=r+(xx+","+(f[s]+e[s]+d[s])/200*50+" ");t=t+(p+","+(j[s]+f[s]+e[s]+d[s])/200*50+" ");t=t+(xx+","+(j[s]+f[s]+e[s]+d[s])/200*50+" ");n++}d=q.split(" ").reverse().join(" ").trim();e=r.split(" ").reverse().join(" ").trim();t=t.split(" ").reverse().join(" ").trim();f=b.pixelPosition+g-(b.position-parseInt(a.start))*b.pixelBase+m;m=b.pixelPosition+g-(b.position-
parseInt(a.end))*b.pixelBase+m;SVG.addChild(h,"polyline",{points:f+",0 "+o+m+",0",fill:"green"});SVG.addChild(h,"polyline",{points:o+" "+d,fill:"blue"});SVG.addChild(h,"polyline",{points:q+" "+e,fill:"gold"});SVG.addChild(h,"polyline",{points:r+" "+t,fill:"red"});var E=SVG.addChild(h,"rect",{x:b.pixelPosition+g-(b.position-l)*b.pixelBase,y:0,width:k,height:50,opacity:"0.5",fill:"lightgray",cursor:"pointer"});$(E).qtip({content:" ",position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:false},
style:{width:true,classes:"ui-tooltip-shadow"}});b.trackSvgLayout.onMousePosition.addEventListener(function(b,d){var e=d.mousePos-parseInt(a.start),e='depth: <span class="ssel">'+c[e]+'</span><br><span style="color:green">A</span>: <span class="ssel">'+a.coverage.a[e]+'</span><br><span style="color:blue">C</span>: <span class="ssel">'+a.coverage.c[e]+'</span><br><span style="color:darkgoldenrod">G</span>: <span class="ssel">'+a.coverage.g[e]+'</span><br><span style="color:red">T</span>: <span class="ssel">'+
a.coverage.t[e]+"</span><br>";$(E).qtip("option","content.text",e)})},l=function(a){var c=a.unclippedStart,f=a.unclippedEnd,h=a.diff,l=b.types[a.featureType],k=l.getStrand(a),m=l.getColor(a,b.region.chromosome);if(d!=0&&e!=0&&!l.getMateUnmappedFlag(a)){Math.abs(a.inferredInsertSize)>e&&(m="maroon");Math.abs(a.inferredInsertSize)<d&&(m="navy")}var f=(f-c+1)*b.pixelBase,p=b.pixelPosition+g-(b.position-c)*b.pixelBase;maxWidth=f;for(var n=70;;){b.renderedArea[n]==null&&(b.renderedArea[n]=new FeatureBinarySearchTree);
if(b.renderedArea[n].add({start:p,end:p+maxWidth-1})){c=[];k=SVG.addChild(j,"polygon",{points:{Reverse:p+","+(n+l.height/2)+" "+(p+5)+","+n+" "+(p+f-5)+","+n+" "+(p+f-5)+","+(n+l.height)+" "+(p+5)+","+(n+l.height),Forward:p+","+n+" "+(p+f-5)+","+n+" "+(p+f)+","+(n+l.height/2)+" "+(p+f-5)+","+(n+l.height)+" "+p+","+(n+l.height)}[k],stroke:l.getStrokeColor(a),"stroke-width":1,fill:m,cursor:"pointer"});c.push(k);if(h!=null&&b.zoom>95){h=SVG.addChild(j,"path",{d:Utils.genBamVariants(h,b.pixelBase,p,n),
fill:"orangered"});c.push(h)}$(c).qtip({content:{text:l.getTipText(a),title:l.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:false},style:{width:280,classes:"ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"});$(c).click(function(){console.log(a);b.showInfoWidget({query:a[l.infoWidgetId],feature:a,featureType:a.featureType,adapter:b.trackData.adapter})});break}n=n+12}},m=function(a,c){var f=a.unclippedStart,h=a.unclippedEnd,l=c.unclippedStart,
k=c.unclippedEnd,p=a.diff,m=c.diff,n=b.types[a.featureType],o=b.types[c.featureType],q=n.getColor(a,b.region.chromosome),r=o.getColor(c,b.region.chromosome),s=n.getStrand(a),t=o.getStrand(c);if(d!=0&&e!=0){if(Math.abs(a.inferredInsertSize)>e)r=q="maroon";if(Math.abs(a.inferredInsertSize)<d)r=q="navy"}var A=f,C=k;l<=f&&(A=l);h>=k&&(C=h);for(var C=(C-A+1)*b.pixelBase,A=b.pixelPosition+g-(b.position-A)*b.pixelBase,h=(h-f+1)*b.pixelBase,f=b.pixelPosition+g-(b.position-f)*b.pixelBase,E=(k-l+1)*b.pixelBase,
l=b.pixelPosition+g-(b.position-l)*b.pixelBase,k=70;;){b.renderedArea[k]==null&&(b.renderedArea[k]=new FeatureBinarySearchTree);if(b.renderedArea[k].add({start:A,end:A+C-1})){C=[];A=[];q=SVG.addChild(j,"polygon",{points:{Reverse:f+","+(k+n.height/2)+" "+(f+5)+","+k+" "+(f+h-5)+","+k+" "+(f+h-5)+","+(k+n.height)+" "+(f+5)+","+(k+n.height),Forward:f+","+k+" "+(f+h-5)+","+k+" "+(f+h)+","+(k+n.height/2)+" "+(f+h-5)+","+(k+n.height)+" "+f+","+(k+n.height)}[s],stroke:n.getStrokeColor(a),"stroke-width":1,
fill:q,cursor:"pointer"});C.push(q);r=SVG.addChild(j,"polygon",{points:{Reverse:l+","+(k+o.height/2)+" "+(l+5)+","+k+" "+(l+E-5)+","+k+" "+(l+E-5)+","+(k+o.height)+" "+(l+5)+","+(k+o.height),Forward:l+","+k+" "+(l+E-5)+","+k+" "+(l+E)+","+(k+o.height/2)+" "+(l+E-5)+","+(k+o.height)+" "+l+","+(k+o.height)}[t],stroke:o.getStrokeColor(c),"stroke-width":1,fill:r,cursor:"pointer"});A.push(r);SVG.addChild(j,"line",{x1:f+h,y1:k+n.height/2,x2:l,y2:k+n.height/2,"stroke-width":"1",stroke:"gray",cursor:"pointer"});
if(b.zoom>95){if(p!=null){p=SVG.addChild(j,"path",{d:Utils.genBamVariants(p,b.pixelBase,f,k),fill:"orangered"});C.push(p)}if(m!=null){m=SVG.addChild(j,"path",{d:Utils.genBamVariants(m,b.pixelBase,l,k),fill:"orangered"});A.push(m)}}$(C).qtip({content:{text:n.getTipText(a),title:n.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:false},style:{width:280,classes:"ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"});$(C).click(function(){console.log(a);
b.showInfoWidget({query:a[n.infoWidgetId],feature:a,featureType:a.featureType,adapter:b.trackData.adapter})});$(A).qtip({content:{text:o.getTipText(c),title:o.getTipTitle(c)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:false},style:{width:280,classes:"ui-tooltip ui-tooltip-shadow"},show:"click",hide:"click mouseleave"});$(A).click(function(){console.log(c);b.showInfoWidget({query:c[o.infoWidgetId],feature:c,featureType:c.featureType,adapter:b.trackData.adapter})});break}k=
k+12}};if(0<f.length){for(var n=0,p=f.length;n<p;n++)if(0<f[n].data.length){var o=f[n];k(o);for(var o=o.data,r=0,q=o.length;r<q;r++){var t=o[r];if(c){var s=o[r+1];null!=s&&(t.name==s.name?(m(t,s),r++):l(t))}else l(t)}}c=24*Object.keys(this.renderedArea).length;0<c&&this.setHeight(c+10+70)}console.timeEnd("BamRender "+a.params.resource)};
TrackSvg.prototype.GeneTranscriptRender=function(a){var a=this._getFeaturesByChunks(a),b=this;console.time("GeneTranscriptRender");for(var c=function(a){var c=a.start,d=a.end-c+1,e=b.width/2,k=b.types[a.featureType],l=k.getColor(a),d=d*b.pixelBase,c=b.pixelPosition+e-(b.position-c)*b.pixelBase;try{var m=Math.max(d,8*k.getLabel(a).length)}catch(n){m=72}for(var p=0,o=10+k.height;;){null==b.renderedArea[p]&&(b.renderedArea[p]=new FeatureBinarySearchTree);var r,q=p;if(null!=a.transcripts)for(var t=0,
s=a.transcripts.length+1;t<s;t++){null==b.renderedArea[q]&&(b.renderedArea[q]=new FeatureBinarySearchTree);r=!b.renderedArea[q].contains({start:c,end:c+m-1});if(!1==r)break;q+=20}else r=b.renderedArea[p].add({start:c,end:c+m-1});if(r){r=SVG.addChild(b.features,"rect",{x:c,y:p,width:d,height:k.height,stroke:"#3B0B0B","stroke-width":0.5,fill:l,cursor:"pointer"});var w=SVG.addChild(b.features,"text",{i:t,x:c,y:o,"font-size":10,opacity:null,fill:"black","font-family":"Oxygen Mono",cursor:"pointer"});
w.textContent=k.getLabel(a);$([r,w]).qtip({content:{text:k.getTipText(a),title:k.getTipTitle(a)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$([r,w]).click(function(){b.showInfoWidget({query:a[b.types[a.featureType].infoWidgetId],feature:a,featureType:a.featureType,adapter:b.trackData.adapter})});q=p+20;p=o+20;if(null!=a.transcripts){t=0;for(s=a.transcripts.length;t<s;t++){null==b.renderedArea[q]&&(b.renderedArea[q]=
new FeatureBinarySearchTree);var u=a.transcripts[t],w=b.pixelPosition+e-(b.position-u.start)*b.pixelBase;r=(u.end-u.start+1)*b.pixelBase;k=b.types[u.featureType];l=k.getColor(u);try{m=Math.max(d,d-(a.end-u.start)*b.pixelBase+7*k.getLabel(u).length)}catch(B){m=72}b.renderedArea[q].add({start:c,end:c+m-1});o=SVG.addChild(b.features,"g",{widgetId:u[k.infoWidgetId]});r=SVG.addChild(o,"rect",{x:w,y:q+1,width:r,height:k.height,fill:"gray",cursor:"pointer"});w=SVG.addChild(o,"text",{x:w,y:p,"font-size":10,
opacity:null,fill:"black","font-family":"Oxygen Mono",cursor:"pointer"});w.textContent=k.getLabel(u);$(o).qtip({content:{text:k.getTipText(u),title:k.getTipTitle(u)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$(o).click(function(){var a=this.getAttribute("widgetId");b.showInfoWidget({query:a,feature:u,featureType:u.featureType,adapter:b.trackData.adapter})});k=0;for(r=a.transcripts[t].exons.length;k<r;k++){var w=
a.transcripts[t].exons[k],o=b.types[w.featureType],x=parseInt(w.start),v=parseInt(w.end),y=b.pixelPosition+e-(b.position-x)*b.pixelBase,z=(v-x+1)*b.pixelBase,D=SVG.addChild(b.features,"g");$(D).qtip({content:{text:o.getTipText(w,u),title:o.getTipTitle(w)},position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});SVG.addChild(D,"rect",{i:t,x:y,y:q-1,width:z,height:o.height,stroke:"gray","stroke-width":1,fill:"white",cursor:"pointer"});
z=y=0;u.genomicCodingStart>x&&u.genomicCodingStart<v?(y=parseInt(u.genomicCodingStart),z=v):u.genomicCodingEnd>x&&u.genomicCodingEnd<v?(y=x,z=parseInt(u.genomicCodingEnd)):u.genomicCodingStart<x&&u.genomicCodingEnd>v&&(y=x,z=v);v=z-y;x=b.pixelPosition+e-(b.position-y)*b.pixelBase;y=(v+1)*b.pixelBase;if(0<v){SVG.addChild(D,"rect",{i:t,x:x,y:q-1,width:y,height:o.height,stroke:l,"stroke-width":1,fill:l,cursor:"pointer"});v=0;for(y=3-w.phase;v<y&&10==Math.round(b.pixelBase)&&-1!=w.phase;v++)SVG.addChild(D,
"rect",{i:t,x:x+10*v,y:q-1,width:b.pixelBase,height:o.height,stroke:l,"stroke-width":1,fill:"white",cursor:"pointer"})}}q+=20;p+=20}}break}p+=20;o+=20}},d=0,e=a.length;d<e;d++)c(a[d]);a=24*Object.keys(this.renderedArea).length;0<a&&this.setHeight(a+10);console.timeEnd("GeneTranscriptRender")};
TrackSvg.prototype.SequenceRender=function(a){this.invalidZoomText.setAttribute("visibility","hidden");console.time("Sequence render "+a.items.sequence.length);var b="14";95==this.zoom&&(b="10");for(var c=this.width/2,d=a.items.start,e=a.items.start,f=a.items.sequence,g=0;g<f.length;g++){var h=this.pixelPosition+c-(this.position-d)*this.pixelBase;d++;h=SVG.addChild(this.features,"text",{x:h+1,y:12,"font-size":b,"font-family":"Oxygen Mono",fill:SEQUENCE_COLORS[f.charAt(g)]});h.textContent=f.charAt(g);
$(h).qtip({content:f.charAt(g)+" "+(e+g).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),position:{target:"mouse",adjust:{x:15,y:0},viewport:$(window),effect:!1},style:{width:!0,classes:"qtip-light qtip-shadow"}})}console.timeEnd("Sequence render "+a.items.sequence.length);this.trackSvgLayout.setNucleotidPosition(this.position)};
TrackSvg.prototype.HistogramRender=function(a){var b=this._getFeaturesByChunks(a);console.log("HISTOGRAM LENGTH: "+b.length);var a=this.width/2,c="";if(0<b.length)var c=b[0],d=(c.end-c.start)*this.pixelBase,e=this.pixelPosition+a-(this.position-parseInt(c.start))*this.pixelBase,c=e+d/2+",75 ";for(var f=0,g=b.length;f<g;f++){e=b[f];e.start=parseInt(e.start);e.end=parseInt(e.end);var d=e.end-e.start,h=this.types[e.featureType].histogramColor,d=d*this.pixelBase,e=this.pixelPosition+a-(this.position-
e.start)*this.pixelBase,j=b[f].value;null==j&&(j=b[f].features_count);j*=5;c+=e+d/2+","+(75-j)+" "}0<b.length&&(b=b[b.length-1],d=(b.end-b.start)*this.pixelBase,e=this.pixelPosition+a-(this.position-parseInt(b.start))*this.pixelBase,c+=e+d/2+",75 ");SVG.addChild(this.features,"polyline",{points:c,stroke:"#000000","stroke-width":0.2,fill:h,cursor:"pointer"});this.setHeight(85);console.log(0);this.axis||(this.axis=!0,h=SVG.addChild(this.histogramLegend,"text",{x:10,y:79,"font-size":12,opacity:"0.9",
fill:"gray","font-family":"Oxygen Mono",visibility:"visible"}),h.textContent="-0",h=SVG.addChild(this.histogramLegend,"text",{x:10,y:79-5*Math.log(10),"font-size":12,opacity:"0.9",fill:"gray","font-family":"Oxygen Mono",visibility:"visible"}),h.textContent="-10",h=SVG.addChild(this.histogramLegend,"text",{x:10,y:79-5*Math.log(100),"font-size":12,opacity:"0.9",fill:"gray","font-family":"Oxygen Mono",visibility:"visible"}),h.textContent="-100",h=SVG.addChild(this.histogramLegend,"text",{x:10,y:79-5*
Math.log(1E3),"font-size":12,opacity:"0.9",fill:"gray","font-family":"Oxygen Mono",visibility:"visible"}),h.textContent="-1000")};
TrackSvg.prototype.showInfoWidget=function(a){if("orange"==this.trackData.adapter.species&&(-1!=a.featureType.indexOf("gene")&&(a.featureType="geneorange"),-1!=a.featureType.indexOf("transcript")))a.featureType="transcriptorange";switch(a.featureType){case "gene":(new GeneInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "geneorange":(new GeneOrangeInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "transcriptorange":(new TranscriptOrangeInfoWidget(null,this.trackData.adapter.species)).draw(a);
break;case "transcript":(new TranscriptInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "snp":(new SnpInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "vcf":(new VCFVariantInfoWidget(null,this.trackData.adapter.species)).draw(a)}};
TrackSvg.prototype._getFeaturesByChunks=function(a){for(var b=a.items,c=a.params.dataType,a=a.params.chromosome,d=[],e,f,g,h,d=[],j=0,k=b.length;j<k;j++)if(!0!=this.chunksDisplayed[b[j].key+c]){for(var l=0,m=b[j][c].length;l<m;l++){e=b[j][c][l];f=!1;g=this.trackData.adapter.featureCache._getChunk(e.start);for(h=this.trackData.adapter.featureCache._getChunk(e.end);g<=h;g++)if(!0==this.chunksDisplayed[a+":"+g+c]){f=!0;break}f||d.push(e)}this.chunksDisplayed[b[j].key+c]=!0}return d};
TrackSvg.prototype._removeDisplayedChunks=function(a){for(var b=a.items,c=[],d=a.params.dataType,e=a.params.chromosome,f,g,h,j,k=[],l=0,m=b.length;l<m;l++)if(!0!=this.chunksDisplayed[b[l].key+d]){for(var k=[],n=0,p=b[l][d].length;n<p;n++){f=b[l][d][n];g=!1;h=this.trackData.adapter.featureCache._getChunk(f.start);for(j=this.trackData.adapter.featureCache._getChunk(f.end);h<=j;h++)if(!0==this.chunksDisplayed[e+":"+h+d]){g=!0;break}g||k.push(f)}this.chunksDisplayed[b[l].key+d]=!0;b[l][d]=k;c.push(b[l])}a.items=
c;return a};
function TrackSvgLayout(a,b){var c=this;this.args=b;this.id=Math.round(1E7*Math.random());this.trackSvgList=[];this.swapHash={};this.zoomOffset=0;this.windowSize=this.mousePosition=this.parentLayout=null;this.zoomMultiplier=1;this.height=0;"undefined"!=typeof b&&(this.width=b.width||this.width,this.height=b.height||this.height,this.region=b.region||this.region,this.zoomOffset=b.zoomOffset||this.zoomOffset,this.zoomMultiplier=b.zoomMultiplier||this.zoomMultiplier,this.parentLayout=b.parentLayout||this.parentLayout,
this.genomeViewer=b.genomeViewer||this.genomeViewer);this.visualRegion=new Region;this.visualRegion.load(this.region);this._calculateMinRegion();this._calculatePixelBase();this.onReady=new Event;this.onRegionChange=new Event;this.onRegionSelect=new Event;this.onMove=new Event;this.onWindowSize=new Event;this.onMousePosition=new Event;this.onSvgRemoveTrack=new Event;this.parent=a;this.svgTop=SVG.init(a.top,{width:this.width,height:25});this.svg=SVG.init(a.track,{width:this.width,height:this.height});
var d=this.width/2;this.positionText=SVG.addChild(this.svgTop,"text",{x:d-30,y:22,"font-size":10,"font-family":"Oxygen Mono",fill:"green"});this.nucleotidText=SVG.addChild(this.svgTop,"text",{x:d+35,y:22,"font-family":"Oxygen Mono","font-size":13});this.firstPositionText=SVG.addChild(this.svgTop,"text",{x:0,y:22,"font-size":10,"font-family":"Oxygen Mono",fill:"green"});this.lastPositionText=SVG.addChild(this.svgTop,"text",{x:this.width-70,y:22,"font-size":10,"font-family":"Oxygen Mono",fill:"green"});
this.viewNtsArrow=SVG.addChild(this.svgTop,"rect",{x:2,y:6,width:this.width-4,height:2,opacity:"0.5",fill:"black"});this.viewNtsArrowLeft=SVG.addChild(this.svgTop,"polyline",{points:"0,1 2,1 2,13 0,13",opacity:"0.5",fill:"black"});this.viewNtsArrowRight=SVG.addChild(this.svgTop,"polyline",{points:this.width+",1 "+(this.width-2)+",1 "+(this.width-2)+",13 "+this.width+",13",opacity:"0.5",fill:"black"});this.windowSize="Window size: "+this.region.length()+" nts";this.viewNtsTextBack=SVG.addChild(this.svgTop,
"rect",{x:d-40,y:0,width:7*this.windowSize.length,height:13,fill:"whitesmoke"});this.viewNtsText=SVG.addChild(this.svgTop,"text",{x:d-30,y:11,"font-size":10,"font-family":"Oxygen Mono",fill:"black"});this.viewNtsText.textContent=this.windowSize;this._setTextPosition();this.currentLine=SVG.addChild(this.svg,"rect",{id:this.id+"centerLine",x:d,y:this.height,width:this.pixelBase,height:this.height,"stroke-width":"2",stroke:"orangered",opacity:"0.5",fill:"orange"});this.mouseLine=SVG.addChild(this.svg,
"rect",{id:this.id+"mouseLine",x:-20,y:this.height,width:this.pixelBase,height:this.height,"stroke-width":"2",stroke:"lightgray",opacity:"0.7",fill:"gainsboro"});if(null==this.parentLayout)$(a.track).mousemove(function(b){var d=c.region.center(),e=c.width/2,f=c.pixelBase/2,b=(b.clientX-$(a.track).offset().left-f)/c.pixelBase|0;c.mouseLine.setAttribute("x",b*c.pixelBase+e%c.pixelBase);c.mousePosition=d+b-(e/c.pixelBase|0);c.onMousePosition.notify({mousePos:c.mousePosition,baseHtml:c.getMousePosition(c.mousePosition)})}),
$(this.svg).mousedown(function(a){this.setAttribute("cursor","move");var b=a.clientX,d=0;$(this).mousemove(function(a){this.setAttribute("cursor","move");a=(b-a.clientX)/c.pixelBase|0;if(a!=d){var e=d-a,f=c.region.center()-e;if(f>0){c.region.start=c.region.start-e;c.region.end=c.region.end-e;c._setTextPosition();c.onMove.notify(e);d=a;c.setNucleotidPosition(f)}}})}),$(this.svg).mouseup(function(){c.mouseLine.setAttribute("visibility","visible");this.setAttribute("cursor","default");$(this).off("mousemove")}),
$(this.svg).mouseleave(function(){this.setAttribute("cursor","default");$(this).off("mousemove");$("body").off("keydown")}),$(this.svg).mouseenter(function(){$("body").off("keydown");$("body").keydown(function(a){var b=0;switch(a.keyCode){case 37:b=a.ctrlKey?Math.round(100/c.pixelBase):Math.round(10/c.pixelBase);break;case 39:b=a.ctrlKey?Math.round(-100/c.pixelBase):Math.round(-10/c.pixelBase);break;case 109:a.shiftKey&&console.log("zoom out");break;case 107:a.shiftKey&&console.log("zoom in")}if(b!=
0){c.region.start=c.region.start-b;c.region.end=c.region.end-b;c._setTextPosition();c.onMove.notify(b)}})});else{c.parentLayout.onMove.addEventListener(function(a,b){c._setTextPosition();c.onMove.notify(b)});var e=SVG.addChild(this.svg,"rect",{x:0,y:0,"stroke-width":"2",stroke:"deepskyblue",opacity:"0.5",fill:"honeydew"}),f,g;$(this.svg).mousedown(function(a){f=a.pageX-$(c.svg).offset().left;e.setAttribute("x",f);$(this).mousemove(function(a){g=a.pageX-$(c.svg).offset().left;g<f&&e.setAttribute("x",
g);e.setAttribute("width",Math.abs(g-f));e.setAttribute("height",c.height)})});$(this.svg).mouseup(function(){e.setAttribute("width",0);e.setAttribute("height",0);$(this).off("mousemove");if(f!=null&&g!=null){var a=f/c.pixelBase,b=g/c.pixelBase,a=a+c.visualRegion.start,b=b+c.visualRegion.start;c.region.start=parseInt(Math.min(a,b));c.region.end=parseInt(Math.max(a,b));c.onRegionSelect.notify()}});$(this.svg).mouseleave(function(){e.setAttribute("width",0);e.setAttribute("height",0);$(this).off("mousemove");
g=f=null})}}
TrackSvgLayout.prototype={setHeight:function(a){this.height=Math.max(a,60);this.svg.setAttribute("height",a);this.currentLine.setAttribute("height",parseInt(a));this.mouseLine.setAttribute("height",parseInt(a))},setWidth:function(a){this.width=a;this._calculateMinRegion();var b=this.width/2;this.svg.setAttribute("width",a);this.svgTop.setAttribute("width",a);this.positionText.setAttribute("x",b-30);this.nucleotidText.setAttribute("x",b+35);this.lastPositionText.setAttribute("x",a-70);this.viewNtsArrow.setAttribute("width",
a-4);this.viewNtsArrowRight.setAttribute("points",a+",1 "+(a-2)+",1 "+(a-2)+",13 "+a+",13");this.viewNtsText.setAttribute("x",b-30);this.viewNtsTextBack.setAttribute("x",b-40);this.currentLine.setAttribute("x",b);this.currentLine.setAttribute("width",this.pixelBase);this.mouseLine.setAttribute("width",this.pixelBase);for(b=0;b<this.trackSvgList.length;b++)this.trackSvgList[b].setWidth(a);this._setTextPosition();this.onWindowSize.notify({windowSize:this.viewNtsText.textContent});this.onRegionChange.notify()},
setZoom:function(){throw"DEPRECATED: TrackSvgLayout.prototype.setZoom";},setRegion:function(a){var b=this;this._calculateMinRegion();this._calculatePixelBase();this.currentLine.setAttribute("width",this.pixelBase);this.mouseLine.setAttribute("width",this.pixelBase);this.viewNtsText.textContent="Window size: "+this.region.length()+" nts";this.windowSize=this.viewNtsText.textContent;this._setTextPosition();this.onWindowSize.notify({windowSize:this.viewNtsText.textContent});if(null!=a.species)for(i in this.trackSvgList)if(this.trackSvgList[i].trackData.adapter instanceof
CellBaseAdapter||this.trackSvgList[i].trackData.adapter instanceof SequenceAdapter)this.trackSvgList[i].trackData.adapter.species=a.species,this.trackSvgList[i].trackData.adapter.clearData();this.nucleotidText.textContent="";var c=function(){var a;a:{for(i in b.trackSvgList)if("ready"!=b.trackSvgList[i].status){a=!1;break a}a=!0}a?null==b.parentLayout&&b.onReady.notify():setTimeout(c,100)};setTimeout(c,10);this.onRegionChange.notify()},addTrack:function(a,b){var c=this,d=b.visibleRange;b.region=this.region;
b.trackData=a;b.zoom=this.zoom;b.pixelBase=this.pixelBase;b.width=this.width;b.visibleRange=b.visibleRange;b.adapter=a.adapter;b.trackSvgLayout=this;var e=new TrackSvg(this.svg,b),f=this.trackSvgList.push(e);this.swapHash[e.id]={index:f-1,visible:!0};e.setY(this.height);e.draw();this.setHeight(this.height+e.getHeight());var g,h,j,k,l=function(){g=parseInt(c.region.start-2*c.halfVirtualBase);h=parseInt(c.region.end+2*c.halfVirtualBase);j=parseInt(c.region.start-2*c.halfVirtualBase);k=parseInt(c.region.end+
2*c.halfVirtualBase);e.pixelBase=c.pixelBase},m=function(){c.zoom<=e.histogramZoom?(e.histogram=!0,e.histogramLogarithm=!0,e.histogramMax=500,e.interval=parseInt(5/c.pixelBase)):(e.histogram=null,e.histogramLogarithm=null,e.histogramMax=null)},n=function(){e.transcript=null!=e.transcriptZoom&&c.zoom>=e.transcriptZoom?!0:null},p=function(b){c.zoom>=d.start-c.zoomOffset&&c.zoom<=d.end?(e.setLoading(!0),a.retrieveData({chromosome:c.region.chromosome,start:j,end:k,histogram:e.histogram,histogramLogarithm:e.histogramLogarithm,
histogramMax:e.histogramMax,interval:e.interval,transcript:e.transcript,sender:b}),e.invalidZoomText.setAttribute("visibility","hidden")):e.invalidZoomText.setAttribute("visibility","visible")};e.getData=function(a,b){!0==b.params.histogram?(e.featuresRender=e.HistogramRender,e.setHistogramLegend(!0)):(e.featuresRender=e.defaultRender,e.setHistogramLegend(!1));c.setHeight(c.height-e.getHeight());e.featuresRender(b);e.setLoading(!1);c.setHeight(c.height+e.getHeight());c._redraw()};e.onGetDataIdx=a.adapter.onGetData.addEventListener(e.getData);
m();n();l();p("firstLoad");e.regionChange=function(){e.pixelBase=c.pixelBase;e.zoom=c.zoom;e.position=e.region.center();m();n();e.cleanSvg();l();p("onRegionChange")};e.onRegionChangeIdx=this.onRegionChange.addEventListener(e.regionChange);e.move=function(b,f){e.position=c.region.center();var l=f*c.pixelBase;e.pixelPosition-=l;l=parseFloat(e.features.getAttribute("x"))+l;e.features.setAttribute("x",l);j=parseInt(e.region.start-c.halfVirtualBase);virtualEnd=parseInt(e.region.end+c.halfVirtualBase);
if(c.zoom>=d.start&&c.zoom<=d.end&&(0<f&&j<g&&(a.retrieveData({chromosome:c.region.chromosome,start:parseInt(g-c.halfVirtualBase),end:g,histogram:e.histogram,interval:e.interval,transcript:e.transcript,sender:"onMove"}),g=parseInt(g-c.halfVirtualBase)),0>f&&virtualEnd>h))a.retrieveData({chromosome:c.region.chromosome,start:h,end:parseInt(h+c.halfVirtualBase),histogram:e.histogram,interval:e.interval,transcript:e.transcript,sender:"onMove"}),h=parseInt(h+c.halfVirtualBase)};e.onMoveIdx=this.onMove.addEventListener(e.move)},
removeTrack:function(a){this._hideTrack(a);var b=this.swapHash[a].index;this.onRegionChange.removeEventListener(this.trackSvgList[b].onRegionChangeIdx);this.onMove.removeEventListener(this.trackSvgList[b].onMoveIdx);var c=this.trackSvgList.splice(b,1)[0];delete this.swapHash[a];for(b=0;b<this.trackSvgList.length;b++)this.swapHash[this.trackSvgList[b].id].index=b;return c},restoreTrack:function(a,b){a.region=this.region;a.zoom=this.zoom;a.pixelBase=this.pixelBase;a.width=this.width;var c=this.trackSvgList.push(a);
this.swapHash[a.id]={index:c-1,visible:!0};a.setY(this.height);a.draw();this.setHeight(this.height+a.getHeight());a.onRegionChangeIdx=this.onRegionChange.addEventListener(a.regionChange);a.onMoveIdx=this.onMove.addEventListener(a.move);a.regionChange();null!=b&&this.setTrackIndex(a.id,b)},_redraw:function(){for(var a=null,b=0,c=0;c<this.trackSvgList.length;c++)a=this.trackSvgList[c],this.swapHash[a.id].visible&&(a.main.setAttribute("y",b),b+=a.getHeight())},_reallocateAbove:function(a){a=this.swapHash[a].index;
console.log(a+" wants to move up");if(0<a){var b=this.trackSvgList[a-1],c=this.trackSvgList[a],d=parseInt(b.main.getAttribute("y")),e=parseInt(c.main.getAttribute("height"));b.main.setAttribute("y",d+e);c.main.setAttribute("y",d);this.trackSvgList[a]=b;this.trackSvgList[a-1]=c;this.swapHash[b.id].index=a;this.swapHash[c.id].index=a-1}else console.log("is at top")},_reallocateUnder:function(a){a=this.swapHash[a].index;console.log(a+" wants to move down");if(a+1<this.trackSvgList.length){var b=this.trackSvgList[a],
c=this.trackSvgList[a+1],d=parseInt(b.main.getAttribute("y")),e=parseInt(c.main.getAttribute("height"));b.main.setAttribute("y",d+e);c.main.setAttribute("y",d);this.trackSvgList[a]=c;this.trackSvgList[a+1]=b;this.swapHash[c.id].index=a;this.swapHash[b.id].index=a+1}else console.log("is at bottom")},setTrackIndex:function(a,b){var c=this.trackSvgList.splice(this.swapHash[a].index,1)[0];this.trackSvgList.splice(b,0,c);for(c=0;c<this.trackSvgList.length;c++)this.swapHash[this.trackSvgList[c].id].index=
c;this._redraw()},scrollToTrack:function(a){a=this.swapHash[a];null!=a&&(a=this.trackSvgList[a.index],$(this.svg).parent().parent().scrollTop(a.main.getAttribute("y")))},_hideTrack:function(a){this.swapHash[a].visible=!1;a=this.trackSvgList[this.swapHash[a].index];this.svg.removeChild(a.main);this.setHeight(this.height-a.getHeight());this._redraw()},_showTrack:function(a){this.swapHash[a].visible=!0;a=this.trackSvgList[this.swapHash[a].index];this.svg.appendChild(a.main);this.setHeight(this.height+
a.getHeight());this._redraw()},_calculatePixelBase:function(){this.pixelBase=this.width/this.region.length();this.pixelBase/=this.zoomMultiplier;this.pixelBase=Math.max(this.pixelBase,10/Math.pow(2,20));this.halfVirtualBase=3*this.width/2/this.pixelBase;this.zoom=Math.round(Utils.getZoomByPixelBase(this.pixelBase))},_setTextPosition:function(){var a=this.region.center(),b=parseInt(this.width/this.pixelBase),b=Math.ceil(b/2-1);this.visualRegion.start=Math.floor(a-b);this.visualRegion.end=Math.floor(a+
b-1);this.positionText.textContent=Utils.formatNumber(a);this.firstPositionText.textContent=Utils.formatNumber(this.visualRegion.start);this.lastPositionText.textContent=Utils.formatNumber(this.visualRegion.end);this.viewNtsText.textContent="Window size: "+this.visualRegion.length()+" nts";this.viewNtsTextBack.setAttribute("width",7*this.viewNtsText.textContent.length);this.windowSize=this.viewNtsText.textContent},getTrackSvgById:function(a){return null!=this.swapHash[a]?this.trackSvgList[this.swapHash[a].index]:
null},getMousePosition:function(a){var b="",c="";0<a&&(b=this.getSequenceNucleotid(a),c="color:"+SEQUENCE_COLORS[b]);return'<span style="font-family: Ubuntu Mono;font-size:19px;'+c+'">'+b+"</span>"},getSequenceNucleotid:function(a){var b=this.getTrackSvgById(1);return null!=b&&this.zoom>=b.visibleRange.start-this.zoomOffset&&this.zoom<=b.visibleRange.end?b.trackData.adapter.getNucleotidByPosition({start:a,end:a,chromosome:this.region.chromosome}):""},setNucleotidPosition:function(a){a=this.getSequenceNucleotid(a);
this.nucleotidText.setAttribute("fill",SEQUENCE_COLORS[a]);this.nucleotidText.textContent=a},_calculateMinRegion:function(){var a=this.region.length(),b=parseInt(this.width/Utils.getPixelBaseByZoom(100));a<b&&(a=this.region.center(),b=Math.ceil(b/2-1),this.region.start=Math.floor(a-b),this.region.end=Math.floor(a+b))}};function TrackData(a,b){this.id=a;if(null!=b&&(null!=b.adapter&&(this.adapter=b.adapter),null!=b.gzip))this.gzip=b.gzip}TrackData.prototype.retrieveData=function(a){this.adapter.getData(a)};
TrackData.prototype.setFilters=function(a){this.adapter.setFilters(a)};TrackData.prototype.setOption=function(a,b){this.adapter.setOption(a,b)};function TrackSettingsWidget(a){this.id="TrackSettingsWidget"+Math.round(1E4*Math.random());"undefined"!=typeof a&&(this.trackSvg=a.trackSvg||this.trackSvg,this.treeRecord=a.treeRecord||this.treeRecord);this.filtersConfig=this.trackSvg.getFiltersConfig();this.filters=this.trackSvg.getFilters();null!=this.filtersConfig&&this.draw()}
TrackSettingsWidget.prototype={setFilters:function(a){this.trackSvg.setFilters(a)},draw:function(){for(var a=this,b=[],c=[],d=0;d<this.filtersConfig.length;d++){var e=this.filtersConfig[d].text,f=this.filtersConfig[d].name,g=[],h;null!=this.filters[f]?h=!1:h=!0;for(var j=0;j<this.filtersConfig[d].values.length;j++)g.push({text:this.filtersConfig[d].values[j],leaf:!0,checked:h,iconCls:"icon-blue-box"});f=Ext.create("Ext.data.TreeStore",{root:{text:f,expanded:!0,checked:h,iconCls:"icon-box",children:g},
fields:["text","name"]});b.push({xtype:"treepanel",useArrows:!0,bodyPadding:"10 0 10 0",title:e,border:!1,store:f,listeners:{checkchange:function(a,b){a.isRoot()&&a.eachChild(function(a){a.set("checked",b)})},afterrender:function(b){var b=b.getStore().getRootNode(),c=b.get("text");if(null!=a.filters[c])for(var d=0;d<a.filters[c].length;d++){var e=b.findChild("text",a.filters[c][d]);e.set("checked",!0);e.save}}}});c.push(f)}d=Ext.create("Ext.panel.Panel",{title:"Display settings",bodyPadding:10,items:[{xtype:"textfield",
value:a.trackSvg.getTitle(),fieldLabel:"TrackName",allowBlank:!1,listeners:{change:function(b,c){b.isValid()&&(a.trackSvg.setTitle(c),a.treeRecord.set("text",c),a.treeRecord.save())}}}]});b=Ext.create("Ext.tab.Panel",{title:"Filters",items:b});Ext.create("Ext.window.Window",{id:this.id+"window",title:"Settings",width:500,modal:!0,items:[d,b],buttons:[{text:"Ok",id:this.id+"okButton",handler:function(){for(var b={},d=0;d<c.length;d++){var e=c[d].getRootNode(),f=e.get("text"),g=[],h=0;e.eachChild(function(a){h++;
a.data.checked&&g.push(a.get("text"))});g.length==h&&(g=[]);b[f]=g}console.log(b);a.setFilters(b);Ext.getCmp(a.id+"window").destroy()}},{text:"Cancel",handler:function(){a.trackSvg.setTitle(k);a.treeRecord.set("text",k);a.treeRecord.save();Ext.getCmp(a.id+"window").destroy()}}]}).show();var k=a.trackSvg.getTitle()}};
function FeatureCache(a){this.args=a;this.id=Math.round(1E7*Math.random());this.chunkSize=5E4;this.gzip=!0;this.maxSize=10485760;this.size=0;if(null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip))this.gzip=a.gzip;this.cache={};this.chunksDisplayed={};this.maxFeaturesInterval=0;this.gzip=!1}FeatureCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)};
FeatureCache.prototype.getChunkRegion=function(a){start=this._getChunk(a.start)*this.chunkSize;end=this._getChunk(a.end)*this.chunkSize+this.chunkSize-1;return{start:start,end:end}};FeatureCache.prototype.getFirstFeature=function(){return this.gzip?JSON.parse(RawDeflate.inflate(this.cache[Object.keys(this.cache)[0]].data[0])):this.cache[Object.keys(this.cache)[0]].data[0]};FeatureCache.prototype.getFeatureChunk=function(a){return null!=this.cache[a]?this.cache[a]:null};
FeatureCache.prototype.getFeatureChunksByRegion=function(a){var b,c,d=[];b=this._getChunk(a.start);c=this._getChunk(a.end);for(var e=b;e<=c;e++)b=a.chromosome+":"+e,null!=this.cache[b]&&d.push(this.cache[b]);return d};
FeatureCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,h,j;f=this._getChunk(b.start);g=this._getChunk(b.end);for(var k=f;k<=g;k++)e=b.chromosome+":"+k,null==this.cache[e]&&(this.cache[e]={},this.cache[e].key=e),null==this.cache[e][d]&&(this.cache[e][d]=[]);a.constructor!=Array&&(a=[a]);for(var l=0,m=a.length;l<m;l++){j=a[l];j.featureType=c;e=this._getChunk(j.start);h=this._getChunk(j.end);j=this.gzip?RawDeflate.deflate(JSON.stringify(j)):j;for(k=e;k<=h;k++)k>=f&&k<=g&&(e=b.chromosome+
":"+k,this.cache[e][d].push(j))}};FeatureCache.prototype.putFeatures=function(a,b){var c,d,e;a.constructor!=Array&&(a=[a]);for(var f=0,g=a.length;f<g;f++){c=a[f];d=this._getChunk(c.start);e=this._getChunk(c.end);for(var h=d;h<=e;h++)d=c.chromosome+":"+h,null==this.cache[d]&&(this.cache[d]=[],this.cache[d].key=d),null==this.cache[d][b]&&(this.cache[d][b]=[]),this.gzip?this.cache[d][b].push(RawDeflate.deflate(JSON.stringify(c))):this.cache[d][b].push(c)}};
FeatureCache.prototype.putChunk=function(a,b){this.cache[a]=b};FeatureCache.prototype.getChunk=function(a){return this.cache[a]};FeatureCache.prototype.putCustom=function(a){a(this)};FeatureCache.prototype.getCustom=function(a){a(this)};FeatureCache.prototype.remove=function(a){for(var b=this._getChunk(a.start),c=this._getChunk(a.end);b<=c;b++)this.cache[a.chromosome+":"+b]=null};FeatureCache.prototype.clear=function(){this.size=0;this.cache={}};
function FeatureDataAdapter(a,b){this.dataSource=a;this.gzip=!0;this.params={};if(null!=b&&(null!=b.gzip&&(this.gzip=b.gzip),null!=b.species&&(this.species=b.species),null!=b.params))this.params=b.params;this.featureCache=new FeatureCache({chunkSize:1E4,gzip:this.gzip});this.onLoad=new Event;this.onGetData=new Event;this.chromosomesLoaded={}}
FeatureDataAdapter.prototype.getData=function(a){console.log("TODO comprobar histograma");console.log(a);this.params.dataType="data";this.params.chromosome=a.chromosome;!0!=this.chromosomesLoaded[a.chromosome]&&(this._fetchData(a),this.chromosomesLoaded[a.chromosome]=!0);a=this.featureCache.getFeatureChunksByRegion(a);null!=a&&this.onGetData.notify({items:a,params:this.params,cached:!0})};
FeatureDataAdapter.prototype._fetchData=function(a){var b=this;if(null!=this.dataSource)if(this.async)this.dataSource.success.addEventListener(function(c,e){b.parse(e,a);b.onLoad.notify()}),this.dataSource.fetch(this.async);else{var c=this.dataSource.fetch(this.async);this.parse(c,a)}};FeatureDataAdapter.prototype.addFeatures=function(a){this.featureCache.putFeatures(a,"data")};
function ChromosomeWidget(a,b){this.id=Math.round(1E7*Math.random());if(null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.species&&(this.species=b.species),null!=b.region))this.region=b.region;this.lastChromosome="";this.onClick=new Event;this.svg=SVG.init(a,{width:this.width,height:this.height});this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",
acen:"blue",clementina:"#ffc967"};this.data=null}ChromosomeWidget.prototype.setWidth=function(a){this.width=a;this.svg.setAttribute("width",a);for(this.tracksViewedRegion=this.width/Utils.getPixelBaseByZoom(this.zoom);this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this._drawSvg(this.data)};
ChromosomeWidget.prototype.drawChromosome=function(){var a=this,b=function(a,b){return a.start-b.start},c=new CellBaseManager(this.species);c.success.addEventListener(function(c,e){a.data=e.result[0];a.data.cytobands.sort(b);a._drawSvg(a.data)});c.get("feature","chromosome",this.region.chromosome,"info");this.lastChromosome=this.region.chromosome};
ChromosomeWidget.prototype._drawSvg=function(a){var b=this;this.chromosomeLength=a.size;b.pixelBase=(b.width-40)/this.chromosomeLength;var c=20,d=!0,e=b.region.center()*b.pixelBase+20,f=SVG.addChild(b.svg,"g",{cursor:"pointer"}),g=SVG.addChild(this.svg,"rect",{x:0,y:2,"stroke-width":"2",stroke:"deepskyblue",opacity:"0.5",fill:"honeydew"});$(this.svg).off("contextmenu");$(this.svg).off("mousedown");$(this.svg).off("mouseup");$(this.svg).off("mousemove");$(this.svg).off("mouseleave");$(this.svg).contextmenu(function(a){a.preventDefault()});
var h=!1,j=!1,k=!1,l,m,n;$(this.svg).mousedown(function(a){l=a.pageX-$(b.svg).offset().left;g.setAttribute("x",l);n=b.positionBox.getAttribute("x");$(this).mousemove(function(a){m=a.pageX-$(b.svg).offset().left;!1==h&&!1==j?(k=!0,m<l&&g.setAttribute("x",m),g.setAttribute("width",Math.abs(m-l)),g.setAttribute("height",b.height-3)):!1==k&&(j=!0,a=b.positionBox.getAttribute("width"),b.positionBox.setAttribute("x",m-a/2))})});$(this.svg).mouseup(function(){$(this).off("mousemove");if(null!=l)if(null!=
m)if(!1==h&&!1==j){var a=(l-20)/b.pixelBase,c=(m-20)/b.pixelBase;b.region.start=parseInt(Math.min(a,c));b.region.end=parseInt(Math.max(a,c));var d=Math.abs(l-m);b.positionBox.setAttribute("width",d);b.positionBox.setAttribute("x",Math.abs((l+m)/2)-d/2);b.onClick.notify();k=!1}else d=b.positionBox.getAttribute("width"),a=m-d/2,c=m+d/2,a=(a-20)/b.pixelBase,c=(c-20)/b.pixelBase,b.region.start=Math.round(a),b.region.end=Math.round(c),b.positionBox.setAttribute("x",m-d/2),b.onClick.notify(),j=!1;else d=
b.positionBox.getAttribute("width"),a=l-d/2,c=l+d/2,a=(a-20)/b.pixelBase,c=(c-20)/b.pixelBase,b.region.start=Math.round(a),b.region.end=Math.round(c),b.positionBox.setAttribute("x",l-d/2),b.onClick.notify();g.setAttribute("width",0);g.setAttribute("height",0);m=l=null;n=b.positionBox.getAttribute("x")});$(this.svg).mouseleave(function(){$(this).off("mousemove");null!=n&&b.positionBox.setAttribute("x",n);g.setAttribute("width",0);g.setAttribute("height",0);n=m=l=null;k=j=h=!1});for(var p=0;p<a.cytobands.length;p++){var o=
a.cytobands[p],r=b.pixelBase*(o.end-o.start),q=b.colors[o.stain];null==q&&(q="purple");var t=c+r/2;if("acen"==o.stain){var s="",s=c+r;d?(s=c+",10 "+t+",10 "+s+",19 "+t+",28 "+c+",28",d=!1):s=c+",19 "+t+",10 "+s+",10 "+s+",28 "+t+",28";SVG.addChild(f,"polyline",{points:s,stroke:"black",opacity:0.8,fill:q})}else SVG.addChild(f,"rect",{x:c,y:10,width:r,height:18,stroke:"black",opacity:0.8,fill:q});SVG.addChild(f,"text",{x:t,y:30,"font-size":10,transform:"rotate(90, "+t+", 30)",fill:"black"}).textContent=
o.name;c+=r}a=b.region.length()*b.pixelBase;this.positionBox=SVG.addChild(f,"rect",{x:e-a/2,y:2,width:a,height:b.height-3,stroke:"orangered","stroke-width":2,opacity:0.5,fill:"navajowhite"});$(this.positionBox).off("mouseenter");$(this.positionBox).off("mouseleave");$(this.positionBox).mouseenter(function(){!1==k&&(h=!0)});$(this.positionBox).mouseleave(function(){h=!1})};
ChromosomeWidget.prototype.setRegion=function(a){var b=!1;null!=a.species&&(this.species=a.species,b=!0);this.lastChromosome!=this.region.chromosome&&(b=!0);a=this.region.center();if(!isNaN(a)){var a=a*this.pixelBase+20,c=parseFloat(this.positionBox.getAttribute("width"));this.positionBox.setAttribute("x",a-c/2);c=this.region.length()*this.pixelBase;this.positionBox.setAttribute("width",c)}if(b){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.drawChromosome()}};
function CircularChromosomeWidget(a,b){var c=this;this.coord_x=400;this.coord_y=250;this.radius=200;this.stroke_width=20;if(null!=b&&(null!=b.coord_x&&(this.coord_x=b.coord_x),null!=b.coord_y&&(this.coord_y=b.coord_y),null!=b.radius&&(this.radius=b.radius),null!=b.stroke_width))this.stroke_width=b.stroke_width;this.circleLength=2*Math.PI*this.radius;this.y_point2=this.x_point2=this.y_point=this.x_point=this.angle_click=this.pixelRatio=this.chroLength=this.d=null;this.sep=27;this.angle_lines=Math.PI/
6;this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"};this.mySvg=document.createElementNS("http://www.w3.org/2000/svg","svg");console.log(this.mySvg);this.mySvg.setAttribute("width","1000");this.mySvg.setAttribute("height","600");a.appendChild(this.mySvg);$.ajax({url:"http://ws-beta.bioinfo.cipf.es/cellbase/rest/latest/hsa/genomic/region/13/cytoband?of=json"}).done(function(a){c.d=
JSON.parse(a);c.chroLength=c.d[0][c.d[0].length-1].end;c.pixelRatio=c.chroLength/c.circleLength;$(c.mySvg).click(function(a){var d,j,k,l;d=c.coord_x;j=c.radius+c.coord_y+c.stroke_width/2;k=c.coord_x;l=c.radius+c.coord_y-c.stroke_width/2;d=Math.sqrt(Math.pow(d-c.coord_x,2)+Math.pow(j-c.coord_y,2));k=Math.sqrt(Math.pow(k-c.coord_x,2)+Math.pow(l-c.coord_y,2));l=Math.sqrt(Math.pow(a.clientX-c.coord_x,2)+Math.pow(a.clientY-c.coord_y,2));j=!1;l>=k&&l<=d&&(j=!0);if(j){c.angle_click=0;a.clientX>c.coord_x&&
a.clientY<c.coord_y?c.angle_click=Math.atan((a.clientX-c.coord_x)/(c.coord_y-a.clientY)):a.clientX>c.coord_x&&a.clientY>c.coord_y?c.angle_click=Math.PI/2+Math.atan((a.clientY-c.coord_y)/(a.clientX-c.coord_x)):a.clientX<c.coord_x&&a.clientY>c.coord_y?c.angle_click=Math.PI+Math.atan((c.coord_x-a.clientX)/(a.clientY-c.coord_y)):a.clientX<c.coord_x&&a.clientY<c.coord_y&&(c.angle_click=3*Math.PI/2+Math.atan((c.coord_y-a.clientY)/(c.coord_x-a.clientX)));a=2*Math.PI;d=c.angle_click*c.circleLength/a*c.pixelRatio;
k=0;for(l=!0;k<c.d[0].length&&l;)c.d[0][k].start<=d&&c.d[0][k].end>=d&&(l=!1),k++;console.log(parseInt(d));c.x_point=(c.radius+c.sep)*Math.cos(c.angle_click)+c.coord_x;c.y_point=(c.radius+c.sep)*Math.sin(c.angle_click)+c.coord_y;c.x_point2=(c.radius-c.sep)*Math.cos(c.angle_click)+c.coord_x;c.y_point2=(c.radius-c.sep)*Math.sin(c.angle_click)+c.coord_y;b.setAttribute("x1",c.x_point);b.setAttribute("y1",c.y_point);b.setAttribute("x2",c.x_point2);b.setAttribute("y2",c.y_point2);d=[];0>c.angle_click-c.angle_lines?
(d.push((c.angle_click+c.angle_lines)*c.circleLength/a),d.push((a-2*c.angle_lines)*c.circleLength/a),d.push((c.angle_lines-c.angle_click)*c.circleLength/a+2)):c.angle_click+c.angle_lines>a?(d.push((c.angle_lines-(a-c.angle_click))*c.circleLength/a),d.push((a-2*c.angle_lines)*c.circleLength/a),d.push((c.angle_lines+(a-c.angle_click))*c.circleLength/a+2)):(d.push(0),d.push((c.angle_click-c.angle_lines)*c.circleLength/a),d.push(2*c.angle_lines*c.circleLength/a),d.push((a-(c.angle_click-c.angle_lines)+
2*c.angle_lines)*c.circleLength/a));f.setAttribute("cx",c.coord_x);f.setAttribute("cy",c.coord_y);f.setAttribute("r",c.radius);f.setAttribute("stroke-dasharray",d.toString())}});var b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("stroke","red");b.setAttribute("stroke-width",1);b.setAttribute("transform","rotate(-90,"+c.coord_x+","+c.coord_y+")");c.mySvg.appendChild(b);c.drawChromosome();var f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("fill",
"transparent");f.setAttribute("stroke","orange");f.setAttribute("opacity","0.2");f.setAttribute("stroke-width",55);f.setAttribute("transform","rotate(-90,"+c.coord_x+","+c.coord_y+")");c.mySvg.appendChild(f)})}
CircularChromosomeWidget.prototype.drawChromosome=function(){this.chroLength=this.d[0][this.d[0].length-1].end;var a=[],b=0,c=[],d=!0;c.push(this.d[0][0].stain);for(b=1;b<=this.d[0].length-1;b++){for(var e=0;e<=c.length-1;e++)c[e]==this.d[0][b].stain&&(d=!1);d&&c.push(this.d[0][b].stain);d=!0}for(var d=null,f=!0,e=0;e<c.length;e++){for(var g=0;g<this.d[0].length;g++)this.d[0][g].stain==c[e]&&(f?(0==g&&1==this.d[0][g].start||(a.push(0),b=this.d[0][g].start-1,b/=this.pixelRatio,a.push(b)),b=this.d[0][g].end-
this.d[0][g].start,b/=this.pixelRatio,a.push(b),d=g,f=!1):(b=this.d[0][g].start-this.d[0][d].end,b/=this.pixelRatio,"blue"==this.colors[c[e]]?a.push(2):a.push(b),b=this.d[0][g].end-this.d[0][g].start,b/=this.pixelRatio,a.push(b),d=g));b=this.chroLength-this.d[0][d].end;b/=this.pixelRatio;a=a+","+b;b=e;f=c;g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.setAttribute("cx",this.coord_x);g.setAttribute("cy",this.coord_y);g.setAttribute("r",this.radius);g.setAttribute("fill","transparent");
g.setAttribute("stroke",this.colors[f[b]]);g.setAttribute("stroke-width",this.stroke_width);g.setAttribute("transform","rotate(-90,"+this.coord_x+","+this.coord_y+")");g.setAttribute("stroke-dasharray",a.toString());this.mySvg.appendChild(g);a=[];f=!0}};
function KaryotypeWidget(a,b){this.parent=a;this.id=Math.round(1E7*Math.random());if(null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.species&&(this.species=b.species),null!=b.region))this.region=b.region;this.onClick=new Event;this.afterRender=new Event;this.rendered=!1;this.svg=SVG.init(a,{width:this.width,height:this.height});this.markGroup=SVG.addChild(this.svg,"g",{cursor:"pointer"});this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",
gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"};this.data2=this.chromosomeList=null}KaryotypeWidget.prototype.setWidth=function(a){this.width=a;for(this.svg.setAttribute("width",a);this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this._drawSvg(this.chromosomeList,this.data2)};
KaryotypeWidget.prototype.drawKaryotype=function(){var a=this,b=function(a,b){for(var c=!0,g=0;g<a.name.length&&!0==c;g++)isNaN(a.name[g])&&(c=!1);return!c?1:a.name-b.name},c=new CellBaseManager(this.species);c.success.addEventListener(function(c,e){a.chromosomeList=e.result;a.chromosomeList.sort(b);a._drawSvg(a.chromosomeList)});c.get("feature","chromosome",null,"all")};
KaryotypeWidget.prototype._drawSvg=function(a){for(var b=this,c=20,d=b.width/a.length,e=0,f=0,g=a.length;f<g;f++){var h=a[f].size;h>e&&(e=h)}b.pixelBase=(b.height-10)/e;b.chrOffsetY={};b.chrOffsetX={};f=0;for(g=a.length;f<g;f++){var h=a[f],j=2+e*b.pixelBase-h.size*b.pixelBase;b.chrOffsetY[h.name]=j;var k=!0,l=b.region.center()*b.pixelBase,m=SVG.addChild(b.svg,"g",{cursor:"pointer",chr:h.name});$(m).click(function(a){var c=this.getAttribute("chr"),a=a.pageY-$(b.svg).offset().top;b.positionBox.setAttribute("x1",
b.chrOffsetX[c]-10);b.positionBox.setAttribute("x2",b.chrOffsetX[c]+23);b.positionBox.setAttribute("y1",a);b.positionBox.setAttribute("y2",a);a=parseInt((a-b.chrOffsetY[c])/b.pixelBase);b.region.chromosome=c;b.region.start=a;b.region.end=a;b.onClick.notify(b.region)});for(var n=0,p=h.cytobands.length;n<p;n++){var o=h.cytobands[n],r=b.pixelBase*(o.end-o.start),q=b.colors[o.stain];null==q&&(q="purple");if("acen"==o.stain){var o="",o=c+6.5,t=j+r/2,s=c+13,w=j+r;k?(o=c+","+j+" "+s+","+j+" "+s+","+t+" "+
o+","+w+" "+c+","+t,k=!1):o=c+","+w+" "+c+","+t+" "+o+","+j+" "+s+","+t+" "+s+","+w;SVG.addChild(m,"polyline",{points:o,stroke:"black",opacity:0.8,fill:q})}else SVG.addChild(m,"rect",{x:c,y:j,width:13,height:r,stroke:"grey",opacity:0.8,fill:q});j+=r}SVG.addChild(b.svg,"text",{x:c+1,y:b.height,"font-size":9,fill:"black"}).textContent=h.name;b.chrOffsetX[h.name]=c;c+=d}b.positionBox=SVG.addChild(b.svg,"line",{x1:b.chrOffsetX[b.region.chromosome]-10,y1:l+b.chrOffsetY[b.region.chromosome],x2:b.chrOffsetX[b.region.chromosome]+
23,y2:l+b.chrOffsetY[b.region.chromosome],stroke:"orangered","stroke-width":2,opacity:0.5});b.rendered=!0;b.afterRender.notify()};
KaryotypeWidget.prototype.setRegion=function(a){var b=!1;null!=a.species&&(this.species=a.species,b=!0);null==a.species&&(this.positionBox.setAttribute("x1",this.chrOffsetX[this.region.chromosome]-10),this.positionBox.setAttribute("x2",this.chrOffsetX[this.region.chromosome]+23));var c=this.region.center();!isNaN(c)&&null==a.species&&(a=c*this.pixelBase+this.chrOffsetY[this.region.chromosome],this.positionBox.setAttribute("y1",a),this.positionBox.setAttribute("y2",a));if(b){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);
this.drawKaryotype()}};KaryotypeWidget.prototype.updatePositionBox=function(){this.positionBox.setAttribute("x1",this.chrOffsetX[this.region.chromosome]-10);this.positionBox.setAttribute("x2",this.chrOffsetX[this.region.chromosome]+23);var a=Utils.centerPosition(this.region)*this.pixelBase+this.chrOffsetY[this.region.chromosome];this.positionBox.setAttribute("y1",a);this.positionBox.setAttribute("y2",a)};
KaryotypeWidget.prototype.addMark=function(a){var b=this,c=function(){if(null!=a.chromosome&&null!=a.start&&null!=b.chrOffsetX[a.chromosome]){var c=b.chrOffsetX[a.chromosome]-10,e=a.start*b.pixelBase+b.chrOffsetY[a.chromosome]-4;SVG.addChild(b.markGroup,"polyline",{points:c+","+e+" "+b.chrOffsetX[a.chromosome]+","+(a.start*b.pixelBase+b.chrOffsetY[a.chromosome])+" "+c+","+(a.start*b.pixelBase+b.chrOffsetY[a.chromosome]+4)+" "+c+","+e,stroke:"black",opacity:0.8,fill:"#33FF33"})}};this.rendered?c():
this.afterRender.addEventListener(function(){c()})};KaryotypeWidget.prototype.unmark=function(){for(;this.markGroup.firstChild;)this.markGroup.removeChild(this.markGroup.firstChild)};function DataSource(){}DataSource.prototype.fetch=function(){};
function CellBaseAdapter(a){this.host=null;this.gzip=!0;this.params={};if(null!=a){null!=a.host&&(this.host=a.host);null!=a.species&&(this.species=a.species);null!=a.category&&(this.category=a.category);null!=a.subCategory&&(this.subCategory=a.subCategory);null!=a.resource&&(this.resource=a.resource);if(null!=a.featureCache)var b=a.featureCache;null!=a.params&&(this.params=a.params);null!=a.filters&&(this.filters=a.filters);null!=a.options&&(this.options=a.options);if(null!=a.featureConfig&&(null!=
a.featureConfig.filters&&(this.filtersConfig=a.featureConfig.filters),null!=a.featureConfig.options)){this.optionsConfig=a.featureConfig.options;for(a=0;a<this.optionsConfig.length;a++)!0==this.optionsConfig[a].checked&&(this.options[this.optionsConfig[a].name]=!0,this.params[this.optionsConfig[a].name]=!0)}}this.featureCache=new FeatureCache(b);this.onGetData=new Event}CellBaseAdapter.prototype.clearData=function(){this.featureCache.clear()};
CellBaseAdapter.prototype.setFilters=function(a){this.clearData();this.filters=a;for(filter in a){var b=a[filter].toString();delete this.params[filter];""!=b&&(this.params[filter]=b)}};CellBaseAdapter.prototype.setOption=function(a,b){a.fetch&&this.clearData();this.options[a.name]=b;for(option in this.options)null!=this.options[a.name]?this.params[a.name]=this.options[a.name]:delete this.params[a.name]};
CellBaseAdapter.prototype.getData=function(a){var b=String.fromCharCode(65+Math.round(10*Math.random())),c=this;this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;this.params.chromosome=a.chromosome;this.params.resource=this.resource;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var d="data";a.histogram&&(d="histogram"+a.interval);a.transcript&&(d="withTranscripts");this.params.dataType=d;for(var e=this.featureCache._getChunk(a.start),f=this.featureCache._getChunk(a.end),
g=[],h=[];e<=f;e++){var j=a.chromosome+":"+e;null==this.featureCache.cache[j]||null==this.featureCache.cache[j][d]?g.push(e):(j=this.featureCache.getFeatureChunk(j),h.push(j))}d=new CellBaseManager(this.species,{host:this.host});d.success.addEventListener(function(a,d){var e="data";d.params.histogram&&(e="histogram"+d.params.interval);d.params.transcript&&(e="withTranscripts");if(d.params.histogram==true)d.result=[d.result];for(var f=d.resource,g=[],j=0;j<d.query.length;j++){var l=d.query[j].split(":"),
k=l[1].split("-");g.push({chromosome:l[0],start:k[0],end:k[1]})}for(j=0;j<d.result.length;j++){d.result[j].constructor!=Array&&(d.result[j]=[d.result[j]]);if(f=="gene"&&d.params.transcript!=null){l=0;for(k=d.result[j].length;l<k;l++)for(var m=0,B=d.result[j][l].transcripts.length;m<B;m++){d.result[j][l].transcripts[m].featureType="transcript";for(var x=0,v=d.result[j][l].transcripts[m].exons.length;x<v;x++)d.result[j][l].transcripts[m].exons[x].featureType="exon"}}if(f=="regulatory"){f=d.params.type;
f=="TF_binding_site_motif"&&(f="tfbs")}console.time(c.resource+" save "+b);c.featureCache.putFeaturesByRegion(d.result[j],g[j],f,e);l=c.featureCache.getFeatureChunksByRegion(g[j]);console.timeEnd(c.resource+" save "+b);l!=null&&(h=h.concat(l))}h.length>0&&c.onGetData.notify({items:h,params:c.params,cached:false});console.timeEnd(c.resource+" get and save "+b)});var f=[],k=j=!0;if(0<g.length){for(e=0;e<g.length;e++){if(j)var l=parseInt(g[e]*this.featureCache.chunkSize),j=!1;if(k)var m=parseInt(g[e]*
this.featureCache.chunkSize+this.featureCache.chunkSize-1),k=!1;null!=g[e+1]?g[e]+1!=g[e+1]&&(j=a.chromosome+":"+l+"-"+m,f.push(j),j=!0):(j=a.chromosome+":"+l+"-"+m,f.push(j),j=!0);k=!0}console.time(c.resource+" get and save "+b);d.get(this.category,this.subCategory,f,this.resource,this.params)}else 0<h.length&&this.onGetData.notify({items:h,params:this.params})};FileDataSource.prototype.fetch=DataSource.prototype.fetch;
function FileDataSource(a){DataSource.prototype.constructor.call(this);this.file=a;this.success=new Event;this.error=new Event}FileDataSource.prototype.error=function(){alert("File is too big. Max file size is 100 Mbytes.")};FileDataSource.prototype.fetch=function(a){var b=this;if(52428800>=this.file.size)if(a)a=new FileReader,a.onload=function(a){b.success.notify(a.target.result)},a.readAsText(this.file,"UTF-8");else return a=new FileReaderSync,a.readAsText(this.file,"UTF-8");else b.error(),b.error.notify()};
StringDataSource.prototype.fetch=DataSource.prototype.fetch;function StringDataSource(a){DataSource.prototype.constructor.call(this);this.str=a;this.success=new Event}StringDataSource.prototype.fetch=function(a){if(a)this.success.notify(this.str);else return this.str};UrlDataSource.prototype.fetch=DataSource.prototype.fetch;
function UrlDataSource(a,b){DataSource.prototype.constructor.call(this);this.url=a;this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=";null!=b&&null!=b.proxy&&("boolean"==typeof b.proxy?!1==b.proxy?this.proxy=!1:this.url=this.proxy+a:"string"==typeof b.proxy&&(this.url=b.proxy+a));this.success=new Event;this.error=new Event}
UrlDataSource.prototype.fetch=function(a){var b=this,c=null;if(this.url)return $.ajax({type:"GET",url:this.url,async:a,success:function(d){a?b.success.notify(d):c=d},error:function(a,c,f){console.log("URL Data source: Ajax call returned : "+f+"\t"+c+"\t"+a.statusText+" END");b.error.notify()}}),c};VCFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;VCFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;
function VCFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0;this.featuresCount=0;this.featuresByChromosome={};this.header="";this.samples=[];null!=b&&null!=b.async&&(this.async=b.async)}
VCFDataAdapter.prototype.parse=function(a,b){console.log(a);var c=a.split("\n");debugger;for(var d=0;d<c.length;d++){debugger;var e=c[d].replace(/^\s+|\s+$/g,"");if(null!=e&&0<e.length){var f=e.split("\t");f[0]==b.chromosome&&("#"===e.substr(0,1)?"#"===e.substr(1,1)?this.header+=e.replace(/</gi,"&#60;").replace(/>/gi,"&#62;")+"<br>":this.samples=f.slice(9):(e={chromosome:f[0],position:parseInt(f[1]),start:parseInt(f[1]),end:parseInt(f[1]),id:f[2],reference:f[3],alternate:f[4],quality:f[5],filter:f[6],
info:f[7].replace(/;/gi,"<br>"),format:f[8],sampleData:e,featureType:"vcf"},this.featureCache.putFeatures(e,"data"),null==this.featuresByChromosome[f[0]]&&(this.featuresByChromosome[f[0]]=0),this.featuresByChromosome[f[0]]++,this.featuresCount++))}}};GFF2DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;GFF2DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;
function GFF2DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async)}
GFF2DataAdapter.prototype.parse=function(a,b){for(var c=a.split("\n"),d=0;d<c.length;d++){var e=c[d].replace(/^\s+|\s+$/g,"");if(null!=e&&0<e.length){var f=e.split("\t"),e=f[0].replace("chr","");e==b.chromosome&&(f={chromosome:e,label:f[2],start:parseInt(f[3]),end:parseInt(f[4]),score:f[5],strand:f[6],frame:f[7],group:f[8],featureType:"gff2"},this.featureCache.putFeatures(f,"data"),null==this.featuresByChromosome[e]&&(this.featuresByChromosome[e]=0),this.featuresByChromosome[e]++,this.featuresCount++)}}};
GFF3DataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;GFF3DataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;function GFF3DataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async)}
GFF3DataAdapter.prototype.parse=function(a,b){for(var c=a.split("\n"),d=0;d<c.length;d++){var e=c[d].replace(/^\s+|\s+$/g,"");if(null!=e&&0<e.length){var f=e.split("\t"),e=f[0].replace("chr","");if(e==b.chromosome){for(var g=e,h=f[2],j=parseInt(f[3]),k=parseInt(f[4]),l=f[5],m=f[6],n=f[7],f=f[8].split(";"),p={},o=0,r=f.length;o<r;o++){var q=f[o].split("=");p[q[0]]=q[1]}this.featureCache.putFeatures({chromosome:g,label:h,start:j,end:k,score:l,strand:m,frame:n,attributes:p,featureType:"gff3"},"data");
null==this.featuresByChromosome[e]&&(this.featuresByChromosome[e]=0);this.featuresByChromosome[e]++;this.featuresCount++}}}};GTFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;GTFDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;function GTFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async)}
GTFDataAdapter.prototype.parse=function(a,b){for(var c=a.split("\n"),d=0;d<c.length;d++){var e=c[d].replace(/^\s+|\s+$/g,"");if(null!=e&&0<e.length){var f=e.split("\t"),e=f[0].replace("chr","");if(e==b.chromosome){for(var g=e,h=f[2],j=parseInt(f[3]),k=parseInt(f[4]),l=f[5],m=f[6],n=f[7],f=f[8].split(";"),p={},o=0,r=f.length;o<r;o++){var q=f[o].split("=");p[q[0]]=q[1]}this.featureCache.putFeatures({chromosome:g,label:h,start:j,end:k,score:l,strand:m,frame:n,attributes:p,featureType:"gtf"},"data");
null==this.featuresByChromosome[e]&&(this.featuresByChromosome[e]=0);this.featuresByChromosome[e]++;this.featuresCount++}}}};BEDDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;BEDDataAdapter.prototype._fetchData=FeatureDataAdapter.prototype._fetchData;function BEDDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);this.async=!0;this.featuresCount=0;this.featuresByChromosome={};null!=b&&null!=b.async&&(this.async=b.async)}
BEDDataAdapter.prototype.parse=function(a,b){for(var c=a.split("\n"),d=0;d<c.length;d++){var e=c[d].replace(/^\s+|\s+$/g,"");if(null!=e&&0<e.length){var f=e.split("\t"),e=f[0].replace("chr","");e==b.chromosome&&(f={label:f[3],chromosome:e,start:parseFloat(f[1]),end:parseFloat(f[2]),score:f[4],strand:f[5],thickStart:f[6],thickEnd:f[7],itemRgb:f[8],blockCount:f[9],blockSizes:f[10],blockStarts:f[11],featureType:"bed"},this.featureCache.putFeatures(f,"data"),null==this.featuresByChromosome[e]&&(this.featuresByChromosome[e]=
0),this.featuresByChromosome[e]++,this.featuresCount++)}}};function TabularDataAdapter(a,b){var c=this;this.dataSource=a;this.async=!0;null!=b&&null!=b.async&&(this.async=b.async);this.fileLines=[];if(this.async)this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async);else{var d=this.dataSource.fetch(this.async);this.parse(d)}this.onLoad=new Event}TabularDataAdapter.prototype.getLines=function(){return this.fileLines};
TabularDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,""),c=c.replace(/\//gi,"");null!=c&&(0<c.length&&"#"!=c.charAt(0))&&(c=c.split("\t"),this.fileLines.push(c))}};TabularDataAdapter.prototype.getLinesCount=function(){return this.fileLines.length};TabularDataAdapter.prototype.getValuesByColumnIndex=function(a){for(var b=[],c=0;c<this.getLinesCount();c++)null!=this.getLines()[c][a]&&b.push(this.getLines()[c][a]);return b};
TabularDataAdapter.prototype.getHeuristicTypeByColumnIndex=function(a){return this.getHeuristicTypeByValues(this.getValuesByColumnIndex(a))};TabularDataAdapter.prototype.getHeuristicTypeByValues=function(a){for(var b=/^[-+]?[0-9]*\.?[0-9]+$/,c=0;c<a.length;c++)if(!b.test((new String(a[c])).replace(",",".")))return"string";return"numeric"};
function DasAdapter(a){this.gzip=!0;this.proxy=CELLBASE_HOST+"/latest/utils/proxy?url=";this.params={};if(null!=a){null!=a.url&&(this.url=a.url);null!=a.species&&(this.species=a.species);if(null!=a.featureCache)var b=a.featureCache;null!=a.params&&(this.params=a.params)}this.featureCache=new FeatureCache(b);this.onGetData=new Event;this.onCheckUrl=new Event;this.onError=new Event}
DasAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);this.params.dataType=c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[];d<=e;d++){var h=a.chromosome+":"+d;null==this.featureCache.cache[h]||null==this.featureCache.cache[h][c]?f.push(d):(h=this.featureCache.getFeatureChunk(h),
g.push(h))}0<g.length&&this.onGetData.notify({items:g,params:this.params,cached:!0});g=e=!0;if(0<f.length)for(d=0;d<f.length;d++){h=null;if(e)var j=parseInt(f[d]*this.featureCache.chunkSize),e=!1;if(g)var k=parseInt(f[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),g=!1;null!=f[d+1]?f[d]+1!=f[d+1]&&(h=a.chromosome+":"+j+","+k,e=!0):(h=a.chromosome+":"+j+","+k,e=!0);g=!0;h&&(h=this.proxy+this.url+"?segment="+h,console.log("fullURL: "+h),$.ajax({url:h,type:"GET",dataType:"xml",error:function(){alert("error");
b.onError.notify("It is not allowed by Access-Control-Allow-Origin ")},success:function(d){b.xml=(new XMLSerializer).serializeToString(d);var e=(new XMLSerializer).serializeToString(d),d=xml2json.parser(e);if(d.dasgff!=null){e=[];if(typeof d.dasgff.gff.segment!="undefined")if(typeof d.dasgff.gff.segment.feature!="undefined")e=d.dasgff.gff.segment.feature;else if(typeof d.dasgff.gff.segment[0]!="undefined")if(d.dasgff.gff.segment[0].feature!=null)for(var f=0;f<d.dasgff.gff.segment.length;f++)for(var g=
0;g<d.dasgff.gff.segment[f].feature.length;g++){d.dasgff.gff.segment[f].feature[g].chromosome=a.chromosome;e.push(d.dasgff.gff.segment[f].feature[g])}else e.push([]);d={chromosome:a.chromosome,start:j,end:k};b.featureCache.putFeaturesByRegion(e,d,"das",c);console.log(b.featureCache.cache);e=b.featureCache.getFeatureChunksByRegion(d);e!=null&&b.onGetData.notify({items:e,params:b.params,cached:false})}}}))}};
DasAdapter.prototype.checkUrl=function(){var a=this,b=this.proxy+this.url+"?segment=1:1,1";console.log("Checking URL: "+b);$.ajax({url:b,type:"GET",dataType:"xml",error:function(){alert("error");a.onError.notify("It is not allowed by Access-Control-Allow-Origin ")},success:function(b){a.xml=(new XMLSerializer).serializeToString(b);a.onCheckUrl.notify({data:a.xml})}})};VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;
VCFFileWidget.prototype.draw=FileWidget.prototype.draw;VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;VCFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;VCFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function VCFFileWidget(a){null==a&&(a={});a.title="VCF";a.tags=["vcf"];FileWidget.prototype.constructor.call(this,a)}
VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new VCFDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){console.log(b.adapter.featuresByChromosome);b._loadChartInfo()});b.btnOk.enable()};VCFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new VCFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this._loadChartInfo();this.btnOk.enable()};
GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GFFFileWidget.prototype.draw=FileWidget.prototype.draw;GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;GFFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;GFFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;
function GFFFileWidget(a){null==a&&(a={});this.version="2";null!=a.version&&(this.version=a.version);a.title="GFF"+this.version;a.tags=["gff"];FileWidget.prototype.constructor.call(this,a)}
GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;switch(this.version){case "2":this.adapter=new GFF2DataAdapter(new FileDataSource(a),{species:this.viewer.species});break;case "3":this.adapter=new GFF3DataAdapter(new FileDataSource(a),{species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new FileDataSource(a),{species:this.viewer.species})}this.adapter.onLoad.addEventListener(function(){b._loadChartInfo()});b.btnOk.enable()};
GFFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};switch(this.version){case "2":this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;case "3":this.adapter=new GFF3DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});break;default:this.adapter=new GFF2DataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species})}this._loadChartInfo();this.btnOk.enable()};
GTFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;GTFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GTFFileWidget.prototype.draw=FileWidget.prototype.draw;GTFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;GTFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;GTFFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;GTFFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;
function GTFFileWidget(a){null==a&&(a={});a.title="GTF";a.tags=["gtf"];FileWidget.prototype.constructor.call(this,a)}GTFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new GTFDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){console.log(b.adapter.featuresByChromosome);b._loadChartInfo()});b.btnOk.enable()};
GTFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new GTFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this._loadChartInfo();this.btnOk.enable()};BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;BEDFileWidget.prototype.draw=FileWidget.prototype.draw;BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;
BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;BEDFileWidget.prototype.getChartItems=FileWidget.prototype.getChartItems;BEDFileWidget.prototype._loadChartInfo=FileWidget.prototype._loadChartInfo;function BEDFileWidget(a){null==a&&(a={});a.title="BED";a.tags=["bed"];FileWidget.prototype.constructor.call(this,a)}
BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new BEDDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){b._loadChartInfo()});b.btnOk.enable()};BEDFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new BEDDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this._loadChartInfo();this.btnOk.enable()};
function SequenceAdapter(a){this.host=null;this.gzip=!0;this.params={};if(null!=a&&(null!=a.host&&(this.host=a.host),null!=a.species&&(this.species=a.species),null!=a.category&&(this.category=a.category),null!=a.subCategory&&(this.subCategory=a.subCategory),null!=a.resource&&(this.resource=a.resource),null!=a.params))this.params=a.params;this.onGetData=new Event;this.sequence={};this.phastCons={};this.phylop={};this.start={};this.end={}}
SequenceAdapter.prototype.clearData=function(){this.sequence={};this.start={};this.end={}};
SequenceAdapter.prototype.getData=function(a){var b=this;this.sender=a.sender;var c=a.chromosome;1>a.start&&(a.start=1);1>a.end&&(a.end=1);3E8<a.end&&(a.end=3E8);(a.start<this.start[c]-5E3||a.end>this.end[c]+5E3)&&this.clearData();this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;this.params.chromosome=a.chromosome;this.params.resource=this.resource;a=this._getSequenceQuery(a);""!=a?(c=new CellBaseManager(this.species,{host:this.host}),c.success.addEventListener(function(a,
c){b._processSequenceQuery(c,true)}),c.get(this.category,this.subCategory,a,this.resource,this.params)):"onMove"!=this.sender&&this.onGetData.notify({items:{sequence:this.sequence[c],phastCons:this.phastCons[c],phylop:this.phylop[c],start:this.start[c],end:this.end[c]},params:this.params})};
SequenceAdapter.prototype._getSequenceQuery=function(a){var b=a.chromosome,c,d,e=[];if(null==this.start[b]&&null==this.end[b])this.start[b]=a.start,this.end[b]=a.end,c=a.start,d=a.end,e.push(b+":"+c+"-"+d);else if(a.start<=this.start[b]&&(c=a.start,d=this.start[b]-1,d=1>d?a.end=1:d,this.start[b]=c,c=a.chromosome+":"+c+"-"+d,e.push(c)),a.end>=this.end[b])d=a.end,c=this.end[b]+1,this.end[b]=d,c=a.chromosome+":"+c+"-"+d,e.push(c);return e.toString()};
SequenceAdapter.prototype._processSequenceQuery=function(a,b){for(var c=a.result,d=a.params,e=a.params.chromosome,f=0;f<c.length;f++){var g=a.query[f].split(":")[1].split("-"),h=parseInt(g[0]),g=parseInt(g[1]);this.sequence[e]=null==this.sequence[e]?c[f].sequence:h==this.start[e]?c[f].sequence+this.sequence[e]:this.sequence[e]+c[f].sequence;"onMove"==this.sender&&!0==b&&this.onGetData.notify({items:{sequence:c[f].sequence,phastCons:c[f].phastCons,phylop:c[f].phylop,start:h,end:g},params:d})}"onMove"!=
this.sender&&!0==b&&this.onGetData.notify({items:{sequence:this.sequence[e],phastCons:this.phastCons[e],phylop:this.phylop[e],start:this.start[e],end:this.end[e]},params:d})};
SequenceAdapter.prototype.getNucleotidByPosition=function(a){if(0<a.start&&0<a.end){var b=this._getSequenceQuery(a),c=a.chromosome;""!=b&&(b=(new CellBaseManager(this.species,{host:this.host,async:!1})).get(this.category,this.subCategory,b,this.resource,this.params),this._processSequenceQuery(b));if(null!=this.sequence[c])return this.sequence[c].substr(a.start-this.start[c],1);console.log("SequenceRender: this.sequence[chromosome] is undefined");return""}};
function Region(a){this.chromosome=this.end=this.start=null;"undefined"!=typeof a&&(this.start=a.start||this.start,this.end=a.end||this.end,this.chromosome=a.chromosome||this.chromosome,null!=a.str&&this.parse(a.str))}
Region.prototype={parse:function(a){a=a.split(":");if(2==a.length){var b=a[1].split("-");this.chromosome=a[0];this.start=parseInt(b[0]);this.end=2==b.length?parseInt(b[1]):this.start}},load:function(a){this.start=a.start;this.end=a.end;this.chromosome=a.chromosome},center:function(){return this.start+Math.floor(this.length()/2)},length:function(){return this.end-this.start+1},toString:function(a){return!0==a?this.chromosome+":"+Utils.formatNumber(this.start)+"-"+Utils.formatNumber(this.end):this.chromosome+
":"+this.start+"-"+this.end}};
function OpencgaManager(a){this.host=a||this.host;this.onGetAccountInfo=new Event(this);this.onLogin=new Event(this);this.onCreateAccount=new Event(this);this.onResetPassword=new Event(this);this.onChangePassword=new Event(this);this.onChangeEmail=new Event(this);this.onLogout=new Event(this);this.onCreateBucket=new Event(this);this.onRefreshBucket=new Event(this);this.onRenameBucket=new Event(this);this.onUploadObjectToBucket=new Event(this);this.onDeleteObjectFromBucket=new Event(this);this.onCreateDirectory=
new Event(this);this.onJobStatus=new Event(this);this.onJobResult=new Event(this);this.onTable=new Event(this);this.onPoll=new Event(this);this.onDeleteJob=new Event(this);this.onRunAnalysis=new Event(this);this.onIndexer=new Event(this);this.onIndexerStatus=new Event(this);this.onBamList=new Event(this);this.onGetAccountInfo=new Event(this);this.onRegion=new Event(this);this.onLocalFileList=new Event(this);this.onError=new Event(this)}
OpencgaManager.prototype={host:OPENCGA_HOST,getHost:function(){return this.host},setHost:function(a){this.host=a},doGet:function(a,b,c){$.ajax({type:"GET",url:a,cache:!1,success:b,error:c})},doPost:function(a,b,c,d){$.ajax({type:"POST",url:a,data:b,processData:!1,contentType:!1,success:c,error:d})},getQuery:function(a){var b="",c;for(c in a)null!=a[c]&&(b+=c+"="+a[c]+"&");""!=b&&(b="?"+b.slice(0,-1));return b},getAccountUrl:function(a){return this.getHost()+"/account/"+a},getStorageUrl:function(a){return this.getAccountUrl(a)+
"/storage"},getAdminProfileUrl:function(a){return this.getAccountUrl(a)+"/admin/profile"},getAdminBucketUrl:function(a,b){return this.getAccountUrl(a)+"/admin/bucket/"+b},getAdminProjectUrl:function(a,b){return this.getAccountUrl(a)+"/admin/project/"+b},getBucketUrl:function(a,b){return this.getStorageUrl(a)+"/"+b},getObjectUrl:function(a,b,c){return this.getStorageUrl(a)+"/"+b+"/"+c},getAnalysisUrl:function(a,b){return this.getAccountUrl(a)+"/analysis/"+b},getJobAnalysisUrl:function(a,b){return this.getAccountUrl(a)+
"/analysis/job/"+b},createAccount:function(a,b,c,d,e){var f=this,b={name:c,email:b,password:d,suiteid:e},a=this.getAccountUrl(a)+"/create"+this.getQuery(b);this.doGet(a,function(a){f.onCreateAccount.notify(a)},function(a){console.log("ERROR: "+a)})},login:function(a,b,c){var d=this,b={password:b,suiteid:c},a=this.getAccountUrl(a)+"/login"+this.getQuery(b);this.doGet(a,function(a){-1==a.indexOf("ERROR")?d.onLogin.notify(JSON.parse(a)):d.onLogin.notify({errorMessage:a})},function(a){console.log("ERROR: "+
a)})},logout:function(a,b){var c=this,d={sessionid:b},d=this.getAccountUrl(a)+"/logout"+this.getQuery(d);this.doGet(d,function(a){c.onLogout.notify(a)},function(a){$.cookie("bioinfo_sid",null);$.cookie("bioinfo_sid",null,{path:"/"});console.log("ERROR: "+a)})},getAccountInfo:function(a,b,c){console.log(c);var d=this,b={last_activity:c,sessionid:b},a=this.getAccountUrl(a)+"/info"+this.getQuery(b);this.doGet(a,function(a){-1==a.indexOf("ERROR")?d.onGetAccountInfo.notify(JSON.parse(a)):console.log(a)},
function(a){console.log("ERROR: "+a);console.log(a)})},changePassword:function(a,b,c,d,e){var f=this,b={old_password:c,new_password1:d,new_password2:e,sessionid:b},a=this.getAdminProfileUrl(a)+"/change_password"+this.getQuery(b);this.doGet(a,function(a){f.onChangePassword.notify(a)},function(a){console.log("ERROR: "+a)})},resetPassword:function(a,b){var c=this,d={email:b},d=this.getAdminProfileUrl(a)+"/reset_password"+this.getQuery(d);this.doGet(d,function(a){c.onResetPassword.notify(a)},function(a){console.log("ERROR: "+
a)})},changeEmail:function(a,b,c){var d=this,b={new_email:c,sessionid:b},a=this.getAdminProfileUrl(a)+"/change_email"+this.getQuery(b);this.doGet(a,function(a){d.onChangeEmail.notify(a)},function(a){console.log("ERROR: "+a)})},getBuckets:function(){return"TODO"},createBucket:function(a,b,c,d){var e=this,b={description:b,sessionid:d},a=this.getAdminBucketUrl(c,a)+"/create"+this.getQuery(b);this.doGet(a,function(a){e.onCreateBucket.notify(a)},function(a){console.log("ERROR: "+a)})},refreshBucket:function(a,
b,c){var d=this,c={sessionid:c},a=this.getAdminBucketUrl(a,b)+"/refresh"+this.getQuery(c);this.doGet(a,function(a){d.onRefreshBucket.notify(a)},function(a){console.log("ERROR: "+a)});console.log(a)},renameBucket:function(a,b,c,d){var e=this,d={sessionid:d},a=this.getAdminBucketUrl(a,b)+"/rename/"+c+this.getQuery(d);this.doGet(a,function(a){e.onRenameBucket.notify(a)},function(a){console.log("ERROR: "+a)});console.log(a)},deleteBucket:"TODO",shareBucket:"TODO",uploadObjectToBucket:function(a,b,c,d,
e,f){var g=this,b={parents:f||!1,sessionid:b},a=this.getObjectUrl(a,c,d)+"/upload"+this.getQuery(b);this.doPost(a,e,function(a){console.log(a);g.onUploadObjectToBucket.notify({status:"done",data:a})},function(a){g.onUploadObjectToBucket.notify({status:"fail",data:a})})},createDirectory:function(a,b,c,d,e){var d=d.replace(RegExp("/","gi"),":"),f=this,b={parents:e||!1,sessionid:b},a=this.getObjectUrl(a,c,d)+"/create_directory"+this.getQuery(b);this.doGet(a,function(a){console.log(a);f.onCreateDirectory.notify(a)},
function(a){console.log("ERROR: "+a)})},deleteObjectFromBucket:function(a,b,c,d){var d=d.replace(RegExp("/","gi"),":"),e=this,b={sessionid:b},a=this.getObjectUrl(a,c,d)+"/delete"+this.getQuery(b);this.doGet(a,function(a){console.log(a);e.onDeleteObjectFromBucket.notify(a)},function(a){console.log("ERROR: "+a)})},region:function(a,b,c,d,e,f){var d=d.replace(RegExp("/","gi"),":"),g=this;f.sessionid=b;f.region=e;f.cellbasehost=CELLBASE_HOST+"/"+CELLBASE_VERSION;-1!=this.host.indexOf("localhost")?(f.region=
e,f.filepath=d,a=this.host+"/storage/fetch"+this.getQuery(f)):a=this.getObjectUrl(a,c,d)+"/fetch"+this.getQuery(f);this.doGet(a,function(a){a.substr(0,5).indexOf("ERROR")==-1&&g.onRegion.notify({resource:f.category,result:JSON.parse(a),filename:d,query:e,params:f})},function(a){console.log("ERROR: "+a);console.log(a)});console.log(a)},jobResult:function(a,b,c){var d=this,b={sessionid:b},a=this.getJobAnalysisUrl(a,c)+"/result.js"+this.getQuery(b);this.doGet(a,function(a){d.onJobResult.notify(a)},function(a){console.log("ERROR: "+
a)});console.log(a)},jobResultUrl:function(a,b,c){b={sessionid:b};return this.getJobAnalysisUrl(a,c)+"/result.js"+this.getQuery(b)},jobStatus:function(a,b,c){var d=this,b={sessionid:b},a=this.getJobAnalysisUrl(a,c)+"/status"+this.getQuery(b);this.doGet(a,function(a){d.onJobStatus.notify(a)},function(a){console.log("ERROR: "+a)});console.log(a)},table:function(a,b,c,d,e,f){var g=this,b={filename:d,colNames:e,colVisibility:f,sessionid:b},a=this.getJobAnalysisUrl(a,c)+"/table"+this.getQuery(b);this.doGet(a,
function(a){g.onTable.notify(a)},function(a){console.log("ERROR: "+a)})},tableurl:function(a,b,c,d,e,f){b={filename:d,colNames:e,colVisibility:f,sessionid:b};return this.getJobAnalysisUrl(a,c)+"/table"+this.getQuery(b)},poll:function(a,b,c,d,e){var f=this,b={filename:d,sessionid:b};!0==e?(a=this.getJobAnalysisUrl(a,c)+"/poll"+this.getQuery(b),open(a)):(b.zip=!1,a=this.getJobAnalysisUrl(a,c)+"/poll"+this.getQuery(b),this.doGet(a,function(a){f.onPoll.notify(a)},function(a){console.log("ERROR: "+a)}))},
pollurl:function(a,b,c,d){b={filename:d,sessionid:b,zip:!1};return this.getJobAnalysisUrl(a,c)+"/poll"+this.getQuery(b)},deleteJob:function(a,b,c){var d=this,b={sessionid:b},a=this.getJobAnalysisUrl(a,c)+"/delete"+this.getQuery(b);this.doGet(a,function(a){d.onDeleteJob.notify(a)},function(a){console.log("ERROR: "+a)})},downloadJob:function(a,b,c){b={sessionid:b};open(this.getJobAnalysisUrl(a,c)+"/download"+this.getQuery(b))},runAnalysis:function(a,b){var c=this,d=this.getAnalysisUrl(b.accountid,a)+
"/run"+this.getQuery({});console.log(d);console.log(b);$.ajax({type:"POST",url:d,data:b,success:function(a){c.onRunAnalysis.notify({status:"done",data:a})},error:function(a){c.onRunAnalysis.notify({status:"fail",data:a})}})},indexer:function(a,b,c,d){var e=this,b={sessionid:b},a=this.getObjectUrl(a,c,d)+"/index"+this.getQuery(b);console.log(a);this.doGet(a,function(a){e.onIndexer.notify(a)},function(a){e.onIndexer.notify(a)})},indexerStatus:function(a,b,c,d,e){var f=this,b={sessionid:b,indexerid:e},
a=this.getObjectUrl(a,c,d)+"/index_status"+this.getQuery(b);console.log(a);this.doGet(a,function(a){f.onIndexerStatus.notify(a)},function(a){f.onIndexerStatus.notify(a)})},localFileList:function(){var a=this,b=this.host+"/getdirs";console.log(b);this.doGet(b,function(b){a.onLocalFileList.notify(b)},function(b){a.onLocalFileList.notify(b)})}};
function OpencgaAdapter(a){this.host=null;this.gzip=!0;this.params={};if(null!=a){null!=a.host&&(this.host=a.host);null!=a.category&&(this.category=a.category);null!=a.resource&&(this.resource=a.resource);if(null!=a.featureCache)var b=a.featureCache;null!=a.params&&(this.params=a.params)}this.featureCache=new FeatureCache(b);this.onGetData=new Event}
OpencgaAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.histogramLogarithm=a.histogramLogarithm;this.params.histogramMax=a.histogramMax;this.params.interval=a.interval;this.params.transcript=a.transcript;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[];d<=e;d++){var h=a.chromosome+":"+d;null==this.featureCache.cache[h]||
null==this.featureCache.cache[h][c]?f.push(d):(h=this.featureCache.getFeatureChunk(h,c),g=g.concat(h))}var c=new OpencgaManager(this.host),j=0,k=[];c.onRegion.addEventListener(function(a,c){console.timeEnd("dqs");console.time("dqs-cache");var d="data";c.params.histogram&&(d="histogram"+c.params.interval);b.params.dataType=d;var e=c.query.split(":"),f=e[1].split("-"),e={chromosome:e[0],start:f[0],end:f[1]};if(c.result[0]!=null&&c.result[0].position!=null)for(f=0;f<c.result.length;f++){c.result[f].start=
c.result[f].position;c.result[f].end=c.result[f].position}b.featureCache.putFeaturesByRegion(c.result,e,b.category,d);d=b.featureCache.getFeatureChunksByRegion(e,d);console.timeEnd("dqs-cache");d!=null&&(g=g.concat(d));j==k.length&&b.onGetData.notify({items:g,params:b.params,cached:false})});h=e=!0;if(0<f.length){for(d=0;d<f.length;d++){if(e)var l=parseInt(f[d]*this.featureCache.chunkSize),e=!1;if(h)var m=parseInt(f[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),h=!1;null!=f[d+1]?f[d]+
1!=f[d+1]&&(e=a.chromosome+":"+l+"-"+m,k.push(e),e=!0):(e=a.chromosome+":"+l+"-"+m,k.push(e),e=!0);h=!0}d=0;for(a=k.length;d<a;d++)console.time("dqs"),j++,c.region($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.resource.bucketId,this.resource.id,k[d],this.params)}else 0<g.length&&this.onGetData.notify({items:g,params:this.params})};BamCache.prototype.putHistogramFeaturesByRegion=FeatureCache.prototype.putFeaturesByRegion;
function BamCache(a){this.args=a;this.id=Math.round(1E7*Math.random());this.chunkSize=5E4;this.gzip=!0;this.maxSize=10485760;this.size=0;if(null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip))this.gzip=a.gzip;this.cache={};this.maxFeaturesInterval=0;this.gzip=!1}BamCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)};BamCache.prototype.getFeatureChunk=function(a){return null!=this.cache[a]?this.cache[a]:null};
BamCache.prototype.getFeatureChunksByRegion=function(a){var b,c,d=[];b=this._getChunk(a.start);c=this._getChunk(a.end);for(var e=b;e<=c;e++)b=a.chromosome+":"+e,null!=this.cache[b]&&d.push(this.cache[b]);return d};
BamCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g,h,c=a.reads;g=a.coverage;a=this._getChunk(b.start);f=this._getChunk(b.end);h=0;console.time("BamCache.prototype.putFeaturesByRegion1");for(var j=a,k=0;j<=f;j++,k++){e=b.chromosome+":"+j;if(null==this.cache[e]||null==this.cache[e][d])this.cache[e]={},this.cache[e][d]=[],this.cache[e].key=e,this.cache[e].start=parseInt(b.start)+k*this.chunkSize,this.cache[e].end=parseInt(b.start)+(k+1)*this.chunkSize-1;if("data"===d)var l=g.all.slice(h,
h+this.chunkSize),m=g.a.slice(h,h+this.chunkSize),n=g.c.slice(h,h+this.chunkSize),p=g.g.slice(h,h+this.chunkSize),o=g.t.slice(h,h+this.chunkSize),l={all:l,a:m,c:n,g:p,t:o};this.cache[e].coverage=this.gzip?RawDeflate.deflate(JSON.stringify(l)):l;h+=this.chunkSize}console.timeEnd("BamCache.prototype.putFeaturesByRegion1");console.time("BamCache.prototype.putFeaturesByRegion");if("data"===d){l=0;for(m=c.length;l<m;l++){g=c[l];g.featureType="bam";e=this._getChunk(g.start);b=this._getChunk(0==g.end?g.end=
-1:g.end);h=this.gzip?RawDeflate.deflate(JSON.stringify(g)):g;j=e;for(k=0;j<=b;j++,k++)j>=a&&j<=f&&(e=g.chromosome+":"+j,this.cache[e][d].push(h))}}console.timeEnd("BamCache.prototype.putFeaturesByRegion");console.log("BamCache.prototype.putFeaturesByRegion0")};BamCache.prototype.clear=function(){this.size=0;this.cache={};console.log("bamCache cleared")};
function BamAdapter(a){if("undefined"!=typeof a){this.host=a.host||this.host;this.category=a.category||this.category;this.resource=a.resource||this.resource;this.params=a.params||this.params;this.filters=a.filters||this.filters;this.options=a.options||this.options;this.species=a.species||this.species;var b=a.featureCache||{}}if(null!=a&&null!=a.featureConfig&&(null!=a.featureConfig.filters&&(this.filtersConfig=a.featureConfig.filters),null!=a.featureConfig.options)){this.optionsConfig=a.featureConfig.options;
for(a=0;a<this.optionsConfig.length;a++)!0==this.optionsConfig[a].checked&&(this.options[this.optionsConfig[a].name]=!0,this.params[this.optionsConfig[a].name]=!0)}this.featureCache=new BamCache(b);this.onGetData=new Event}BamAdapter.prototype={host:null,gzip:!0,params:{}};BamAdapter.prototype.clearData=function(){this.featureCache.clear()};
BamAdapter.prototype.setFilters=function(a){this.clearData();this.filters=a;for(filter in a){var b=a[filter].toString();delete this.params[filter];""!=b&&(this.params[filter]=b)}};BamAdapter.prototype.setOption=function(a,b){a.fetch&&this.clearData();this.options[a.name]=b;for(option in this.options)null!=this.options[a.name]?this.params[a.name]=this.options[a.name]:delete this.params[a.name]};
BamAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.histogramLogarithm=a.histogramLogarithm;this.params.histogramMax=a.histogramMax;this.params.interval=a.interval;this.params.transcript=a.transcript;this.params.chromosome=a.chromosome;this.params.resource=this.resource.oid;this.params.category=this.category;this.params.species=this.species;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);this.params.dataType=
c;for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[];d<=e;d++){var h=a.chromosome+":"+d;null==this.featureCache.cache[h]||null==this.featureCache.cache[h][c]?f.push(d):(h=this.featureCache.getFeatureChunk(h),g.push(h))}c=new OpencgaManager(this.host);c.onRegion.addEventListener(function(a,c){var d=c.query.split(":"),e=d[1].split("-"),d={chromosome:d[0],start:e[0],end:e[1]},e="data";if(c.params.histogram){e="histogram"+c.params.interval;b.featureCache.putHistogramFeaturesByRegion(c.result,
d,c.resource,e)}else b.featureCache.putFeaturesByRegion(c.result,d,c.resource,e);d=b.featureCache.getFeatureChunksByRegion(d,e);g=g.concat(d);g.length>0&&b.onGetData.notify({items:g,params:b.params,cached:false})});var e=[],j=h=!0;if(0<f.length){for(d=0;d<f.length;d++){if(h)var k=parseInt(f[d]*this.featureCache.chunkSize),h=!1;if(j)var l=parseInt(f[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),j=!1;null!=f[d+1]?f[d]+1!=f[d+1]&&(h=a.chromosome+":"+k+"-"+l,e.push(h),h=!0):(h=a.chromosome+
":"+k+"-"+l,e.push(h),h=!0);j=!0}d=0;for(a=e.length;d<a;d++)console.time("dqs"),c.region($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.resource.bucketId,this.resource.id,e[d],this.params)}else 0<g.length&&this.onGetData.notify({items:g,params:this.params})};
function InfoWidget(a,b,c){this.id="InfoWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.species=b;this.featureId=this.title=null;this.width=800;this.height=460;this.adapter=this.query=this.feature=null;null!=a&&(this.targetId=a);if(null!=c&&(null!=c.title&&(this.title=c.title),null!=c.width&&(this.width=c.width),null!=c.height))this.height=c.height;switch(b){case "hsapiens":this.ensemblSpecie="Homo_sapiens";this.reactomeSpecie="48887";this.wikipathwaysSpecie="Homo+sapiens";this.haphapSpecie=
this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie="";break;case "mmusculus":this.ensemblSpecies="Mus_musculus";this.reactomeSpecies="48892";this.wikipathwaysSpecie="Mus+musculus";this.haphapSpecie=this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie="";break;case "drerio":this.ensemblSpecie="Danio_rerio",this.reactomeSpecie="68323",this.wikipathwaysSpecie="Danio+rerio",this.haphapSpecie=this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie=""}this.notFoundPanel=
Ext.create("Ext.panel.Panel",{id:this.id+"notFoundPanel",cls:"panel-border-left",border:!1,flex:3,bodyPadding:"40",html:"No results found"})}InfoWidget.prototype.draw=function(a){console.log(a);this.query=a.query;this.feature=a.feature;this.adapter=a.adapter;this.panel=Ext.getCmp(this.title+" "+this.query);null==this.panel?(this.render(),this.panel.show(),this.getData()):this.panel.show()};
InfoWidget.prototype.render=function(){this.panel=Ext.create("Ext.ux.Window",{title:this.title+" "+this.query,id:this.title+" "+this.query,minimizable:!0,constrain:!0,closable:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[this.getTreePanel()],buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})};
InfoWidget.prototype.getTreePanel=function(){var a=this.getdataTypes();this.checkDataTypes(a);a=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Options",children:a}});return Ext.create("Ext.tree.Panel",{title:"Detailed information",bodyPadding:10,flex:1,border:!1,store:a,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,c){this.optionClick(c.data)}}})};
InfoWidget.prototype.doGrid=function(a,b,c,d){for(var e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{[values.name]} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!0}),f=[],g=0;g<b.length;g++)f.push({type:"string",dataIndex:b[g]});f={ftype:"filters",local:!0,filters:f};Ext.define(c,{extend:"Ext.data.Model",fields:b});b=Ext.create("Ext.data.Store",{groupField:d,model:c});return Ext.create("Ext.grid.Panel",{id:this.id+c,store:b,title:c,border:!1,cls:"panel-border-left",
flex:3,features:[e,f],viewConfig:{enableTextSelection:!0},columns:a,bbar:["->",{text:"Clear Grouping",handler:function(){e.disable()}}]})};InfoWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)};InfoWidget.prototype.getdataTypes=function(){return[]};InfoWidget.prototype.optionClick=function(){};InfoWidget.prototype.getData=function(){};
InfoWidget.prototype.getGeneTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Location/View?g={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',
"</div><br>",'<div><span class="w75 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w75 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w75 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>','<div><span class="w75 infokey s90">Source: </span> <span class="s110">{source}</span></div>',
'<div><span class="w75 infokey s90">Status: </span> {status}</div>')};
InfoWidget.prototype.getTranscriptTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {id} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={id}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',
"</div><br>",'<div><span class="w100 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w100 infokey s90">Biotype: </span> {biotype}</div>','<div><span class="w100 infokey s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></div>',"",'<div><span class="w100 infokey s90">CDS &nbsp; (start-end): </span> {genomicCodingStart}-{genomicCodingEnd} <span style="margin-left:50px" class="w100 infokey s90">CDNA (start-end): </span> {cdnaCodingStart}-{cdnaCodingEnd}</div>',
'<div><span class="w100 infokey s90">External DB: </span> {externalDb}</div>','<div><span class="w100 infokey s90">Status: </span> {status}</div><br>')};
InfoWidget.prototype.getSnpTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span class="panel-border-bottom"><span class="ssel s130">{id}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Variation/Summary?v={id}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" infokey s90">Strand: </span> {strand}</div>','<div><span class="w140 infokey s90">Source: </span> <span class="s110">{source}</span></div>',
'<div><span class="w140 infokey s90">Type: </span> <span class="s110">{type}</span></div>','<div><span class="w140 infokey s90">Map weight: </span> {mapWeight}</div>','<div><span class="w140 infokey s90">Allele string: </span> {alleleString}</div>','<div><span class="w140 infokey s90">Ancestral allele: </span> {ancestralAllele}</div>','<div><span class="w140 infokey s90">Display SO consequence type: </span> {displayConsequenceType}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div>')};
InfoWidget.prototype.getExonTemplate=function(){return new Ext.XTemplate('<span style="font-family:Oxygen" ><span class="panel-border-bottom"><span class="ssel s110">{id}</span></span></span>','<span><span style="margin-left:30px" class="infokey s90"> Location: </span> <span class="">{chromosome}:{start}-{end} </span></span>','<span><span style="margin-left:30px" class="infokey s90"> Strand: </span> {strand}</span>')};
InfoWidget.prototype.getProteinTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {primaryAccession} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Full name: </span> <span class="">{fullName}</span></div>','<div><span class="w100 infokey s90">Gene name: </span> <span class="">{geneName}</span></div>','<div><span class="w100 infokey s90">Organism: </span> <span class="">{organism}</span></div>')};
InfoWidget.prototype.getVCFVariantTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span><span class="panel-border-bottom"><span class="ssel s130">{chromosome}:{start}-{alt}</span> &nbsp; <span class="emph s120"> {label} </span></span></span></div><br>','<div><span class="w75 infokey s90">Alt: </span> {alt}</div>','<div><span class="w75 infokey s90">Ref: </span> {ref}</div>','<div><span class="w75 infokey s90">Quality: </span> {quality}</div>','<div><span class="w75 infokey s90">Format: </span> {format}</div>',
'<div><span class="w75 infokey s90">Samples: </span> {samples}</div>','<div><span class="w75 infokey s90">Info: <br></span> {info}</div>')};
InfoWidget.prototype.getPWMTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span class="panel-border-bottom"><span class="ssel s130">{accession}</span> &nbsp; <span class="emph s120"> {tfName} </span></span></div>',"<br>",'<div><span class="w100 infokey s90">Type: </span> <span class="">{source}</span></div>','<div><span class="w100 infokey s90">Source: </span> <span class="">{type}</span></div>','<div><span class="w100 infokey s90">Description: </span> <span class="">{description}</span></div>',
'<div><span class="w100 infokey s90">Length: </span> <span class="">{length}</span></div>','<div><span class="w100 infokey s90">Frequencies: </span> <span class="">{[this.parseFrequencies(values.frequencies)]}</span></div>',{parseFrequencies:function(a){return"<div>"+a.replace(/,/gi,"<br>")+"</div>"}})};
InfoWidget.prototype.getProteinXrefTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span class="w75 emph s100">{[values.source.toUpperCase()]}</span> &nbsp; <span class="emph w125 s100"> {[this.generateLink(values)]} <span class="info">&raquo;</span> </span></div>',{generateLink:function(a){if(null!=a.source)switch(a.source.toUpperCase()){case "GO":return'<a TARGET="_blank" href="http://amigo.geneontology.org/cgi-bin/amigo/term_details?term='+a.name+'">'+a.name+"</a>";
case "REACTOME":return'<a TARGET="_blank" href="http://www.reactome.org/cgi-bin/eventbrowser_st_id?ST_ID='+a.name+'">'+a.name+"</a>";case "KEGG":return'<a TARGET="_blank" href="http://www.genome.jp/dbget-bin/www_bget?'+a.name+'">'+a.name+"</a>";case "INTACT":return'<a TARGET="_blank" href="http://www.ebi.ac.uk/intact/pages/interactions/interactions.xhtml?query='+a.name+'">'+a.name+"</a>";case "MINT":return'<a TARGET="_blank" href="http://mint.bio.uniroma2.it/mint/search/search.do?queryType=protein&interactorAc='+
a.name+'">'+a.name+"</a>";case "DIP":return'<a TARGET="_blank" href="http://dip.doe-mbi.ucla.edu/dip/Browse.cgi?ID='+a.name+'">'+a.name+"</a>";case "STRING":return'<a TARGET="_blank" href="http://string-db.org/newstring_cgi/show_network_section.pl?identifier=P51587">'+a.name+"</a>";case "MIM":return'<a TARGET="_blank" href="http://www.omim.org/entry/'+a.name+'">'+a.name+"</a>";case "PHARMGKB":return'<a TARGET="_blank" href="http://www.pharmgkb.org/do/serve?objId='+a.name+'&objCls=Gene">'+a.name+"</a>";
case "ORPHANET":return'<a TARGET="_blank" href="http://www.orpha.net/consor/cgi-bin/OC_Exp.php?lng=EN&Expert='+a.name+'">'+a.name+"</a>"}else return""}})};
InfoWidget.prototype.getSnpTranscriptTemplate=function(){return new Ext.XTemplate('<div style="font-family:Oxygen"><span class="panel-border-bottom"><span class="ssel s130">{[this.getStableId(values)]}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={[this.getStableId(values)]}">Ensembl</a>',"</div><br>",'<div><span class="w140 infokey s90">CDS &nbsp; (start : end): </span> {cdsStart} : {cdsEnd} <span style="margin-left:50px" class="w100 infokey s90">cDNA (start : end): </span> {cdnaStart} : {cdnaEnd}</div>',
'<div><span class="w140 infokey s90">Translation (start : end): </span> {translationStart} : {translationEnd}</div>','<div><span class="w140 infokey s90">Peptide allele: </span> {peptideAlleleString}</div>','<div><span class="w140 infokey s90">Codon: </span> {codonAlleleString}</div>','<div><span class="w140 infokey s90">Polyphen prediction: </span> {polyphenPrediction}','<span style="margin-left:50px" class="w140 infokey s90">Polyphen score: </span> {polyphenScore}</div>','<div><span class="w140 infokey s90">Sift prediction: </span> {siftPrediction}',
'<span style="margin-left:50px" class="w140 infokey s90">Sift score: </span> {siftScore}</div>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>',{getStableId:function(a){return""!=a.transcriptId?a.transcriptId:"Intergenic SNP"}})};InfoWidget.prototype.getConsequenceTypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{transcriptId}</span> &nbsp; </span></div><br>','<div><span class="w140 infokey s90">SO consequence types: </span> {consequenceTypes}</div><br>')};
InfoWidget.prototype.getPhenotypeTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{phenotypeDescription}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w150 infokey s90">PValue: </span>{PValue}</div>','<div><span class="w150 infokey s90">Assoc. gene name: </span>{associatedGeneName}</div>','<div><span class="w150 infokey s90">Assoc. variant risk allele: </span>{associatedVariantRiskAllele}</div>',
'<div><span class="w150 infokey s90">Phenotype description: </span>{phenotypeDescription}</div>','<div><span class="w150 infokey s90">Phenotype name: </span>{phenotypeName}</div>','<div><span class="w150 infokey s90">Risk allele freq in controls: </span>{riskAlleleFrequencyInControls}</div>','<div><span class="w150 infokey s90">Source: </span>{source}</div>','<div><span class="w150 infokey s90">Study name: </span>{studyName}</div>','<div><span class="w150 infokey s90">Study type: </span>{studyType}</div>',
'<div><span class="w150 infokey s90">Study URL: </span>{studyUrl}</div>','<div><span class="w150 infokey s90">Study description: </span>{studyDescription}</div>')};
InfoWidget.prototype.getPopulationTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{population}</span> &nbsp; <span class="emph s120"> {source} </span></span></div><br>','<div><span class="w140 infokey s90">Ref allele:  </span>{refAllele} ({refAlleleFrequency})</div>','<div><span class="w140 infokey s90">Other allele:  </span>{otherAllele} ({otherAlleleFrequency})</div>','<div><span class="w140 infokey s90">Ref allele homozygote:  </span>{refAlleleHomozygote} ({refAlleleHomozygoteFrequency})</div>',
'<div><span class="w140 infokey s90">Allele heterozygote:  </span>{alleleHeterozygote} ({alleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Other allele homozygote:  </span>{otherAlleleHomozygote} ({otherAlleleHeterozygoteFrequency})</div>','<div><span class="w140 infokey s90">Source:  </span>{source}</div>','<div><span class="w140 infokey s90">Population:  </span>{population}</div>')};InfoWidget.prototype.getVariantEffectTemplate=function(){return new Ext.XTemplate('<div><span class="panel-border-bottom"><span class="ssel s130">{consequenceTypeObo}</span> &nbsp; <span class="emph s120"> {featureBiotype} </span></span></div><br>')};
GeneInfoWidget.prototype.draw=InfoWidget.prototype.draw;GeneInfoWidget.prototype.render=InfoWidget.prototype.render;GeneInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;GeneInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;GeneInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;GeneInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate;GeneInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate;
function GeneInfoWidget(a,b,c){null==c&&(c={});c.title="Gene Info";InfoWidget.prototype.constructor.call(this,a,b,c)}GeneInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Regulatory",children:[{text:"TFBS"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]};
GeneInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getGenePanel(this.data).show());break;case "Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case "Xrefs":this.panel.add(this.getXrefGrid(this.data.transcripts,"Xref","transcript").show());break;case "GO":this.panel.add(this.getXrefGrid(this.data.transcripts,
"GO","transcript").show());break;case "Interpro":this.panel.add(this.getXrefGrid(this.data.transcripts,"Interpro","transcript").show());break;case "Reactome":this.panel.add(this.getXrefGrid(this.data.transcripts,"Reactome","transcript").show());break;case "TFBS":this.panel.add(this.getTfbsGrid(this.data.transcripts).show());break;case "miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());break;case "Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());
break;case "3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}};GeneInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel};
GeneInfoWidget.prototype.getTranscriptPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid};
GeneInfoWidget.prototype.getXrefGrid=function(a,b,c){for(var d=[],e=0;e<a.length;e++)for(var f=0;f<a[e].xrefs.length;f++){var g=a[e].xrefs[f];if("Xref"==b){var h=g.dbNameShort.toLowerCase();"go"!=h&&("interpro"!=h&&"reactome"!=h)&&(g.transcript=a[e].id,d.push(g))}else g.dbNameShort.toLowerCase()==b.toLowerCase()&&(g.transcript=a[e].id,d.push(g))}if(0>=d.length)return this.notFoundPanel;null==this[b+"Grid"]&&(this[b+"Grid"]=this.doGrid([{header:"Display Id",dataIndex:"id",flex:1},{header:"DB name",
dataIndex:"dbName",flex:1},{header:"Description",dataIndex:"description",flex:3}],["description","id","dbName","transcript"],b,c),this[b+"Grid"].store.loadData(d));return this[b+"Grid"]};
GeneInfoWidget.prototype.getTfbsGrid=function(a){if(0>=a.length)return this.notFoundPanel;var b="";if(null!=a[0].id){for(var c=[],b="transcriptId",d=0;d<a.length;d++)if(transcript=a[d],null!=transcript.tfbs){for(var e=0;e<transcript.tfbs.length;e++)transcript.tfbs[e].transcriptId=transcript.id;c=c.concat(transcript.tfbs)}a=c}null==this.tfbsGrid&&(this.tfbsGrid=this.doGrid([{header:"Name",dataIndex:"tfName",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",
flex:2.5},{header:"Relative (start-end)",xtype:"templatecolumn",tpl:"{relativeStart}-{relativeEnd}",flex:1.5},{header:"Target gene",dataIndex:"targetGeneName",flex:1},{header:"Score",dataIndex:"score",flex:1},{header:"Sequence",dataIndex:"sequence",flex:1}],"chromosome start end strand tfName relativeStart relativeEnd targetGeneName score sequence transcriptId".split(" "),"TFBS",b),this.tfbsGrid.store.loadData(a));return this.tfbsGrid};
GeneInfoWidget.prototype.getMirnaTargetGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.mirnaTargetGrid&&(this.mirnaTargetGrid=this.doGrid([{header:"Id",dataIndex:"mirbaseId",flex:1},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Score",dataIndex:"score",flex:1},{header:"Exp. Method",dataIndex:"experimentalMethod",flex:1},{header:"source",dataIndex:"source",flex:1}],"chromosome start end strand mirbaseId score experimentalMethod source".split(" "),
"miRNA targets",""),this.mirnaTargetGrid.store.loadData(a));return this.mirnaTargetGrid};
GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.proteinFeaturesGrid&&(this.proteinFeaturesGrid=this.doGrid([{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}],"identifier start end original type description".split(" "),
"Protein features",""),this.proteinFeaturesGrid.store.loadData(a));return this.proteinFeaturesGrid};
GeneInfoWidget.prototype.getProteinFeaturesGrid=function(a){debugger;if(0>=a.length)return this.notFoundPanel;null==this.proteinFeaturesGrid&&(this.proteinFeaturesGrid=this.doGrid([{header:"Identifier",dataIndex:"identifier",flex:1},{header:"Location: (start-end)",xtype:"templatecolumn",tpl:"{start}-{end}",flex:1.2},{header:"Original",dataIndex:"original",flex:1},{header:"Type",dataIndex:"type",flex:1},{header:"Description",dataIndex:"description",flex:1.5}],"identifier start end original type description".split(" "),
"Protein features",""),this.proteinFeaturesGrid.store.loadData(a));return this.proteinFeaturesGrid};
GeneInfoWidget.prototype.get3Dprotein=function(){var a=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"panel-border-left",flex:3,autoScroll:!0});var b=[];$.ajax({url:(new CellBaseManager).host+"/v3/"+a.species+"/feature/id/"+this.query+"/xref?dbname=pdb&of=json",async:!1,success:function(c){if(""!=c){b=c[0];for(c=0;c<b.length;c++){var d=b[c].id,d=Ext.create("Ext.panel.Panel",{title:d,bodyCls:"background-black",html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+
d+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){a=a.title;ChemDoodle.default_backgroundColor="#000000";var b=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+a,300,300);b.gl?(b.specs.set3DRepresentation("Ball and Stick"),b.specs.proteins_ribbonCartoonize=!0,b.handle=null,b.timeout=15,b.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,b.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,
b.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,b.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,b.nextFrame=function(a){var b=[];mat4.identity(b);var a=a/1E3,c=Math.PI/15;mat4.rotate(b,c*a,[1,0,0]);mat4.rotate(b,c*a,[0,1,0]);mat4.rotate(b,c*a,[0,0,1]);mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+a+".pdb",function(a){a=ChemDoodle.readPDB(a);b.loadMolecule(a);b.startAnimation()})):(b.emptyMessage="Your browser does not support WebGL",b.displayMessage())}}});
a.p3dProtein.add(d)}}else a.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein};GeneInfoWidget.prototype.getEnsembleId=function(){};GeneInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(d.result)});b.get("feature","gene",this.query,"fullinfo")};
GeneInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0];console.log(this.data);this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};ProteinInfoWidget.prototype.draw=InfoWidget.prototype.draw;ProteinInfoWidget.prototype.render=InfoWidget.prototype.render;ProteinInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;ProteinInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;ProteinInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;
function ProteinInfoWidget(a,b,c){null==c&&(c={});c.title="Protein Info";InfoWidget.prototype.constructor.call(this,a,b,c)}ProteinInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Sumary",children:[{text:"Long"},{text:"Seq"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Interactions"},{text:"Variations"}]};
ProteinInfoWidget.prototype.optionClick=function(a){a.leaf&&null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1))};SnpInfoWidget.prototype.draw=InfoWidget.prototype.draw;SnpInfoWidget.prototype.render=InfoWidget.prototype.render;SnpInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;SnpInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;SnpInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;
SnpInfoWidget.prototype.getSnpTemplate=InfoWidget.prototype.getSnpTemplate;SnpInfoWidget.prototype.getSnpTranscriptTemplate=InfoWidget.prototype.getSnpTranscriptTemplate;SnpInfoWidget.prototype.getConsequenceTypeTemplate=InfoWidget.prototype.getConsequenceTypeTemplate;SnpInfoWidget.prototype.getPhenotypeTemplate=InfoWidget.prototype.getPhenotypeTemplate;SnpInfoWidget.prototype.getPopulationTemplate=InfoWidget.prototype.getPopulationTemplate;
function SnpInfoWidget(a,b,c){null==c&&(c={});c.title="SNP Info";InfoWidget.prototype.constructor.call(this,a,b,c)}SnpInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Consequence type"},{text:"Annotated phenotype"}]};
SnpInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data).show());break;case "Transcripts":this.panel.add(this.getSnpTranscriptPanel(this.data.transcriptVariations).show());break;case "Consequence type":this.panel.add(this.getConsequenceTypePanel(this.data.transcriptVariations).show());break;case "Annotated phenotype":this.panel.add(this.getPhenotypePanel(this.data.phenotype).show())}};
SnpInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getSnpTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel};
SnpInfoWidget.prototype.getSnpTranscriptPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.snpTranscriptGrid){for(var b=this.getSnpTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.snpTranscriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.snpTranscriptGrid};
SnpInfoWidget.prototype.getConsequenceTypePanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.consequencePanel){for(var b=this.getConsequenceTypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.consequencePanel=Ext.create("Ext.panel.Panel",{title:"Consequence type ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.consequencePanel};
SnpInfoWidget.prototype.getPhenotypePanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.phenotypePanel){for(var b=this.getPhenotypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.phenotypePanel=Ext.create("Ext.panel.Panel",{title:"Phenotype ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.phenotypePanel};
SnpInfoWidget.prototype.getPopulationPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.populationPanel){for(var b=this.getPopulationTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.populationPanel=Ext.create("Ext.panel.Panel",{title:"Population ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.populationPanel};
SnpInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(d.result)});b.get("feature","snp",this.query,"info")};SnpInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0];console.log(this.data);this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};TranscriptInfoWidget.prototype.draw=InfoWidget.prototype.draw;
TranscriptInfoWidget.prototype.render=InfoWidget.prototype.render;TranscriptInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;TranscriptInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;TranscriptInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;TranscriptInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate;TranscriptInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate;
TranscriptInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate;TranscriptInfoWidget.prototype.get3Dprotein=GeneInfoWidget.prototype.get3Dprotein;TranscriptInfoWidget.prototype.getGenePanel=GeneInfoWidget.prototype.getGenePanel;TranscriptInfoWidget.prototype.getXrefGrid=GeneInfoWidget.prototype.getXrefGrid;TranscriptInfoWidget.prototype.getTfbsGrid=GeneInfoWidget.prototype.getTfbsGrid;TranscriptInfoWidget.prototype.getMirnaTargetGrid=GeneInfoWidget.prototype.getMirnaTargetGrid;
TranscriptInfoWidget.prototype.getProteinFeaturesGrid=GeneInfoWidget.prototype.getProteinFeaturesGrid;function TranscriptInfoWidget(a,b,c){null==c&&(c={});c.title="Transcript";InfoWidget.prototype.constructor.call(this,a,b,c)}
TranscriptInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"},{text:"Xrefs"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Variation",children:[{text:"SNPs"},{text:"Mutations"}]},{text:"Regulatory",children:[{text:"TFBS"},{text:"miRNA targets"}]},{text:"Protein",children:[{text:"Features"},{text:"3D structure"}]}]};
TranscriptInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data).show());break;case "Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case "Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case "Xrefs":this.panel.add(this.getXrefGrid([this.data],"Xref","dbName").show());break;case "GO":this.panel.add(this.getXrefGrid([this.data],
"GO").show());break;case "Interpro":this.panel.add(this.getXrefGrid([this.data],"Interpro").show());break;case "Reactome":this.panel.add(this.getXrefGrid([this.data],"Reactome").show());break;case "SNPs":this.panel.add(this.getSnpsGrid(this.data.snps).show());break;case "Mutations":this.panel.add(this.getMutationsGrid(this.data.mutations).show());break;case "TFBS":this.panel.add(this.getTfbsGrid(this.data.tfbs).show());break;case "miRNA targets":this.panel.add(this.getMirnaTargetGrid(this.data.mirnaTargets).show());
break;case "Features":this.panel.add(this.getProteinFeaturesGrid(this.data.proteinFeatures).show());break;case "3D structure":this.panel.add(this.get3Dprotein(this.data.snps).show())}};TranscriptInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel};
TranscriptInfoWidget.prototype.getExonsGrid=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid};
TranscriptInfoWidget.prototype.getSnpsGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.snpsGrid&&(this.snpsGrid=this.doGrid([{header:"Name",dataIndex:"name",flex:2},{header:"Location: chr:start-end (strand)",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end} ({strand})",flex:2},{header:"Alleles",dataIndex:"alleleString",flex:0.7},{header:"Most severe SO term",dataIndex:"displaySoConsequence",flex:2}],"chromosome start end name strand alleleString displaySoConsequence".split(" "),
"SNPs",""),this.snpsGrid.store.loadData(a));return this.snpsGrid};
TranscriptInfoWidget.prototype.getMutationsGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.mutationsGrid&&(this.mutationsGrid=this.doGrid([{header:"Mutation AA",dataIndex:"mutationAa",flex:1},{header:"Mutation CDS",dataIndex:"mutationCds",flex:1.5},{header:"Location: chr:start-end",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:1.7},{header:"Primary histology",dataIndex:"primaryHistology",flex:1},{header:"Source",dataIndex:"source",flex:1}],"chromosome start end mutationAa mutationCds primaryHistology source".split(" "),
"Mutations",""),this.mutationsGrid.store.loadData(a));return this.mutationsGrid};TranscriptInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(d.result)});b.get("feature","transcript",this.query,"fullinfo")};
TranscriptInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0];console.log(this.data);this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};VCFVariantInfoWidget.prototype.draw=InfoWidget.prototype.draw;VCFVariantInfoWidget.prototype.render=InfoWidget.prototype.render;VCFVariantInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;VCFVariantInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;
VCFVariantInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;VCFVariantInfoWidget.prototype.getVCFVariantTemplate=InfoWidget.prototype.getVCFVariantTemplate;VCFVariantInfoWidget.prototype.getVariantEffectTemplate=InfoWidget.prototype.getVariantEffectTemplate;function VCFVariantInfoWidget(a,b,c){null==c&&(c={});c.title="VCF variant Info";InfoWidget.prototype.constructor.call(this,a,b,c)}
VCFVariantInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Variant effect"},{text:"Header"},{text:"Samples"}]}]};
VCFVariantInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data.feature).show());break;case "Variant effect":this.panel.add(this.getEffectPanel(this.data.consequenceType).show());break;case "Header":this.panel.add(this.getHeaderPanel(this.data.header).show());break;case "Samples":this.panel.add(this.getSamplesGrid(this.data.feature.sampleData,
this.data.samples,this.data.feature.format).show())}};VCFVariantInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getVCFVariantTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel};
VCFVariantInfoWidget.prototype.getEffectPanel=function(a){if(0>=a.length)return this.notFoundPanel;for(var b=0;b<a.length;b++)if(a[b].consequence=a[b].consequenceType+" - "+a[b].consequenceTypeObo,""==a[b].featureName&&(a[b].featureName="-"),""==a[b].geneId&&(a[b].geneId="-"),""==a[b].transcriptId&&(a[b].transcriptId="-"),""==a[b].featureBiotype&&(a[b].featureBiotype="-"),""==a[b].aaPosition&&(a[b].aaPosition="-"),""==a[b].aminoacidChange)a[b].aminoacidChange="-";null==this.effectGrid&&(this.effectGrid=
this.doGrid([{header:"Feature",dataIndex:"featureName",flex:1},{header:"Gene Id",dataIndex:"geneId",flex:1.5},{header:"Transcript Id",dataIndex:"transcriptId",flex:1.5},{header:"Feat.Biotype",dataIndex:"featureBiotype",flex:1},{header:"aa Position",dataIndex:"aaPosition",flex:1},{header:"aa Change",dataIndex:"aminoacidChange",flex:1}],"featureName geneId transcriptId featureBiotype aaPosition aminoacidChange consequence".split(" "),"effectGridModel","consequence"),this.effectGrid.store.loadData(a));
return this.effectGrid};VCFVariantInfoWidget.prototype.getHeaderPanel=function(a){if(""==a)return this.notFoundPanel;null==this.headerPanel&&(this.headerPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,html:a}));return this.headerPanel};
VCFVariantInfoWidget.prototype.getSamplesGrid=function(a,b,c){a=a.split("\t").slice(9);if(0>=a.length)return this.notFoundPanel;for(var d=Array(b.length),e=0,f=d.length;e<f;e++)d[e]={id:b[e],info:a[e]};null==this.samplesGrid&&(this.samplesGrid=this.doGrid([{header:"Identifier",dataIndex:"id",flex:1},{header:c,dataIndex:"info",flex:5}],["id","info"],"VCF samples",""),this.samplesGrid.store.loadData(d));return this.samplesGrid};
VCFVariantInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(d.result)});b.get("genomic","variant",this.feature.chromosome+":"+this.feature.start+":"+this.feature.ref+":"+this.feature.alt,"consequence_type")};
VCFVariantInfoWidget.prototype.dataReceived=function(a){this.data={};this.data.header=this.adapter.header;this.data.samples=this.adapter.samples;this.data.feature=this.feature;this.data.consequenceType=a;this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};
function CellBaseManager(a,b){this.host=CELLBASE_HOST;this.version=CELLBASE_VERSION;this.species=a;this.subcategory=this.category=null;this.contentformat="json";this.fileformat="";this.outputcompress=!1;this.dataType="script";this.query=null;this.resource=this.originalQuery="";this.params={};this.async=!0;this.maxQuery=30;this.numberQueries=0;this.results=[];this.resultsCount=[];this.batching=!1;if(null!=b&&(null!=b.host&&(this.host=b.host),null!=b.async))this.async=b.async;this.completed=new Event;
this.success=new Event;this.batchSuccessed=new Event;this.error=new Event;this.setVersion=function(a){this.version=a};this.setSpecies=function(a){this.species=a};this.getVersion=function(){return this.version};this.getSpecies=function(){return this.species};this.setAsync=function(a){this.async=a};this.getUrl=function(){return null!=this.query?this.host+"/"+this.version+"/"+this.species+"/"+this.category+"/"+this.subcategory+"/"+this.query+"/"+this.resource:this.host+"/"+this.version+"/"+this.species+
"/"+this.category+"/"+this.subcategory+"/"+this.resource};this.get=function(a,b,e,f,g,h){null!=g&&(this.params=g);if(null!=e){this.originalQuery=e=e instanceof Array?e:e.split(",");if(1<e.length)return this.batching=!0,this.results=[],this.getMultiple(a,b,e,f);if(this.maxQuery<e.length)this.batching=!0,this.getMultiple(a,b,e,f,h);else return this.batching=!1,this.getSingle(a,b,e[0],f,h)}else return this.getSingle(a,b,e,f,h)};this._joinToResults=function(a){this.resultsCount.push(!0);this.results[a.id]=
a.data;if(this.numberQueries==this.resultsCount.length){for(var a=[],b=0;b<this.results.length;b++)for(var e=0;e<this.results[b].length;e++)a.push(this.results[b][e]);this.success.notify({result:a,category:this.category,subcategory:this.subcategory,query:this.originalQuery,resource:this.resource,params:this.params,error:""})}};this.getSingle=function(a,b,e,f,g,h){this.category=a;this.subcategory=b;this.query=e;this.resource=f;a=this.getUrl();return this._callServer(a,g,h)};this.getMultiple=function(a,
b,e,f){var g=[];if(e.length>this.maxQuery)for(var h=0;h<e.length;h+=this.maxQuery)g.push(e.slice(h,h+this.maxQuery));else g.push(e);this.numberQueries=g.length;var j=this;this.batchSuccessed.addEventListener(function(a,b){j._joinToResults(b)});for(h=0;h<g.length;h++)this.results.push([]),this.getSingle(a,b,g[h].toString(),f,h)};this._callServer=function(a,b){var e=this;this.params.of=this.contentformat;a+=this.getQuery(this.params,a);console.log(a);if(!0==this.async)$.ajax({type:"GET",url:a,dataType:"json",
async:this.async,success:function(a){e.batching?e.batchSuccessed.notify({data:a,id:b}):e.success.notify({result:a,category:e.category,subcategory:e.subcategory,query:e.originalQuery,resource:e.resource,params:e.params,error:""})},complete:function(){e.completed.notify()},error:function(a,b,c){console.log("CellBaseManager: Ajax call returned : "+c+"\t"+b+"\t"+a.statusText+" END");e.error.notify()}});else{var f=null;$.ajax({type:"GET",url:a,dataType:"json",async:this.async,success:function(a){f={result:a,
category:e.category,subcategory:e.subcategory,query:e.originalQuery,resource:e.resource,params:e.params,error:""}},error:function(){}});return f}}}CellBaseManager.prototype.getQuery=function(a,b){var c="?";-1!=b.indexOf("?")&&(c="&");var d="",e;for(e in a)null!=a[e]&&(d+=e+"="+a[e].toString()+"&");""!=d&&(d=c+d.substring(0,d.length-1));return d};
Ext.define("Ext.ux.Window",{extend:"Ext.window.Window",minimizable:!0,constrain:!0,collapsible:!0,initComponent:function(){this.callParent();null!=this.taskbar&&(this.zIndexManager=this.taskbar.winMgr,this.iconCls="icon-grid",this.button=Ext.create("Ext.button.Button",{text:this.title,window:this,iconCls:this.iconCls,handler:function(){this.window.zIndexManager.front==this.window?this.window.minimize():this.window.show()}}),this.taskbar.add(this.button),this.contextMenu=new Ext.menu.Menu({items:[{text:"Close",
window:this,iconCls:"tools-icons x-tool-close",handler:function(){this.window.close()}}]}),this.button.getEl().on("contextmenu",function(a){a.preventDefault();this.contextMenu.showAt(a.getX(),a.getY()-10-25*this.contextMenu.items.length)},this),this.button.on("destroy",function(){this.window.close()}),this.on("destroy",function(){!0!=this.button.destroying&&this.button.destroy()}),this.on("minimize",function(){this.hide()}),this.on("deactivate",function(){this.zIndexManager&&this.zIndexManager.front.ghostPanel&&
this.zIndexManager.unregister(this.zIndexManager.front.ghostPanel);this.button.toggle(!1)}),this.on("activate",function(){this.button.toggle(!0)}))}});
function GenomicAttributesWidget(a,b){var c=this;this.id="GenomicAttributesWidget"+Math.round(1E4*Math.random());this.species=a;this.args=b;this.title="None";this.featureType="gene";this.columnsCount=null;if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.columnsCount&&(this.columnsCount=b.columnsCount),null!=b.featureType&&(this.featureType=b.featureType),null!=b.viewer))this.viewer=b.viewer,b.listWidgetArgs.viewer=b.viewer;this.listWidget=new ListWidget(this.species,b.listWidgetArgs);this.attributesPanel=
new AttributesPanel({height:240,columnsCount:this.columnsCount,wum:b.wum,tags:b.tags});this.onMarkerClicked=new Event(this);this.onTrackAddAction=new Event(this);this.attributesPanel.onDataChange.addEventListener(function(a,b){c.dataChange(b)})}
GenomicAttributesWidget.prototype.draw=function(){var a=this;null==this.panel&&(this.karyotypePanel=Ext.create("Ext.panel.Panel",{id:this.id+"karyotypePanel",height:350,maxHeight:350,border:0,padding:"0 0 0 0",html:'<div id="'+this.id+'karyotypeDiv" ><div>'}),this.karyotypePanel.on("afterrender",function(){var b=$("#"+a.id+"karyotypeDiv")[0];console.log(b);a.karyotypeWidget=new KaryotypeWidget(b,{width:1E3,height:340,species:a.viewer.species,region:a.viewer.region});a.karyotypeWidget.onClick.addEventListener(function(b,
d){a.viewer.region.load(d);a.viewer.onRegionChange.notify({sender:"KaryotypePanel"})});a.karyotypeWidget.drawKaryotype()}),this.filtersButton=Ext.create("Ext.button.Button",{text:"Additional Filters",disabled:!0,listeners:{scope:this,click:function(){this.onAdditionalInformationClick()}}}),this.addTrackButton=Ext.create("Ext.button.Button",{text:"Add Track",disabled:!0,handler:function(){a.onTrackAddAction.notify({adapter:a.adapter,fileName:a.attributesPanel.fileName})}}),this.panel=Ext.create("Ext.ux.Window",
{title:this.title,resizable:!1,minimizable:!0,constrain:!0,closable:!0,bodyStyle:"background:#fff;",taskbar:Ext.getCmp(this.args.viewer.id+"uxTaskbar"),items:[this.attributesPanel.getPanel(),this.karyotypePanel],width:1035,height:653,buttonAlign:"left",buttons:[this.addTrackButton,"->",{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.attributesPanel.barField.add(this.filtersButton),this.panel.setLoading());
this.panel.show()};GenomicAttributesWidget.prototype.dataChange=function(a){try{this.karyotypePanel.setLoading("Connecting to Database");this.karyotypeWidget.unmark();for(var b=[],c=0;c<a.length;c++)b.push(a[c].data[0]);0<a.length?this.fill(b):this.karyotypePanel.setLoading(!1)}catch(d){alert(d)}finally{this.karyotypePanel.setLoading(!1)}};
GenomicAttributesWidget.prototype.onAdditionalInformationClick=function(){var a=this;this.listWidget.draw(this.cbResponse,!1);this.listWidget.onFilterResult.addEventListener(function(b,c){a.karyotypeWidget.unmark();for(var d=0;d<c.length;d++)a.karyotypeWidget.addMark(c[d].data);a.attributesPanel.store.clearFilter();a.attributesPanel.store.filter(function(a){return a.data.cellBase})})};ExpressionGenomicAttributesWidget.prototype.draw=GenomicAttributesWidget.prototype.draw;
ExpressionGenomicAttributesWidget.prototype.getMainPanel=GenomicAttributesWidget.prototype.getMainPanel;ExpressionGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;ExpressionGenomicAttributesWidget.prototype.drawKaryotype=GenomicAttributesWidget.prototype.drawKaryotype;ExpressionGenomicAttributesWidget.prototype.makeGrid=GenomicAttributesWidget.prototype.makeGrid;ExpressionGenomicAttributesWidget.prototype.getKaryotypePanelId=GenomicAttributesWidget.prototype.getKaryotypePanelId;
ExpressionGenomicAttributesWidget.prototype.onAdditionalInformationClick=GenomicAttributesWidget.prototype.onAdditionalInformationClick;function ExpressionGenomicAttributesWidget(a,b){null==b&&(b={});b.columnsCount=2;b.title="Expression";b.tags=["expression"];b.featureType="gene";b.listWidgetArgs={title:"Filter",action:"filter"};GenomicAttributesWidget.prototype.constructor.call(this,a,b)}
ExpressionGenomicAttributesWidget.prototype.fill=function(a){for(var b=this,c=Normalizer.normalizeArray(values),d=[],e=0;e<c.length;e++)isNaN(parseFloat(values[e]))?d.push("#000000"):d.push(Colors.getColorByScoreValue(c[e]).HexString());if(null==this.cbResponse){var c=new CellBaseManager(this.species),f=new FeatureDataAdapter(null,{species:this.species});c.success.addEventListener(function(a,c){b.karyotypePanel.setLoading("Retrieving data");for(var e=0;e<c.result.length;e++){b.attributesPanel.store.data.items[e].data.cellBase=
0<c.result[e].length?!0:!1;for(var k=0;k<c.result[e].length;k++){var l=c.result[e][k];l.featureType="gene";b.karyotypeWidget.addMark(l,d[e]);f.addFeatures(l)}}b.adapter=f;b.filtersButton.enable();b.addTrackButton.enable();b.karyotypePanel.setLoading(!1);b.cbResponse=c;b.karyotypePanel.setLoading(!1)});this.karyotypePanel.setLoading("Connecting to Database");c.get("feature","gene",a.toString(),"info")}};
ExpressionGenomicAttributesWidget.prototype.dataChange=function(a){try{var b=[];values=[];for(var c=0;c<a.length;c++)b.push(a[c].data[0]),values.push(a[c].data[1]);0<a.length&&this.fill(b,values)}catch(d){alert(d),this.panel.setLoading(!1)}};GenotypeGenomicAttributesWidget.prototype.draw=GenomicAttributesWidget.prototype.draw;GenotypeGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;GenotypeGenomicAttributesWidget.prototype.drawKaryotype=GenomicAttributesWidget.prototype.drawKaryotype;
GenotypeGenomicAttributesWidget.prototype.makeGrid=GenomicAttributesWidget.prototype.makeGrid;GenotypeGenomicAttributesWidget.prototype.getKaryotypePanelId=GenomicAttributesWidget.prototype.getKaryotypePanelId;GenotypeGenomicAttributesWidget.prototype.dataChange=GenomicAttributesWidget.prototype.dataChange;GenotypeGenomicAttributesWidget.prototype.fill=GenomicAttributesWidget.prototype.fill;GenotypeGenomicAttributesWidget.prototype.onAdditionalInformationClick=GenomicAttributesWidget.prototype.onAdditionalInformationClick;
function GenotypeGenomicAttributesWidget(a,b){null==b&&(b={});b.title="Genotype";b.tags=["genotype"];b.featureType="snp";b.listWidgetArgs={title:"Filter",action:"filter",gridFields:"name variantAlleles ancestralAllele mapWeight position sequence".split(" ")};GenomicAttributesWidget.prototype.constructor.call(this,a,b)}
function AttributesWidget(a){this.id="AttributesWidget_"+Math.random();this.title="";this.width=1025;this.height=628;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height;this.attributesPanel=new AttributesPanel({borderCls:a.borderCls,height:325})}AttributesWidget.prototype.draw=function(){this.render()};AttributesWidget.prototype.getDetailPanel=function(){return{}};
AttributesWidget.prototype.getButtons=function(){var a=this;return[{text:"Close",handler:function(){a.panel.close()}}]};
AttributesWidget.prototype.render=function(){null==this.panel&&(this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,collapsible:!0,layout:{type:"vbox",align:"stretch"},items:[this.attributesPanel.getPanel(),this.getDetailPanel()],width:this.width,height:this.height,buttonAlign:"right",buttons:this.getButtons(),listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.panel.setLoading());this.panel.show()};
function AttributesPanel(a){var b=this;this.targetId=null;this.id="AttributesPanel_"+Math.round(1E7*Math.random());this.title=null;this.width=1023;this.height=628;this.wum=!0;this.tags=[];this.borderCls="panel-border-bottom";this.columnsCount=null;if(null!=a&&(null!=a.wum&&(this.wum=a.wum),null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.columnsCount&&(this.columnsCount=a.columnsCount),
null!=a.borderCls&&(this.borderCls=a.borderCls),null!=a.tags))this.tags=a.tags;this.browserData=new BrowserDataWidget;this.onDataChange=new Event(this);this.onFileRead=new Event(this);this.browserData.adapter.onReadData.addEventListener(function(a,d){var e=new TabularDataAdapter(new StringDataSource(d.data),{async:!1}),f=e.getLines();b.makeGrid(e);b.uptadeTotalFilteredRowsInfo(f.length);b.uptadeTotalRowsInfo(f.length);b.fileName=d.filename;b.fileNameLabel.setText('<span class="emph">'+d.filename+
'</span> <span class="info">(server)</span>',!1)})}AttributesPanel.prototype.draw=function(){var a=this.getPanel();null!=this.targetId&&a.render(this.targetId)};AttributesPanel.prototype.uptadeTotalRowsInfo=function(a){this.infoLabel.setText('<span class="dis">Total rows: </span><span class="emph">'+a+"</span>",!1)};AttributesPanel.prototype.uptadeTotalFilteredRowsInfo=function(a){this.infoLabel2.setText('<span class="dis">Filtered rows: </span><span class="emph">'+a+"</span>",!1)};
AttributesPanel.prototype.sessionInitiated=function(){null!=this.btnBrowse&&this.btnBrowse.enable()};AttributesPanel.prototype.sessionFinished=function(){null!=this.btnBrowse&&this.btnBrowse.disable()};
AttributesPanel.prototype.getPanel=function(){var a=this;null==this.panel&&(this.expresionAnalysisUploadFieldFile=Ext.create("Ext.form.field.File",{msgTarget:"side",width:75,emptyText:"Choose a local file",allowBlank:!1,buttonText:"Browse local",buttonOnly:!0,listeners:{scope:this,change:function(){a.panel.setLoading("Reading file");try{var b=new TabularFileDataAdapter({comment:"#"}),c=document.getElementById(this.expresionAnalysisUploadFieldFile.fileInputEl.id).files[0];a.fileName=c.name;a.fileNameLabel.setText('<span class="emph">'+
c.name+'</span> <span class="info">(local)</span>',!1);b.loadFromFile(c);b.onRead.addEventListener(function(){a.makeGrid(b);a.uptadeTotalFilteredRowsInfo(b.lines.length);a.uptadeTotalRowsInfo(b.lines.length);a.panel.setLoading(!1);a.onFileRead.notify()})}catch(d){alert(d),a.panel.setLoading(!1)}}}}),this.barField=Ext.create("Ext.toolbar.Toolbar"),this.barInfo=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom"}),this.barHelp=Ext.create("Ext.toolbar.Toolbar",{dock:"top"}),this.clearFilter=Ext.create("Ext.button.Button",
{text:"Clear filters",disabled:!0,listeners:{scope:this,click:function(){null!=this.grid.filters&&(this.grid.filters.clearFilters(),this.store.clearFilter())}}}),this.helpLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">Click on the header down arrow to filter by column</span>'}),this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="emph">Select a <span class="info">local</span> file or a <span class="info">server</span> file from your account.</span>'}),this.infoLabel=
Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"}),this.infoLabel2=Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"}),this.barField.add(this.expresionAnalysisUploadFieldFile),this.barInfo.add("->",this.infoLabel,this.infoLabel2),this.barHelp.add(this.fileNameLabel,"->",this.helpLabel),this.store=Ext.create("Ext.data.Store",{fields:["1","2"],data:[]}),this.grid=Ext.create("Ext.grid.Panel",{store:this.store,disabled:!0,border:0,columns:[{header:"Column 1",dataIndex:"1"},{header:"Column 2",dataIndex:"2"}]}),
this.panel=Ext.create("Ext.panel.Panel",{title:this.title,border:!1,layout:"fit",cls:this.borderCls,items:[this.grid],tbar:this.barField,width:this.width,height:this.height,maxHeight:this.height,buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.panel.addDocked(this.barInfo),this.panel.addDocked(this.barHelp));this.wum&&(this.btnBrowse=Ext.create("Ext.button.Button",{text:"Browse server",disabled:!0,listeners:{scope:this,
click:function(){this.browserData.draw($.cookie("bioinfo_sid"),this.tags)}}}),this.barField.add(this.btnBrowse),null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished());this.barField.add("-",this.clearFilter);return this.panel};AttributesPanel.prototype.getData=function(){return this.data};
AttributesPanel.prototype.makeGrid=function(a){this.data=a.getLines();var b=[],c=[],d=[];null==this.columnsCount&&(this.columnsCount=this.data[0].length);for(var e=0;e<this.columnsCount;e++){var f=a.getHeuristicTypeByColumnIndex(e);b.push({name:e.toString(),type:f});c.push({header:"Column "+e.toString(),dataIndex:e.toString(),flex:1,filterable:!0,filter:{type:f}});d.push({type:f,dataIndex:e.toString()})}this.store=Ext.create("Ext.data.Store",{fields:b,data:this.data,listeners:{scope:this,datachanged:function(a){a.getRange();
this.uptadeTotalFilteredRowsInfo(a.getRange().length);this.onDataChange.notify(a.getRange())}}});a={ftype:"filters",local:!0,filters:d};null!=this.grid&&this.panel.remove(this.grid);this.grid=Ext.create("Ext.grid.Panel",{store:this.store,columns:c,border:0,features:[a]});this.panel.insert(0,this.grid);this.clearFilter.enable()};
function ListPanel(a,b){this.targetId=null;this.id="ListPanel"+Math.round(1E5*Math.random());this.species=a;this.args=b;this.title="List of Genes";this.width=1E3;this.height=500;this.borderCls="panel-border-bottom";this.gridFields="externalName stableId biotype position strand description chromosome start end".split(" ");if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.targetId&&(this.targetId=b.targetId),null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.gridFields&&
(this.gridFields=b.gridFields),null!=b.borderCls&&(this.borderCls=b.borderCls),null!=b.viewer&&(this.viewer=b.viewer),null!=b.featureType))this.featureType=b.featureType;this.onSelected=new Event(this);this.onFilterResult=new Event(this)}
ListPanel.prototype._getGeneGrid=function(){for(var a=this,b=this.gridFields,c=[],d=[],e=0;e<b.length;e++)c.push({type:"string",dataIndex:b[e]}),d.push({header:this.gridFields[e],dataIndex:this.gridFields[e],flex:1});this.store=Ext.create("Ext.data.Store",{fields:b,groupField:"biotype",autoload:!1});c={ftype:"filters",local:!0,filters:c};this.infoToolBar=Ext.create("Ext.toolbar.Toolbar");this.infoLabelOk=Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"});this.infoLabelNotFound=Ext.create("Ext.toolbar.TextItem",
{text:"&nbsp;"});this.clearFilter=Ext.create("Ext.button.Button",{text:"Clear filters",listeners:{scope:this,click:function(){null!=this.grid.filters&&this.grid.filters.clearFilters()}}});this.found=Ext.create("Ext.button.Button",{text:"Features found",hidden:!0,listeners:{scope:this,click:function(){(new InputListWidget({title:"Features found",headerInfo:"This features were found in the database",viewer:this.viewer})).draw(this.queriesFound.join("\n"))}}});this.notFound=Ext.create("Ext.button.Button",
{text:"Features not found",hidden:!0,listeners:{scope:this,click:function(){(new InputListWidget({title:"Features not found",headerInfo:"This features were not found in the database",viewer:this.viewer})).draw(this.queriesNotFound.join("\n"))}}});this.exportButton=Ext.create("Ext.button.Button",{text:"Export to Text",handler:function(){(new InputListWidget({width:1100,title:"VCS content",headerInfo:"Export results",viewer:a.args.viewer})).draw(a._getStoreContent())}});this.localizeButton=Ext.create("Ext.button.Button",
{text:"Localize on karyotype",handler:function(){a._localize()}});this.infoToolBar.add(["->",this.exportButton,this.localizeButton,"-",this.found,this.notFound,this.clearFilter]);return this.grid=Ext.create("Ext.grid.Panel",{border:0,store:this.store,features:[c],bbar:this.infoToolBar,columns:d,selModel:{mode:"SINGLE"}})};
ListPanel.prototype._localize=function(){var a=this,b=Ext.create("Ext.window.Window",{id:this.id+"karyotypePanel",title:"Karyotype",width:1020,height:410,bodyStyle:"background:#fff;",html:'<div id="'+this.id+'karyotypeDiv" ><div>',buttons:[{text:"Close",handler:function(){b.close()}}],listeners:{afterrender:function(){var b=$("#"+a.id+"karyotypeDiv")[0],b=new KaryotypeWidget(b,{width:1E3,height:340,species:a.viewer.species,chromosome:a.viewer.chromosome,position:a.viewer.position});b.onClick.addEventListener(function(b,
c){a.viewer.onLocationChange.notify({position:c.position,chromosome:c.chromosome,sender:"KaryotypePanel"})});b.drawKaryotype();for(var d=0;d<a.features.length;d++)b.addMark(a.features[d])}}}).show()};ListPanel.prototype.setTextInfoBar=function(a,b,c){this.found.setText('<span class="dis">'+a+" results found </span> ");this.found.show();0<c&&(this.notFound.setText('<span class="err">'+c+" features not found</span>"),this.notFound.show())};
ListPanel.prototype._getStoreContent=function(){for(var a=new String,b=0;b<this.store.data.items.length;b++){var c=new String;if(0==b){for(var d=0;d<this.gridFields.length;d++)c=c+this.gridFields[d]+"\t";c+="\n"}for(d=0;d<this.gridFields.length;d++)c=c+this.store.data.items[b].data[this.gridFields[d]]+"\t";c+="\n";a+=c}return a};
ListPanel.prototype._render=function(){null==this.panel&&(this.panel=Ext.create("Ext.panel.Panel",{height:240,layout:"fit",cls:this.borderCls,title:this.title,border:!1}));this.panel.add(this._getGeneGrid())};
ListPanel.prototype.draw=function(a,b){this._render();this.queriesNotFound=[];this.queriesFound=[];this.features=[];if(!1!=b){this.adapter=new FeatureDataAdapter(null,{species:this.species});for(var c=0;c<a.result.length;c++){a.result[c].constructor!=Array&&(a.result[c]=[a.result[c]]);for(var d=0;d<a.result[c].length;d++){var e=a.result[c][d];e.position=e.chromosome+":"+e.start+"-"+e.end;e.featureType=a.subCategory;this.features.push(e)}0==a.result[c].length?this.queriesNotFound.push(a.query[c]):
(this.queriesFound.push(a.query[c]),this.adapter.addFeatures(a.result[c]))}}else for(c=0;c<a.result.length;c++){a.result[c].constructor!=Array&&(a.result[c]=[a.result[c]]);for(d=0;d<a.result[c].length;d++)e=a.result[c][d],e.position=e.chromosome+":"+e.start+"-"+e.end,e.featureType=a.subCategory,this.features.push(e);0==a.result[c].length?this.queriesNotFound.push(a.query[c]):this.queriesFound.push(a.query[c])}this.store.loadData(this.features);this.setTextInfoBar(this.queriesFound.length,this.queriesFound.length,
this.queriesNotFound.length)};
function ListWidget(a,b){this.targetId=null;this.id="ListWidget"+Math.round(1E7*Math.random());this.species=a;this.width=1E3;this.height=500;this.action="localize";this.title="";this.args=b;if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.targetId&&(this.targetId=b.targetId),null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.action&&(this.action=b.action),null!=b.viewer))this.viewer=b.viewer;this.listPanel=new ListPanel(this.species,{title:!1,gridFields:b.gridFields,
viewer:this.args.viewer});this.onSelected=this.listPanel.onSelected;this.onFilterResult=this.listPanel.onFilterResult}
ListWidget.prototype._render=function(){var a=this;null==this.panel&&(this.localizeButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",disabled:!0,handler:function(){a.listPanel.onSelected.notify(a.listPanel.grid.getSelectionModel().getSelection()[0].data);a.panel.hide()}}),this.filterButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",handler:function(){a.listPanel.onFilterResult.notify(a.listPanel.store.getRange());a.panel.hide()}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,
taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),resizable:!1,constrain:!0,closable:!0,layout:"fit",minimizable:!0,width:this.width,height:this.height,items:[this.listPanel.grid],buttonAlign:"right",buttons:[this.getActionButton(this.action),{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}))};
ListWidget.prototype.draw=function(a,b){var c=this;this.listPanel.draw(a,b);this.listPanel.grid.getSelectionModel().on("selectionchange",function(){c.listPanel.grid.getSelectionModel().hasSelection()?c.localizeButton.enable():c.localizeButton.disable()});this._render();this.panel.show()};ListWidget.prototype.getActionButton=function(a){switch(a){case "localize":return this.localizeButton;case "filter":return this.listPanel.localizeButton.disable().hide(),this.filterButton}};
GenomicListPanel.prototype._getGeneGrid=ListPanel.prototype._getGeneGrid;GenomicListPanel.prototype._localize=ListPanel.prototype._localize;GenomicListPanel.prototype.setTextInfoBar=ListPanel.prototype.setTextInfoBar;GenomicListPanel.prototype._getStoreContent=ListPanel.prototype._getStoreContent;GenomicListPanel.prototype._render=ListPanel.prototype._render;GenomicListPanel.prototype.draw=ListPanel.prototype.draw;function GenomicListPanel(a){ListPanel.prototype.constructor.call(this,a)}
GenomicListWidget.prototype.draw=ListWidget.prototype.draw;GenomicListWidget.prototype.getActionButton=ListWidget.prototype.getActionButton;function GenomicListWidget(a,b){ListWidget.prototype.constructor.call(this,a,b);this.onSelected=this.listPanel.onSelected;this.onFilterResult=this.listPanel.onFilterResult;this.onTrackAddAction=new Event}
GenomicListWidget.prototype._render=function(){var a=this;null==this.panel&&(this.localizeButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",disabled:!0,handler:function(){a.listPanel.onSelected.notify(a.listPanel.grid.getSelectionModel().getSelection()[0].data);a.panel.hide()}}),this.filterButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",handler:function(){a.listPanel.onFilterResult.notify(a.listPanel.store.getRange());a.panel.hide()}}),this.panel=Ext.create("Ext.ux.Window",
{title:this.title,taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),resizable:!1,constrain:!0,closable:!0,layout:"fit",minimizable:!0,width:this.width,height:this.height,items:[this.listPanel.grid],buttonAlign:"left",buttons:[{text:"Add Track",handler:function(){var b="Search "+Math.round(1E3*Math.random());a.onTrackAddAction.notify({adapter:a.listPanel.adapter,fileName:b})}},"->",this.getActionButton(this.action),{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},
destroy:function(){delete this.panel}}}))};function InputListWidget(a){this.id="InputListWidget"+Math.round(1E7*Math.random());this.title="List";this.width=500;this.height=350;this.headerInfo="Write a list separated only by lines";this.args=a;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.headerInfo&&(this.headerInfo=a.headerInfo),null!=a.viewer))this.viewer=a.viewer;this.onOk=new Event(this)}
InputListWidget.prototype.draw=function(a){var b=this;null==a&&(a=new String);null==this.panel&&(this.infobar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"}),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{text:this.headerInfo}),this.infobar.add(this.infoLabel),this.editor=Ext.create("Ext.form.field.TextArea",{id:this.id+"genelist_preview",xtype:"textarea",name:"file",margin:"-1",width:this.width,height:this.height,enableKeyEvents:!0,cls:"dis",style:"normal 6px tahoma, arial, verdana, sans-serif",
value:a,listeners:{scope:this,change:function(){this.validate()}}}),a=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.editor]}),this.okButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,listeners:{scope:this,click:function(){var a=Ext.getCmp(this.id+"genelist_preview").getValue().split("\n");this.onOk.notify(a);b.panel.close()}}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),layout:"fit",resizable:!1,collapsible:!0,
constrain:!0,closable:!0,items:[a],buttons:[this.okButton,{text:"Cancel",handler:function(){b.panel.close()}}],listeners:{scope:this,destroy:function(){delete this.panel}}}));this.panel.show()};InputListWidget.prototype.validate=function(){""!=this.editor.getValue()?this.okButton.enable():this.okButton.disable()};
function ChartWidget(a){this.id="ChartWidget_"+Math.round(1E7*Math.random());this.title=null;this.width=750;this.height=300;if(null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height))this.height=a.height}ChartWidget.prototype.getStore=function(){return this.store};
ChartWidget.prototype.getChart=function(a){Ext.define("ChromosomeChart",{extend:"Ext.data.Model",fields:a});this.store=Ext.create("Ext.data.Store",{model:"ChromosomeChart",autoLoad:!1});return Ext.create("Ext.chart.Chart",{animate:!0,shadow:!0,store:this.store,width:this.width,height:this.height,axes:[{position:"left",fields:[a[0]],title:a[0],grid:!0,type:"Numeric",minimum:0},{title:a[1],type:"category",position:"bottom",fields:[a[1]],label:{rotate:{degrees:270}}}],series:[{type:"column",axis:"left",
gutter:10,yField:a[0],xField:a[1],style:{fill:"#38B8BF"}}]})};
function GenomeMaps(a,b){var c=this;this.id="GenomeMaps"+Math.round(1E4*Math.random());this.suiteId=9;this.title="Genome Maps";this.description="Genomic data visualization";this.version="3.1.0";this.trackIdCounter=1;this.args=b;this.width=$(window).width();this.height=$(window).height();this.targetId=a||document.body;if(null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height))this.height=b.height;this.accountData=null;var d=new Region,e=$.url(),f=e.param("CELLBASE_HOST");null!=f&&(CELLBASE_HOST=
f);speciesObj=DEFAULT_SPECIES;f=e.param("species");"undefined"!==typeof f&&""!=f&&(speciesObj=Utils.getSpeciesFromAvailable(AVAILABLE_SPECIES,f)||speciesObj);this.species=Utils.getSpeciesCode(speciesObj.text);d.load(speciesObj.region);f=e.param("region");null!=f&&d.parse(f);f=parseInt(e.param("zoom"));if(isNaN(f)||100<f||0>f)f=null;var g=e.param("gene");null!=g&&""!=g&&d.load(this.getRegionByFeature(g,"gene"));g=e.param("snp");null!=g&&""!=g&&d.load(this.getRegionByFeature(g,"snp"));this.headerWidget=
new HeaderWidget({appname:this.title,description:this.description,version:this.version,suiteId:this.suiteId,accountData:this.accountData});d.url=e.param("region");g=CONFPANELHIDDEN;"false"===e.param("confpanel")&&(g=!0);var h=REGIONPANELHIDDEN;"false"===e.param("regionpanel")&&(h=!1);this.genomeViewer=new GenomeViewer(this.id+"gvDiv",speciesObj,{region:d,version:this.version,zoom:f,confPanelHidden:g,regionPanelHidden:h,availableSpecies:AVAILABLE_SPECIES,popularSpecies:POPULAR_SPECIES,height:this.height-
this.headerWidget.height,width:this.width});this.headerWidget.onLogin.addEventListener(function(){Ext.example.msg("Welcome","You logged in");c.sessionInitiated()});this.headerWidget.onLogout.addEventListener(function(){Ext.example.msg("Good bye","You logged out");c.sessionFinished()});this.headerWidget.onGetAccountInfo.addEventListener(function(a,b){c.setAccountData(b)});this._updateLocalOpencgaTracks();this.genomeViewer.onSpeciesChange.addEventListener(function(){debugger;c.headerWidget.setDescription(c.genomeViewer.speciesName);
c.species=c.genomeViewer.species;c._refreshInitialTracksConfig()});$(window).smartresize(function(){c.setSize($(window).width(),$(window).height())});$(window).unload(function(){$.cookie("gm_settings",JSON.stringify({species:{name:c.genomeViewer.speciesName,species:c.genomeViewer.species,chromosome:c.genomeViewer.chromosome,position:c.genomeViewer.position}}),{expires:365})})}
GenomeMaps.prototype.sessionInitiated=function(){Ext.getStore(this.id+"import").getRootNode().findChild("id","opencga").set("text","Browse remote data")};GenomeMaps.prototype.sessionFinished=function(){Ext.getStore(this.id+"import").getRootNode().findChild("id","opencga").set("text",'Browse remote data <span class="tip">(login required)</span>');this._unloadOpencgaTracks();this.accountData=null};GenomeMaps.prototype.setAccountData=function(a){this.accountData=a;this._updateOpencgaTracks(JSON.parse(JSON.stringify(a)))};
GenomeMaps.prototype.draw=function(){var a=this;if(null==this._panel){var b=Ext.create("Ext.container.Container",{id:this.id+"gvContainer",region:"center",html:'<div id="'+this.id+'gvDiv"></div>'});this._panel=Ext.create("Ext.panel.Panel",{id:this.id+"_panel",renderTo:this.targetId,layout:"border",border:!1,width:this.width,height:this.height,items:[this.headerWidget.getPanel(),b]});this.headerWidget.setDescription(this.genomeViewer.speciesName);this.genomeViewer.afterRender.addEventListener(function(){Ext.getCmp(a.genomeViewer.id+
"versionLabel").setText('<span class="info">Genome Maps v'+a.version+"</span>");a._setOverviewTracks();a.genomeViewer.addSidePanelItems(a.getSidePanelItems());a.genomeViewer.onSvgRemoveTrack.addEventListener(function(b,d){Ext.getCmp(a.id+d+"menu").setChecked(!1)})});this.genomeViewer.draw()}null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished()};
GenomeMaps.prototype.setSize=function(a,b){this.width=a;this.height=b;this._panel.setSize(a,b);this.genomeViewer.setSize(a,b-this.headerWidget.height);this.headerWidget.setWidth(a)};GenomeMaps.prototype.getRegionByFeature=function(a,b){var c;$.ajax({url:CELLBASE_HOST+"/latest/"+this.species+"/feature/"+b+"/"+a+"/info?of=json",async:!1,success:function(a){c=JSON.parse(a)[0][0]}});return null!=c?{chromosome:c.chromosome,start:c.start,end:c.end}:{}};
GenomeMaps.prototype._setOverviewTracks=function(){var a=new TrackData("gene",{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:5E4}})});this.genomeViewer.trackSvgLayoutOverview.addTrack(a,{id:"gene1",type:"gene",title:"Gene",featuresRender:"MultiFeatureRender",histogramZoom:10,labelZoom:20,height:150,visibleRange:{start:0,end:100},titleVisibility:"hidden",featureTypes:FEATURE_TYPES})};
GenomeMaps.prototype.genTrackId=function(){var a=this.trackIdCounter;this.trackIdCounter++;return a};GenomeMaps.prototype.removeTrack=function(a){return this.genomeViewer.removeTrack(a)};GenomeMaps.prototype.restoreTrack=function(a,b){return this.genomeViewer.restoreTrack(a,b)};GenomeMaps.prototype.scrollToTrack=function(a){this.genomeViewer.scrollToTrack(a)};GenomeMaps.prototype.setTrackIndex=function(a,b){this.genomeViewer.setTrackIndex(a,b)};GenomeMaps.prototype.getTrackSvgById=function(a){return this.genomeViewer.getTrackSvgById(a)};
GenomeMaps.prototype.addTrack=function(a,b,c,d){var e=this.genTrackId();switch(a){case "Gene/Transcript":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"gene",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:5E4},filters:{},options:{},featureConfig:FEATURE_CONFIG.gene})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"GeneTranscriptRender",histogramZoom:20,transcriptZoom:50,height:24,visibleRange:{start:0,end:100},
featureTypes:FEATURE_TYPES});break;case "Cytoband":break;case "Sequence":c=new TrackData(e,{adapter:new SequenceAdapter({category:"genomic",subCategory:"region",resource:"sequence",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E3}})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"SequenceRender",height:30,visibleRange:{start:100,end:100}});break;case "CpG islands":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"cpg_island",
species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:5E4}})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:10,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "SNP":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"snp",species:this.genomeViewer.species,params:{exclude:"transcriptVariations,xrefs,samples"},featureCache:{gzip:!0,chunkSize:1E4},filters:{},
options:{},featureConfig:FEATURE_CONFIG.snp})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:70,labelZoom:80,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Mutation":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"mutation",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",
histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Structural variation (<20Kb)":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"structural_variation",species:this.genomeViewer.species,params:{min_length:1,max_length:2E4},featureCache:{gzip:!0,chunkSize:5E4}})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:40,height:150,visibleRange:{start:0,end:100},
featureTypes:FEATURE_TYPES});break;case "Structural variation (>20Kb)":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"structural_variation",species:this.genomeViewer.species,params:{min_length:2E4,max_length:3E8},featureCache:{gzip:!0,chunkSize:5E6}})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:40,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "miRNA targets":c=
new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"regulatory",params:{type:"mirna_target"},species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:0,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "TFBS":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"regulatory",
params:{type:"TF_binding_site_motif"},species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:0,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "Conserved regions":c=new TrackData(e,{adapter:new CellBaseAdapter({category:"genomic",subCategory:"region",resource:"conserved_region2",species:this.genomeViewer.species,featureCache:{gzip:!0,chunkSize:1E4}})});
this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "bam":c=new TrackData(e,{adapter:new BamAdapter({category:"bam",host:d,resource:c,species:this.genomeViewer.species,featureCache:{gzip:!1,chunkSize:5E3},filters:{},options:{},featureConfig:FEATURE_CONFIG.bam})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"BamRender",histogramZoom:60,height:24,
visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;case "vcf":c=new TrackData(e,{adapter:new OpencgaAdapter({category:"vcf",resource:c,species:this.genomeViewer.species,featureCache:{gzip:!1,chunkSize:5E3},filters:{},options:{},featureConfig:FEATURE_CONFIG.vcf})});this.genomeViewer.addTrack(c,{id:e,type:a,title:b,featuresRender:"MultiFeatureRender",histogramZoom:60,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});break;default:return null}return e};
GenomeMaps.prototype.addFileTrack=function(a,b){var c=this,d=null;switch(a){case "GFF2":d=new GFFFileWidget({version:2,viewer:c.genomeViewer});break;case "GFF3":d=new GFFFileWidget({version:3,viewer:c.genomeViewer});break;case "GTF":d=new GTFFileWidget({viewer:c.genomeViewer});break;case "BED":d=new BEDFileWidget({viewer:c.genomeViewer});break;case "VCF":d=new VCFFileWidget({viewer:c.genomeViewer})}null!=d&&(d.draw(),c.headerWidget.onLogin.addEventListener(function(){d.sessionInitiated()}),c.headerWidget.onLogout.addEventListener(function(){d.sessionFinished()}),
d.onOk.addEventListener(function(d,f){var g=new TrackData(f.fileName,{adapter:f.adapter}),h=c.genTrackId();c.genomeViewer.addTrack(g,{id:h,title:f.fileName,type:a,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES});b(a,f.fileName+"-"+h,h,!0)}))};
GenomeMaps.prototype.addDASTrack=function(a,b){var c=this.genTrackId(),d=new TrackData("das",{adapter:new DasAdapter({url:b,species:this.genomeViewer.species,featureCache:{gzip:!1,chunkSize:1E4}})});this.genomeViewer.addTrack(d,{id:c,title:a,type:"das",featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:50,end:100},settings:{height:10}});return c};
GenomeMaps.prototype._loadInitialTracksConfig=function(a){for(var b=TRACKS[SPECIES_TRACKS_GROUP[this.species]],c=[],d=[],e=0,f=b.length;e<f;e++){var g=[];d.push({text:b[e].category,iconCls:"icon-box",expanded:!0,children:g});for(var h=0,j=b[e].tracks.length;h<j;h++){var k=b[e].tracks[h].id,l=b[e].tracks[h].checked;g.push({text:k,iconCls:"icon-blue-box",leaf:!0,disabled:b[e].tracks[h].disabled});if(l){if(a&&a.addTrack)var m=this.addTrack(k,k);c.push({text:k,trackId:m,trackType:k,checked:!0,iconCls:"icon-blue-box",
leaf:!0})}}}return{cellbaseTracks:d,activeTracks:c}};GenomeMaps.prototype._refreshInitialTracksConfig=function(){var a=Ext.getStore(this.id+"curated").getRootNode().findChild("text","CellBase");a.removeAll();a.appendChild(this._loadInitialTracksConfig().cellbaseTracks)};
GenomeMaps.prototype._loadInitialDasTrackConfig=function(){for(var a=DAS_TRACKS,b=[],c=0,d=a.length;c<d;c++)if(a[c].species==this.species){for(var d=0,e=a[c].categories.length;d<e;d++){var f,g,h=[];b.push({text:a[c].categories[d].name,iconCls:"icon-box",expanded:!0,children:h});for(var j=0,k=a[c].categories[d].sources.length;j<k;j++)f=a[c].categories[d].sources[j].name,g=a[c].categories[d].sources[j].url,h.push({text:f,url:g,iconCls:"icon-blue-box",leaf:!0})}break}return b};
GenomeMaps.prototype._loadInitialPluginTrackConfig=function(){for(var a=GENOME_MAPS_AVAILABLE_PLUGINS,b=[],c=0,d=a.length;c<d;c++){var e=[];b.push({text:a[c].category,iconCls:"icon-box",expanded:!0,children:e});for(var f=0,g=a[c].plugins.length;f<g;f++)e.push({text:a[c].plugins[f].name,plugin:a[c].plugins[f],iconCls:"icon-blue-box",leaf:!0})}return b};
GenomeMaps.prototype.getSidePanelItems=function(){var a=this,b=this._loadInitialTracksConfig({addTrack:!0}),c=this._loadInitialPluginTrackConfig(),d=Ext.create("Ext.data.TreeStore",{fields:["text","trackId","trackType"],root:{expanded:!0,children:b.activeTracks}});this.activeSt=d;Ext.create("Ext.data.TreeStore",{fields:["text","plugin"],root:{expanded:!0,children:c}});var c={title:'<span class="">Active tracks</span>',id:this.id+"activeTracksPanel",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"treepanel",
id:this.id+"activeTracksTree",store:d,bodyPadding:"5 0 0 0",margin:"-1 0 0 0",border:!1,autoScroll:!0,flex:1,useArrows:!0,rootVisible:!1,selType:"cellmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2,listeners:{edit:function(b,c){a.getTrackSvgById(c.record.data.trackId).setTitle(c.record.data.text)}}})],hideHeaders:!0,columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{xtype:"actioncolumn",menuDisabled:!0,align:"center",tooltip:"Remove",
width:30,icon:Utils.images.del,handler:function(b,c,d,e,k,l){l.isLeaf()&&(b=l.data.trackId,c=l.data.checked,l.destroy(),c&&a.removeTrack(b))}}],viewConfig:{markDirty:!1,plugins:{ptype:"treeviewdragdrop"},listeners:{drop:function(b,c){var d=c.records[0];d.isLeaf()&&(d.data.index!=d.removedFrom&&d.data.checked)&&a.setTrackIndex(d.data.trackId,d.data.index)}}},listeners:{itemclick:function(b,c){if(c.isLeaf()&&c.data.checked){var d=c.data.trackId;a.scrollToTrack(d);d=a.getTrackSvgById(d);null!=d&&a._loadTrackConfig(d,
c)}},checkchange:function(b,c){var d=b.data.trackId;c?(d=b.raw.track,a.restoreTrack(d,b.data.index)):(d=a.removeTrack(d),b.raw.track=d)},itemmouseenter:function(b,c){var d=a.getTrackSvgById(c.data.trackId);null!=d&&d.fnTitleMouseEnter()},itemmouseleave:function(b,c){var d=a.getTrackSvgById(c.data.trackId);null!=d&&d.fnTitleMouseLeave()}}},{xtype:"tabpanel",id:this.id+"activeTracksSettings",plain:!0,border:!1,margin:"5 0 0 0",autoScroll:!0,flex:2,items:[{id:this.id+"trackOptions",itemId:this.id+"trackOptions",
title:"Options",bodyPadding:10,border:!1},{id:this.id+"trackFiltering",itemId:this.id+"trackFiltering",title:"Filtering",layout:{type:"vbox",align:"stretch"},border:!1}]}]},d={title:'<span class="">Advanced search</span>',id:this.id+"searchSidePanel",layout:{type:"vbox",align:"stretch"},bodyPadding:"5",items:[{xtype:"tbtext",text:'<span class="">Search by any external reference:</span>'},{id:this.id+"searchTextArea",xtype:"textarea",flex:1,enableKeyEvents:!0,value:"",listeners:{change:function(b){""!=
b.getValue()?Ext.getCmp(a.id+"searchPanelButton").enable():Ext.getCmp(a.id+"searchPanelButton").disable()}}},{id:this.id+"searchPanelCombo",fieldLabel:"Result type",xtype:"combobox",store:{fields:["value","name"],data:[{value:"info",name:"Genes"},{value:"snp",name:"SNPs"},{value:"transcript",name:"Transcripts"},{value:"exon",name:"Exons"}]},displayField:"name",valueField:"value",listeners:{afterrender:function(a){a.select(a.getStore().data.items[0])}}},{id:this.id+"searchPanelButton",margin:"0 0 0 0",
xtype:"button",text:"Search",disabled:!0,handler:function(){var b=Ext.getCmp(a.id+"searchResults");b.setLoading(!0);b.removeAll();var c=Ext.getCmp(a.id+"searchTextArea").getValue().trim().split("\n"),d=Ext.getCmp(a.id+"searchPanelCombo").getValue().toLowerCase(),e=new CellBaseManager(a.species);e.success.addEventListener(function(c,e){for(var g="",j=[],k=d.replace("info","gene"),r=FEATURE_TYPES[k].infoWidgetId,q=0,t=e.result.length;q<t;q++){var s=e.query[q];if(0<e.result[q].length){var w=3<e.query.length;
switch(k){case "snp":case "mutation":case "exon":for(var u=[],B=e.result[q],x=1<B.length?244:250,v=0,y=B.length;v<y;v++){var z=B[v],D=Ext.create("Ext.data.Store",{fields:[r,"chromosome","start","end"],data:z,proxy:{type:"memory"},pageSize:5});u.push({xtype:"grid",store:D,hideHeaders:!0,width:x,height:180,loadMask:!0,margin:"2 0 0 0",title:'<span class="info">'+s+'</span> <span style="font-family: Oxygen;color:slategray">'+z.length+"</span>",collapsible:!0,collapsed:w,titleCollapse:!0,columns:[{text:"id",
dataIndex:r,width:230}],plugins:"bufferedrenderer",loadMask:!0,listeners:{itemclick:function(b,c){a.genomeViewer.region.load(c.data);a.genomeViewer.onRegionChange.notify({sender:"searchSidePanel"})}}})}2>u.length?j.push(u[0]):j.push({xtype:"panel",title:'<span class="info">'+s+'</span> - <span style="font-family: Oxygen;color:slategray">'+u.length+" genes</span>",bodyPadding:"0 2 2 2",collapsible:!0,collapsed:!1,titleCollapse:!0,width:250,items:u});break;case "transcript":w=!1;u=[];w=new Ext.XTemplate("<span>{"+
r+"}</span>");B=e.result[q];v=0;for(y=B.length;v<y;v++){x=B[v];items2=[];z=0;for(D=x.length;z<D;z++){var F=x[z];items2.push({xtype:"box",padding:"1 5 1 10",border:1,tpl:w,data:F,datos:F,listeners:{afterrender:function(b){this.getEl().addClsOnOver("encima2");this.getEl().addCls("whiteborder");this.getEl().on("click",function(){a.genomeViewer.region.load(b.datos);a.genomeViewer.onRegionChange.notify({sender:"searchSidePanel"})})}}})}u.push({xtype:"panel",border:0,title:"Gene "+(v+1),items:items2})}2>
u.length&&(u=u[0].items);j.push({xtype:"panel",title:'<span class="info">'+s+"</span>",margin:"2 0 0 0",collapsible:!0,collapsed:!1,titleCollapse:!0,width:250,items:u});break;default:w=!1;u=[];w=new Ext.XTemplate("<span>{"+r+"}</span>");v=0;for(y=e.result[q].length;v<y;v++)u.push({xtype:"box",padding:"1 5 1 10",border:1,tpl:w,data:e.result[q][v],datos:e.result[q][v],listeners:{afterrender:function(b){this.getEl().addClsOnOver("encima2");this.getEl().addCls("whiteborder");this.getEl().on("click",function(){a.genomeViewer.region.load(b.datos);
a.genomeViewer.onRegionChange.notify({sender:"searchSidePanel"})})}}});j.push({xtype:"panel",title:'<span class="info">'+s+"</span>",margin:"2 0 0 0",collapsible:!0,collapsed:!1,titleCollapse:!0,width:250,items:u})}}else g+="&nbsp; &nbsp;"+e.query[q]+"<br>"}""!=g&&(g='<span class="err">Features not found:</span>'+g);j.push({xtype:"box",padding:"15 5 2 3",border:1,html:g});b.add(j);b.setLoading(!1)});var k=null;switch(d){case "snp":k={exclude:"transcriptVariations,xrefs,samples"};break;case "transcript":k=
{exclude:"exons,xrefs"}}e.get("feature","gene",c,d,k)}},{xtype:"tbtext",margin:"10 0 0 0",text:'<p class="">Results:</p>'},{id:this.id+"searchResults",border:!1,autoScroll:!0,flex:3,items:[{xtype:"container"}]}]},b=this._createTracksTreePanel({title:"Add new tracks from CellBase and DAS",id:"curated",nodes:[{text:"CellBase",iconCls:"icon-box",id:"cellbase",expanded:!0,children:b.cellbaseTracks},{text:"DAS",iconCls:"icon-box",id:"das",expanded:!0,children:this._loadInitialDasTrackConfig()}]}),e=this._createTracksTreePanel({title:"Import data",
id:"import",nodes:[{text:"Browse remote data",id:"opencga",iconCls:"icon-box",expanded:!0,children:[]},{text:'Browse local data <span class="tip">(light server required)</span>',id:"localopencga",iconCls:"icon-box",expanded:!0,children:[]},{text:"Load local data (<500MB)",id:"load",iconCls:"icon-box",expanded:!0,children:[{text:"GFF2",iconCls:"icon-blue-box",leaf:!0},{text:"GFF3",iconCls:"icon-blue-box",leaf:!0},{text:"BED",iconCls:"icon-blue-box",leaf:!0},{text:"VCF",iconCls:"icon-blue-box",leaf:!0}]}]});
return[c,b,e,d]};
GenomeMaps.prototype._createTracksTreePanel=function(a){var b=this,c=Ext.create("Ext.data.TreeStore",{id:this.id+a.id,fields:["text","id"],root:{expanded:!0,children:a.nodes}});return{xtype:"treepanel",id:this.id+a.id,title:'<span class="">'+a.title+"</span>",bodyPadding:"10 0 0 0",useArrows:!0,rootVisible:!1,hideHeaders:!0,store:c,viewConfig:{markDirty:!1},columns:[{xtype:"treecolumn",dataIndex:"text",flex:1},{xtype:"actioncolumn",menuDisabled:!0,align:"center",width:20,renderer:function(a,b,c){"cellbase"==
c.data.id?(this.icon=Utils.images.info,this.tooltip=CELLBASE_HOST):"das"==c.data.id?(this.icon=Utils.images.info,this.tooltip="Add custom DAS track"):"opencga"==c.data.id?(this.icon=Utils.images.info,this.tooltip="OpenCGA server information link"):"localopencga"==c.data.id?(this.icon=Utils.images.info,this.tooltip="OpenCGA light server information link"):this.icon=this.tooltip=null},handler:function(a,b,c,g,h,j){a=j.data.id;"opencga"==a&&open("http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:opencga_sever");
"localopencga"==a&&open("http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:opencga_light_sever")}},{xtype:"actioncolumn",menuDisabled:!0,align:"center",width:30,icon:Utils.images.add,renderer:function(a,b,c){c.isLeaf()?(this.icon=Utils.images.add,this.tooltip="Add",c.raw.disabled&&(this.tooltip=this.icon=null)):"cellbase"==c.data.id?this.icon=Utils.images.edit:"das"==c.data.id?this.icon=Utils.images.add:"localopencga"==c.data.id?(this.icon=Utils.images.refresh,this.tooltip="Refresh local files"):
this.tooltip=this.icon=null},handler:function(a,e,f,g,h,j){var k=function(a,c,d,e){b.activeSt.getRootNode().appendChild({text:c,trackId:d,trackType:a,leaf:!0,checked:!0,iconCls:"icon-blue-box"});Ext.example.msg("Track "+a,"actived");!0==e&&Ext.getCmp(b.id+"activeTracksTree").expand()},a=j.data.text,e=j.data.id;if(j.isLeaf()){if(j.isAncestor(c.getRootNode().findChild("id","cellbase"))&&!j.raw.disabled&&(e=a,f=b.addTrack(e,a),k(e,e,f,!0)),j.isAncestor(c.getRootNode().findChild("id","das"))&&(e="das",
f=b.addDASTrack(a,j.raw.url),k(e,a,f,!0)),j.isAncestor(c.getRootNode().findChild("id","load"))&&b.addFileTrack(a,k),j.isAncestor(c.getRootNode().findChild("id","opencga"))&&!j.raw.disabled&&(e=j.raw.fileFormat,f=b.addTrack(e,a,j.raw),null!=f&&k(e,a,f,!0)),j.isAncestor(c.getRootNode().findChild("id","localopencga")))e=j.raw.oid.split(".").pop(),f=b.addTrack(e,a,j.raw.oid,OPENCGA_LOCALHOST),null!=f&&k(e,a,f,!0)}else"cellbase"==e&&Ext.Msg.prompt("Cellbase","Please enter a new Cellbase URL:",function(a,
b){if("ok"==a){var c=null,d="http://"+b+"/cellbase/rest";$.ajax({url:d+"/rest/latest",async:!1,success:function(a){-1!=a.indexOf("hsa")&&(c=!0)}});c?(CELLBASE_HOST=d,j.set("tooltip",CELLBASE_HOST),Ext.example.msg("Cellbase Host","Host changed<br>"+CELLBASE_HOST)):Ext.example.msg("Cellbase Host","Not found")}}),"das"==e&&(a=new UrlWidget({title:"Add a DAS track"}),a.onAdd.addEventListener(function(a,c){var d=b.addDASTrack(c.name,c.url);k("das",c.name+"-"+d,d,!0)}),a.draw()),"localopencga"==e&&b._updateLocalOpencgaTracks()}}]}};
GenomeMaps.prototype._loadOpencgaTracks=function(a){for(var b=0;b<a.buckets.length;b++){for(var c=[],d=a.buckets[b].id,e=0;e<a.buckets[b].objects.length;e++){var f=a.buckets[b].objects[e];f.bucketId=d;if("dir"!==f.fileType&&("bam"===f.fileFormat||"vcf"===f.fileFormat))f.text=f.fileName,f.qtip=f.status,f.icon=Utils.images.r,f.leaf=!0,f.oid=f.id||f.oid,c.push(f)}Ext.getStore(this.id+"import").getRootNode().findChild("id","opencga").appendChild({text:a.buckets[b].name,iconCls:"icon-blue-box",expanded:!0,
children:c})}};GenomeMaps.prototype._unloadOpencgaTracks=function(){Ext.getStore(this.id+"import").getRootNode().findChild("id","opencga").removeAll()};GenomeMaps.prototype._updateOpencgaTracks=function(a){this._unloadOpencgaTracks();this._loadOpencgaTracks(a)};
GenomeMaps.prototype._updateLocalOpencgaTracks=function(){var a=this,b=new OpencgaManager(OPENCGA_LOCALHOST);b.onLocalFileList.addEventListener(function(b,d){Ext.getStore(a.id+"import").getRootNode().findChild("id","localopencga").removeAll();if("error"!=d.statusText){Ext.example.msg("Local Open CGA","loaded");Ext.getStore(a.id+"import").getRootNode().findChild("id","localopencga").set("text",'Browse local data <span class="ok">(ready)</span>');var e=JSON.parse(d);Ext.getStore(a.id+"import").getRootNode().findChild("id",
"localopencga").appendChild(e)}});b.localFileList()};
GenomeMaps.prototype._loadTrackConfig=function(a){var b=a.getFiltersConfig(),c=a.getFilters();if(null!=b){for(var d=[],e=[],f=0;f<b.length;f++){var g=b[f].text,h=b[f].name,j=[],k;null!=c[h]?k=!1:k=!0;for(var l=0;l<b[f].values.length;l++)j.push({text:b[f].values[l],leaf:!0,checked:k,iconCls:"icon-blue-box"});h=Ext.create("Ext.data.TreeStore",{root:{text:h,expanded:!0,checked:k,iconCls:"icon-box",children:j},fields:["text","name"]});d.push({xtype:"treepanel",useArrows:!0,bodyPadding:"5 0 5 0",title:g,
border:0,store:h,listeners:{checkchange:function(a,b){a.isRoot()&&a.eachChild(function(a){a.set("checked",b)})},afterrender:function(a){var a=a.getStore().getRootNode(),b=a.get("text");if(null!=c[b])for(var d=0;d<c[b].length;d++){var e=a.findChild("text",c[b][d]);e.set("checked",!0);e.save}}}});e.push(h)}f=Ext.create("Ext.tab.Panel",{flex:1,plain:!0,border:0,bbar:{xtype:"toolbar",layout:{type:"hbox",pack:"center"},items:[{xtype:"button",flex:1,text:'<span class="emph">Apply filter</span>',id:this.id+
"SettingsPanelOkButton",handler:function(){for(var b={},c=0;c<e.length;c++){var d=e[c].getRootNode(),f=d.get("text"),g=[],h=0;d.eachChild(function(a){h++;a.data.checked&&g.push(a.get("text"))});g.length==h&&(g=[]);b[f]=g}console.log(b);a.setFilters(b)}}]},items:d});Ext.getCmp(this.id+"trackFiltering").removeAll();Ext.getCmp(this.id+"trackFiltering").add([f])}else Ext.getCmp(this.id+"activeTracksSettings").child("#"+this.id+"trackFiltering").tab.hide(),Ext.getCmp(this.id+"trackFiltering").removeAll();
Ext.getCmp(this.id+"activeTracksSettings").child("#"+this.id+"trackFiltering").tab.show();Ext.getCmp(this.id+"activeTracksSettings").setActiveTab(Ext.getCmp(this.id+"trackFiltering"));b=a.getOptionsConfig();a.getOptions();if(null!=b){optionComponents=[];for(f=0;f<b.length;f++){var m=b[f];"checkbox"==m.type&&optionComponents.push({xtype:m.type,boxLabel:m.text,checked:m.checked,option:m,listeners:{change:function(b,c){c?a.setOption(b.option,c):a.setOption(b.option,null)}}});"doublenumberfield"==m.type&&
optionComponents.push({xtype:"panel",title:m.text,bodyPadding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"numberfield",checked:m.checked,value:m.minValue,fieldLabel:"Min",flex:1,option:m,minValue:0,listeners:{change:function(a,b){m.minValue=b}}},{xtype:"numberfield",checked:m.checked,value:m.maxValue,fieldLabel:"Max",option:m,flex:1,minValue:0,listeners:{change:function(a,b){m.maxValue=b}}},{xtype:"button",text:"apply",option:m,flex:2,handler:function(b){0!=b.option.minValue&&0!=b.option.maxValue?
a.setOption(b.option,b.option.minValue+","+b.option.maxValue):a.setOption(b.option,null)}}]})}Ext.getCmp(this.id+"activeTracksSettings").child("#"+this.id+"trackOptions").tab.show();Ext.getCmp(this.id+"trackOptions").removeAll();Ext.getCmp(this.id+"trackOptions").add(optionComponents);Ext.getCmp(this.id+"activeTracksSettings").setActiveTab(Ext.getCmp(this.id+"trackOptions"))}else Ext.getCmp(this.id+"activeTracksSettings").child("#"+this.id+"trackOptions").tab.hide(),Ext.getCmp(this.id+"trackOptions").removeAll()};
