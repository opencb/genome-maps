/*! Genome Viewer - v1.0.2 - 2013-09-09
* http://https://github.com/opencb-bigdata-viz/js-common-libs/
* Copyright (c) 2013  Licensed GPLv2 */
function UserListWidget(a){this.id="UserListWidget_"+Math.round(1e7*Math.random()),this.data=new Array,this.args=new Object,this.timeout=4e3,this.pagedViewList=a.pagedViewList,this.suiteId=-1,this.tools=[],null!=a&&(null!=a.timeout&&a.timeout>4e3&&(this.timeout=a.timeout),null!=a.suiteId&&(this.suiteId=a.suiteId),null!=a.tools&&(this.tools=a.tools))}function GenericFormPanel(a){this.analysis=a,this.form=null,this.paramsWS={},this.opencgaManager=new OpencgaManager,this.panelId=this.analysis+"-FormPanel",this.testing=!1,this.opencgaManager.onRunAnalysis.addEventListener(function(a,b){-1!=b.data.indexOf("ERROR")?Ext.Msg.show({title:"Error",msg:b.data,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}):console.log(b.data)})}function OpencgaManager(a){this.host=OPENCGA_HOST||this.host,this.host=a||this.host,this.onGetAccountInfo=new Event(this),this.onLogin=new Event(this),this.onCreateAccount=new Event(this),this.onResetPassword=new Event(this),this.onChangePassword=new Event(this),this.onChangeEmail=new Event(this),this.onLogout=new Event(this),this.onCreateBucket=new Event(this),this.onRefreshBucket=new Event(this),this.onRenameBucket=new Event(this),this.onUploadObjectToBucket=new Event(this),this.onDeleteObjectFromBucket=new Event(this),this.onCreateDirectory=new Event(this),this.onJobStatus=new Event(this),this.onJobResult=new Event(this),this.onTable=new Event(this),this.onPoll=new Event(this),this.onDeleteJob=new Event(this),this.onRunAnalysis=new Event(this),this.onIndexer=new Event(this),this.onIndexerStatus=new Event(this),this.onBamList=new Event(this),this.onGetAccountInfo=new Event(this),this.onRegion=new Event(this),this.onLocalFileList=new Event(this),this.onError=new Event(this)}function CheckBrowser(a){Ext.isIE&&window.console&&"undefined"==typeof window.console.time&&(console.time=function(a,b){if(a){var c=(new Date).getTime();console.timeCounters||(console.timeCounters={});var d="KEY"+a.toString();(b||!console.timeCounters[d])&&(console.timeCounters[d]=c)}},console.timeEnd=function(a){var b=(new Date).getTime();if(console.timeCounters){var c="KEY"+a.toString(),d=console.timeCounters[c];if(d){var e=b-d,f=a+": "+e+"ms";console.info(f),delete console.timeCounters[c]}return e}});var b=!1;switch(a){case"renato":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;case"variant":Ext.chromeVersion>=16&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.firefoxVersion>=10&&(b=!0);break;default:Ext.chromeVersion>=14&&(b=!0),Ext.safariVersion>=5&&(b=!0),Ext.isIE10>=5&&(b=!0)}0==b&&(console.log("--------------------------------------------"+b),$("#checkBrowser").html("This application provides the best user experience with Google Chrome and Apple Safari, otherwise some latencies may be experienced when browsing due to some problems in Firefox.").css("width","540px").css("height","40px").css("position","absolute").css("margin-left","300px").css("margin-top","26px").css("padding","5px").css("border","1px solid #F1D031").css("background","#FFFFA3").css("color","#555").css("position","absolute").css("z-index","50000").click(function(){$("#checkBrowser").fadeOut(function(){$(this).remove()})}))}function HeaderWidget(a){_.extend(this,Backbone.Events);var b=this;this.id=Utils.genId("HeaderWidget"),this.targetId,this.height=67,this.accountData,this.appname="My new App",this.description="",this.suiteId=-1,this.news="",this.checkTimeInterval=4e3,this.version="",this.allowLogin=!0,_.extend(this,a),this.adapter=new OpencgaManager,this.onLogin=new Event,this.onLogout=new Event,this.onGetAccountInfo=new Event,this.loginWidget=new LoginWidget(this.suiteId),this.editUserWidget=new ProfileWidget,this.uploadWidget=new UploadWidget({suiteId:this.suiteId}),this.opencgaBrowserWidget=new OpencgaBrowserWidget({suiteId:this.suiteId}),this.loginWidget.onSessionInitiated.addEventListener(function(){b.sessionInitiated(),b.onLogin.notify()}),this.adapter.onLogout.addEventListener(function(a,c){console.log(c),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"}),b.sessionFinished(),b.onLogout.notify()}),this.opencgaBrowserWidget.onNeedRefresh.addEventListener(function(){b.getAccountInfo()}),this.adapter.onGetAccountInfo.addEventListener(function(a,c){null!=c.accountId&&(b.setAccountData(c),b.onGetAccountInfo.notify(c),console.log("accountData has been modified since last call"))}),this.rendered=!1,this.autoRender&&this.render()}function JobListWidget(a){var b=this;UserListWidget.prototype.constructor.call(this,a),this.counter=null;var c=['<tpl for=".">','<div class="joblist-item">','<div style="color:<tpl if="visites == 0">green</tpl><tpl if="visites &gt; 0">blue</tpl><tpl if="visites == -1">red</tpl><tpl if="visites == -2">Darkorange</tpl>">{name}</div>','<div style="color: #15428B"><i>{date}</i></div>','<div style="color:steelblue"><i>{toolName}</i></div>','<div style="color:grey"><i>',"{status}",'<tpl if="visites &gt; -1"> - {visites} views</tpl>',"</i></div>","</div>","</tpl>"],d=["commandLine","date","description","diskUsage","status","finishTime","inputData","jobId","message","name","outputData","ownerId","percentage","projectId","toolName","visites"];this.pagedViewList.storeFields=d,this.pagedViewList.template=c,null!=a.pagedViewList&&(null!=a.pagedViewList.storeFields&&(this.pagedViewList.storeFields=a.pagedViewList.storeFields),null!=a.pagedViewList.template&&(this.pagedViewList.template=a.pagedViewList.template)),this.pagedListViewWidget=new PagedViewListWidget(this.pagedViewList),this.btnAllId=this.id+"_btnAll",this.btnActivePrjId=this.id+"_btnActivePrj",this.btnFinishedId=this.id+"_btnFinished",this.btnVisitedId=this.id+"_btnVisited",this.btnRunningId=this.id+"_btnRunning",this.btnQueuedId=this.id+"_btnQueued",this.projectFilterButton=Ext.create("Ext.button.Button",{id:this.btnActivePrjId,iconCls:"icon-project-all",tooltip:"Toggle jobs from all projects or active project",enableToggle:!0,pressed:!1,listeners:{toggle:function(){b.render()}}}),this.bar=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"jobsFilterBar",dock:"top",items:[{id:this.btnAllId,text:" ",tooltip:"Total jobs"},{id:this.btnFinishedId,text:" ",tooltip:"Finished jobs"},{id:this.btnVisitedId,text:" ",tooltip:"Visited jobs"},{id:this.btnRunningId,text:" ",tooltip:"Running jobs"},{id:this.btnQueuedId,text:" ",tooltip:"Queued jobs"}]}),Ext.getCmp(this.btnAllId).on("click",this.filter,this),Ext.getCmp(this.btnFinishedId).on("click",this.filter,this),Ext.getCmp(this.btnVisitedId).on("click",this.filter,this),Ext.getCmp(this.btnRunningId).on("click",this.filter,this),Ext.getCmp(this.btnQueuedId).on("click",this.filter,this),this.allData=[]}function LoginWidget(a,b){var c=this;this.id="LoginWidget_",this.targetId=null,this.suiteId=a,null!=b&&null!=b.targetId&&(this.targetId=b.targetId),this.onSessionInitiated=new Event(this),this.adapter=new OpencgaManager,this.adapter.onLogin.addEventListener(function(a,b){null!=c.panel&&c.panel.setLoading(!1),console.log(b),null==b.errorMessage?($.cookie("bioinfo_sid",b.sessionId),$.cookie("bioinfo_account",b.accountId),$.cookie("bioinfo_bucket",b.bucketId),c.onSessionInitiated.notify()):(Ext.getCmp(c.labelEmailId).setText('<span class="err">'+b.errorMessage+"</span>",!1),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"}))}),this.adapter.onCreateAccount.addEventListener(function(a,b){c.panel.setLoading(!1),b=b.replace(/^\s+|\s+$/g,""),-1!=b.indexOf("OK")?Ext.getCmp(c.labelEmailId).setText('<span class="ok">Account created</span>',!1):(b=b.replace(/ERROR: /gi," "),Ext.getCmp(c.labelEmailId).setText('<span class="err">Account already exists</span>',!1),$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),$.cookie("bioinfo_account",null),$.cookie("bioinfo_account",null,{path:"/"}))}),this.adapter.onResetPassword.addEventListener(function(a,b){c.panel.setLoading(!1),Ext.getCmp(c.labelEmailId).setText('<span class="emph">'+b+"</span>",!1)}),this.labelEmailId=this.id+"labelEmail",this.labelPassId=this.id+"labelPass",this.fldEmailId=this.id+"fldEmail",this.fldPasswordId=this.id+"fldPassword",this.fldNpass1Id=this.id+"fldNpass1",this.fldNpass2Id=this.id+"fldNpass2",this.btnSignId=this.id+"fldSign",this.btnAnonymousId=this.id+"btnAnonymous",this.btnForgotId=this.id+"btnForgot",this.btnNewaccId=this.id+"btnNewacc",this.btnSendId=this.id+"btnSend",this.btnBackId=this.id+"btnBack",this.btnRegisterId=this.id+"btnRegister"}function OpencgaBrowserWidget(a){var b=this;"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId,this.title=a.title||this.title,this.width=a.width||this.width,this.height=a.height||this.height),this.adapter=new OpencgaManager,this.adapter.onCreateBucket.addEventListener(function(a,c){-1!=c.indexOf("ERROR")?Ext.Msg.alert("Create project","ERROR: could not create this project."):b.onNeedRefresh.notify(),b.panel.setLoading(!1),Ext.getBody().unmask()}),this.uploadWidget=new UploadWidget({suiteId:a.suiteId,opencgaBrowserWidget:this}),this.uploadWidget.adapter.onUploadObjectToBucket.addEventListener(function(a,c){"done"==c.status&&b.onNeedRefresh.notify()}),this.searchFieldId=this.id+"_searchField"}function PagedViewListWidget(a){var b=this;this._data=null,this.id="PagedViewListWidget_"+Math.round(1e4*Math.random()),this.targetId=null,this.pageSize=6,this.storeFields=new Object,this.template=new Object,this.width=280,this.height=550,this.title="",this.order=0,this.border=0,this.mode="view",this.sort="DESC",null!=a&&(null!=a.pageSize&&(this.pageSize=a.pageSize),null!=a.storeFields&&(this.storeFields=a.storeFields),null!=a.template&&(this.template=a.template),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.title&&(this.title=a.title),null!=a.order&&(this.order=a.order),null!=a.border&&(this.border=a.border),null!=a.mode&&(this.mode=a.mode)),this.currentPage=1,this.pageFieldId=this.id+"_pageField",this.pageLabelId=this.id+"_pageLabel",this.pagbarId=this.id+"_pagbar",this.panelId=this.id+"_panel",this.onItemClick=new Event(this),this.textFilterFunction=function(a){var c=Ext.getCmp(b.id+"searchField").getValue().toLowerCase();return a.data.name.toLowerCase().indexOf(c)<0?!1:!0}}function ProfileWidget(a){var b=this;this.id="EditUserWidget_"+Math.round(1e4*Math.random()),this.targetId=null,"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId),this.adapter=new OpencgaManager,this.adapter.onChangePassword.addEventListener(function(a,c){b.panel.setLoading(!1),-1==c.indexOf("ERROR")&&(Ext.getCmp(b.id+"fldOld").setValue(null),Ext.getCmp(b.id+"fldNew1").setValue(null),Ext.getCmp(b.id+"fldNew2").setValue(null)),Ext.getCmp(b.id+"labelPass").setText('<span class="info">'+c+"</span>",!1)}),this.adapter.onChangeEmail.addEventListener(function(a,c){b.panel.setLoading(!1),-1==c.indexOf("ERROR")&&(Ext.getCmp(b.id+"fldEmail").setValue(null),Ext.getCmp(b.id+"fldEmail").setFieldLabel("e-mail",!1)),Ext.getCmp(b.id+"labelPass").setText('<span class="info">'+c+"</span>",!1)})}function ResultTable(a,b,c,d){var e=this;this.id="ResultTable"+Math.round(1e7*Math.random()),this.targetId=null,this.jobId=a,this.fileName=b,this.tags=c,this.numRows=10,this.flex=null,this.collapsible=!0,this.border=!0,this.cls=null,"undefined"!=typeof d&&(this.targetId=d.targetId||this.targetId,this.numRows=d.numRows||this.numRows,this.flex=d.flex||this.flex,this.collapsible=d.collapsible||this.collapsible,this.border=d.border||this.border,this.cls=d.cls||this.cls,this.tableLayout=d.tableLayout||this.tableLayout),this.adapter=new OpencgaManager,this.table=null,this.onRendered=new Event,this.onRendered.addEventListener(function(){e.draw()})}function ResultWidget(a){var b=this;this.id="ResultWidget"+Math.round(1e4*Math.random()),this.targetId=null,null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.application&&(this.application=a.application),null!=a.app&&(this.app=a.app)),this.adapter=new OpencgaManager,this.adapter.onJobResult.addEventListener(function(a,c){b.data=JSON.parse(c),Ext.getBody().unmask(),b.panel.setLoading(!1),b.render()}),this.panelId=null,this.networkViewerId=null,this.genomeMapsId=null,this.resultTables=new Object,this.resultHistograms=new Object,this.resultGCharts=new Object,this.variantFiles=new Object,this.onViewRendered=new Event,this.onViewRendered.addEventListener(function(){b.drawTables(),b.drawHistograms(),b.drawGCharts(),b.drawApplicationItems()})}function ResultWidget(a){"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId,this.application=a.application||this.application,this.app=a.app||this.app),this.adapter=new OpencgaManager,this.panelId=null,this.networkViewerId=null,this.genomeMapsId=null}function UploadWidget(a){var b=this;this.id=Utils.genId("uploadWidget"),this.targetId=null,this.suiteId=null,"undefined"!=typeof a&&(this.targetId=a.targetId||this.targetId,this.suiteId=a.suiteId||this.suiteId,this.opencgaBrowserWidget=a.opencgaBrowserWidget||this.opencgaBrowserWidget),this.adapter=new OpencgaManager,this.adapter.onUploadObjectToBucket.addEventListener(function(a,c){"done"==c.status?(console.log(b.objectID),b.uploadComplete(c.data)):"fail"==c.status&&b.uploadFailed(c.data)}),this.uploadButtonId=this.id+"_uploadButton",this.uploadFieldId=this.id+"_uploadField",this.selectedDataType=null}UserListWidget.prototype.draw=function(){var a=this;this.getResponse(),this.interval=setInterval(function(){a.getResponse()},this.timeout)},UserListWidget.prototype.getData=function(){return this.data},UserListWidget.prototype.getCount=function(){return this.data.length},UserListWidget.prototype.getResponse=function(){throw"abstract method must be implemented in child classes"},UserListWidget.prototype.render=function(){throw"abstract method must be implemented in child classes"},GenericFormPanel.prototype.draw=function(a){return null==a||"window"!=a.type?Ext.create("Ext.container.Container",{id:this.panelId,title:a.title,closable:!0,defaults:{margin:30},autoScroll:!0,items:this.getForm()}):(Ext.create("Ext.ux.Window",{title:a.title||"",resizable:a.resizable||!1,width:a.width||500,height:a.height,overflowY:"auto",taskbar:a.taskbar,items:this.getForm()}).show(),void 0)},GenericFormPanel.prototype.getForm=function(){if(null==this.form){var a=this.getPanels();a.push(this.getJobPanel()),a.push(this.getRunButton()),this.form=Ext.create("Ext.form.Panel",{border:!1,bodyPadding:"5",width:"95%",layout:"vbox",items:a})}return this.form},GenericFormPanel.prototype.getPanels=function(){},GenericFormPanel.prototype.getJobPanel=function(){var a=Ext.create("Ext.form.field.Text",{id:"jobname",name:"jobname",fieldLabel:"Name",emptyText:"Job name",allowBlank:!1,margin:"5 0 0 5"}),b=Ext.create("Ext.form.field.TextArea",{id:"jobdescription",name:"jobdescription",fieldLabel:"Description",emptyText:"Description",margin:"5 0 0 5"}),c=this.createOpencgaBrowserCmp({fieldLabel:"Folder:",dataParamName:"outdir",mode:"folderSelection",btnMargin:"0 0 0 66",defaultFileLabel:"Default job folder",allowBlank:!0}),d=Ext.create("Ext.panel.Panel",{title:"Job",border:!0,bodyPadding:"5",margin:"0 0 5 0",width:"99%",buttonAlign:"center",items:[a,b,c]});return d},GenericFormPanel.prototype.getRunButton=function(){var a=this;return Ext.create("Ext.button.Button",{text:"Run",width:300,height:35,disabled:!0,formBind:!0,handler:function(){var b=a.getForm().getForm().getValues();for(var c in b)a.paramsWS[c]=b[c];a.beforeRun(),a.run()}})},GenericFormPanel.prototype.setAccountParams=function(){this.paramsWS.sessionid=$.cookie("bioinfo_sid"),this.paramsWS.accountid=$.cookie("bioinfo_account")},GenericFormPanel.prototype.beforeRun=function(){},GenericFormPanel.prototype.run=function(){this.setAccountParams(),""===this.paramsWS.outdir?delete this.paramsWS.outdir:console.log(this.paramsWS.outdir),this.testing||this.opencgaManager.runAnalysis(this.analysis,this.paramsWS),Ext.example.msg("Job Launched","It will be listed soon"),console.log(this.paramsWS)},GenericFormPanel.prototype.createCombobox=function(a,b,c,d,e,f){return Ext.create("Ext.form.field.ComboBox",{id:a,name:a,fieldLabel:b,store:c,queryMode:"local",displayField:"name",valueField:"value",value:c.getAt(d).get("value"),labelWidth:e,margin:f,editable:!1,allowBlank:!1})},GenericFormPanel.prototype.createCheckBox=function(a,b,c,d,e){return Ext.create("Ext.form.field.Checkbox",{id:a,name:a,boxLabel:b,checked:c||!1,disabled:e,margin:d||"0 0 0 0"})},GenericFormPanel.prototype.createRadio=function(a,b,c,d){var e=Ext.create("Ext.form.field.Radio",{id:a+"_"+this.id,boxLabel:a,inputValue:a,checked:c,name:b,hidden:d});return e},GenericFormPanel.prototype.createLabel=function(a,b){var c=Ext.create("Ext.form.Label",{id:a+"_"+this.id,margin:b||"15 0 0 0",html:'<span class="emph">'+a+"</span>"});return c},GenericFormPanel.prototype.createTextFields=function(a){var b=Ext.create("Ext.form.field.Text",{id:a+"_"+this.id,fieldLabel:a,name:a});return b},GenericFormPanel.prototype.createOpencgaBrowserCmp=function(a){var b=this,c=Ext.create("Ext.button.Button",{text:"Browse...",margin:a.btnMargin||"0 0 0 10",handler:function(){b.opencgaBrowserWidget.allowedTypes=a.allowedTypes,null!=a.beforeClick&&a.beforeClick();var c=b.opencgaBrowserWidget.onSelect.addEventListener(function(a,f){d.setText('<span class="emph">'+f.bucketId+"/"+f.id+"</span>",!1),e.setValue(f.bucketId+":"+f.id.replace(/\//g,":")),b.opencgaBrowserWidget.onSelect.removeEventListener(c)});b.opencgaBrowserWidget.draw(a.mode)}}),d=Ext.create("Ext.form.Label",{id:a.dataParamName,text:a.defaultFileLabel||"No file selected",margin:"5 0 0 15"}),e=Ext.create("Ext.form.field.Text",{id:a.dataParamName+"hidden",name:a.dataParamName,hidden:!0,allowBlank:a.allowBlank||!1,margin:"5 0 0 15"});return Ext.create("Ext.container.Container",{margin:"5 0 5 0",items:[{xtype:"label",text:a.fieldLabel,margin:"5 0 0 5"},c,d,e]})},OpencgaManager.prototype={host:"http://ws.bioinfo.cipf.es/opencga/rest",getHost:function(){return this.host},setHost:function(a){this.host=a},doGet:function(a,b,c){$.ajax({type:"GET",url:a,cache:!1,success:b,error:c})},doPost:function(a,b,c,d){$.ajax({type:"POST",url:a,data:b,processData:!1,contentType:!1,success:c,error:d})},getQuery:function(a){var b="";for(var c in a)null!=a[c]&&(b+=c+"="+a[c]+"&");return""!=b&&(b="?"+b.slice(0,-1)),b},getAccountUrl:function(a){return this.getHost()+"/account/"+a},getStorageUrl:function(a){return this.getAccountUrl(a)+"/storage"},getAdminProfileUrl:function(a){return this.getAccountUrl(a)+"/admin/profile"},getAdminBucketUrl:function(a,b){return this.getAccountUrl(a)+"/admin/bucket/"+b},getAdminProjectUrl:function(a,b){return this.getAccountUrl(a)+"/admin/project/"+b},getBucketUrl:function(a,b){return this.getStorageUrl(a)+"/"+b},getObjectUrl:function(a,b,c){return this.getStorageUrl(a)+"/"+b+"/"+c},getAnalysisUrl:function(a,b){return this.getAccountUrl(a)+"/analysis/"+b},getJobAnalysisUrl:function(a,b){return this.getAccountUrl(a)+"/analysis/job/"+b},createAccount:function(a,b,c,d,e){function f(a){h.onCreateAccount.notify(a)}function g(a){console.log("ERROR: "+a)}var h=this,i={name:c,email:b,password:d,suiteid:e},j=this.getAccountUrl(a)+"/create"+this.getQuery(i);this.doGet(j,f,g)},login:function(a,b,c){function d(a){-1==a.indexOf("ERROR")?f.onLogin.notify(JSON.parse(a)):f.onLogin.notify({errorMessage:a})}function e(a){console.log("ERROR: "+a)}var f=this,g={password:b,suiteid:c},h=this.getAccountUrl(a)+"/login"+this.getQuery(g);this.doGet(h,d,e)},logout:function(a,b){function c(a){e.onLogout.notify(a)}function d(a){$.cookie("bioinfo_sid",null),$.cookie("bioinfo_sid",null,{path:"/"}),console.log("ERROR: "+a)}var e=this,f={sessionid:b},g=this.getAccountUrl(a)+"/logout"+this.getQuery(f);this.doGet(g,c,d)},getAccountInfo:function(a,b,c){function d(a){-1==a.indexOf("ERROR")?f.onGetAccountInfo.notify(JSON.parse(a)):console.log(a)}function e(a){console.log("ERROR: "+a),console.log(a)}console.log(c);var f=this,g={last_activity:c,sessionid:b},h=this.getAccountUrl(a)+"/info"+this.getQuery(g);this.doGet(h,d,e)},changePassword:function(a,b,c,d,e){function f(a){h.onChangePassword.notify(a)}function g(a){console.log("ERROR: "+a)}var h=this,i={old_password:c,new_password1:d,new_password2:e,sessionid:b},j=this.getAdminProfileUrl(a)+"/change_password"+this.getQuery(i);this.doGet(j,f,g)},resetPassword:function(a,b){function c(a){e.onResetPassword.notify(a)}function d(a){console.log("ERROR: "+a)}var e=this,f={email:b},g=this.getAdminProfileUrl(a)+"/reset_password"+this.getQuery(f);this.doGet(g,c,d)},changeEmail:function(a,b,c){function d(a){f.onChangeEmail.notify(a)}function e(a){console.log("ERROR: "+a)}var f=this,g={new_email:c,sessionid:b},h=this.getAdminProfileUrl(a)+"/change_email"+this.getQuery(g);this.doGet(h,d,e)},getBuckets:function(){return"TODO"},createBucket:function(a,b,c,d){function e(a){g.onCreateBucket.notify(a)}function f(a){console.log("ERROR: "+a)}var g=this,h={description:b,sessionid:d},i=this.getAdminBucketUrl(c,a)+"/create"+this.getQuery(h);this.doGet(i,e,f)},refreshBucket:function(a,b,c){function d(a){f.onRefreshBucket.notify(a)}function e(a){console.log("ERROR: "+a)}var f=this,g={sessionid:c},h=this.getAdminBucketUrl(a,b)+"/refresh"+this.getQuery(g);this.doGet(h,d,e),console.log(h)},renameBucket:function(a,b,c,d){function e(a){g.onRenameBucket.notify(a)}function f(a){console.log("ERROR: "+a)}var g=this,h={sessionid:d},i=this.getAdminBucketUrl(a,b)+"/rename/"+c+this.getQuery(h);this.doGet(i,e,f),console.log(i)},deleteBucket:"TODO",shareBucket:"TODO",uploadObjectToBucket:function(a,b,c,d,e,f){function g(a){console.log(a),i.onUploadObjectToBucket.notify({status:"done",data:a})}function h(a){i.onUploadObjectToBucket.notify({status:"fail",data:a})}var i=this,j={parents:f||!1,sessionid:b},k=this.getObjectUrl(a,c,d)+"/upload"+this.getQuery(j);this.doPost(k,e,g,h)},createDirectory:function(a,b,c,d,e){function f(a){console.log(a),h.onCreateDirectory.notify(a)}function g(a){console.log("ERROR: "+a)}d=d.replace(new RegExp("/","gi"),":");var h=this,i={parents:e||!1,sessionid:b},j=this.getObjectUrl(a,c,d)+"/create_directory"+this.getQuery(i);this.doGet(j,f,g)},deleteObjectFromBucket:function(a,b,c,d){function e(a){console.log(a),g.onDeleteObjectFromBucket.notify(a)}function f(a){console.log("ERROR: "+a)}d=d.replace(new RegExp("/","gi"),":");var g=this,h={sessionid:b},i=this.getObjectUrl(a,c,d)+"/delete"+this.getQuery(h);this.doGet(i,e,f)},region:function(a,b,c,d,e,f){function g(a){-1==a.substr(0,5).indexOf("ERROR")&&i.onRegion.notify({resource:f.category,result:JSON.parse(a),filename:d,query:e,params:f})}function h(a){console.log("ERROR: "+a),console.log(a)}d=d.replace(new RegExp("/","gi"),":");var i=this;if(f.sessionid=b,f.region=e,f.cellbasehost=CELLBASE_HOST+"/"+CELLBASE_VERSION,-1!=this.host.indexOf("localhost")){f.region=e,f.filepath=d;var j=this.host+"/storage/fetch"+this.getQuery(f)}else var j=this.getObjectUrl(a,c,d)+"/fetch"+this.getQuery(f);this.doGet(j,g,h),console.log(j)},jobResult:function(a,b,c){function d(a){f.onJobResult.notify(a)}function e(a){console.log("ERROR: "+a)}var f=this,g={sessionid:b},h=this.getJobAnalysisUrl(a,c)+"/result.js"+this.getQuery(g);this.doGet(h,d,e),console.log(h)},jobResultUrl:function(a,b,c){var d={sessionid:b};return this.getJobAnalysisUrl(a,c)+"/result.js"+this.getQuery(d)},jobStatus:function(a,b,c){function d(a){f.onJobStatus.notify(a)}function e(a){console.log("ERROR: "+a)}var f=this,g={sessionid:b},h=this.getJobAnalysisUrl(a,c)+"/status"+this.getQuery(g);this.doGet(h,d,e),console.log(h)},table:function(a,b,c,d,e,f){function g(a){i.onTable.notify(a)}function h(a){console.log("ERROR: "+a)}var i=this,j={filename:d,colNames:e,colVisibility:f,sessionid:b},k=this.getJobAnalysisUrl(a,c)+"/table"+this.getQuery(j);this.doGet(k,g,h)},tableurl:function(a,b,c,d,e,f){var g={filename:d,colNames:e,colVisibility:f,sessionid:b};return this.getJobAnalysisUrl(a,c)+"/table"+this.getQuery(g)},poll:function(a,b,c,d,e){function f(a){i.onPoll.notify(a)}function g(a){console.log("ERROR: "+a)}var h,i=this,j={filename:d,sessionid:b};1==e?(h=this.getJobAnalysisUrl(a,c)+"/poll"+this.getQuery(j),open(h)):(j.zip=!1,h=this.getJobAnalysisUrl(a,c)+"/poll"+this.getQuery(j),this.doGet(h,f,g))},pollurl:function(a,b,c,d){var e={filename:d,sessionid:b,zip:!1};return this.getJobAnalysisUrl(a,c)+"/poll"+this.getQuery(e)},deleteJob:function(a,b,c){function d(a){f.onDeleteJob.notify(a)}function e(a){console.log("ERROR: "+a)}var f=this,g={sessionid:b},h=this.getJobAnalysisUrl(a,c)+"/delete"+this.getQuery(g);this.doGet(h,d,e)},downloadJob:function(a,b,c){var d={sessionid:b};open(this.getJobAnalysisUrl(a,c)+"/download"+this.getQuery(d))},runAnalysis:function(a,b){function c(a){e.onRunAnalysis.notify({status:"done",data:a})}function d(a){e.onRunAnalysis.notify({status:"fail",data:a})}var e=this,f=b.accountid,g={},h=this.getAnalysisUrl(f,a)+"/run"+this.getQuery(g);console.log(h),console.log(b),$.ajax({type:"POST",url:h,data:b,success:c,error:d})},indexer:function(a,b,c,d){function e(a){g.onIndexer.notify(a)}function f(a){g.onIndexer.notify(a)}var g=this,h={sessionid:b},i=this.getObjectUrl(a,c,d)+"/index"+this.getQuery(h);console.log(i),this.doGet(i,e,f)},indexerStatus:function(a,b,c,d,e){function f(a){h.onIndexerStatus.notify(a)}function g(a){h.onIndexerStatus.notify(a)}var h=this,i={sessionid:b,indexerid:e},j=this.getObjectUrl(a,c,d)+"/index_status"+this.getQuery(i);console.log(j),this.doGet(j,f,g)},localFileList:function(){function a(a){c.onLocalFileList.notify(a)}function b(a){c.onLocalFileList.notify(a)}var c=this,d=this.host+"/getdirs";console.log(d),this.doGet(d,a,b)}},HeaderWidget.prototype={setAccountData:function(a){this.accountData=a,this.opencgaBrowserWidget.setAccountData(a),Ext.getCmp(this.id+"textUser").setText(this._getAccountText())},getAccountInfo:function(){var a=null;null!=this.accountData&&(a=this.accountData.lastActivity),$.cookie("bioinfo_account")?this.adapter.getAccountInfo($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),a):(console.log("cookie: bioinfo_account, is not set, session will be finished..."),this.sessionFinished())},_getAccountText:function(){var a=this.accountData.accountId;return-1!=a.indexOf("anonymous_")&&(a="anonymous"),'logged in as <span style="color:darkred">'+a+"</span>"},sessionInitiated:function(){var a=this;this.loginWidget.clean(),Ext.getCmp(this.id+"btnSignin").hide(),Ext.getCmp(this.id+"btnLogout").show(),Ext.getCmp(this.id+"btnEdit").show(),Ext.getCmp(this.id+"btnOpencga").show(),this.accountInfoInterval||(this.getAccountInfo(),this.accountInfoInterval=setInterval(function(){a.getAccountInfo()},this.checkTimeInterval))},sessionFinished:function(){Ext.getCmp(this.id+"btnOpencga").hide(),Ext.getCmp(this.id+"btnLogout").hide(),Ext.getCmp(this.id+"btnEdit").hide(),Ext.getCmp(this.id+"btnSignin").show(),Ext.getCmp(this.id+"textUser").setText(""),clearInterval(this.accountInfoInterval),delete this.accountInfoInterval},setDescription:function(a){$("#"+this.id+"description").html(a)},draw:function(){return this.rendered?(null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished(),void 0):(console.info("Header Widget is not rendered yet"),void 0)},getPanel:function(){return this.draw(),this.panel},setWidth:function(a){this.width=a,this.getPanel().setWidth(a),this.getPanel().updateLayout()},render:function(a){var b=this;if(this.targetId=a?a:this.targetId,$("#"+this.targetId).length<1)return console.log("targetId not found in DOM"),void 0;if(null==this.panel){switch(this.suiteId){case 11:this.homeLink="http://renato.bioinfo.cipf.es",this.helpLink="http://bioinfo.cipf.es/docs/renato/",this.tutorialLink="http://bioinfo.cipf.es/docs/renato/tutorial",this.aboutText="";break;case 6:this.homeLink="http://variant.bioinfo.cipf.es",this.helpLink="http://docs.bioinfo.cipf.es/projects/variant",this.tutorialLink="http://docs.bioinfo.cipf.es/projects/variant/wiki/Tutorial",this.aboutText="";break;case 9:this.homeLink="http://www.genomemaps.org",this.helpLink="http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:overview",this.tutorialLink="http://wiki.opencb.org/projects/visualization/doku.php?id=genome-maps:tutorial",this.aboutText='Genome Maps is built with open and free technologies like HTML5 and SVG inline, so no plug-in is needed in modern internet browsers. Weâ€™ve focused on providing the best user experience possible with a modern drag navigation and many features included.<br><br>Genome Maps project has been developed in the <b>Computational Biology Unit</b> led by <b>Ignacio Medina</b>, at <b>Computational Genomic Institute</b> led by <b>Joaquin Dopazo</b> at CIPF. Two people from my lab deserve special mention for their fantastic job done: <br><b>Franscisco Salavert</b> and <b>Alejandro de Maria</b>.<br><br>Genome Maps has been designed to be easily be embedded in any project with a couple of lines of code, and it has been implemented as a plugin framework to extend the standard features.<br><br>Supported browsers include: Google Chrome 14+, Apple Safari 5+, Opera 12+ and Mozilla Firefox 14+ (works slower than in the other browsers). Internet Explorer 10 is under RC and seems to work properly.<br><br>For more information or suggestions about Genome Maps please contact <br><b>Ignacio Medina</b>:  <span class="info">imedina@cipf.es</span>';break;case 10:this.homeLink="http://www.cellbrowser.org",this.helpLink="http://docs.bioinfo.cipf.es/projects/cellbrowser",this.tutorialLink="http://docs.bioinfo.cipf.es/projects/cellbrowser/wiki/Tutorial",this.aboutText="";break;case 12:this.homeLink="http://bioinfo.cipf.es/apps/untbgen",this.helpLink="http://bioinfo.cipf.es/ecolopy/",this.tutorialLink="http://bioinfo.cipf.es/ecolopy/",this.aboutText="";break;case 22:this.homeLink="http://pathiways.bioinfo.cipf.es",this.helpLink="http://bioinfo.cipf.es/pathiways",this.tutorialLink="http://bioinfo.cipf.es/pathiways/tutorial",this.aboutText='PATHiWAYS is built with open and free technologies like HTML5 and SVG inline, so no plug-in is needed in modern internet browsers<br><br>PATHiWAYS project has been developed in the <b>Computational Biology Unit</b>, at <b>Computational Medicine Institute</b> at CIPF in Valencia, Spain.<br><br>For more information please visit our web page  <span class="info"><a target="_blank" href="http://bioinfo.cipf.es">bioinfo.cipf.es</a></span>';break;default:this.homeLink="http://docs.bioinfo.cipf.es",this.helpLink="http://docs.bioinfo.cipf.es",this.tutorialLink="http://docs.bioinfo.cipf.es",this.aboutText=""}var c=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"linkbar",dock:"top",cls:"bio-linkbar",height:40,minHeight:40,maxHeight:40,items:[{xtype:"tbtext",id:this.id+"speciesTextItem",text:""},{xtype:"tbtext",id:this.id+"assemblyTextItem",text:""},"->",{id:this.id+"homeButton",text:"home",handler:function(){window.location.href=b.homeLink}},{id:this.id+"helpButton",text:"documentation",handler:function(){window.open(b.helpLink)}},{id:this.id+"tutorialButton",text:"tutorial",handler:function(){window.open(b.tutorialLink)}},{id:this.id+"aboutButton",text:"about",handler:function(){Ext.create("Ext.window.Window",{id:b.id+"aboutWindow",bodyStyle:"background:#fff; color:#333;",bodyPadding:10,title:"About",height:340,width:500,modal:!0,layout:"fit",html:b.aboutText}).show()}}]}),d=new Ext.create("Ext.toolbar.Toolbar",{id:this.id+"userbar",dock:"top",border:!1,cls:"gm-login-bar",height:27,minHeight:27,maxHeight:27,layout:"hbox",items:[{xtype:"tbtext",id:this.id+"textNews",text:this.news},"->",{xtype:"tbtext",id:this.id+"textUser",text:""},{id:this.id+"btnOpencga",text:'<span class="emph">Upload & Manage</span>',iconCls:"icon-project-manager",handler:function(){b.opencgaBrowserWidget.draw("manager")}},{id:this.id+"btnSignin",disabled:!this.allowLogin,text:'<span class="emph">sign in</span>',handler:function(){b.loginWidget.draw()}},{id:this.id+"btnEdit",text:'<span class="emph">profile</span>',handler:function(){b.editUserWidget.draw()
}},{id:this.id+"btnLogout",text:'<span class="emph">logout</span>',handler:function(){b.adapter.logout($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"))}}]});this.panel=Ext.create("Ext.panel.Panel",{id:this.id+"panel",region:"north",border:!1,renderTo:this.targetId,height:this.height,minHeight:this.height,maxHeigth:this.height,layout:"hbox",items:[{xtype:"container",items:[{id:this.id+"appTextItem",xtype:"tbtext",margin:"25 0 0 20",text:'<span class="appName">'+this.appname+"</span> "+'<span id="'+this.id+'description" class="appDesc">'+this.description+"</span>"+'<span id="'+this.id+'version" class="appVersion"></span>',padding:"0 0 0 10",listeners:{afterrender:function(){$("#"+b.id+"appTextItem").qtip({content:'<span class="info">'+b.version+"</span>",position:{my:"bottom center",at:"top center",adjust:{y:12,x:-25}}})}}}]},{xtype:"container",flex:2,layout:{type:"vbox",align:"right"},items:[d,c]}]})}this.rendered=!0}},JobListWidget.prototype.draw=UserListWidget.prototype.draw,JobListWidget.prototype.getData=UserListWidget.prototype.getData,JobListWidget.prototype.getCount=UserListWidget.prototype.getCount,JobListWidget.prototype.show=function(){this.pagedListViewWidget.show()},JobListWidget.prototype.hide=function(){this.pagedListViewWidget.hide()},JobListWidget.prototype.draw=function(){},JobListWidget.prototype.clean=function(){clearInterval(this.interval),1==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).removeDocked(this.bar,!1),this.pagedListViewWidget.clean()},JobListWidget.prototype.setAccountData=function(a){this.accountData=a,console.log("joblistwidget");for(var b,c=[],d=0;d<this.accountData.projects.length;d++)for(var e=0;e<this.accountData.projects[d].jobs.length;e++)b=this.accountData.projects[d].jobs[e],-1!=this.tools.indexOf(b.toolName)&&(b.date=Utils.parseDate(b.date),c.push(b));this.data=c,this.render()},JobListWidget.prototype.render=function(){this.pagedListViewWidget.draw(this.getData()),0==this.bar.isDescendantOf(Ext.getCmp(this.pagedListViewWidget.panelId))&&Ext.getCmp(this.pagedListViewWidget.panelId).addDocked(this.bar);var a=this.getJobCounter();0==a.all?Ext.getCmp(this.btnAllId).hide():Ext.getCmp(this.btnAllId).show(),0==a.finished?Ext.getCmp(this.btnFinishedId).hide():Ext.getCmp(this.btnFinishedId).show(),0==a.visited?Ext.getCmp(this.btnVisitedId).hide():Ext.getCmp(this.btnVisitedId).show(),0==a.running?Ext.getCmp(this.btnRunningId).hide():Ext.getCmp(this.btnRunningId).show(),0==a.queued?Ext.getCmp(this.btnQueuedId).hide():Ext.getCmp(this.btnQueuedId).show(),Ext.getCmp(this.btnAllId).setText('<b style="color:black;font-size: 1.3em;">'+a.all+"</b>"),Ext.getCmp(this.btnFinishedId).setText('<b style="color:green;font-size: 1.3em;">'+a.finished+"</b>"),Ext.getCmp(this.btnVisitedId).setText('<b style="color:blue;font-size: 1.3em;">'+a.visited+"</b>"),Ext.getCmp(this.btnRunningId).setText('<b style="color:red;font-size: 1.3em;">'+a.running+"</b>"),Ext.getCmp(this.btnQueuedId).setText('<b style="color:Darkorange;font-size: 1.3em;">'+a.queued+"</b>")},JobListWidget.prototype.getJobCounter=function(){for(var a=0,b=0,c=0,d=0,e=0;e<this.getData().length;e++)this.getData()[e].visites>0?b++:(0==this.getData()[e].visites&&a++,-1==this.getData()[e].visites&&c++,-2==this.getData()[e].visites&&d++);return{all:this.getData().length,visited:b,finished:a,running:c,queued:d}},JobListWidget.prototype.filter=function(a){switch(a.id){case this.btnFinishedId:this.pagedListViewWidget.setFilter(function(a){return 0==a.data.visites});break;case this.btnVisitedId:this.pagedListViewWidget.setFilter(function(a){return a.data.visites>0});break;case this.btnRunningId:this.pagedListViewWidget.setFilter(function(a){return-1==a.data.visites});break;case this.btnQueuedId:this.pagedListViewWidget.setFilter(function(a){return-2==a.data.visites});break;default:this.pagedListViewWidget.setFilter(function(){return!0})}this.pagedListViewWidget.draw(this.getData())},JobListWidget.prototype.selectProjectData=function(){if(this.projectFilterButton.pressed){for(var a=new Array,b=0;b<this.allData.length;b++)if(null!=this.allData[b].jobs)for(var c=0;c<this.allData[b].jobs.length;c++)a.push(this.allData[b].jobs[c]);this.data=a}else for(var b=0;b<this.allData.length;b++)if(this.allData[b].active){this.data=this.allData[b].jobs;break}null==this.data&&(this.data=[]),this.pagedListViewWidget.draw(this.getData())},LoginWidget.prototype.sign=function(){Ext.getCmp(this.btnAnonymousId).getValue()?(this.anonymousSign(),this.panel.setLoading("Waiting server...")):this.checkAccountId()&&(this.adapter.login(this.getLogin(),this.getPassword(),this.suiteId),this.panel.setLoading("Waiting server..."),$.cookie("bioinfo_user",null,{path:"/"}),$.cookie("bioinfo_user",this.getLogin(),{expires:7}))},LoginWidget.prototype.anonymousSign=function(){this.adapter.login("anonymous","",this.suiteId)},LoginWidget.prototype.register=function(){this.checkAccountId()&&this.checkemail()&&this.checkName()&&this.checkpass()?this.adapter.createAccount(this.getLogin(),this.getEmail(),this.getAccountName(),this.getPasswordReg(),this.suiteId):Ext.getCmp(this.labelEmailId).setText('<span class="info">Fill all fields</span>',!1)},LoginWidget.prototype.sendRecover=function(){this.checkAccountId()&&this.checkemail()&&(this.adapter.resetPassword(this.getLogin(),this.getEmail()),this.panel.setLoading("Waiting server..."))},LoginWidget.prototype.getLogin=function(){return Ext.getCmp(this.id+"accountId").getValue()},LoginWidget.prototype.getAccountName=function(){return Ext.getCmp(this.id+"accountName").getValue()},LoginWidget.prototype.getEmail=function(){return Ext.getCmp(this.fldEmailId).getValue()},LoginWidget.prototype.getPassword=function(){return $.sha1(Ext.getCmp(this.fldPasswordId).getValue())},LoginWidget.prototype.getPasswordReg=function(){return $.sha1(Ext.getCmp(this.fldNpass1Id).getValue())},LoginWidget.prototype.draw=function(){this.render()},LoginWidget.prototype.clean=function(){null!=this.panel&&this.panel.destroy()},LoginWidget.prototype.render=function(){var a=this;if(null==this.panel){var b=Ext.create("Ext.toolbar.TextItem",{id:this.labelEmailId,padding:3,text:'<span class="info">Type your account ID and password</span>'});this.pan=Ext.create("Ext.form.Panel",{id:this.id+"formPanel",bodyPadding:20,width:350,height:145,border:!1,bbar:{items:[b]},items:[{id:this.id+"accountId",xtype:"textfield",value:$.cookie("bioinfo_user"),fieldLabel:"account ID",hidden:!1,listeners:{scope:this,change:this.checkAccountId}},{id:this.fldPasswordId,xtype:"textfield",fieldLabel:"password",inputType:"password",listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a.sign()}}},{id:this.fldEmailId,xtype:"textfield",fieldLabel:"e-mail",hidden:!0,listeners:{change:function(){a.checkemail()},specialkey:function(b,c){c.getKey()==c.ENTER&&a.sign()}}},{id:this.id+"accountName",xtype:"textfield",fieldLabel:"name",hidden:!0,listeners:{scope:this,change:this.checkName}},{id:this.fldNpass1Id,xtype:"textfield",fieldLabel:"password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.fldNpass2Id,xtype:"textfield",fieldLabel:"re-password",inputType:"password",hidden:!0,listeners:{scope:this,change:this.checkpass}},{id:this.btnAnonymousId,xtype:"checkboxfield",padding:"10 0 0 0",boxLabel:'Anonymous login <p class="tip s90">Your work will be lost after logout</p>',margin:"0 0 0 50",listeners:{change:function(b,c){c?(Ext.getCmp(a.id+"accountId").disable(),Ext.getCmp(a.fldPasswordId).disable()):(Ext.getCmp(a.id+"accountId").enable(),Ext.getCmp(a.fldPasswordId).enable())}}}]}),this.panel=Ext.create("Ext.window.Window",{id:this.id+"windowPanel",title:"Sign in",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,items:[this.pan],buttonAlign:"center",buttons:[{id:this.btnSignId,text:"Sign in"},{id:this.btnForgotId,text:"Forgot yout password?",width:130,minWidth:130},{id:this.btnNewaccId,text:"New account",width:100,minWidth:100},{id:this.btnSendId,text:"Send",hidden:!0},{id:this.btnRegisterId,text:"Register",hidden:!0},{id:this.btnBackId,text:"Back",hidden:!0}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),Ext.getCmp(this.btnForgotId).on("click",this.ShowForgot,this),Ext.getCmp(this.btnBackId).on("click",this.ShowBack,this),Ext.getCmp(this.btnNewaccId).on("click",this.ShowNewacc,this),Ext.getCmp(this.btnSignId).on("click",this.sign,this),Ext.getCmp(this.btnSendId).on("click",this.sendRecover,this),Ext.getCmp(this.btnRegisterId).on("click",this.register,this),Ext.getCmp(this.btnAnonymousId).on("change",this.anonymousSelected,this)}this.panel.show()},LoginWidget.prototype.ShowForgot=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).show(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and email to send a new password</span>',!1),Ext.getCmp(this.id+"formPanel").setHeight(145),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1)},LoginWidget.prototype.ShowBack=function(){Ext.getCmp(this.fldEmailId).hide(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).show(),Ext.getCmp(this.btnAnonymousId).show(),Ext.getCmp(this.fldNpass1Id).hide(),Ext.getCmp(this.fldNpass2Id).hide(),Ext.getCmp(this.btnSignId).show(),Ext.getCmp(this.btnForgotId).show(),Ext.getCmp(this.btnNewaccId).show(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).hide(),Ext.getCmp(this.btnRegisterId).hide(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").hide(),Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1),Ext.getCmp(this.id+"formPanel").setHeight(145),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1)},LoginWidget.prototype.ShowNewacc=function(){Ext.getCmp(this.fldEmailId).reset(),Ext.getCmp(this.fldEmailId).show(),Ext.getCmp(this.fldPasswordId).reset(),Ext.getCmp(this.btnAnonymousId).reset(),Ext.getCmp(this.fldNpass1Id).reset(),Ext.getCmp(this.fldNpass2Id).reset(),Ext.getCmp(this.fldPasswordId).hide(),Ext.getCmp(this.btnAnonymousId).hide(),Ext.getCmp(this.fldNpass1Id).show(),Ext.getCmp(this.fldNpass2Id).show(),Ext.getCmp(this.btnSignId).hide(),Ext.getCmp(this.btnForgotId).hide(),Ext.getCmp(this.btnNewaccId).hide(),Ext.getCmp(this.btnSendId).hide(),Ext.getCmp(this.btnBackId).show(),Ext.getCmp(this.btnRegisterId).show(),Ext.getCmp(this.id+"accountId").reset(),Ext.getCmp(this.id+"accountName").reset(),Ext.getCmp(this.id+"accountName").show(),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),Ext.getCmp(this.id+"formPanel").setHeight(200),Ext.getCmp(this.id+"accountName").setFieldLabel("name",!1),Ext.getCmp(this.id+"accountId").setFieldLabel("account ID",!1),Ext.getCmp(this.fldEmailId).setFieldLabel("e-mail",!1),Ext.getCmp(this.fldNpass1Id).setFieldLabel("password",!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel("re-password",!1),Ext.getCmp(this.id+"accountId").setValue("")},LoginWidget.prototype.checkpass=function(){var a=Ext.getCmp(this.fldNpass1Id).getValue(),b=Ext.getCmp(this.fldNpass2Id).getValue(),c=new RegExp("[ *]");return!c.test(a)&&a.length>3?a==b?(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="ok">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="ok">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText("&nbsp;",!1),!0):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password does not match</span>',!1),!1):(Ext.getCmp(this.fldNpass1Id).setFieldLabel('<span class="err">password</span>',!1),Ext.getCmp(this.fldNpass2Id).setFieldLabel('<span class="err">re-password</span>',!1),Ext.getCmp(this.labelEmailId).setText('<span class="err">Password minimum length is 4</span>',!1),!1)},LoginWidget.prototype.anonymousSelected=function(a,b){b?Ext.getCmp(this.labelEmailId).setText('<span class="ok">Anonymous selected</span>',!1):Ext.getCmp(this.labelEmailId).setText('<span class="info">Type your account ID and password</span>',!1)},LoginWidget.prototype.checkemail=function(){Ext.getCmp(this.btnAnonymousId).reset();var a=Ext.getCmp(this.fldEmailId).getValue(),b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)?(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.fldEmailId).setFieldLabel('<span class="err">e-mail</span>',!1),!1)},LoginWidget.prototype.checkName=function(){var a=Ext.getCmp(this.id+"accountName").getValue();return""!=a&&null!=a?(Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="ok">name</span>',!1),!0):(Ext.getCmp(this.id+"accountName").setFieldLabel('<span class="err">name</span>',!1),!1)},LoginWidget.prototype.checkAccountId=function(){var a=Ext.getCmp(this.id+"accountId").getValue();return""!=a&&null!=a?(Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="ok">account ID</span>',!1),!0):(Ext.getCmp(this.id+"accountId").setFieldLabel('<span class="err">account ID</span>',!1),!1)},OpencgaBrowserWidget.prototype={id:"OpencgaBrowserWidget_"+Math.round(1e7*Math.random()),title:"Cloud data",onSelect:new Event(this),onNeedRefresh:new Event(this),width:800,height:375,rendered:!1,draw:function(a){this.render(a),this.rendered=!0},setAccountData:function(a){this.accountData=a,this.rendered&&this._updateFolderTree()},_updateFolderTree:function(){console.log("updating folder tree");var a=function(a,b){for(var c=0;c<b.length;c++)if(b[c].text==a)return c;return-1};if(null!=this.accountData&&null!=this.accountData.accountId){this.folderStore.getRootNode().removeAll(),this.allStore.getRootNode().removeAll(),this.filesStore.removeAll();for(var b=0;b<this.accountData.buckets.length;b++){for(var c=[],d=0;d<this.accountData.buckets[b].objects.length;d++){var e=this.accountData.buckets[b].objects[d];e.bucketId=this.accountData.buckets[b].id,null!=e.id&&(e.oid=e.id,delete e.id);var f=e.oid.split("/");"dir"==e.fileType?(e.expanded=!0,e.icon=Utils.images.dir):(e.leaf=!0,e.icon=Utils.images.r);for(var g=c,h=0;h<f.length;h++){var i=a(f[h],g);if(-1!=i)g=g[i].children;else{var j=[],k=g.push({text:f[h],children:j})-1;if("undefined"==typeof f[h+1])for(key in e)"children"!=key&&(g[k][key]=e[key]);g=j}}}c=JSON.stringify(c),this.allStore.getRootNode().appendChild({text:this.accountData.buckets[b].name,bucketId:this.accountData.buckets[b].name,oid:"",icon:Utils.images.bucket,expanded:!0,isBucket:!0,children:JSON.parse(c)}),this.folderStore.getRootNode().appendChild({text:this.accountData.buckets[b].name,bucketId:this.accountData.buckets[b].name,oid:"",icon:Utils.images.bucket,expanded:!0,isBucket:!0,children:JSON.parse(c)})}}if(this.folderStore.getRootNode().collapse(),this.folderStore.getRootNode().expand(),null!=this.selectedFolderNode){var l=this.folderTree.getRootNode().findChild(this.selectedFolderNode.field,this.selectedFolderNode.value,!0);null!=l&&this.folderTree.getSelectionModel().select(l)}if(null!=this.selectedFileNode){var m=this.filesGrid.getStore().findExact("oid",this.selectedFileNode.oid);-1!=m&&this.filesGrid.getSelectionModel().select(m)}},addUpload:function(a,b){var c=Ext.create("Ext.ProgressBar",{text:"Ready",width:250,margin:"4 6 0 6"}),d=Ext.create("Ext.Component",{html:a.name.substr(0,67),width:430,margin:"7 6 0 6"}),e=Ext.create("Ext.Button",{text:'<span style="color:#1155cc">Cancel</span>',margin:"3 6 0 4",width:50,handler:function(){b.terminate(),f.destroy()}}),f=Ext.create("Ext.container.Container",{padding:"3 6 0 6",layout:"hbox",items:[d,c,e]});b.onmessage=function(a){var b=a.data;console.log("@@@@@@@@@@@@@@@@ WORKER event message"),console.log(b),c.updateProgress((b.chunkId+1)/b.total,"uploading part "+(b.chunkId+1)+" of "+b.total,!1),1==b.finished&&e.setText('<span style="color:#1155cc">Done </span>')},this.activeUploadsCont.add(f),Ext.getCmp(this.id+"activeUploadsButton").toggle(!0)},viewBuckets:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.panAccordion),a.panel.add(a.filesGrid)},viewUploads:function(){var a=this;a.panel.removeAll(!1),a.panel.add(a.activeUploadsCont)}},OpencgaBrowserWidget.prototype.render=function(a){var b=this;if(null==this.panel){this.folderStore=Ext.create("Ext.data.TreeStore",{id:this.id+"folderStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:[]},listeners:{beforeappend:function(a,b){return b.isLeaf()?!1:void 0}}}),this.allStore=Ext.create("Ext.data.TreeStore",{id:this.id+"allStore",fields:["text","oid"],root:{expanded:!0,text:"Drive",children:[]}}),this.filesStore=Ext.create("Ext.data.Store",{fields:["oid","fileBioType","fileType","fileFormat","fileName","multiple","diskUsage","creationTime","responsible","organization","date","description","status","statusMessage","members"],data:[]});var c=Ext.create("Ext.Action",{icon:Utils.images.refresh,text:"Refresh bucket",handler:function(){var a=b.folderTree.getSelectionModel().getSelection()[0];if(a&&a.raw.isBucket){var c=new OpencgaManager;c.onRefreshBucket.addEventListener(function(a,c){Ext.example.msg("Refresh Bucket",'</span class="emph">'+c+"</span>"),-1!=c.indexOf("ERROR")?console.log(c):b.onNeedRefresh.notify()}),c.refreshBucket($.cookie("bioinfo_account"),a.raw.text,$.cookie("bioinfo_sid"))}}}),d=Ext.create("Ext.Action",{text:"Rename bucket",handler:function(){var a=b.folderTree.getSelectionModel().getSelection()[0];a&&a.raw.isBucket&&Ext.Msg.prompt("Rename bucket","Please enter a new name:",function(c,d){if("ok"==c){d=d.replace(/[^a-z0-9-_.\/\s]/gi,"").trim();var e=new OpencgaManager;e.onRenameBucket.addEventListener(function(a,c){Ext.example.msg("Refresh Bucket",'</span class="emph">'+c+"</span>"),-1!=c.indexOf("ERROR")?console.log(c):b.onNeedRefresh.notify()}),e.renameBucket($.cookie("bioinfo_account"),a.raw.bucketId,d,$.cookie("bioinfo_sid"))}},null,null,"new name")}});this.folderTree=Ext.create("Ext.tree.Panel",{id:this.id+"activeTracksTree",title:"Upload & Manage",bodyPadding:"5 0 0 0",margin:"-1 0 0 0",border:!1,autoScroll:!0,flex:4,useArrows:!0,rootVisible:!1,hideHeaders:!0,columns:[{xtype:"treecolumn",dataIndex:"text",flex:1,editor:{xtype:"textfield",allowBlank:!1}}],viewConfig:{markDirty:!1,plugins:{ptype:"treeviewdragdrop"},listeners:{drop:function(a,c){var d=c.records[0];if(d.isLeaf()&&d.data.index!=d.removedFrom&&d.data.checked){var e=d.data.trackId;b.setTrackIndex(e,d.data.index)}},itemcontextmenu:function(a,b,e,f,g){g.stopEvent();var h=[];if(console.log(b),b.raw.isBucket){h.push(c),h.push(d);var i=Ext.create("Ext.menu.Menu",{items:h});i.showAt(g.getXY())}return!1}}},listeners:{selectionchange:function(c,d){var e=d[0];if("undefined"!=typeof e){var f,g;null!=e.raw.isBucket?(f="text",g=!1):(f="oid",g=!0);var h=b.allStore.getRootNode().findChild(f,e.raw[f],g),i=[];b.selectedFolderNode={value:h.data[f],field:f},h.eachChild(function(a){i.push(a.raw)}),b.filesGrid.setTitle(h.getPath("text"," / ")),b.filesStore.loadData(i),"folderSelection"==a&&(b.selectedFileNode=h.raw,b.selectButton.enable())}},viewready:function(a){setTimeout(function(){var b=a.getRootNode().getChildAt(0);"undefined"!=typeof b&&a.getSelectionModel().select(b)},0)},checkchange:function(){},itemmouseenter:function(){},itemmouseleave:function(){}},store:this.folderStore});var e=Ext.create("Ext.button.Button",{text:"OK",handler:function(){b.createProject(),b.folderTree.toggleCollapse()}}),f=Ext.create("Ext.form.field.Text",{id:this.id+"newProjectNameField",emptyText:"name",allowBlank:!1}),g=Ext.create("Ext.form.field.TextArea",{id:this.id+"newProjectDescriptionField",emptyText:"description"});Ext.create("Ext.container.Container",{flex:1,layout:{type:"hbox",align:"stretch"},items:[f,g]});var h=Ext.create("Ext.panel.Panel",{title:"Create bucket",bodyPadding:5,border:!1,items:[f,g,e]}),i=Ext.create("Ext.Action",{icon:Utils.images.info,text:"Create index",handler:function(){var a=b.filesGrid.getSelectionModel().getSelection()[0];if(a){var c=new OpencgaManager;c.onIndexer.addEventListener(function(b,c){console.log(c),Ext.example.msg("indexer",c),a.raw.indexerId=c}),c.indexer($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),a.raw.bucketId,a.data.oid)}}}),j=Ext.create("Ext.Action",{text:"Show name",handler:function(){var a=b.filesGrid.getSelectionModel().getSelection()[0];a&&Ext.example.msg("objectId",""+a.get("oid"))}}),k=Ext.create("Ext.Action",{icon:Utils.images.del,text:"Delete this file",handler:function(){var a=b.filesGrid.getSelectionModel().getSelection()[0];a&&Ext.MessageBox.confirm("Confirm",'Are you sure you want to delete this file?<p class="emph">'+a.data.fileName+"<p>",function(c){if("yes"==c){console.log("deleting");var d=new OpencgaManager;d.onDeleteObjectFromBucket.addEventListener(function(c,d){-1!=d.indexOf("ERROR:")?Ext.example.msg("Deleting",d):(a.destroy(),b.onNeedRefresh.notify())}),d.deleteObjectFromBucket($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),a.raw.bucketId,a.data.oid)}})}});this.filesGrid=Ext.create("Ext.grid.Panel",{title:this.allStore.getRootNode().getPath("text"," / "),store:this.filesStore,flex:4,border:!1,viewConfig:{stripeRows:!0,listeners:{itemcontextmenu:function(a,b,c,d,e){e.stopEvent();var f=[j];console.log(b),("bam"==b.raw.fileFormat||"vcf"==b.raw.fileFormat)&&f.push(i),f.push(k);var g=Ext.create("Ext.menu.Menu",{items:f});return g.showAt(e.getXY()),!1}}},selModel:{mode:"SINGLE",listeners:{selectionchange:function(c,d){if(d.length>0){if(b.selectedFileNode=d[0].raw,"fileSelection"==a&&"dir"==d[0].raw.fileType)return;b.selectButton.enable()}else b.selectButton.disable()}}},columns:[{text:"File type",xtype:"actioncolumn",menuDisabled:!0,align:"center",width:54,icon:Utils.images.bluebox,renderer:function(a,b,c){this.icon=Utils.images[c.data.fileType],this.tooltip=c.data.fileType}},{text:"Name",dataIndex:"fileName",flex:2},{text:"Creation time",dataIndex:"creationTime",flex:1}]}),this.panAccordion=Ext.create("Ext.panel.Panel",{minWidth:125,minHeight:250,flex:1,cls:"panel-border-right",border:!1,layout:"accordion",items:[this.folderTree,h]}),this.selectButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){b.onSelect.notify({id:b.selectedFileNode.oid,bucketId:b.selectedFileNode.bucketId}),b.panel.close()}}),this.activeUploadsCont=Ext.create("Ext.container.Container",{autoScroll:!0,items:[]});var l={items:[]};switch(a){case"folderSelection":var m;m={text:"New folder",handler:function(){b.folderTree.expand(),b.createFolder()}},l.items.splice(0,0,m),m={text:"New bucket",handler:function(){h.expand()}},l.items.splice(0,0,m),this.filesStore.filter("fileType",/dir/);break;case"manager":var m;m={text:"Upload",handler:function(){b.drawUploadWidget()}},l.items.splice(0,0,m),m={text:"New folder",handler:function(){b.folderTree.expand(),b.createFolder()}},l.items.splice(0,0,m),m={text:"New bucket",handler:function(){h.expand()}},l.items.splice(0,0,m),this.selectButton.hide();break;default:var m;m={text:"Upload",handler:function(){b.drawUploadWidget()}},l.items.splice(0,0,m),m={text:"New folder",handler:function(){b.folderTree.expand(),b.createFolder()}},l.items.splice(0,0,m),m={text:"New bucket",handler:function(){h.expand()}},l.items.splice(0,0,m)}l.items.push({id:this.id+"activeUploadsButton",text:"Active uploads",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?b.viewUploads():b.viewBuckets()}}),this.panel=Ext.create("Ext.window.Window",{title:"Upload & Manage",resizable:!1,minimizable:!0,constrain:!0,closable:!1,modal:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},tbar:l,items:[this.panAccordion,this.filesGrid],buttonAlign:"right",buttons:[{text:"Close",handler:function(){b.onSelect=new Event,b.panel.hide()}},this.selectButton],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this._updateFolderTree(),this.panel.show()},OpencgaBrowserWidget.prototype.setFilter=function(){var a=this,b=this.viewOrigin.getSelectionModel().getSelection()[0],c=this.viewSuite.getSelectionModel().getSelection()[0];if(this.folderStore.clearFilter(),null!=b)switch(b.data.suiteId){case"all":break;case"Uploaded Data":this.folderStore.filter(function(a){return a.data.jobId<0});break;case"Job Generated":this.folderStore.filter(function(a){return a.data.jobId>0})}if(null!=c)switch(c.data.suiteId){case 1:break;default:this.folderStore.filter(function(a){return a.data.suiteId==c.data.suiteId})}this.folderStore.filter(function(b){var c=Ext.getCmp(a.searchFieldId).getValue().toLowerCase();return b.data.name.toLowerCase().indexOf(c)<0?!1:!0})},OpencgaBrowserWidget.prototype.checkTags=function(a){for(var b=0;b<this.tags.length;b++)if(this.tags[b].indexOf("|")>-1){for(var c=this.tags[b].split("|"),d=!1,e=0;e<c.length;e++)a.indexOf(c[e])>-1&&(d=!0);if(!d)return!1}else if(-1==a.indexOf(this.tags[b]))return!1;return!0},OpencgaBrowserWidget.prototype.createProject=function(){var a=this,b=Ext.getCmp(this.id+"newProjectNameField").getValue(),c=Ext.getCmp(this.id+"newProjectDescriptionField").getValue();""!=b&&(Ext.getBody().mask(),a.panel.setLoading("Creating project"),this.adapter.createBucket(b,c,$.cookie("bioinfo_account"),$.cookie("bioinfo_sid")))},OpencgaBrowserWidget.prototype._getFolderTreeSelection=function(){var a=this.folderTree.getSelectionModel().getSelection();if(a.length<1)return Ext.example.msg("No folder selected","Please select a bucket or a folder."),null;var b,c=a[0],d="";if(null!=c.raw.fileType&&"dir"==c.raw.fileType){var e=c.getPath("text","/").substr(1),f=e.split("/",2);d=e.replace(f.join("/"),"").substr(1)+"/",b=f[1]}else b=c.raw.text;return{bucketId:b,directory:d}},OpencgaBrowserWidget.prototype.drawUploadWidget=function(){var a=this,b=this._getFolderTreeSelection();null!=b&&a.uploadWidget.draw(b)},OpencgaBrowserWidget.prototype.createFolder=function(){var a=this;if(this.accountData.buckets.length<1)Ext.MessageBox.alert("No buckets found","Please create and select a bucket.");else{var b=this._getFolderTreeSelection();null!=b&&Ext.Msg.prompt("New folder","Please enter a name for the new folder:",function(c,d){if("ok"==c){d=d.replace(/[^a-z0-9-_.\s]/gi,""),d=d.trim()+"/";var e=new OpencgaManager;e.onCreateDirectory.addEventListener(function(b,c){Ext.example.msg("Create folder",'</span class="emph">'+c+"</span>"),-1!=c.indexOf("ERROR")?console.log(c):a.onNeedRefresh.notify()}),e.createDirectory($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.bucketId,b.directory+d)}},null,null,"New Folder")}},PagedViewListWidget.prototype.getData=function(){return this._data},PagedViewListWidget.prototype._setData=function(a){this._data=a},PagedViewListWidget.prototype.setFilter=function(a){this.store.clearFilter(),null!=a?(this.filterFunction=a,this.store.filter([a,this.textFilterFunction])):this.store.filter([this.textFilterFunction])},PagedViewListWidget.prototype.draw=function(a){this._setData(a),this.render(),this.store.loadData(this.getData()),null!=this.filterFunction&&this.setFilter(this.filterFunction)},PagedViewListWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel)},PagedViewListWidget.prototype.render=function(){var a=this;if(null==this.panel){this.tpl=new Ext.XTemplate(this.template),this.store=Ext.create("Ext.data.Store",{fields:this.storeFields,sorters:[{property:"date",direction:"DESC"}],autoLoad:!1});var b=null;if("view"==this.mode&&(this.view=Ext.create("Ext.view.View",{id:this.id+"view",padding:15,store:this.store,tpl:this.tpl,height:this.height,trackOver:!0,autoScroll:!0,overItemCls:"list-item-hover",itemSelector:".joblist-item",listeners:{scope:this,itemclick:function(a,b){console.log(b.data),this.onItemClick.notify(b)}}}),b=this.view),"grid"==this.mode){for(var c=[],d=0;d<this.storeFields.length;d++)c.push({header:this.storeFields[d],dataIndex:this.storeFields[d],flex:1});this.grid=Ext.create("Ext.grid.Panel",{store:this.store,columns:c,border:0}),b=this.grid}var e=Ext.create("Ext.form.field.Text",{id:this.id+"searchField",flex:1,margin:"0 1 0 0",emptyText:"enter search term",enableKeyEvents:!0,listeners:{change:function(){a.setFilter(null)}}});this.pagBar=Ext.create("Ext.toolbar.Toolbar",{id:this.pagbarId,style:"border: "+this.border,items:[{id:this.id+"btnSort",iconCls:"icon-order-desc",tooltip:"Change order",handler:function(){"DESC"==a.sort?(a.sort="ASC",a.store.sort("date","ASC"),this.setIconCls("icon-order-asc")):(a.sort="DESC",a.store.sort("date","DESC"),this.setIconCls("icon-order-desc"))}},e,{id:this.id+"btnClear",text:"X",margin:"0 2 0 0",tooltip:"Clear search box",handler:function(){e.reset()}}]}),this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,title:this.title,border:this.border,width:this.width,tbar:this.pagBar,items:[b]});var f=Ext.getCmp(this.targetId);f instanceof Ext.panel.Panel?f.insert(this.order,this.panel):this.panel.render(this.targetId)}},PagedViewListWidget.prototype.show=function(){null!=this.panel&&this.panel.show()},PagedViewListWidget.prototype.hide=function(){null!=this.panel&&this.panel.hide()},ProfileWidget.prototype={getOldPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldOld").getValue())},getNewPassword:function(){return $.sha1(Ext.getCmp(this.id+"fldNew1").getValue())},getLogin:function(){return Ext.getCmp(this.id+"fldEmail").getValue()},clearAllFields:function(){Ext.getCmp(this.id+"fldOld").setValue(null),Ext.getCmp(this.id+"fldNew1").setValue(null),Ext.getCmp(this.id+"fldNew2").setValue(null),Ext.getCmp(this.id+"fldEmail").setValue(null),Ext.getCmp(this.id+"labelPass").setText("&nbsp",!1)},changeEmail:function(){this.checkemail()&&(this.adapter.changeEmail($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.getLogin()),this.panel.setLoading("Waiting for the server to respond..."))},changePassword:function(){this.checkpass()&&(this.adapter.changePassword($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.getOldPassword(),this.getNewPassword(),this.getNewPassword()),this.panel.setLoading("Waiting for the server to respond..."))},draw:function(){this.render()},clean:function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))},render:function(){var a=this;if(null==this.panel){console.log(this.id+" CREATING PANEL");var b=Ext.create("Ext.toolbar.TextItem",{id:this.id+"labelPass",padding:3,text:"&nbsp"}),c=Ext.create("Ext.form.Panel",{title:"Change password",bodyPadding:15,width:350,height:155,border:!1,items:[{id:this.id+"fldOld",name:"password",xtype:"textfield",fieldLabel:"Old password",inputType:"password"},{id:this.id+"fldNew1",name:"new_password1",xtype:"textfield",fieldLabel:"New password",inputType:"password",listeners:{scope:this,change:this.checkpass}},{id:this.id+"fldNew2",name:"new_password2",xtype:"textfield",fieldLabel:"Confirm new",inputType:"password",listeners:{scope:this,change:this.checkpass}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){a.changePassword()}}]}),d=Ext.create("Ext.form.Panel",{title:"Change email",bodyPadding:15,width:350,height:155,border:!1,items:[{id:this.id+"fldEmail",name:"new_email",xtype:"textfield",fieldLabel:"e-mail",listeners:{change:function(){a.checkemail()
}}},{xtype:"button",text:"Change",margin:"0 0 0 105",handler:function(){a.changeEmail()}}]}),e=Ext.create("Ext.tab.Panel",{width:350,height:175,border:!1,bbar:{items:[b]},items:[c,d],listeners:{tabchange:function(){a.clearAllFields()}}});this.panel=Ext.create("Ext.window.Window",{title:"Profile",resizable:!1,minimizable:!0,constrain:!0,closable:!0,modal:!0,items:[e],buttonAlign:"center",buttons:[{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})}this.panel.show()},checkpass:function(){var a=Ext.getCmp(this.id+"fldNew1").getValue(),b=Ext.getCmp(this.id+"fldNew2").getValue(),c=Ext.getCmp(this.id+"fldOld").getValue(),d=new RegExp("[ *]");return""!=c?!d.test(a)&&a.length>3?a==b?(Ext.getCmp(this.id+"labelPass").setText('<p class="ok">Passwords match</p>',!1),!0):(Ext.getCmp(this.id+"labelPass").setText('<p class="err">Passwords does not match</p>',!1),!1):(Ext.getCmp(this.id+"labelPass").setText('<p class="err">Password must be at least 4 characters</p>',!1),!1):(Ext.getCmp(this.id+"labelPass").setText('<p class="err">Old password is empty</p>',!1),!1)},checkemail:function(){var a=Ext.getCmp(this.id+"fldEmail").getValue(),b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)?(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="ok">e-mail</span>',!1),!0):(Ext.getCmp(this.id+"fldEmail").setFieldLabel('<span class="err">e-mail</span>',!1),""==a&&Ext.getCmp(this.id+"fldEmail").setFieldLabel("e-mail",!1),!1)}},ResultTable.prototype.draw=function(){this.render()},ResultTable.prototype.render=function(){var a=this,b=null,c=new Array,d=new Array;this.tableSkel=this.tableLayout,this.colNames=this.tableSkel.colNames,this.colVisibilty=this.tableSkel.colVisibility,this.colTypes=this.tableSkel.colTypes,b=this.tableSkel.numRows,c=new Array,d=new Array;for(var e=0;e<this.colNames.length;e++)1==this.colVisibilty[e]&&(c.push({header:this.colNames[e],dataIndex:this.colNames[e],flex:1}),d.push({name:this.colNames[e],type:this.colTypes[e]}));if("text"==this.tableSkel.type){var f=new WumAdapter;f.onPoll.addEventListener(function(b,c){for(var d=a.parse(c),e=[],f=0;f<d.length;f++){var g=Ext.create("Ext.container.Container",{data:d[0],tpl:a.getTemplate(a.tableSkel.colNames)});e.push(g)}this.table=Ext.create("Ext.container.Container",{items:e,margin:"0 0 0 50",renderTo:a.targetId})}),f.poll(this.jobId,this.fileName,!1,$.cookie("bioinfo_sid"))}else{var g=this.adapter.tableurl($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.jobId,this.fileName,this.colNames,this.colVisibilty);console.log(g),null==b&&(b=this.numRows);var h=b;this.st=Ext.create("Ext.data.Store",{fields:d,pageSize:h,remoteSort:!0,proxy:{type:"jsonp",url:g,reader:{type:"json",root:"items",totalProperty:"total"}}}),this.st.loadPage(1);var i=75+22*h;this.table=Ext.create("Ext.grid.Panel",{title:this.fileName,collapsible:this.collapsible,flex:this.flex,store:this.st,border:this.border,cls:this.cls,columns:c,height:i,dockedItems:[{xtype:"pagingtoolbar",store:this.st,dock:"top",displayInfo:!0}],renderTo:this.targetId})}},ResultTable.prototype.parse=function(a){for(var b=this,c=a.split("\n"),d=[],e=0;e<c.length;e++)if("#"!=c[e].charAt(0)&&""!=c[e]){for(var f=c[e].split("	"),g={},h=0;h<f.length;h++)""!=f[h]&&(g[b.tableSkel.colNames[h].replace(/ /g,"_")]=f[h]);d.push(g)}return d},ResultTable.prototype.getTemplate=function(a){for(var b="<p>",c=0;c<a.length;c++)b+='<span class="dis s90">'+a[c]+" </span> {"+a[c].replace(/ /g,"_")+"} &nbsp; &nbsp; &nbsp;";return b+="</p>",new Ext.XTemplate(b)},ResultWidget.prototype.draw=function(a,b){this.record=b,this.jobId=this.record.data.id,this.id=this.jobId+this.id,this.panelId="ResultWidget_"+this.jobId,this.networkViewerId=this.panelId+"_CellBrowserId",this.genomeMapsId=this.panelId+"_GenomeMapsId",this.panel=Ext.getCmp(this.panelId),null==this.panel?(this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:this.record.data.name,closable:!0,autoScroll:!0}),Ext.getCmp(this.targetId).add(this.panel),Ext.getCmp(this.targetId).setActiveTab(this.panel),this.panel.setLoading("Loading job info..."),Ext.getBody().mask(),this.adapter.jobResult($.cookie("bioinfo_account"),a,this.jobId,"json")):Ext.getCmp(this.targetId).setActiveTab(this.panel)},ResultWidget.prototype.render=function(){var a=this;if(console.log(this.application),0!=this.data.outputItems.length){for(var b=this.data.inputItems.concat(this.data.outputItems),c={},d=0;d<b.length;d++){var e=b[d].group;if(""!=e)if(-1!=e.indexOf(".")){var f=e.split(".")[0],g=e.split(".")[1];null==c[f]&&(c[f]={}),null==c[f][g]&&(c[f][g]=[]),this.checkPValue(b[d].title)&&c[f][g].push(b[d])}else null==c[e]&&(c[e]={},c[e].items=[]),this.renamePValue(b[d]),c[e].items.push(b[d])}("renato"==this.application||"variant"==this.application)&&(c["Interactive Results"]={items:[]}),console.log(c);var h=Ext.create("Ext.container.Container",{html:'<a name="'+this.jobId+'top"></a>'}),i=Ext.create("Ext.container.Container",{margin:"15 0 5 15",html:'<p >The job named <span class="info">'+this.record.data.name+" </span>"+'was launched on <span class="err">'+this.record.data.date+" </span>"+"<br>"}),j=[],d=1;for(key in c){var k=this.jobId+key.replace(/\s/g,"_")+"group",l=Ext.create("Ext.container.Container",{padding:"0 0 2 15",width:14*key.length,groupId:k,html:'<span class="s110 emph">'+d+". "+key+"</span>",listeners:{afterrender:function(){this.getEl().addClsOnOver("ssel u"),this.getEl().addCls("dedo");var b=this.groupId;this.getEl().on("click",function(){var c=$("#"+b).position().top;$(a.panel.getEl().dom).children().scrollTop(c)})}}});j.push(l),d++}var d=1;for(key in c){var m=(this.jobId+key+"info").replace(/ /gi,""),k=this.jobId+key.replace(/\s/g,"_")+"group",l=Ext.create("Ext.container.Container",{infoId:m,groupName:key,padding:"60 15 5 15",html:'<p id="'+k+'" class="panel-border-bottom"><span class="s140 emph">'+d+". "+key+" &nbsp;&nbsp; &uarr;"+' </span><span class="info" id="'+m+'"></span></p>',listeners:{afterrender:function(){this.getEl().addClsOnOver("ssel"),this.getEl().addCls("dedo"),this.getEl().on("click",function(){$(a.panel.getEl().dom).children().scrollTop(0)});var b=a.getInfo(this.groupName);if(""!=b){$("#"+this.infoId).html("+info");var c=Ext.create("Ext.tip.Tip",{html:b,listeners:{show:function(){var a=this;this.getEl().on("mouseleave",function(){a.hide()})}}});$("#"+this.infoId).mouseover(function(a){$(this).css({cursor:"pointer"}),c.showAt(a.clientX,a.clientY)}),$("#"+this.infoId).click(function(){c.hide()})}}}});j.push(l),j.push(this.getResults(c[key].items));var n=1;for(clave in c[key])if("items"!=clave){var l=Ext.create("Ext.container.Container",{padding:"15 15 5 30",cls:"inlineblock",html:'<p class="panel-border-bottom s120 emph">'+d+"."+n+" "+clave+"</p>"});j.push(l),j.push(this.getResults(c[key][clave])),n++}d++}Ext.create("Ext.button.Button",{text:"Download",margin:"0 0 25 15",handler:function(){a.adapter.download(a.jobId,$.cookie("bioinfo_sid"))}}),Ext.create("Ext.button.Button",{text:"Delete",margin:"0 0 25 30",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(b){"yes"==b&&(a.adapter.onDeleteJob.addEventListener(function(b,c){var d="";-1!=c.response.indexOf("OK")?(Ext.getCmp(a.targetId).getActiveTab().close(),d="The job has been succesfully deleted."):d="ERROR: could not delete job.",Ext.Msg.alert("Delete job",d)}),a.adapter.deleteJob(a.jobId,$.cookie("bioinfo_sid")))})}}),this.panel.add(h),this.panel.add(i),this.panel.add(j),a.onViewRendered.notify()}},ResultWidget.prototype.getResults=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.showInfo(d);b.push(e);var f=this.showTypeInfo(d);f&&b.push(f);var f=this.showTagInfo(d);null!=f&&b.push(f)}var g=Ext.create("Ext.container.Container",{layout:{type:"table",columns:1,tableAttrs:{style:{width:"100%"}}},items:b});return g},ResultWidget.prototype.showInfo=function(a){var b=this,c=new Ext.XTemplate('<span class="key">{title} </span>','<span class="{[ this.setCSS(values) ]}">{value}</span><br>',{disableFormats:!0,setCSS:function(a){switch(a.type){case"FILE":return"file";case"MESSAGE":return"species"==a.name&&(b.species=a.value),"message"}}});return itemBox=Ext.create("Ext.container.Container",{data:a,datos:a,margin:"0 10 0 20",padding:5,tpl:c,cls:"inlineblock",listeners:{afterrender:function(){var a=this.datos;"FILE"==this.datos.type&&(this.getEl().addClsOnOver("encima"),this.getEl().addCls("whiteborder"),"variant"==b.application&&-1!=a.title.toLowerCase().indexOf("filter")&&(b.filteredVcfFile=a.value),this.getEl().on("click",function(){console.log(a);var c=a.value.trim();b.adapter.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,c,!0)}))}}})},ResultWidget.prototype.showTypeInfo=function(a){var b=this,c=Ext.create("Ext.container.Container",{margin:"0 10 0 10",padding:5});switch(a.type){case"IMAGE":var d=a.value.trim();return c.html='<div><img src="'+b.adapter.pollurl($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,d)+'"></div>',c;default:return null}},ResultWidget.prototype.showTagInfo=function(a){for(var b=this,c=Ext.create("Ext.container.Container",{margin:"0 10 0 10",flex:1,padding:5,html:""}),d=0;d<a.tags.length;d++)switch(a.tags[d]){case"TABLE":var e=a.value.trim(),f=b.jobId+e+a.tags;return b.resultTables[f]=new ResultTable(b.jobId,e,a.tags,{targetId:"resultTable_"+f}),c.html+='<div id="resultTable_'+f+'" style="padding:5px;"></div>',c;case"HISTOGRAM":var f="histogram_"+b.jobId+a.value+a.tags;return b.resultHistograms[f]=a.value,c.html='<div id="'+f+'" style="padding:5px;"></div>',c;case"GCHART":var f="gchart_"+a.name;return b.resultGCharts[f]=a.value,c.html='<div id="'+f+'"></div>',c;case"CONSEQUENCE_TYPE_VARIANTS":this.variantFiles[a.name]=a.title}return null},ResultWidget.prototype.drawTables=function(){for(id in this.resultTables)this.resultTables[id].draw()},ResultWidget.prototype.drawHistograms=function(){for(id in this.resultHistograms){var a=new OpencgaManager;a.onPoll.addEventListener(function(a,b){if(""!=b){for(var c=b.split("\n"),d=[],e=[],f=[],g=[],h=0,i=0;i<c.length;i++)d.push(c[i].split("	")),""!=d[i][0]&&e.push(d[i][0]),null!=d[i][1]&&(h+=parseFloat(d[i][1]),f.push(d[i][1]));for(var i=0;i<f.length;i++)g.push(Math.round(100*(parseFloat(f[i])/h)));e=e.toString().replace(/,/gi,"|");var j='<img src="https://chart.googleapis.com/chart?cht=p&chs=600x300&chd=t:'+g+"&chl="+e+'&chtt=Consequence+types&chts=000000,14.5">';document.getElementById(id).innerHTML=j}}),a.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),this.jobId,this.resultHistograms[id],!1)}},ResultWidget.prototype.drawGCharts=function(){for(id in this.resultGCharts)drawChart(id,this.resultGCharts[id])},ResultWidget.prototype.drawApplicationItems=function(){var a=this,b=Ext.create("Ext.container.Container",{id:this.application+this.id+"Container",border:!0,margin:"50 50 0 50",html:'<div class="greyborder" id="'+this.id+'Container"></div><div style="height:40px"></div>'});switch(this.application){case"variant":b.on("afterrender",function(){a.createGenomeViewer(a.id+"Container")});break;case"renato":var c=Ext.create("Ext.ProgressBar",{id:this.id+"pbar",margin:"5 0 0 50",width:500});c.wait({interval:500,duration:5e4,increment:15,text:"Getting database information and drawing the network, please wait...",scope:this,fn:function(){c.updateText("Done!")}}),this.panel.add(c),b.on("afterrender",function(){a.createCellBrowser(a.id+"Container")});break;default:return null}this.panel.add(b)},ResultWidget.prototype.createGenomeViewer=function(a){var b=this,c=Ext.getCmp(this.application+a).getWidth();Ext.getCmp(this.application+a).getHeight(),genomeViewer=new GenomeViewer(a,DEFAULT_SPECIES,{sidePanelCollapsed:!0,width:c-2,height:698}),genomeViewer.afterRender.addEventListener(function(){b.app.setTracks(genomeViewer),genomeViewer.addSidePanelItems(),new VariantFilterWidget(b.jobId,{width:c-2,targetId:b.application+a,viewer:genomeViewer,fileNames:b.variantFiles})}),genomeViewer.draw();var d=new OpencgaManager;d.onPoll.addEventListener(function(a,b){1!=b.indexOf("ERROR")&&console.error(b);var c=new VCFDataAdapter(new StringDataSource(b),{async:!1,species:genomeViewer.species}),d=new TrackData("VCF file",{adapter:c});genomeViewer.addTrack(d,{id:"VCF file",featuresRender:"MultiFeatureRender",histogramZoom:50,height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})}),null!=this.filteredVcfFile?d.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,this.filteredVcfFile,!1):console.log("No filtered VCF file.")};var mostSignificativesFeatures=new Array;ResultWidget.prototype.createCellBrowser=function(a){var b=this;record=this.record,Ext.getCmp(this.application+a).disable();var c=Ext.getCmp(this.application+a).getWidth(),d=Ext.getCmp(this.application+a).getHeight();this.networkViewer=new NetworkViewer(a,this.getSpeciesItem(this.species),{width:c-2,height:d-2}),this.networkViewer.draw();var e=new GraphDataset,f=new LayoutDataset,g=new NetworkDataSetFormatter({defaultFormat:{type:"LineEdgeNetworkFormatter",opacity:1,fill:"#000000",radius:"5",strokeWidth:"1",stroke:"#000000",size:"2",title:{fontSize:10,fill:"#000000"}},selected:{opacity:.9,fill:"#FF0000",radius:"5",stroke:"#000000",size:"2"},over:{opacity:1,fill:"#DF0101",radius:"5",stroke:"#000000",size:"2",strokeWidth:"1"}},{defaultFormat:{opacity:.8,stroke:"#000000",strokeWidth:"1",strokeOpacity:.5,title:{fontSize:6,fontColor:"#000000"}},selected:{stroke:"#DF0101",fill:"#FF0000"},over:{stroke:"#DF0101",strokeOpacity:1,strokeWidth:"4"}},{labeled:!1,backgroundColor:"#FFFFFF",balanceNodes:!1,nodesMaxSize:4,nodesMinSize:2});g.dataBind(e),f.dataBind(e),g.setHeight(d-140),g.setWidth(c-2-13),this.networkViewer.drawNetwork(e,g,f);var h=new WumRestAdapter;h.onPoll.addEventListener(function(c,d){for(var e=d.split("\n"),f=new Array,g=1;g<e.length;g++){var h=13;"fatiscan"==record.data.toolName&&7==e[g].split("	").length&&(h=6);var i=e[g].split("	")[h];1e6>i&&f.push(e[g].split("	")[0])}console.log("significativesFeatures.length: "+f.length);var j=new WumRestAdapter;j.onPoll.addEventListener(function(c,d){var e=d.split("\n");e.pop(),console.log("genes.length: "+e.length),b.loadNetworkOnCellBrowser(e,f,a)});var k="clean_list1.txt";"fatiscan"==record.data.toolName&&(k="id_list.txt"),j.poll(b.jobId,k,!1,$.cookie("bioinfo_sid"))}),h.poll(this.jobId,"significant_your_annotation_0.05.txt",!1,$.cookie("bioinfo_sid")),console.log("getting ranked_list...");var i=new WumRestAdapter;i.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top clean_list...");for(var f=0;50>e&&d>f;f++)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++);e=0,console.log("getting bottom clean_list...");for(var f=d-1;50>e&&f>0;f--)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++)}),i.poll(this.jobId,"clean_list1.txt",!1,$.cookie("bioinfo_sid")),console.log("getting ranked_list...");var j=new WumRestAdapter;j.onPoll.addEventListener(function(a,b){var c=b.split("\n"),d=c.length,e=0;console.log("getting top ranked_list...");for(var f=0;50>e&&d>f;f++)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++);e=0,console.log("getting bottom ranked_list...");for(var f=d-1;50>e&&f>0;f--)c[f].indexOf("#")<0&&(mostSignificativesFeatures[c[f].split("	")[0]]=!0,e++)}),j.poll(this.jobId,"ranked_list.txt",!1,$.cookie("bioinfo_sid"))},ResultWidget.prototype.loadNetworkOnCellBrowser=function(a,b,c){var d=this,e=0,f=new CellBaseManager(this.networkViewer.species);f.success.addEventListener(function(f,g){for(var h=g.result,i=new Object,j=0;j<h.length;j++)for(var k=0;k<h[j].length;k++)-1!=b.toString().indexOf(h[j][k].tfName)&&(null==i[h[j][k].tfName]&&(i[h[j][k].tfName]=new Object),null==i[h[j][k].tfName][a[j]]&&(i[h[j][k].tfName][a[j]]=!0));console.log(i),console.log(h.length),console.log("contando TFBSs...");var l=0;for(var m in i){if(l>500)break;for(var n in i[m])l++}console.log("menos de 500: "+l);for(var m in i){d.networkViewer.networkWidget.getDataset().addNode(m,{type:"tf"});var o=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1;d.networkViewer.networkWidget.getFormatter().getVertexById(o).getDefault().setFill("#DF0101");for(var n in i[m])if(500>l||1==mostSignificativesFeatures[n]){0==d.networkViewer.networkWidget.getDataset().getVertexByName(n).length&&d.networkViewer.networkWidget.getDataset().addNode(n,{type:"gene"});var p=d.networkViewer.networkWidget.getDataset().getVertexByName(n)[0].id,q=d.networkViewer.networkWidget.getDataset().getVertexByName(m)[0].id;d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+p+"_"+q,q,p),d.networkViewer.networkWidget.getFormatter().getVertexById(p).getDefault().setFill("#0000FF")}}d.networkViewer.networkWidget.getLayout().getLayout("neato"),d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(){e++,2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})}),a.length>0&&f.get("feature","gene",a,"tfbs");var g=new CellBaseManager(this.networkViewer.species);g.success.addEventListener(function(f,g){for(var h=g.result,i=new Object,j=0;j<h.length;j++)for(var k=0;k<h[j].length;k++)-1!=b.toString().indexOf(h[j][k].mirbaseId)&&(null==i[h[j][k].mirbaseId]&&(i[h[j][k].mirbaseId]=new Object),null==i[h[j][k].mirbaseId][a[j]]&&(i[h[j][k].mirbaseId][a[j]]=!0));console.log(i),console.log(h.length),console.log("contando miRNAs...");var l=0;for(var m in i){if(l>500)break;for(var n in i[m])l++}console.log("menos de 500: "+l);for(var o in i){d.networkViewer.networkWidget.getDataset().addNode(o,{type:"mirna"});var p=d.networkViewer.networkWidget.getDataset().getVerticesCount()-1;d.networkViewer.networkWidget.getFormatter().getVertexById(p).getDefault().setFill("red");for(var n in i[o])if(500>l||1==mostSignificativesFeatures[n]){0==d.networkViewer.networkWidget.getDataset().getVertexByName(n).length&&d.networkViewer.networkWidget.getDataset().addNode(n,{type:"gene"});var q=d.networkViewer.networkWidget.getDataset().getVertexByName(n)[0].id,r=d.networkViewer.networkWidget.getDataset().getVertexByName(o)[0].id;d.networkViewer.networkWidget.getDataset().addEdge("tfbs_"+q+"_"+r,r,q),d.networkViewer.networkWidget.getFormatter().getVertexById(q).getDefault().setFill("blue");var s=d.networkViewer.networkWidget.getDataset().getEdgesCount()-1;d.networkViewer.networkWidget.getFormatter().changeEdgeType(s,"CutDirectedLineEdgeNetworkFormatter")}}d.networkViewer.networkWidget.getLayout().getLayout("neato"),d.networkViewer.networkWidget.getLayout().layoutDone.addEventListener(function(){e++,2==e&&(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())})}),a.length>0?g.get("feature","gene",a,"mirna_target"):(Ext.getCmp(d.id+"pbar").destroy(),Ext.getCmp(d.application+c).enable())},ResultWidget.prototype.getGenomeViewerResultBar=function(a){var b=this;switch(this.application){case"variant":var c=Ext.create("Ext.container.Container",{cls:"bio-toolbar",defaults:{margin:"1 0 0 2"},layout:"vbox",height:27,items:[{xtype:"button",text:'<span class="info">Variant filter tool...</span>',handler:function(){new VariantFilterWidget(b.jobId,{viewer:a,fileNames:b.variantFiles})}}]});return c;default:return null}},ResultWidget.prototype.getSpeciesItem=function(a){for(var b=0;b<AVAILABLE_SPECIES.length;b++)if(AVAILABLE_SPECIES[b].species==a)return AVAILABLE_SPECIES[b]},ResultWidget.prototype.checkPValue=function(a){return-1!=a.indexOf("pvalue<0.005")||-1!=a.indexOf("pvalue<0.01")||-1!=a.indexOf("pvalue<0.1")?!1:!0},ResultWidget.prototype.renamePValue=function(a){-1!=a.value.indexOf("${pvalue}")&&(a.value=a.value.replace(/\$\{pvalue\}/gi,"0.05"))},ResultWidget.prototype.setPValue=function(a){console.log(this.id);var b="#pvalue"+this.id;$(b).html(a)},ResultWidget.prototype.getInfo=function(a){switch(this.application){case"renato":switch(a){case"Input data":return"This section is a reminder of the parameters or settings you have submitted to run the analysis.";case"Summary":return"<p>This section shows the number of genes annotated to each database in each list.</p><br><p>Gene list: contains three elements, the number of genes in your gene list annotated in the database over the total number of genes remaining in your gene list after the duplicates management, a percentage of genes in your gene list annotated in the database and the ratio of regulators per gene.<br> Genome: the same structure explained above but applied to the whole genome (TFBS or miRNA) or Your Annotations after the duplicates management.</p>";case"Significant Results":return"<p>We consider a significant enrichment after correcting the results by a multiple testing correction method. Enrichment p-values are corrected applying the False discovery rate (FDR) method (Benjamini et al., 1995; Storey andTibshirani, 2003). The threshold of signification applied to the correction has been set to 0.05.</p><br><p>The table provided summarizes the information about the enrichment test for each of the significant regulatory elements that have an Adjusted p-value < 0.05. The table is originally sorted by adjusted p-value and can be sorted up and down by clicking in any of the other column headings. When the number of significant results in a table is higher than five, results are split into different pages. You can move forward or backward in the page list using the arrow buttons.</p>";case"All results":return"This section contains a downloadable individual text file containing all results for all significant and not significant regulators. This file follows the same structure described above.";case"Annotation files":return"<p>When significant results are obtained, we can suppose that there is one or several regulatory elements behaving different when comparing groups. The list of genes included in the analysis have pointed to a significantly over-represented set of common regulators to these genes. The interpretation of the results will be different in the case of TFs (transcription factors) and miRNAs given that (generally) the first are positive regulators and the latter are negative regulators.</p><br><p>TFs generally bind to the promoter region of their target genes to assist and promote the transcription. miRNAs, on the other hand, bind to transcript products preventing them from being translated. Significant TF and miRNAs can be pointed to be responsible for the differential expression of the genes observed in the list. We must take special care in the interpretation of over-expressed or under-expressed genes in a functional analysis. In the case of TFs, if we are working with the list of over-expressed genes, the significant results makes reference to active TFs in one condition with respect to the other; while significant results of under-expressed genes makes reference to inactive TFs. In miRNAs, significant results of over-expressed genes will point to inactive miRNAs, while significant results of under-expressed genes will point to active miRNAs when comparing conditions.</p>";default:return""}break;case"variant":switch(a){case"Variants by Consequence Type":return"Click this link: <a class='ok' target='_blank' href='http://docs.bioinfo.cipf.es/projects/variant/wiki/Output_columns'>Output columns</a>";default:return""}break;default:return""}},ResultWidget.prototype={id:"ResultWidget"+Math.round(1e4*Math.random()),draw:function(a,b){var c=this;if(this.job=b.raw,this.jobId=this.job.id,this.id=this.jobId+this.id,this.panelId="ResultWidget_"+this.jobId,this.panel=Ext.getCmp(this.panelId),null==this.panel){this.panel=Ext.create("Ext.panel.Panel",{id:this.panelId,border:0,title:this.job.name,closable:!0,autoScroll:!0}),Ext.getCmp(this.targetId).add(this.panel),Ext.getCmp(this.targetId).setActiveTab(this.panel),this.panel.setLoading("Loading job info...");var d=this.adapter.jobResultUrl($.cookie("bioinfo_account"),a,this.jobId,"json");$.getScript(d,function(){c.panel.setLoading(!1);var a=RESULT[c.job.toolName].layout;a.outputItems=c.job.outputData.sort(a.sortOutputItems),c.render(RESULT)})}else Ext.getCmp(this.targetId).setActiveTab(this.panel)},render:function(a){var b=this;console.log(this.application);var c=function(){var a=new Ext.XTemplate('<p><span class="ssel border-bot s120">Information </span><span style="color:gray"> &nbsp; &nbsp; {id}</span></p><br>','<p><span class="emph">{name}</span> - <span class="info"> {toolName} </span> - <span style="color:orangered"> {date}</span></p>','<p class="tip emph">{description}</p>','<p class="">{[ this.getInfo(values) ]}</p>',{getInfo:function(a){switch(a.toolName){case"pathiways":var b=a.commandLine.split(/ --/g);console.log(b);var c=b[1].replace(/ /g,": ")+"<br>";return c+=b[2].replace(/ /g,": ")+"<br>",c+=b[3].replace(/ /g,": ").replace("/httpd/bioinfo/opencga/analysis/pathiways/examples/","").replace("/httpd/bioinfo/opencga/accounts/","")+"<br>",c+=b[4].replace(/ /g,": ")+"<br>",c+=b[5].replace(/ /g,": ")+"<br>",c+=b[6].replace(/ /g,": ").replace("/httpd/bioinfo/opencga/analysis/pathiways/examples/","").replace("/httpd/bioinfo/opencga/accounts/","")+"<br>",c+=b[7].replace(/ /g,": ")+"<br>",c+=b[10].replace(/ /g,": ")+"<br>",c+=b[12].replace(/ /g,": "),c+='<div style="width:400px">'+b[11].replace(/ /g,": ").replace(/,/g,", ")+"</div>";default:return""}}});return Ext.create("Ext.container.Container",{margin:"15 0 15 15",items:[{xtype:"box",data:b.job,tpl:a},{xtype:"container",layout:"hbox",margin:"10 0 0 0",defaults:{margin:"0 5 0 5"},items:[{xtype:"button",text:"download",handler:function(){b.adapter.downloadJob($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId)}},{xtype:"button",text:"delete",handler:function(){Ext.Msg.confirm("Delete job","Are you sure you want to delete this job?",function(a){"yes"==a&&(b.adapter.onDeleteJob.addEventListener(function(a,c){var d="";-1!=c.indexOf("OK")?(Ext.getCmp(b.targetId).getActiveTab().close(),d="The job has been succesfully deleted."):d="ERROR: could not delete job.",Ext.Msg.alert("Delete job",d)}),b.adapter.deleteJob($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId))})}}]}]})},d=function(a){for(var c=[{xtype:"box",cls:"inlineblock ssel border-bot s120",html:"Index",margin:15}],d=0;d<a.length;d++)c.push(Ext.create("Ext.Component",{margin:"0 15 0 15",cls:"dedo emph",overCls:"err",resultId:b.jobId+a[d].title.replace(/ /g,""),html:a[d].title,listeners:{afterrender:function(a){this.getEl().on("click",function(){var c=$("#"+a.resultId).position();if("undefined"!=typeof c){var d=c.top;$(b.panel.getEl().dom).children().scrollTop(d-10)}var e=Ext.getCmp(a.resultId),f=e.up();f.isXType("tabpanel")&&f.setActiveTab(e)})}}}));return Ext.create("Ext.container.Container",{margin:"0 0 20 0",items:c})},e=new Ext.XTemplate('<span class="s140 emph">{title}</span>','<span class="ok"> {pathi} </span>','<span class="info"> {date}</span><br>'),f=function(a){for(var c,d=[],e=0;e<a.renderers.length;e++){var f=a.renderers[e];switch(f.type){case"file":c=Ext.create("Ext.Component",{html:'<span class="key">'+a.title+'</span><span class="file">'+a.file+"</span>",item:a,padding:3,overCls:"encima",cls:"inlineblock whiteborder",listeners:{afterrender:function(){var a=this.item;this.getEl().on("click",function(){console.log(a),b.adapter.poll($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,a.file,!0)})}}});break;case"image":c=Ext.create("Ext.Component",{html:'<div><img src="'+b.adapter.pollurl($.cookie("bioinfo_account"),$.cookie("bioinfo_sid"),b.jobId,a.file)+'"></div>'});break;case"grid":var g="resultTable_"+b.jobId+a.file,h=new ResultTable(b.jobId,a.file,a.tags,{targetId:g,tableLayout:f.tableLayout});c=Ext.create("Ext.Component",{flex:1,resultTable:h,html:'<div id="'+g+'" style="padding:5px;"> </div>',listeners:{afterrender:function(a){a.resultTable.draw()}}})}d.push(c)}return Ext.create("Ext.container.Container",{title:a.title,margin:"0 0 15 0",items:d})},g=function(a,c){var d;if("undefined"!=typeof a.children){"function"==typeof a.children&&(a.children=a.children()),d=[];for(var h=0;h<a.children.length;h++)d.push(g(a.children[h]));if(1==c){var i={xtype:"container",items:d};return"tabs"==a.presentation&&(i={xtype:"tabpanel",padding:"0 30 15 15",plain:!0,border:0,defaults:{overflowX:"scroll",height:2e3,padding:10},items:d}),Ext.create("Ext.container.Container",{title:a.title,items:[{xtype:"box",cls:"inlineblock ssel border-bot s120",margin:"15",html:"Details"},i]})}return Ext.create("Ext.container.Container",{id:b.jobId+a.title.replace(/ /g,""),title:a.title,margin:"0 0 0 10",items:[{xtype:"box",overCls:"dedo",cls:"panel-border-bottom",margin:"0 0 10 0",data:a,tpl:e,listeners:{afterrender:function(){this.getEl().on("click",function(){$(b.panel.getEl().dom).children().scrollTop(0)})}}},{xtype:"container",items:d}]})}return f(a)},h=g(a[this.job.toolName].layout,!0),i=d(a[this.job.toolName].layout.children);this.panel.add(c()),this.panel.insert(i),this.panel.add(h)}},UploadWidget.prototype={getTypeValidation:function(a){return function(b){var c=new RegExp("^.*\\.("+a+")$","i");return c.test(b)}}},UploadWidget.prototype.draw=function(a){this.opencgaLocation=a;var b={};switch(b["9"]=[{text:"ID List",children:[{text:"SNP",tag:"idlist:snp"},{text:"Gene/Transcript",tag:"idlist:gene:transcript"}]},{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf",validate:this.getTypeValidation("vcf")},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"},{text:"BAM",tag:"bam",validate:this.getTypeValidation("bam")},{text:"BAI",tag:"bai",validate:this.getTypeValidation("bai")},{text:"Expression",tag:"expression"}]}],b["6"]=[{text:"Feature",children:[{text:"VCF 4.0",tag:"vcf"},{text:"GFF2",tag:"gff2"},{text:"GFF3",tag:"gff3"},{text:"GTF",tag:"gtf"},{text:"BED",tag:"bed"}]}],b["11"]=[{text:"Annotation",tag:"annotation"},{text:"ID List",children:[{text:"Gene",tag:"idlist:gene"},{text:"Ranked",tag:"ranked"}]}],b["12"]=[{text:"Abundances",tag:"abundances"}],b["100"]=[{text:"Sequence",tag:"sequence"}],b["22"]=[{text:"Tabbed text file",tag:"txt",validate:this.getTypeValidation("txt|text")},{text:"CEL compressed file",tag:"cel",validate:this.getTypeValidation("zip|tar|tar.gz|tgz")}],this.suiteId){case 9:this.checkDataTypes(b["9"]),this.render(b["9"]);break;case 6:this.checkDataTypes(b["6"]),this.render(b["6"]);break;case 11:this.checkDataTypes(b["11"]),this.render(b["11"]);break;case 12:this.checkDataTypes(b["12"]),this.render(b["12"]);break;case 22:this.checkDataTypes(b["22"]),this.render(b["22"]);break;case 100:this.checkDataTypes(b["100"]),this.render(b["100"]);break;case-1:break;default:this.render([{text:"No data types defined"}])}},UploadWidget.prototype.clean=function(){null!=this.panel&&(this.panel.destroy(),delete this.panel,console.log(this.id+" PANEL DELETED"))},UploadWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)},UploadWidget.prototype.render=function(a){var b=this;if(null==this.panel){var c=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Data type",children:a}}),d=23*Object.keys(c.tree.nodeHash).length;250>d&&(d=250);var e=250,f=Ext.create("Ext.tree.Panel",{title:"Select your data type",bodyPadding:10,height:d,border:!1,cls:"panel-border-right",width:e,store:c,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,b){b.data.leaf?(this.selectedDataType=b.raw.tag,this.selectedDataTypeObj=b.raw,this.dataTypeLabel.setText('<span class="info">Type:</span><span class="ok"> OK </span>',!1)):(this.selectedDataType=null,this.selectedDataTypeObj=null,this.dataTypeLabel.setText('<span class="info">Select a data type</span><span class="err"> !!!</span>',!1)),this.validate()}}});this.nameField=Ext.create("Ext.form.field.Text",{name:"datalabel",fieldLabel:"Data name",labelWidth:110,msgTarget:"side",enableKeyEvents:!0,listeners:{scope:this,change:function(a){""!=a.getValue()?this.dataNameLabel.setText('<span class="info">Name:</span><span class="ok"> OK </span>',!1):this.dataNameLabel.setText('<span class="info">Enter the data name</span><span class="err"> !!!</span>',!1),this.validate()
}}}),this.textArea=Ext.create("Ext.form.field.TextArea",{name:"datadescription",fieldLabel:"Data description",labelWidth:110,msgTarget:"side"}),this.organizationField=Ext.create("Ext.form.field.Text",{name:"organization",fieldLabel:"Organization",labelWidth:110,msgTarget:"side"}),this.responsableField=Ext.create("Ext.form.field.Text",{name:"responsable",fieldLabel:"Responsible",labelWidth:110,msgTarget:"side"}),this.acquisitiondate=Ext.create("Ext.form.field.Text",{name:"acquisitiondate",fieldLabel:"Acquisition date",labelWidth:110,msgTarget:"side"});var g=350,h=Ext.create("Ext.panel.Panel",{title:"Some aditional data",width:g,border:!1,height:d,bodyPadding:15,items:[this.nameField,this.textArea,this.organizationField,this.responsableField,this.acquisitiondate]});this.dataTypeLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data type</span>'}),this.dataNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Enter the data name</span>'}),this.dataFieldLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="info">Select a data file</span>'}),this.originCheck=Ext.create("Ext.form.field.Checkbox",{xtype:"checkbox",margin:"0 0 5 5",boxLabel:"Text mode",listeners:{scope:this,change:function(){this.originCheck.getValue()?(this.dataFieldLabel.setText('<span class="ok">'+this.editor.getValue().length+'</span><span class="info"> chars</span>',!1),this.uploadBar.hide(),this.editor.show(),this.uploadField.destroy(),this.uploadField.setRawValue(null)):(this.dataFieldLabel.setText('<span class="info">Select a data file</span>',!1),this.editor.hide(),this.uploadBar.show(),this.editor.setRawValue(null),this.createUploadField()),this.validate()}}});var i=Ext.create("Ext.button.Button",{id:this.uploadButtonId,text:"Upload",disabled:!0,handler:function(){b.uploadFile2()}});this.editor=Ext.create("Ext.form.field.TextArea",{xtype:"textarea",width:602,flex:1,height:100,emptyText:"Paste or write your file directly",hidden:!0,name:"file",margin:"-1",enableKeyEvents:!0,listeners:{scope:this,change:function(){this.dataFieldLabel.setText('<span class="ok">'+this.editor.getValue().length+'</span> <span class="info"> chars</span>',!1),this.validate()}}}),this.uploadBar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"}),this.createUploadField(),this.modebar=Ext.create("Ext.toolbar.Toolbar",{dock:"top",height:28,border:!1,items:[this.originCheck,"->",this.dataTypeLabel,"-",this.dataFieldLabel]});var j=Ext.create("Ext.panel.Panel",{title:"File origin",colspan:2,border:!1,width:e+g,cls:"panel-border-top",items:[this.uploadBar,this.editor],bbar:this.modebar});this.panel=Ext.create("Ext.window.Window",{title:'Upload a data file -  <span class="err">ZIP files will be allowed shortly</span>',iconCls:"icon-upload",resizable:!1,constrain:!0,closable:!1,modal:!0,layout:{type:"table",columns:2,rows:2},items:[f,h,j],buttonAlign:"right",buttons:[{text:"Close",handler:function(){b.panel.destroy()}},i],listeners:{scope:this,minimize:function(){this.panel.destroy()},destroy:function(){delete this.panel}}})}this.panel.show()},UploadWidget.prototype.createUploadField=function(){this.uploadField=Ext.create("Ext.form.field.File",{id:this.uploadFieldId,xtype:"filefield",name:"file",flex:1,padding:1,msgTarget:"side",emptyText:"Choose a file",allowBlank:!1,anchor:"100%",buttonText:"Open file...",listeners:{scope:this,change:function(){this.fileSelected(),this.validate()}}}),this.uploadBar.add(this.uploadField)},UploadWidget.prototype.validate=function(){var a=!0;null!=this.selectedDataTypeObj.validate&&(a=this.selectedDataTypeObj.validate(Ext.getCmp(this.uploadFieldId).getValue())),!a||null==this.selectedDataType||""==this.uploadField.getRawValue()&&""==this.editor.getValue()?(Ext.getCmp(this.uploadButtonId).disable(),this.dataTypeLabel.setText('<span class="info">Type:</span><span class="err"> Not valid </span>',!1)):(Ext.getCmp(this.uploadButtonId).enable(),this.dataTypeLabel.setText('<span class="info">Type:</span><span class="ok"> OK </span>',!1))},UploadWidget.prototype.fileSelected=function(){var a=this.uploadField.fileInputEl.id,b=document.getElementById(a).files[0];if(b){var c=0;c=b.size>1048576?(Math.round(100*b.size/1048576)/100).toString()+"MB":(Math.round(100*b.size/1024)/100).toString()+"KB",this.dataFieldLabel.setText('<span class="info">Size: </span><span class="ok">'+c+"</span>",!1)}},UploadWidget.prototype.uploadFile=function(){Ext.getBody().mask("Uploading file..."),this.panel.disable();var a=new FormData,b=null;if(this.originCheck.getValue())b=this.nameField.getValue(),a.append("file",this.editor.getValue());else{var c=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0];b=c.name,a.append("file",c)}var d=$.cookie("bioinfo_sid"),e=this.opencgaLocation.directory+b;e=e.replace(new RegExp("/","gi"),":"),a.append("name",this.nameField.getValue()),a.append("fileFormat",this.selectedDataType),a.append("responsible",this.responsableField.getValue()),a.append("organization",this.organizationField.getValue()),a.append("date",this.acquisitiondate.getValue()),a.append("description",this.textArea.getValue()),a.append("objectid",e),a.append("sessionid",d),this.objectID=this.opencgaLocation.bucketId+":"+e,this.adapter.uploadObjectToBucket($.cookie("bioinfo_account"),d,this.opencgaLocation.bucketId,e,a)},UploadWidget.prototype.uploadFile2=function(){var a=document.getElementById(Ext.getCmp(this.uploadFieldId).fileInputEl.id).files[0],b=this.opencgaLocation.directory+a.name;b=b.replace(new RegExp("/","gi"),":");var c=new Worker(UPLOAD_WORKER);this.opencgaBrowserWidget.addUpload(a,c),c.postMessage({host:OPENCGA_HOST,accountId:$.cookie("bioinfo_account"),sessionId:$.cookie("bioinfo_sid"),file:a,objectId:b,fileFormat:this.selectedDataType,bucketId:this.opencgaLocation.bucketId,resume:!0}),this.panel.close()},UploadWidget.prototype.uploadComplete=function(a){var b="Uploaded sucessfully";-1!=a.indexOf("ERROR")&&(b=a),Ext.Msg.show({title:"Upload status",msg:b}),this.panel.enable(),Ext.getBody().unmask(),"Uploaded sucessfully"==b&&this.panel.close()},UploadWidget.prototype.uploadFailed=function(a){console.log(a),Ext.Msg.show({title:"Upload status",msg:"There was an error attempting to upload the file."}),this.panel.enable(),Ext.getBody().unmask()},UploadWidget.prototype.uploadCanceled=function(a){console.log(a),Ext.Msg.show({title:"Upload status",msg:"The upload has been canceled by the user or the browser dropped the connection."}),this.panel.enable(),Ext.getBody().unmask()};